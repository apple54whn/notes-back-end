(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{604:function(s,e,a){s.exports=a.p+"assets/img/image-20210331002702476.f5b89a33.png"},760:function(s,e,a){"use strict";a.r(e);var t=a(11),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群"}},[s._v("#")]),s._v(" 集群")]),s._v(" "),t("h2",{attrs:{id:"业务发展过程中遇到的峰值瓶颈"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#业务发展过程中遇到的峰值瓶颈"}},[s._v("#")]),s._v(" 业务发展过程中遇到的峰值瓶颈")]),s._v(" "),t("ul",[t("li",[s._v("Redis 提供的服务 "),t("strong",[s._v("OPS")]),s._v(" 可以达到"),t("strong",[s._v("10万/秒")]),s._v("，当前业务 OPS 已经达到20万/秒")]),s._v(" "),t("li",[s._v("内存单机容量达到256G，当前业务需求内存容量1T。但内存也没有那么多")])]),s._v(" "),t("h2",{attrs:{id:"集群-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群-2"}},[s._v("#")]),s._v(" 集群")]),s._v(" "),t("h3",{attrs:{id:"简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),t("p",[s._v("集群就是使用网络将"),t("strong",[s._v("若干台计算机联通")]),s._v("起来，并提供统一的管理方式，使其"),t("strong",[s._v("对外呈现单机")]),s._v("的服务效果。")]),s._v(" "),t("p",[s._v("Redis 集群是 3.0 版本引入的，在 5.0 后搭建更方便！")]),s._v(" "),t("h3",{attrs:{id:"作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#作用"}},[s._v("#")]),s._v(" 作用")]),s._v(" "),t("ul",[t("li",[s._v("分散单台服务器的"),t("strong",[s._v("访问压力")]),s._v("，实现"),t("strong",[s._v("负载均衡")])]),s._v(" "),t("li",[s._v("分散单台服务器的"),t("strong",[s._v("存储压力")]),s._v("，实现"),t("strong",[s._v("可扩展性")])]),s._v(" "),t("li",[s._v("降低单台服务器"),t("strong",[s._v("宕机带来的业务灾难")])])]),s._v(" "),t("h2",{attrs:{id:"架构设计-🔥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#架构设计-🔥"}},[s._v("#")]),s._v(" 架构设计 🔥")]),s._v(" "),t("h3",{attrs:{id:"数据存储设计-数据分片"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据存储设计-数据分片"}},[s._v("#")]),s._v(" 数据存储设计—数据分片")]),s._v(" "),t("ul",[t("li",[s._v("Redis 集群将整个"),t("strong",[s._v("数据库空间")]),s._v("划分为"),t("strong",[s._v("16384个槽")]),s._v("来实现"),t("strong",[s._v("数据分片")]),s._v("。集群中各个 master 负责处理一部分的槽。每份槽代表的是"),t("strong",[s._v("一个存储空间")]),s._v("，"),t("strong",[s._v("不是一个key的保存空间")])]),s._v(" "),t("li",[s._v("通过算法设计，计算出key应该保存的位置")]),s._v(" "),t("li",[s._v("将key按照计算出的结果放到对应的存储空间")]),s._v(" "),t("li",[t("strong",[s._v("集群添加节点时")]),s._v("，会"),t("strong",[s._v("将相应的槽以及槽中存储的数据迁移至新节点")]),s._v("！且都是"),t("strong",[s._v("在线")]),s._v("进行！"),t("strong",[s._v("无需停机")]),s._v("！")])]),s._v(" "),t("h3",{attrs:{id:"集群内部通讯设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群内部通讯设计"}},[s._v("#")]),s._v(" 集群内部通讯设计")]),s._v(" "),t("ul",[t("li",[s._v("各个数据库相互通信，保存各个库中"),t("strong",[s._v("槽的编号数据")])]),s._v(" "),t("li",[t("strong",[s._v("一次命中，直接返回")])]),s._v(" "),t("li",[t("strong",[s._v("一次未命中，告知具体位置")]),s._v("。然后"),t("strong",[s._v("客户端")]),s._v("访问**重定向（redirect）**的位置！")]),s._v(" "),t("li",[s._v("Redis 集群采用"),t("strong",[s._v("无代理模式")]),s._v("，客户端的命令直接交由节点执行！对于优化过的集群客户端来说，大部分情况下命令不需要实施转向或仅需要一次转向")])]),s._v(" "),t("h3",{attrs:{id:"主从复制、sentinel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主从复制、sentinel"}},[s._v("#")]),s._v(" 主从复制、Sentinel")]),s._v(" "),t("p",[s._v("Redis 集群也提供了与单机版 Redis 服务器一样的"),t("strong",[s._v("主从复制")]),s._v("功能；")]),s._v(" "),t("p",[s._v("还提供了类似于单机版 "),t("strong",[s._v("Sentinel")]),s._v(" 的功能！当集群中的某个 master 下线时，会提升该节点的 slave 为新 master 继续提供服务")]),s._v(" "),t("h2",{attrs:{id:"搭建方式1-集群自动搭建程序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搭建方式1-集群自动搭建程序"}},[s._v("#")]),s._v(" 搭建方式1—集群自动搭建程序")]),s._v(" "),t("h3",{attrs:{id:"帮助"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#帮助"}},[s._v("#")]),s._v(" 帮助")]),s._v(" "),t("p",[s._v("在 utils/create-cluster/create-cluster 位置的 create-cluster 程序专门用来快速构建起一个完整可用的集群以供用户测试。")]),s._v(" "),t("p",[t("code",[s._v("./create-cluster help")]),s._v("可以查看用法")]),s._v(" "),t("p",[s._v("创建一个群集，请按照以下步骤进行：")]),s._v(" "),t("ol",[t("li",[s._v("编辑create-cluster，并更改开始/结束端口，这取决于要创建的实例数量。")]),s._v(" "),t("li",[s._v('使用"./creat-cluster start "来运行实例。')]),s._v(" "),t("li",[s._v('使用"./create-cluster create "来执行redis-cli --cluster create，这样将会创建一个Redis集群。(如果您通过本地容器访问您的设置，请确保CLUSTER_HOST值被更改为您的本地IP)')]),s._v(" "),t("li",[s._v("现在你已经准备好玩集群了。每个实例的AOF文件和日志会创建在在当前目录下。")])]),s._v(" "),t("p",[s._v("停止一个集群：")]),s._v(" "),t("ol",[t("li",[s._v('使用"./cake-cluster stop "来停止所有实例。在你停止实例后，如果你改变主意，你可以使用"./cake-cluster start "来重新启动它们。')]),s._v(" "),t("li",[s._v('使用"./creat-cluster clean "删除所有AOF/日志文件，以干净的环境重新启动。')])]),s._v(" "),t("h3",{attrs:{id:"创建集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建集群"}},[s._v("#")]),s._v(" 创建集群")]),s._v(" "),t("p",[s._v("通过执行start命令来创建出6个节点，这6个节点的IP地址都为本机，而端口号则为30001～30006")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ubuntu@VM-0-3-ubuntu:/usr/local/redis-6.2.1/utils/create-cluster$ sudo ./create-cluster start\nStarting 30001\nStarting 30002\nStarting 30003\nStarting 30004\nStarting 30005\nStarting 30006\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("使用create命令，把上述6个节点组合成一个集群，其中包含3个主节点和3个从节点")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ubuntu@VM-0-3-ubuntu:/usr/local/redis-6.2.1/utils/create-cluster$ sudo ./create-cluster create\n>>> Performing hash slots allocation on 6 nodes...\nMaster[0] -> Slots 0 - 5460\nMaster[1] -> Slots 5461 - 10922\nMaster[2] -> Slots 10923 - 16383\nAdding replica 127.0.0.1:30005 to 127.0.0.1:30001\nAdding replica 127.0.0.1:30006 to 127.0.0.1:30002\nAdding replica 127.0.0.1:30004 to 127.0.0.1:30003\n>>> Trying to optimize slaves allocation for anti-affinity\n[WARNING] Some slaves are in the same host as their master\nM: 01577c26ceb76eec6716563170826517f321d968 127.0.0.1:30001\n   slots:[0-5460] (5461 slots) master\nM: 97fd26fcdc24382afe81b8d0c45f514ecb67a2f8 127.0.0.1:30002\n   slots:[5461-10922] (5462 slots) master\nM: 81c5a05a97fe697e834e388ce318f3bb2b6155cd 127.0.0.1:30003\n   slots:[10923-16383] (5461 slots) master\nS: 7162dc4ebcb149b140639da0f229363276416a32 127.0.0.1:30004\n   replicates 01577c26ceb76eec6716563170826517f321d968\nS: e71361e154517888a63470b56343e16a88f91c6e 127.0.0.1:30005\n   replicates 97fd26fcdc24382afe81b8d0c45f514ecb67a2f8\nS: 3947e6ab1101ad12c8ddd18157edb7848712aa4a 127.0.0.1:30006\n   replicates 81c5a05a97fe697e834e388ce318f3bb2b6155cd\nCan I set the above configuration? (type 'yes' to accept): yes\n>>> Nodes configuration updated\n>>> Assign a different config epoch to each node\n>>> Sending CLUSTER MEET messages to join the cluster\nWaiting for the cluster to join\n\n>>> Performing Cluster Check (using node 127.0.0.1:30001)\nM: 01577c26ceb76eec6716563170826517f321d968 127.0.0.1:30001\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\nS: 7162dc4ebcb149b140639da0f229363276416a32 127.0.0.1:30004\n   slots: (0 slots) slave\n   replicates 01577c26ceb76eec6716563170826517f321d968\nS: 3947e6ab1101ad12c8ddd18157edb7848712aa4a 127.0.0.1:30006\n   slots: (0 slots) slave\n   replicates 81c5a05a97fe697e834e388ce318f3bb2b6155cd\nM: 81c5a05a97fe697e834e388ce318f3bb2b6155cd 127.0.0.1:30003\n   slots:[10923-16383] (5461 slots) master\n   1 additional replica(s)\nM: 97fd26fcdc24382afe81b8d0c45f514ecb67a2f8 127.0.0.1:30002\n   slots:[5461-10922] (5462 slots) master\n   1 additional replica(s)\nS: e71361e154517888a63470b56343e16a88f91c6e 127.0.0.1:30005\n   slots: (0 slots) slave\n   replicates 97fd26fcdc24382afe81b8d0c45f514ecb67a2f8\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br")])]),t("p",[s._v("create命令会根据现有的节点制定出一个相应的角色和槽分配计划，然后询问你的意见。以上面打印出的计划为例：")]),s._v(" "),t("ul",[t("li",[s._v("节点30001、30002和30003将被设置为主节点，并且分别负责槽0～5460、槽5461～10922和槽10923～16383。")]),s._v(" "),t("li",[s._v("节点30004、30005和30006分别被设置为以上3个主节点的从节点。")])]),s._v(" "),t("p",[s._v("搭建完成后的集群：")]),s._v(" "),t("img",{staticStyle:{zoom:"33%"},attrs:{src:a(604),alt:"image-20210331002702476"}}),s._v(" "),t("h2",{attrs:{id:"搭建方式2-配置文件手动搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搭建方式2-配置文件手动搭建"}},[s._v("#")]),s._v(" 搭建方式2—配置文件手动搭建")]),s._v(" "),t("h3",{attrs:{id:"方式1问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方式1问题"}},[s._v("#")]),s._v(" 方式1问题")]),s._v(" "),t("p",[s._v("使用create-cluster程序快速搭建Redis集群虽然非常方便，但是由于该程序搭建的Redis集群"),t("strong",[s._v("不具备配置文件")]),s._v("、"),t("strong",[s._v("主从节点数量固定")]),s._v("以及"),t("strong",[s._v("槽分配模式固定")]),s._v("等原因，这些快速搭建的集群通常"),t("strong",[s._v("只能够用于测试")]),s._v("，但是无法应用在实际的生产环境中")]),s._v(" "),t("p",[s._v("搭建真正能够在生产环境中使用的Redis集群，我们需要创建相应的配置文件，并使用集群管理命令对集群进行配置和管理")]),s._v(" "),t("h3",{attrs:{id:"创建集群-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建集群-2"}},[s._v("#")]),s._v(" 创建集群")]),s._v(" "),t("p",[s._v("为了保证集群的各项功能可以正常运转，一个集群至少需要3个主节点和3个从节点。不过为了与之前使用create-cluster程序搭建的集群区别开来，这次我们将搭建一个由5个主节点和5个从节点组成的Redis集群。")]),s._v(" "),t("p",[s._v("我们需要先创建出10个文件夹，用于存放相应节点的数据以及配置文件")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ubuntu@VM-0-3-ubuntu:/usr/local/redis-6.2.1/utils/create-cluster$ sudo mkdir my-cluster\nubuntu@VM-0-3-ubuntu:/usr/local/redis-6.2.1/utils/create-cluster$ cd my-cluster/\nubuntu@VM-0-3-ubuntu:/usr/local/redis-6.2.1/utils/create-cluster/my-cluster$ sudo mkdir node1 node2 node3 node4 node5 node6 node7 node8 node9 node10\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("接着，我们需要在每个节点文件夹中创建一个包含以下内容的"),t("code",[s._v("redis.conf")]),s._v("配置文件")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cluster-enabled yes\nport 30001\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("cluster-enabled选项的值为yes表示将Redis实例设置成集群节点而不是单机服务器")]),s._v(" "),t("li",[s._v("port选项则用于为每个节点设置不同的端口号。本例中，我们为10个节点分别设置了从30001～30010的端口号")])]),s._v(" "),t("p",[s._v("在为每个节点都设置好相应的配置文件之后，我们需要通过以下命令（目录自己调整），陆续启动各个文件夹中的集群节点：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ubuntu@VM-0-3-ubuntu:/usr/local/redis-6.2.1$ src/redis-server /node1/redis.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("连接这10个集群节点并为它们分配槽：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ubuntu@VM-0-3-ubuntu:/usr/local/redis-6.2.1$ src/redis-cli --cluster create \n127.0.0.1:30001\n127.0.0.1:30002\n127.0.0.1:30003\n127.0.0.1:30004\n127.0.0.1:30005\n127.0.0.1:30006\n127.0.0.1:30007\n127.0.0.1:30008\n127.0.0.1:30009\n127.0.0.1:30010\n-- cluster-replicas 1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("ul",[t("li",[s._v("redis-cli --cluster是Redis客户端附带的集群管理工具，它的create子命令"),t("strong",[s._v("接受任意多个节点的IP地址和端口号")]),s._v("作为参数，然后使用这些节点组建起一个Redis集群。")]),s._v(" "),t("li",[s._v("cluster-replicas用于指定集群中"),t("strong",[s._v("每个主节点的从节点数量")]),s._v("。在上面的命令调用中，该参数的值为1，这表示我们想要"),t("strong",[s._v("为每个主节点设置一个从节点")])])]),s._v(" "),t("p",[s._v("执行完上述命令后，会定制出节点角色、槽分配计划等（略）")]),s._v(" "),t("h2",{attrs:{id:"连接集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#连接集群"}},[s._v("#")]),s._v(" 连接集群")]),s._v(" "),t("h3",{attrs:{id:"redis-cli"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-cli"}},[s._v("#")]),s._v(" redis-cli")]),s._v(" "),t("p",[s._v("使用Redis附带的redis-cli客户端，"),t("code",[s._v("-c")]),s._v("用于"),t("strong",[s._v("连接集群")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ubuntu@VM-0-3-ubuntu:/usr/local/redis-6.2.1$ src/redis-cli -c -p 30001\n127.0.0.1:30001>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"常用配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用配置"}},[s._v("#")]),s._v(" 常用配置")]),s._v(" "),t("p",[s._v("添加节点🔥")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cluster-enabled yes|no\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("cluster配置文件名，该文件属于自动生成，仅用于快速查找文件并查询文件内容")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cluster-config-file <filename>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("节点服务响应超时时间，用于判定该节点是否下线或切换为从节点🔥")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cluster-node-timeout <milliseconds>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("master连接的slave最小数量")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cluster-migration-barrier <count>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),t("p",[s._v("redis-cli 常用命令：")]),s._v(" "),t("p",[s._v("查看集群节点信息🔥")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cluster nodes\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("进入一个从节点 redis，切换其主节点")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cluster replicate <master-id>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("发现一个新节点，新增主节点")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cluster meet ip:port\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("忽略一个没有solt的节点")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cluster forget <id>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("手动故障转移")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cluster failover\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])}),[],!1,null,null,null);e.default=n.exports}}]);