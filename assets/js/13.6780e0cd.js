(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{348:function(s,a,t){s.exports=t.p+"assets/img/image-20210224235606470.17dd20f5.png"},349:function(s,a,t){s.exports=t.p+"assets/img/image-20210224235537410.0f0a063c.png"},543:function(s,a,t){s.exports=t.p+"assets/img/image-20210224235839218.5d86bcd3.png"},544:function(s,a,t){s.exports=t.p+"assets/img/image-20210225000228111.50aa7103.png"},545:function(s,a,t){s.exports=t.p+"assets/img/image-20210302235202668.3f5e47b0.png"},546:function(s,a,t){s.exports=t.p+"assets/img/image-20210302233910017.e204de82.png"},547:function(s,a,t){s.exports=t.p+"assets/img/image-20210225002811887.cdddc9ab.png"},743:function(s,a,t){"use strict";t.r(a);var e=t(11),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"hash"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hash"}},[s._v("#")]),s._v(" hash")]),s._v(" "),e("h2",{attrs:{id:"string-类型存储困惑"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#string-类型存储困惑"}},[s._v("#")]),s._v(" string 类型存储困惑")]),s._v(" "),e("p",[s._v("例如新浪微博大V主页显示粉丝数与微博数量。解决如下：")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("在redis中为大V用户设定用户信息，"),e("strong",[s._v("以用户主键和属性值作为key")]),s._v("，后台设定定时刷新策略即可")]),s._v(" "),e("p",[e("img",{attrs:{src:t(348),alt:"image-20210224235606470"}})]),s._v(" "),e("p",[s._v("缺点就是"),e("strong",[s._v("太分散了")])])]),s._v(" "),e("li",[e("p",[s._v("在redis中"),e("strong",[s._v("以json格式")]),s._v("存储大V用户信息，定时刷新")]),s._v(" "),e("p",[e("img",{attrs:{src:t(349),alt:"image-20210224235537410"}})]),s._v(" "),e("p",[s._v("缺点就是频繁"),e("strong",[s._v("更新太麻烦了")])])]),s._v(" "),e("li",[e("p",[s._v("可以使用如下类型")]),s._v(" "),e("p",[e("img",{attrs:{src:t(543),alt:"image-20210224235839218"}})])])]),s._v(" "),e("h2",{attrs:{id:"hash-介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hash-介绍"}},[s._v("#")]),s._v(" hash 介绍")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("新的存储需求：对一系列存储的数据进行编组，方便管理，典型应用存储对象信息")])]),s._v(" "),e("li",[e("p",[s._v("需要的存储结构：一个存储空间保存多个键值对数据")])]),s._v(" "),e("li",[e("p",[s._v("hash 类型："),e("strong",[s._v("底层使用哈希表")]),s._v("结构实现数据存储")])]),s._v(" "),e("li",[e("p",[s._v("hash存储结构优化")]),s._v(" "),e("ul",[e("li",[s._v("如果"),e("strong",[s._v("field数量较少")]),s._v("，存储结构优化为"),e("strong",[s._v("类数组")]),s._v("结构")]),s._v(" "),e("li",[s._v("如果"),e("strong",[s._v("field数量较多")]),s._v("，存储结构使用"),e("strong",[s._v("HashMap结构")])])])]),s._v(" "),e("li",[e("p",[e("strong",[s._v("hash类型下的value只能存储字符串！")]),s._v("，不允许存储其他数据类型，不存在嵌套现象。如果数据未获取到， 对应的值为("),e("strong",[s._v("nil")]),s._v(")")])]),s._v(" "),e("li",[e("p",[s._v("每个 hash 可以存储 23^2 - 1 个键值对")])]),s._v(" "),e("li",[e("p",[e("strong",[s._v("hash类型十分贴近对象的数据存储形式")]),s._v("，并且可以"),e("strong",[s._v("灵活添加删除对象属性")]),s._v("。但hash设计"),e("strong",[s._v("初衷不是为了存储大量对象而设计")]),s._v("的，切记"),e("strong",[s._v("不可滥用")]),s._v("，更不可以将hash作为对象列表使用")])]),s._v(" "),e("li",[e("p",[e("strong",[s._v("hgetall 操作可以获取全部属性")]),s._v("，如果内部field过多，遍历整体数据效率就很会低，有"),e("strong",[s._v("可能成为数据访问瓶颈")])])]),s._v(" "),e("li",[e("p",[s._v("string存储对象（json）与hash存储对象")]),s._v(" "),e("ul",[e("li",[s._v("string存储对象，当做整体。"),e("strong",[s._v("读为主")])]),s._v(" "),e("li",[s._v("hash存储对象，"),e("strong",[s._v("修改为主")]),s._v("。也可以里面存储string")])])])]),s._v(" "),e("p",[e("img",{attrs:{src:t(544),alt:"image-20210225000228111"}})]),s._v(" "),e("h2",{attrs:{id:"🔥hset-为字段设置值"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#🔥hset-为字段设置值"}},[s._v("#")]),s._v(" 🔥HSET 为字段设置值")]),s._v(" "),e("p",[s._v("根据给定的字段是否已经存在于散列中，HSET命令的行为也会有所不同：")]),s._v(" "),e("ul",[e("li",[s._v("如果给定字段并不存在于散列当中，那么这次设置就是一次创建操作，命令将在散列里面关联起给定的字段和值，然后返回1。")]),s._v(" "),e("li",[s._v("如果给定的字段原本已经存在于散列里面，那么这次设置就是一次更新操作，命令将使用用户给定的新值去覆盖字段原有的旧值，然后返回0。")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("hset key field value\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("实例")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" hset user name conan\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" hset user age "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h2",{attrs:{id:"🔥hsetnx-只在字段不存在的情况下为它设置值"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#🔥hsetnx-只在字段不存在的情况下为它设置值"}},[s._v("#")]),s._v(" 🔥HSETNX 只在字段不存在的情况下为它设置值")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("hsetnx key field value\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("在字段不存在并且成功为它设置值时返回1")]),s._v(" "),e("li",[s._v("在字段已经存在并导致设置操作未能成功执行时返回0。")])]),s._v(" "),e("h2",{attrs:{id:"🔥hget"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#🔥hget"}},[s._v("#")]),s._v(" 🔥HGET")]),s._v(" "),e("p",[s._v("获取数据命令：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("hget key field\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("实例")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" hget user name\n"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"conan"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"🔥hincrby-hincrbyfloat"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#🔥hincrby-hincrbyfloat"}},[s._v("#")]),s._v(" 🔥HINCRBY / HINCRBYFLOAT")]),s._v(" "),e("p",[s._v("设置指定字段的"),e("strong",[s._v("数值数据增加指定范围的值（可负数）")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("hincrby key field increment \nhincrbyfloat key field increment\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"hstrlena-获取字段值的字节长度"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hstrlena-获取字段值的字节长度"}},[s._v("#")]),s._v(" HSTRLENA 获取字段值的字节长度")]),s._v(" "),e("h2",{attrs:{id:"hexists❗️检查字段是否存在"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hexists❗️检查字段是否存在"}},[s._v("#")]),s._v(" HEXISTS❗️检查字段是否存在")]),s._v(" "),e("p",[s._v("获取哈希表中是否存在指定的字段")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("hexists key field\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("尽量不要用，应在业务逻辑层做判断，redis 只做数据的存改")]),s._v(" "),e("h2",{attrs:{id:"🔥hdel-del-删除字段-键"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#🔥hdel-del-删除字段-键"}},[s._v("#")]),s._v(" 🔥HDEL/DEL 删除字段/键")]),s._v(" "),e("p",[s._v("删除数据字段、key命令：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("hdel key field1 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("field2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndel key\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("实例")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" hdel user name\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" hdel user name age\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" --上面已经删了 name 所以这次只删了一个\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" hgetall user\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("empty array"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" hget user name\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nil"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n-- 假设已经添加了值\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" del user\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" hgetall user\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("empty array"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("h2",{attrs:{id:"🔥hlen-获取散列包含的字段数量"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#🔥hlen-获取散列包含的字段数量"}},[s._v("#")]),s._v(" 🔥HLEN 获取散列包含的字段数量")]),s._v(" "),e("p",[s._v("用户可以通过使用HLEN命令获取给定散列包含的"),e("strong",[s._v("字段数量")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("HLEN key\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"hmset-一次为多个字段设置值"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hmset-一次为多个字段设置值"}},[s._v("#")]),s._v(" HMSET 一次为多个字段设置值")]),s._v(" "),e("p",[s._v("添加/修改多个数据。有则改，没则加")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("hmset key field1 value1 field2 value2 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("HMSET命令在设置成功时返回OK")]),s._v(" "),e("h2",{attrs:{id:"hmget-一次获取多个字段的值"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hmget-一次获取多个字段的值"}},[s._v("#")]),s._v(" HMGET 一次获取多个字段的值")]),s._v(" "),e("p",[s._v("获取多个数据")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("hmget key field1 field2 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"🔥hkeys、hvals、hgetall-获取所有字段、所有值、所有字段和值"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#🔥hkeys、hvals、hgetall-获取所有字段、所有值、所有字段和值"}},[s._v("#")]),s._v(" 🔥HKEYS、HVALS、HGETALL 获取所有字段、所有值、所有字段和值")]),s._v(" "),e("p",[s._v("注意，是无序的，不应有侥幸心里")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("hkeys key \nhvals key\nHGETALL KEY\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("实例")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" hmset user name conan age "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("\nOK\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" hkeys user\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" hvals user\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"conan"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"18"')]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" hgetall user\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"conan"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"18"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("h2",{attrs:{id:""}},[e("a",{staticClass:"header-anchor",attrs:{href:"#"}},[s._v("#")]),s._v(" ====================")]),s._v(" "),e("h2",{attrs:{id:"🔥【比较】string-vs-hash"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#🔥【比较】string-vs-hash"}},[s._v("#")]),s._v(" 🔥【比较】string vs hash")]),s._v(" "),e("h3",{attrs:{id:"hash-优点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hash-优点"}},[s._v("#")]),s._v(" hash 优点")]),s._v(" "),e("ul",[e("li",[e("p",[e("strong",[s._v("散列的最大优势，就是它只需要在数据库里面创建一个键，就可以把任意多的字段和值存储到散列里面")]),s._v("。相反，因为每个字符串键只能存储一个键值对，所以如果用户要使用字符串键去存储多个数据项，就只能在数据库中创建多个字符串键。")]),s._v(" "),e("p",[s._v("数据库键数量增多带来的问题主要和资源有关：")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("为了对数据库以及数据库键的使用情况进行统计，Redis会为每个数据库键存储一些额外的信息，并因此带来一些额外的内存消耗。对于单个数据库键来说，这些额外的内存消耗几乎可以忽略不计，但是当数据库键的数量达到上百万、上千万甚至更多的时候，这些额外的内存消耗就会变得比较可观。")])]),s._v(" "),e("li",[e("p",[s._v("当散列包含的字段数量比较少的时候，Redis就会使用特殊的内存优化结构去存储散列中的字段和值。与字符串键相比，这种内存优化结构存储相同数据所需要的内存要少得多。使用内存优化结构的散列越多，内存优化结构的效果也就越明显。在一定条件下，对于相同的数据，使用散列键进行存储比使用字符串键存储要节约一半以上的内存，有时候甚至会更多。")])]),s._v(" "),e("li",[e("p",[s._v("除了需要耗费更多内存之外，更多的数据库键也需要占用更多的CPU。每当Redis需要对数据库中的键进行处理时，数据库包含的键越多，进行处理所需的CPU资源就会越多，处理所耗费的时间也会越长，典型的情况包括：")]),s._v(" "),e("ul",[e("li",[s._v("统计数据库和数据库键的使用情况。")]),s._v(" "),e("li",[s._v("对数据库执行持久化操作，或者根据持久化文件还原数据库。")]),s._v(" "),e("li",[s._v("通过模式匹配在数据库中查找某个键，或者执行类似的查找操作")])])])]),s._v(" "),e("p",[s._v("这些操作的执行时间都会受到数据库键数量的影响。")])]),s._v(" "),e("li",[e("p",[s._v("除了资源方面的优势之外，散列键还可以"),e("strong",[s._v("有效地组织起相关的多项数据，让程序产生更容易理解的数据")]),s._v("，使得针对数据的批量操作变得更方便。")])])]),s._v(" "),e("h3",{attrs:{id:"string-优点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#string-优点"}},[s._v("#")]),s._v(" string 优点")]),s._v(" "),e("ul",[e("li",[s._v("虽然散列键命令和字符串键命令在部分功能上有重合的地方，但是"),e("strong",[s._v("字符串键命令提供的操作比散列键命令更为丰富")]),s._v("。比如，字符串能够使用SETRANGE命令和GETRANGE命令设置或者读取字符串值的其中一部分，或者使用APPEND命令将新内容追加到字符串值的末尾，而散列键并不支持这些操作。")]),s._v(" "),e("li",[e("strong",[s._v("Redis的键过期功能")]),s._v("，这一功能可以在指定时间到达时，自动删除指定的键。因为"),e("strong",[s._v("键过期功能针对的是整个键")]),s._v("，用户"),e("strong",[s._v("无法为散列中的不同字段设置不同的过期时间")]),s._v("，所以当一个散列键过期的时候，它包含的所有字段和值都将被删除。与此相反，如果用户使用字符串键存储信息项，就不会遇到这样的问题——用户可以为每个字符串键分别设置不同的过期时间，让它们根据实际的需要自动被删除。")])]),s._v(" "),e("h3",{attrs:{id:"字符串键和散列键的选择"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#字符串键和散列键的选择"}},[s._v("#")]),s._v(" 字符串键和散列键的选择")]),s._v(" "),e("p",[e("img",{attrs:{src:t(545),alt:"image-20210302235202668"}})]),s._v(" "),e("ul",[e("li",[s._v("如果程序需要为每个数据项"),e("strong",[s._v("单独设置过期时间")]),s._v("，那么使用"),e("strong",[s._v("字符串")]),s._v("键。")]),s._v(" "),e("li",[s._v("如果程序需要对数据项执行诸如"),e("strong",[s._v("SETRANGE、GETRANGE或者APPEND等操")]),s._v("作，那么"),e("strong",[s._v("优先考虑使用字符串键")]),s._v("。当然，用户也可以选择把数据存储在散列中，然后将类似SETRANGE、GETRANGE这样的操作交给客户端执行。")]),s._v(" "),e("li",[s._v("如果程序需要"),e("strong",[s._v("存储的数据项比较多")]),s._v("，并且希望尽可能地"),e("strong",[s._v("减少存储数据所需的内存")]),s._v("，就应优先考虑使用"),e("strong",[s._v("散列键")]),s._v("。")]),s._v(" "),e("li",[s._v("如果"),e("strong",[s._v("多个数据项在逻辑上属于同一组或者同一类")]),s._v("，那么应该"),e("strong",[s._v("优先考虑使用散列键")]),s._v("。")])]),s._v(" "),e("h2",{attrs:{id:"🔥【场景】使用散列键重新实现计数器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#🔥【场景】使用散列键重新实现计数器"}},[s._v("#")]),s._v(" 🔥【场景】使用散列键重新实现计数器")]),s._v(" "),e("p",[s._v("略")]),s._v(" "),e("h2",{attrs:{id:"🔥【场景】实现短网址生成程序"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#🔥【场景】实现短网址生成程序"}},[s._v("#")]),s._v(" 🔥【场景】实现短网址生成程序")]),s._v(" "),e("p",[s._v("创建短网址本质上就是要创建出短网址ID与目标网址之间的映射，并在用户访问短网址时，根据短网址的ID从映射记录中找出与之相对应的目标网址。比如微博的短网址程序就将短网址http://t.cn/RqRRZ8n中的ID值RqRRZ8n映射到了http://redisdoc.com/geo/index.html这个网址上面，当用户访问短网址http://t.cn/RqRRZ8n时，程序就会根据这个短网址的ID值RqRRZ8n找出与之对应的目标网址http://redisdoc.com/geo/index.html，并将用户引导至目标网址上面去")]),s._v(" "),e("p",[s._v("因为Redis的散列非常适合用来存储短网址ID与目标网址之间的映射，所以我们可以基于Redis的散列实现")]),s._v(" "),e("h2",{attrs:{id:"🔥【场景】实现用户登录会话"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#🔥【场景】实现用户登录会话"}},[s._v("#")]),s._v(" 🔥【场景】实现用户登录会话")]),s._v(" "),e("p",[s._v("为了方便用户，网站一般都会为已登录的用户生成一个加密令牌，然后把这个令牌分别存储在服务器端和客户端，之后每当用户再次访问该网站的时候，网站就可以通过验证客户端提交的令牌来确认用户的身份，从而使得用户不必重复地执行登录操作。")]),s._v(" "),e("p",[s._v("另外，为了防止用户因为长时间不输入密码而遗忘密码，以及为了保证令牌的安全性，网站一般都会为令牌设置一个过期期限（比如一个月），当期限到达之后，用户的会话就会过时，而网站则会要求用户重新登录。")]),s._v(" "),e("p",[s._v("上面描述的这种使用令牌来避免重复登录的机制一般称为登录会话（login session），通过使用Redis的散列")]),s._v(" "),e("h2",{attrs:{id:"🔥【场景】存储图数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#🔥【场景】存储图数据"}},[s._v("#")]),s._v(" 🔥【场景】存储图数据")]),s._v(" "),e("p",[s._v("在构建地图应用、设计电路图、进行任务调度、分析网络流量等多种任务中，都需要对图（graph）数据结构实施建模，并存储相关的图数据。对于不少数据库来说，想要高效、直观地存储图数据并不是一件容易的事情，但是Redis却能够以多种不同的方式表示图数据结构，其中一种方式就是使用散列。")]),s._v(" "),e("p",[s._v("例如，假设我们想要存储图3-20所示的带权重有向图，那么可以创建一个图3-21所示的散列键，这个散列键会以start_vertex->end_vertex的形式将各个顶点之间的边存储到散列的字段中，并将字段的值设置成边的权重。通过这种方法，我们可以将图的相关数据全部存储到散列中")]),s._v(" "),e("p",[s._v("适合用来存储节点较多但边较少的稀疏图（sparsegraph）")]),s._v(" "),e("img",{staticStyle:{zoom:"33%"},attrs:{src:t(546),alt:"image-20210302233910017"}}),s._v(" "),e("h2",{attrs:{id:"🔥【场景】使用散列键重新实现文章存储程序"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#🔥【场景】使用散列键重新实现文章存储程序"}},[s._v("#")]),s._v(" 🔥【场景】使用散列键重新实现文章存储程序")]),s._v(" "),e("p",[s._v("略")]),s._v(" "),e("h2",{attrs:{id:"🔥【场景】电商网站购物车设计与实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#🔥【场景】电商网站购物车设计与实现"}},[s._v("#")]),s._v(" 🔥【场景】电商网站购物车设计与实现")]),s._v(" "),e("h3",{attrs:{id:"业务分析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#业务分析"}},[s._v("#")]),s._v(" 业务分析")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("仅分析购物车的redis存储模型")]),s._v(" "),e("ul",[e("li",[s._v("添加、浏览、更改数量、删除、清空")])])]),s._v(" "),e("li",[e("p",[s._v("购物车于数据库间持久化同步(不讨论)")])]),s._v(" "),e("li",[e("p",[s._v("购物车于订单间关系(不讨论)")]),s._v(" "),e("ul",[e("li",[s._v("提交购物车:读取数据生成订单")]),s._v(" "),e("li",[s._v("商家临时价格调整:隶属于订单级别")])])]),s._v(" "),e("li",[e("p",[s._v("未登录用户购物车信息存储(不讨论)")]),s._v(" "),e("ul",[e("li",[s._v("cookie存储")]),s._v(" "),e("li",[s._v("手机端使用 localstorage？")])])])]),s._v(" "),e("p",[e("img",{attrs:{src:t(547),alt:"image-20210225002811887"}})]),s._v(" "),e("h3",{attrs:{id:"解决方案"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[s._v("#")]),s._v(" 解决方案")]),s._v(" "),e("ul",[e("li",[s._v("以客户id作为key，每位客户创建一个hash存储结构存储对应的购物车信息")]),s._v(" "),e("li",[s._v("将商品编号作为field，购买数量作为value进行存储")]),s._v(" "),e("li",[s._v("添加商品:追加全新的field与value")]),s._v(" "),e("li",[s._v("浏览:遍历hash")]),s._v(" "),e("li",[s._v("更改数量:自增/自减，设置value值")]),s._v(" "),e("li",[s._v("删除商品:删除field")]),s._v(" "),e("li",[s._v("清空:删除key")])]),s._v(" "),e("h3",{attrs:{id:"当前设计是否加速了购物车的呈现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#当前设计是否加速了购物车的呈现"}},[s._v("#")]),s._v(" 当前设计是否加速了购物车的呈现")]),s._v(" "),e("p",[s._v("当前仅仅是将数据存储到了redis中，并没有起到加速的作用，商品信息还需要二次查询数据库")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("每条购物车中的商品记录保存成两条field")])]),s._v(" "),e("li",[e("p",[s._v("field1专用于保存"),e("strong",[s._v("购买数量")])]),s._v(" "),e("ul",[e("li",[s._v("命名格式：商品id:nums")]),s._v(" "),e("li",[s._v("保存数据：数值")])])]),s._v(" "),e("li",[e("p",[s._v("field2专用于保存购物车中显示的"),e("strong",[s._v("信息")]),s._v("，包含文字描述，图片地址，所属商家信息等")]),s._v(" "),e("ul",[e("li",[s._v("命名格式：商品id:info")]),s._v(" "),e("li",[s._v("保存数据："),e("strong",[s._v("json")])])])])]),s._v(" "),e("h2",{attrs:{id:"🔥【场景】限量抢购"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#🔥【场景】限量抢购"}},[s._v("#")]),s._v(" 🔥【场景】限量抢购")]),s._v(" "),e("h3",{attrs:{id:"业务分析-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#业务分析-2"}},[s._v("#")]),s._v(" 业务分析")]),s._v(" "),e("p",[s._v("双11活动日，销售手机充值卡的商家对移动、联通、电信的30元、50元、100元商品推出抢购活动，每种商品抢购上限1000张")]),s._v(" "),e("h3",{attrs:{id:"解决方案-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解决方案-2"}},[s._v("#")]),s._v(" 解决方案")]),s._v(" "),e("ul",[e("li",[s._v("以商家id作为key")]),s._v(" "),e("li",[s._v("将参与抢购的商品id（三大运营商之类的）作为field")]),s._v(" "),e("li",[s._v("将参与抢购的商品数量作为对应的value")]),s._v(" "),e("li",[s._v("抢购时使用"),e("strong",[s._v("降值")]),s._v("的方式控制产品数量")]),s._v(" "),e("li",[s._v("实际业务中还有超卖等实际问题，这里不做讨论")])])])}),[],!1,null,null,null);a.default=r.exports}}]);