---
title: JPAç¤ºä¾‹
date: 2020-12-16 01:28:30
permalink: /pages/5ad3bf/
categories:
  - Spring
  - SpringDataJPA
tags:
  - 
---
# CRUD æ¡ˆä¾‹

## å¸¸ç”¨æ³¨è§£ ğŸ”¥

### `@Entity` ğŸ”¥

ä½œç”¨ï¼šæŒ‡å®šå½“å‰ç±»æ˜¯**å®ä½“ç±»**ã€‚

### `@Table` ğŸ”¥

ä½œç”¨ï¼šæŒ‡å®š**å®ä½“ç±»å’Œè¡¨ä¹‹é—´çš„å¯¹åº”å…³ç³»**ã€‚

å±æ€§ï¼š

- `name`ï¼šæŒ‡å®šæ•°æ®åº“**è¡¨çš„åç§°**ï¼Œä¸æŒ‡å®šåˆ™ä¸ºç±»åé¦–å­—æ¯å°å†™ï¼Œè‹¥æ˜¯**å¤šä¸ªå•è¯åˆ™é»˜è®¤å˜ä¸ºä¸‹åˆ’çº¿è¿æ¥**

### `@Id` ğŸ”¥

ä½œç”¨ï¼šæŒ‡å®šå½“å‰å­—æ®µæ˜¯**ä¸»é”®**ã€‚

### `@GeneratedValue` ğŸ”¥

ä½œç”¨ï¼šæŒ‡å®š**ä¸»é”®çš„ç”Ÿæˆç­–ç•¥**ã€‚

å±æ€§ï¼š

- `strategy` ï¼šæŒ‡å®šä¸»é”®ç”Ÿæˆç­–ç•¥ã€‚JPA æä¾›çš„å››ç§æ ‡å‡†ç”¨æ³•ä¸º`TABLE`,`SEQUENCE`,`IDENTITY`,`AUTO`ã€‚

    - `IDENTITY`ï¼šä¸»é”®ç”±æ•°æ®åº“**è‡ªåŠ¨ç”Ÿæˆ**ï¼ˆä¸»è¦æ˜¯è‡ªåŠ¨å¢é•¿å‹ï¼Œå¿…é¡»æ•°æ®åº“åº•å±‚æ”¯æŒï¼Œå¦‚ MySQLï¼‰

        ```java
        @Id
        @GeneratedValue(strategy = GenerationType.IDENTITY)
        private Long custId;
        ```

    - `SEQUENCE`ï¼šæ ¹æ®åº•å±‚æ•°æ®åº“çš„**åºåˆ—**æ¥ç”Ÿæˆä¸»é”®ï¼Œæ¡ä»¶æ˜¯æ•°æ®åº“æ”¯æŒåºåˆ—ï¼Œå¦‚ Oracleã€‚

        ```java
        @Id
        @GeneratedValue(strategy = GenerationType.SEQUENCE,generator="payablemoney_seq")
        @SequenceGenerator(name="payablemoney_seq", sequenceName="seq_payment")
        private Long custId;
        ```

        ```java
        //@SequenceGeneratoræºç ä¸­çš„å®šä¹‰
        @Target({TYPE, METHOD, FIELD})
        @Retention(RUNTIME)
        public @interface SequenceGenerator {
            //è¡¨ç¤ºè¯¥è¡¨ä¸»é”®ç”Ÿæˆç­–ç•¥çš„åç§°ï¼Œå®ƒè¢«å¼•ç”¨åœ¨@GeneratedValueä¸­è®¾ç½®çš„â€œgeneratorâ€å€¼ä¸­
            String name();
            //å±æ€§è¡¨ç¤ºç”Ÿæˆç­–ç•¥ç”¨åˆ°çš„æ•°æ®åº“åºåˆ—åç§°ã€‚
            String sequenceName() default "";
            //è¡¨ç¤ºä¸»é”®åˆè¯†å€¼ï¼Œé»˜è®¤ä¸º0
            int initialValue() default 0;
            //è¡¨ç¤ºæ¯æ¬¡ä¸»é”®å€¼å¢åŠ çš„å¤§å°ï¼Œä¾‹å¦‚è®¾ç½®1ï¼Œåˆ™è¡¨ç¤ºæ¯æ¬¡æ’å…¥æ–°è®°å½•åè‡ªåŠ¨åŠ 1ï¼Œé»˜è®¤ä¸º50
            int allocationSize() default 50;
        }
        ```

    - `AUTO`ï¼šä¸»é”®ç”±ç¨‹åºæ§åˆ¶ï¼ˆæµ‹è¯•äº†ä¸‹ä½¿ç”¨çš„æ˜¯ TABLEï¼‰

        ```java
        @Id
        @GeneratedValue(strategy = GenerationType.AUTO)
        private Long custId;
        ```

    - `TABLE`ï¼šä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„æ•°æ®åº“è¡¨æ ¼æ¥ä¿å­˜ä¸»é”®

        ```java
        @Id
        @GeneratedValue(strategy = GenerationType.TABLE, generator="payablemoney_gen")
        @TableGenerator(name = "pk_gen",
                        table="tb_generator",
                        pkColumnName="gen_name",
                        valueColumnName="gen_value",
                        pkColumnValue="PAYABLEMOENY_PK",
                        allocationSize=1
                       )
        private Long custId;
        ```

        ```java
        //@TableGeneratorçš„å®šä¹‰ï¼š
        @Target({TYPE, METHOD, FIELD})
        @Retention(RUNTIME)
        public @interface TableGenerator {
            //è¡¨ç¤ºè¯¥è¡¨ä¸»é”®ç”Ÿæˆç­–ç•¥çš„åç§°ï¼Œå®ƒè¢«å¼•ç”¨åœ¨@GeneratedValueä¸­è®¾ç½®çš„â€œgeneratorâ€å€¼ä¸­
            String name();
            //è¡¨ç¤ºè¡¨ç”Ÿæˆç­–ç•¥æ‰€æŒä¹…åŒ–çš„è¡¨åï¼Œä¾‹å¦‚ï¼Œè¿™é‡Œè¡¨ä½¿ç”¨çš„æ˜¯æ•°æ®åº“ä¸­çš„â€œtb_generatorâ€ã€‚
            String table() default "";
            //catalogå’Œschemaå…·ä½“æŒ‡å®šè¡¨æ‰€åœ¨çš„ç›®å½•åæˆ–æ˜¯æ•°æ®åº“å
            String catalog() default "";
            String schema() default "";
            //å±æ€§çš„å€¼è¡¨ç¤ºåœ¨æŒä¹…åŒ–è¡¨ä¸­ï¼Œè¯¥ä¸»é”®ç”Ÿæˆç­–ç•¥æ‰€å¯¹åº”é”®å€¼çš„åç§°ã€‚ä¾‹å¦‚åœ¨â€œtb_generatorâ€ä¸­å°†â€œgen_nameâ€ä½œä¸ºä¸»é”®çš„é”®å€¼
            String pkColumnName() default "";
            //å±æ€§çš„å€¼è¡¨ç¤ºåœ¨æŒä¹…åŒ–è¡¨ä¸­ï¼Œè¯¥ä¸»é”®å½“å‰æ‰€ç”Ÿæˆçš„å€¼ï¼Œå®ƒçš„å€¼å°†ä¼šéšç€æ¯æ¬¡åˆ›å»ºç´¯åŠ ã€‚ä¾‹å¦‚ï¼Œåœ¨â€œtb_generatorâ€ä¸­å°†â€œgen_valueâ€ä½œä¸ºä¸»é”®çš„å€¼
            String valueColumnName() default "";
            //å±æ€§çš„å€¼è¡¨ç¤ºåœ¨æŒä¹…åŒ–è¡¨ä¸­ï¼Œè¯¥ç”Ÿæˆç­–ç•¥æ‰€å¯¹åº”çš„ä¸»é”®ã€‚ä¾‹å¦‚åœ¨â€œtb_generatorâ€è¡¨ä¸­ï¼Œå°†â€œgen_nameâ€çš„å€¼ä¸ºâ€œCUSTOMER_PKâ€ã€‚
            String pkColumnValue() default "";
            //è¡¨ç¤ºä¸»é”®åˆè¯†å€¼ï¼Œé»˜è®¤ä¸º0ã€‚
            int initialValue() default 0;
            //è¡¨ç¤ºæ¯æ¬¡ä¸»é”®å€¼å¢åŠ çš„å¤§å°ï¼Œä¾‹å¦‚è®¾ç½®æˆ1ï¼Œåˆ™è¡¨ç¤ºæ¯æ¬¡åˆ›å»ºæ–°è®°å½•åè‡ªåŠ¨åŠ 1ï¼Œé»˜è®¤ä¸º50ã€‚
            int allocationSize() default 50;
            UniqueConstraint[] uniqueConstraints() default {};
        }
        /*==================================================================*/
        //è¿™é‡Œåº”ç”¨è¡¨tb_generatorï¼Œå®šä¹‰ä¸º ï¼š
        CREATE TABLE  tb_generator (
            id NUMBER NOT NULL,
            gen_name VARCHAR2(255) NOT NULL,
            gen_value NUMBER NOT NULL,
            PRIMARY KEY(id)
        )
        ```



### `@Column` ğŸ”¥

ä½œç”¨ï¼šæŒ‡å®šå®ä½“ç±»å±æ€§å’Œæ•°æ®åº“è¡¨ä¹‹é—´çš„å¯¹åº”å…³ç³»

å±æ€§ï¼š

- `name`ï¼šæŒ‡å®šæ•°æ®åº“è¡¨çš„åˆ—åç§°ã€‚ä¸æŒ‡å®šåˆ™ä¸ºå±æ€§åï¼Œè‹¥æ˜¯**å¤šä¸ªå•è¯åˆ™é»˜è®¤å˜ä¸ºä¸‹åˆ’çº¿è¿æ¥**
- `length`ï¼šé•¿åº¦
- `unique`ï¼šæ˜¯å¦å”¯ä¸€
- `nullable`ï¼šæ˜¯å¦å¯ä»¥ä¸ºç©º
- `inserttable`ï¼šæ˜¯å¦å¯ä»¥æ’å…¥
- `updateable`ï¼šæ˜¯å¦å¯ä»¥æ›´æ–°
- `columnDefinition`: å®šä¹‰å»ºè¡¨æ—¶åˆ›å»ºæ­¤åˆ—çš„ DDL
- `secondaryTable`: ä»è¡¨åã€‚å¦‚æœæ­¤åˆ—ä¸å»ºåœ¨ä¸»è¡¨ä¸Šï¼ˆé»˜è®¤å»ºåœ¨ä¸»è¡¨ï¼‰ï¼Œè¯¥å±æ€§å®šä¹‰è¯¥åˆ—æ‰€åœ¨ä»è¡¨çš„åå­—æ­å»ºå¼€å‘ç¯å¢ƒ[é‡ç‚¹]





### `@Transient` ğŸ”¥

ç¬æ€ï¼Œå³ä¸ä¼šè¢«æ˜ å°„åˆ°æ•°æ®åº“è¡¨å­—æ®µ



### `@OneToMany`

å»ºç«‹ä¸€å¯¹å¤šçš„å…³ç³»æ˜ å°„

å±æ€§ï¼š

- `mappedBy`ï¼šğŸ”¥æŒ‡å®š**åœ¨ä»è¡¨å®ä½“ç±»ä¸­å¼•ç”¨ä¸»è¡¨å¯¹è±¡çš„åç§°**ï¼Œä¸€èˆ¬ç”¨äº**ä¸»è¡¨æ”¾å¼ƒå¤–é”®ç»´æŠ¤**æˆ–**è¢«ç»´æŠ¤è¡¨æ”¾å¼ƒç»´æŠ¤ä¸­é—´è¡¨**
- **`fetch`**ï¼šæŒ‡å®šæ˜¯å¦é‡‡ç”¨**å»¶è¿ŸåŠ è½½**ï¼Œæšä¸¾ç±»`FetchType`
    - `LAZY`ï¼ˆ**é»˜è®¤**ï¼‰ï¼Œ`EAGER`
- **`cascade`**ï¼šæŒ‡å®šè¦ä½¿ç”¨çš„**çº§è”**æ“ä½œï¼Œæšä¸¾ç±»`CascadeType`
    - `ALL`ï¼Œ`PERSIST`ï¼Œ`MERGE`ï¼Œ`REMOVE`ï¼Œ`REFRESH`ï¼Œ`DETACH`ï¼›
- `orphanRemoval`ï¼šæ˜¯å¦ä½¿ç”¨å­¤å„¿åˆ é™¤ï¼Œtrueï¼›falseï¼ˆé»˜è®¤ï¼‰
- `targetEntity`ï¼šæŒ‡å®šå¤šçš„å¤šæ–¹çš„ç±»çš„å­—èŠ‚ç ï¼Œå¯çœç•¥ä¼šè‡ªåŠ¨æ¨å€’



### `@ManyToOne`

å»ºç«‹å¤šå¯¹ä¸€çš„å…³ç³»

å±æ€§ï¼š

- `fetch`ï¼šæŒ‡å®šæ˜¯å¦é‡‡ç”¨**å»¶è¿Ÿ**åŠ è½½ï¼ˆåŒä¸Šï¼‰
- `cascade`ï¼šæŒ‡å®šè¦ä½¿ç”¨çš„**çº§è”**æ“ä½œï¼ˆåŒä¸Šï¼‰
- `optional`ï¼šå…³è”æ˜¯å¦å¯é€‰ã€‚å¦‚æœè®¾ç½®ä¸º falseï¼Œåˆ™å¿…é¡»å§‹ç»ˆå­˜åœ¨éç©ºå…³ç³»ã€‚é»˜è®¤ä¸º true
- `targetEntity`ï¼šæŒ‡å®šä¸€çš„ä¸€æ–¹å®ä½“ç±»å­—èŠ‚ç ï¼Œå¯çœç•¥ä¼šè‡ªåŠ¨æ¨å¯¼



### `@ManyToMany`

ç”¨äºæ˜ å°„å¤šå¯¹å¤šå…³ç³»

å±æ€§ï¼š

- `fetch`ï¼šæŒ‡å®šæ˜¯å¦é‡‡ç”¨**å»¶è¿Ÿ**åŠ è½½ï¼ˆåŒä¸Šï¼‰
- `cascade`ï¼šæŒ‡å®šè¦ä½¿ç”¨çš„**çº§è”**æ“ä½œï¼ˆåŒä¸Šï¼‰
- `targetEntity`ï¼šé…ç½®ç›®æ ‡çš„å®ä½“ç±»ã€‚æ˜ å°„å¤šå¯¹å¤šçš„æ—¶å€™ä¸ç”¨å†™ã€‚å¯çœç•¥ä¼šè‡ªåŠ¨æ¨å¯¼



### `@OneToOne`



### `@JoinColumn` ğŸ”¥

ç”¨äºå®šä¹‰**ä¸»é”®å­—æ®µå’Œå¤–é”®å­—æ®µçš„å¯¹åº”å…³ç³»**ï¼Œä¸»è¦ç”¨äº**ä»è¡¨ä¸­å®šä¹‰å¤–é”®çš„å¼•ç”¨**

å±æ€§ï¼š

- `name`ï¼šæŒ‡å®š**å¤–é”®å­—æ®µçš„åç§°**ï¼Œä¸é…ç½®åˆ™æ ¹æ®è¢«ç»´æŠ¤è¡¨ä¸­å±æ€§åå’Œ`referencedColumnName`ç»„åˆ
- `referencedColumnName`ï¼šæŒ‡å®š**å¼•ç”¨ä¸»è¡¨çš„ä¸»é”®å­—æ®µåç§°**
- `unique`ï¼šæ˜¯å¦å”¯ä¸€ã€‚é»˜è®¤ false
- `nullable`ï¼šæ˜¯å¦å…è®¸ä¸ºç©ºã€‚é»˜è®¤ trueã€‚
- `insertable`ï¼šæ˜¯å¦å…è®¸æ’å…¥ã€‚é»˜è®¤ trueã€‚
- `updatable`ï¼šæ˜¯å¦å…è®¸æ›´æ–°ã€‚é»˜è®¤ trueã€‚
- `columnDefinition`ï¼šåˆ—çš„å®šä¹‰ä¿¡æ¯ã€‚



### `@JoinTable`

é’ˆå¯¹**ä¸­é—´è¡¨çš„é…ç½®**ï¼Œä¸»è¦**ç”¨äºç»´æŠ¤è¡¨æ¥è®¾ç½®**

å±æ€§ï¼š

- `name`ï¼šé…ç½®**ä¸­é—´è¡¨çš„åç§°**ï¼Œä¸é…ç½®åˆ™è‡ªåŠ¨æ ¹æ®ç»´æŠ¤è¡¨å’Œè¢«ç»´æŠ¤è¡¨çš„ç±»åç»„åˆæ¥ç”Ÿæˆ
- `@joinColumns`ï¼šéœ€è¦ä¸­é—´è¡¨çš„å¤–é”®å­—æ®µ**å…³è”å½“å‰å®ä½“ç±»æ‰€å¯¹åº”è¡¨çš„ä¸»é”®å­—æ®µ**
- `@inverseJoinColumn`ï¼šéœ€è¦ä¸­é—´è¡¨çš„å¤–é”®å­—æ®µ**å…³è”å¯¹æ–¹è¡¨çš„ä¸»é”®å­—æ®µ**









## é…ç½®

### Maven åæ ‡å¯¼å…¥

```xml
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <scope>runtime</scope>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>
```



### é…ç½®æ–‡ä»¶

```yml
spring:
  datasource:
    url: jdbc:mysql:///sleeve?characterEncoding=utf-8&serverTimezone=GMT%2B8
    username: root
    password: w111111
  jpa:
    hibernate:
      # ä¸€èˆ¬åªæ¨è updateï¼ˆä½†æ˜¯ä¿®æ”¹å­—æ®µä¹Ÿä¸ä¼šé‡æ–°ç”Ÿæˆè¡¨ï¼‰; create ä¼šæ¸…ç©ºä¹‹å‰çš„è¡¨; create-drop ä¸€èˆ¬ç”¨åœ¨æµ‹è¯•, ä¼šè¯å®Œæˆåæ¸…ç©ºè¡¨ã€‚
      # å…¶å®ä¹Ÿä¸æ¨èä½¿ç”¨, åç»­ä¼šç½®ä¸º none
      ddl-auto: create-drop
    show-sql: true # æ˜¾ç¤º
```







## å»ºç«‹ ORM ğŸ”¥

1. åˆ›å»ºå®¢æˆ·çš„æ•°æ®åº“è¡¨ï¼ˆä¸åˆ›å»ºä¹Ÿè¡Œï¼‰

2. **åœ¨å®ä½“ç±»ä¸Šä½¿ç”¨ JPA æ³¨è§£çš„å½¢å¼é…ç½®æ˜ å°„å…³ç³»**

   æ‰€æœ‰çš„æ³¨è§£éƒ½æ˜¯ä½¿ç”¨ JPA çš„è§„èŒƒæä¾›çš„æ³¨è§£ï¼Œå¯¼å…¥`javax.persistence`ä¸‹æ³¨è§£åŒ…

   ```java
   @Entity
   @Table(name = "cst_customer")
   public class Customer {

       @Id
       @GeneratedValue(strategy = GenerationType.IDENTITY)
       @Column(name = "cust_id")
       private Long custId; //å®¢æˆ·çš„ä¸»é”®

       @Column(name = "cust_name")
       private String custName;//å®¢æˆ·åç§°

       @Column(name = "cust_source")
       private String custSource;//å®¢æˆ·æ¥æº

       @Column(name = "cust_level")
       private String custLevel;//å®¢æˆ·çº§åˆ«

       @Column(name = "cust_industry")
       private String custIndustry;//å®¢æˆ·æ‰€å±è¡Œä¸š

       @Column(name = "cust_phone")
       private String custPhone;//å®¢æˆ·çš„è”ç³»æ–¹å¼

       @Column(name = "cust_address")
       private String custAddress;//å®¢æˆ·åœ°å€

       //getter setter
   }
   ```



## Repository æ¥å£

åˆ«å¿˜äº†æ¥å£ä¹‹é—´æ˜¯å¯ä»¥å¤šç»§æ‰¿çš„ï¼ï¼ï¼

```java
/**
 * JpaRepository<å®ä½“ç±»ç±»å‹ï¼Œä¸»é”®ç±»å‹>ï¼šç”¨æ¥å®ŒæˆåŸºæœ¬CRUDæ“ä½œ
 * JpaSpecificationExecutor<å®ä½“ç±»ç±»å‹>ï¼šç”¨äºå¤æ‚æŸ¥è¯¢ï¼ˆåˆ†é¡µç­‰æŸ¥è¯¢æ“ä½œï¼‰
 */
public interface CustomerDao extends JpaRepository<Customer,Long>, JpaSpecificationExecutor<Customer> {
}
```

![image-20201124233941717](../images/image-20201124233941717.png)





## åŸºæœ¬CRUDå’Œå¤æ‚æŸ¥è¯¢

### æ¥å£ä¸­çš„å®šä¹‰å¥½çš„æ–¹æ³•

> ä»¥ä¸‹æ˜¯ç»§æ‰¿äº†JpaRepositoryæ¥å£åè·å¾—çš„

```java
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = "classpath:applicationContext.xml")//locationså¯çœç•¥
public class CustomerDaoTest {

    @Autowired
    private CustomerDao customerDao;
    
    @Test
    public void testFindById() {
        Optional<Customer> optional = customerDao.findById(3L);
        System.out.println(optional.orElse(null));
    }
    

    /**
     * æ ¹æ®IDæŸ¥è¯¢ï¼ˆç«‹å³åŠ è½½ï¼Œåº•å±‚è°ƒç”¨find()æ–¹æ³•ï¼‰
     */
    @Test
    public void testFindOne() {
        Customer customer = customerDao.findOne(3L);
        System.out.println(customer);
    }

    /**
     * æ ¹æ®IDæŸ¥è¯¢ï¼ˆå»¶è¿ŸåŠ è½½ï¼Œåº•å±‚è°ƒç”¨getReference()æ–¹æ³•ï¼‰
     * è¿”å›çš„æ˜¯åŠ¨æ€ä»£ç†å¯¹è±¡ï¼›ä»€ä¹ˆæ—¶å€™ç”¨ï¼Œä»€ä¹ˆæ—¶å€™æŸ¥è¯¢ï¼ˆIDEAéœ€è¦å»æ‰Debugä¸­å‡ ä¸ªé€‰é¡¹æ‰å¯ä»¥çœ‹åˆ°ï¼‰
     */
    @Test
    @Transactional
    public void testGetOne() {
        Customer customer = customerDao.getOne(3L);
        System.out.println(customer);
    }

    /**
     * æŸ¥è¯¢æ‰€æœ‰
     */
    @Test
    public void testFindAll() {
        List<Customer> customerList = customerDao.findAll();
        System.out.println(customerList);
    }

    /**
     * ä¿å­˜æˆ–æ›´æ–°ï¼ˆï¼ï¼ï¼ä¸è¦ç›´æ¥ä½¿ç”¨è¿™ä¸ªæ¥æ›´æ–°ï¼Œå¦åˆ™ä¼šå°†å…¶ä»–æ²¡æœ‰å€¼çš„æ•°æ®ç½®nullã€‚ï¼‰
     * æ ¹æ®ä¼ é€’çš„å¯¹è±¡æ˜¯å¦åŒ…å«ä¸»é”®IDï¼Œä¸åŒ…å«åˆ™æ˜¯ä¿å­˜ï¼›åŒ…å«åˆ™æ˜¯å…ˆæ ¹æ®IDæŸ¥è¯¢æ•°æ®ï¼Œå¹¶æ›´æ–°
     *
     * æ›´æ–°éœ€è¦æ ¹æ®IDæ‰‹åŠ¨æŸ¥æ‰¾ï¼Œç„¶åä¿®æ”¹å†ä¿å­˜ï¼ï¼ï¼
     */
    @Test
    public void testSave() {
        Customer customer = new Customer();
        customer.setCustName("é»‘é©¬ç¨‹åºå‘˜");
        customer.setCustAddress("è¥¿å®‰");
        customerDao.save(customer);
    }
    @Test
    public void testUpdate() {
        Customer customer = new Customer();
        customer.setCustId(8L);
        customer.setCustName("é»‘é©¬ç¨‹åºå‘˜ç‰›é€¼");
        customer.setCustAddress("è¥¿å®‰");
        customer.setCustLevel("VIP");
        customerDao.save(customer);
    }

    /**
     * æ ¹æ®IDåˆ é™¤ï¼ˆåº•å±‚æ˜¯å…ˆæŸ¥è¯¢ï¼Œè‹¥æœ‰å†åˆ é™¤ï¼‰
     */
    @Test
    public void testDelete() {
        customerDao.delete(8L);
    }

    /**
     * ç»Ÿè®¡æŸ¥è¯¢
     */
    @Test
    public void testCount() {
        long count = customerDao.count();
        System.out.println(count);
    }

    /**
     * æ ¹æ®IDåˆ¤æ–­æ˜¯å¦å­˜åœ¨è¯¥æ•°æ®ï¼ˆå¯ä»¥æ ¹æ®æŸ¥è¯¢çš„å¯¹è±¡æ˜¯å¦ä¸ºnullï¼›æˆ–ç»Ÿè®¡å‡ºçš„æ•°é‡æ˜¯å¦å¤§äº0ï¼ˆè¿™é‡Œåº•å±‚ç”¨çš„æ˜¯è¿™ä¸ªï¼‰ï¼‰
     */
    @Test
    public void testExists() {
        boolean exists = customerDao.exists(7L);
        System.out.println(exists);
    }
}
```



### æ–¹æ³•åç§°è§„åˆ™æŸ¥è¯¢

æ–¹æ³•å‘½åè§„åˆ™æŸ¥è¯¢å°±æ˜¯æ ¹æ®æ–¹æ³•çš„åå­—ï¼Œå°±èƒ½åˆ›å»ºæŸ¥è¯¢ï¼Œæ˜¯å¯¹JPQLæ›´æ·±å±‚æ¬¡å°è£…ã€‚åªéœ€è¦æŒ‰ç…§Spring Data JPAæä¾›çš„æ–¹æ³•å‘½åè§„åˆ™å®šä¹‰æ–¹æ³•çš„åç§°ï¼Œä¸éœ€è¦é…ç½®JPQLè¯­å¥å°±å¯ä»¥å®ŒæˆæŸ¥è¯¢å·¥ä½œã€‚Spring Data JPAåœ¨ç¨‹åºæ‰§è¡Œçš„æ—¶å€™ä¼šæ ¹æ®æ–¹æ³•åç§°è¿›è¡Œè§£æï¼Œå¹¶è‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢è¯­å¥è¿›è¡ŒæŸ¥è¯¢ã€‚

æŒ‰ç…§Spring Data JPA å®šä¹‰çš„è§„åˆ™ï¼ŒæŸ¥è¯¢æ–¹æ³•ä»¥**`findBy`**å¼€å¤´ï¼Œæ¶‰åŠæ¡ä»¶æŸ¥è¯¢æ—¶ï¼Œ**æ¡ä»¶çš„å±æ€§ç”¨æ¡ä»¶å…³é”®å­—è¿æ¥**ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼šæ¡ä»¶**å±æ€§é¦–å­—æ¯éœ€å¤§å†™**ã€‚æ¡†æ¶åœ¨è¿›è¡Œæ–¹æ³•åè§£ææ—¶ï¼Œä¼šå…ˆæŠŠæ–¹æ³•åå¤šä½™çš„å‰ç¼€æˆªå–æ‰ï¼Œç„¶åå¯¹å‰©ä¸‹éƒ¨åˆ†è¿›è¡Œè§£æã€‚ä¹Ÿå¯ä»¥**åˆ é™¤**ã€‚

ä¼šæ ¹æ®**å…ˆåé¡ºåº**ä¼ å‚ï¼ï¼åç§°æ— æ‰€è°“

```java
public interface CustomerDao extends JpaRepository<Customer,Long>, JpaSpecificationExecutor<Customer> {
    /**
     * æ–¹æ³•åç§°æŸ¥è¯¢ï¼ˆç²¾å‡†åŒ¹é…ï¼‰
     */
    Customer findByCustName(String custName);

    /**
     * æ–¹æ³•åç§°æŸ¥è¯¢ï¼ˆlikeæ¨¡ç³ŠåŒ¹é…ï¼‰
     */
    List<Customer> findByCustNameLike(String custName);

    /**
     * æ–¹æ³•åç§°æŸ¥è¯¢ï¼ˆä½¿ç”¨å®¢æˆ·åç§°æ¨¡ç³ŠåŒ¹é…å’Œå®¢æˆ·è¡Œä¸šç²¾å‡†åŒ¹é…ï¼‰
     */
    List<Customer> findByCustNameLikeAndCustIndustry(String custName,String custIndustry);
}

```

```java
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = "classpath:applicationContext.xml")//locationså¯çœç•¥
public class JPQLTest {

    @Autowired
    private CustomerDao customerDao;

    /**
     * æµ‹è¯•æ–¹æ³•å‘½åæŸ¥è¯¢
     */
    @Test
    public void testFindByCustName(){
        Customer customer = customerDao.findByCustName("ä¼ æ™ºæ’­å®¢6");
        System.out.println(customer);
    }

    /**
     * æµ‹è¯•æ–¹æ³•å‘½åæŸ¥è¯¢ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼‰
     */
    @Test
    public void testFindByCustNameLike(){
        List<Customer> customerList = customerDao.findByCustNameLike("ä¼ æ™º%");
        System.out.println(customerList);
    }

    /**
     * æµ‹è¯•æ–¹æ³•å‘½åæŸ¥è¯¢ï¼ˆä½¿ç”¨å®¢æˆ·åç§°æ¨¡ç³ŠåŒ¹é…å’Œå®¢æˆ·è¡Œä¸šç²¾å‡†åŒ¹é…ï¼‰
     */
    @Test
    public void testFindByCustNameLikeAndCustIndustry(){
        List<Customer> customerList = customerDao.findByCustNameLikeAndCustIndustry("ä¼ æ™º%","IT");
        System.out.println(customerList);
    }
}

```



å…·ä½“çš„å…³é”®å­—ï¼Œä½¿ç”¨æ–¹æ³•å’Œç”Ÿäº§æˆSQLå¦‚ä¸‹è¡¨æ‰€ç¤º

|    **Keyword**    |                 **Sample**                 |                           **JPQL**                           |
| :---------------: | :----------------------------------------: | :----------------------------------------------------------: |
|        And        |         findByLastnameAndFirstname         |        â€¦   where x.lastname = ?1 and x.firstname = ?2        |
|        Or         |         findByLastnameOrFirstname          |        â€¦   where x.lastname = ?1 or x.firstname = ?2         |
|     Is,Equals     | findByFirstnameIs,   findByFirstnameEquals |                  â€¦   where x.firstname = ?1                  |
|      Between      |           findByStartDateBetween           |           â€¦   where x.startDate between ?1 and ?2            |
|     LessThan      |             findByAgeLessThan              |                     â€¦   where x.age < ?1                     |
|   LessThanEqual   |           findByAgeLessThanEqual           |                     â€¦   where x.age â‡ ?1                     |
|    GreaterThan    |            findByAgeGreaterThan            |                     â€¦   where x.age > ?1                     |
| GreaterThanEqual  |         findByAgeGreaterThanEqual          |                    â€¦   where x.age >= ?1                     |
|       After       |            findByStartDateAfter            |                  â€¦   where x.startDate > ?1                  |
|      Before       |           findByStartDateBefore            |                  â€¦   where x.startDate < ?1                  |
|      IsNull       |              findByAgeIsNull               |                   â€¦   where x.age is null                    |
| IsNotNull,NotNull |            findByAge(Is)NotNull            |                   â€¦   where x.age not null                   |
|       Like        |            findByFirstnameLike             |                â€¦   where x.firstname like ?1                 |
|      NotLike      |           findByFirstnameNotLike           |              â€¦ where   x.firstname not like ?1               |
|   StartingWith    |        findByFirstnameStartingWith         | â€¦   where x.firstname like ?1 (parameter bound with appended %) |
|    EndingWith     |         findByFirstnameEndingWith          | â€¦   where x.firstname like ?1 (parameter bound with prepended %) |
|    Containing     |         findByFirstnameContaining          | â€¦   where x.firstname like ?1 (parameter bound wrapped in %) |
|      OrderBy      |        findByAgeOrderByLastnameDesc        |        â€¦   where x.age = ?1 order by x.lastname desc         |
|        Not        |             findByLastnameNot              |                  â€¦   where x.lastname <> ?1                  |
|        In         |        findByAgeIn(Collection ages)        |                    â€¦   where x.age in ?1                     |
|       NotIn       |       findByAgeNotIn(Collection age)       |                  â€¦   where x.age not in ?1                   |
|       TRUE        |             findByActiveTrue()             |                  â€¦   where x.active = true                   |
|       FALSE       |            findByActiveFalse()             |                  â€¦   where x.active = false                  |
|    IgnoreCase     |         findByFirstnameIgnoreCase          |           â€¦   where UPPER(x.firstame) = UPPER(?1)            |





### JPQL æŸ¥è¯¢

- ç‰¹æœ‰çš„æŸ¥è¯¢ï¼šéœ€è¦åœ¨**Daoæ¥å£ä¸Šé…ç½®æ–¹æ³•**
- åœ¨æ–°æ·»åŠ çš„æ–¹æ³•ä¸Šï¼Œä½¿ç”¨**`@Query`æ³¨è§£çš„å½¢å¼é…ç½®JPQLæŸ¥è¯¢è¯­å¥**

```java
public interface CustomerDao extends JpaRepository<Customer,Long>, JpaSpecificationExecutor<Customer> {

    /**
     * æ ¹æ®å®¢æˆ·åç§°æŸ¥è¯¢å®¢æˆ·ã€‚ä½¿ç”¨JPQLæŸ¥è¯¢
     * ?1ä»£è¡¨å‚æ•°çš„å ä½ç¬¦ï¼Œå…¶ä¸­1å¯¹åº”æ–¹æ³•ä¸­çš„å‚æ•°ç´¢å¼•
     */
    @Query("from Customer where custName = ?1")
    Customer findByName(String custName);

    /**
     * æ ¹æ®å®¢æˆ·åç§°å’Œå®¢æˆ·IDæŸ¥è¯¢å®¢æˆ·ã€‚ä½¿ç”¨JPQLæŸ¥è¯¢
     * ?1ä»£è¡¨å‚æ•°çš„å ä½ç¬¦ï¼Œå…¶ä¸­1å¯¹åº”æ–¹æ³•ä¸­çš„å‚æ•°ç´¢å¼•ã€‚ä¸æŒ‡å®šåˆ™æŒ‰ç…§æ–¹æ³•ä¸­å‚æ•°ä½ç½®å¯¹åº”
     */
    @Query("from Customer where custName = ?1 and custId=?2")
    Customer findByNameAndId(String custName,Long custId);


    /**
     * æ ¹æ®IDæ›´æ–°å®¢æˆ·åç§°ã€‚ä½¿ç”¨JPQL
     * ?1ä»£è¡¨å‚æ•°çš„å ä½ç¬¦ï¼Œå…¶ä¸­1å¯¹åº”æ–¹æ³•ä¸­çš„å‚æ•°ç´¢å¼•ã€‚ä¸æŒ‡å®šåˆ™æŒ‰ç…§æ–¹æ³•ä¸­å‚æ•°ä½ç½®å¯¹åº”ã€‚â€œ:å‚æ•°åç§°â€œ ä¹Ÿå¯ä»¥å½“åšå ä½ç¬¦
     */
    @Query("update Customer set custName = ?1 where custId = ?2")
    @Modifying//ä»£è¡¨æ˜¯æ›´æ–°æ“ä½œ
    void updateNameById(String custName,Long custId);
}

```

```java
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = "classpath:applicationContext.xml")//locationså¯çœç•¥
public class JPQLTest {

    @Autowired
    private CustomerDao customerDao;

    @Test
    public void testFindByName() {
        Customer customer = customerDao.findByName("ä¼ æ™ºæ’­å®¢6");
        System.out.println(customer);
    }

    @Test
    public void testFindByNameAndId() {
        Customer customer = customerDao.findByNameAndId("ä¼ æ™ºæ’­å®¢", 5L);
        System.out.println(customer);
    }

    /**
     * Spring Data JPAä¸­ä½¿ç”¨JPQLå®Œæˆ æ›´æ–°ã€åˆ é™¤æ“ä½œéœ€è¦æ‰‹åŠ¨æ·»åŠ äº‹åŠ¡ï¼Œä½†é»˜è®¤æ‰§è¡Œåä¼šå›æ»šäº‹åŠ¡ï¼Œéœ€è¦æ·»åŠ æ³¨è§£è®¾ç½®ä¸ºä¸å›æ»š
     */
    @Test
    @Transactional
    @Rollback(value = false)
    public void testUpdateNameById() {
        customerDao.updateNameById("ä¼ æ™ºæ’­å®¢æœ€ç‰›é€¼", 5L);
    }
}

```





### SQL è¯­å¥æŸ¥è¯¢

- ç‰¹æœ‰çš„æŸ¥è¯¢ï¼šéœ€è¦åœ¨**Daoæ¥å£ä¸Šé…ç½®æ–¹æ³•**
- åœ¨æ–°æ·»åŠ çš„æ–¹æ³•ä¸Šï¼Œä½¿ç”¨**`@Query`æ³¨è§£çš„å½¢å¼é…ç½®SQLæŸ¥è¯¢è¯­å¥**ï¼Œè¿˜éœ€è®¾ç½®`nativeQuery`å±æ€§

```java
public interface CustomerDao extends JpaRepository<Customer,Long>, JpaSpecificationExecutor<Customer> {
    /**
     * ä½¿ç”¨SQLæŸ¥è¯¢å…¨éƒ¨å®¢æˆ·/æ¨¡ç³ŠæŸ¥è¯¢
     * nativeQueryï¼šé»˜è®¤falseä¸ºJPQLæŸ¥è¯¢ï¼Œtrueä¸ºSQLæŸ¥è¯¢
     */
    //@Query(value = "select * from cst_customer", nativeQuery = true)
    @Query(value = "select * from cst_customer where cust_name like ?1", nativeQuery = true)
    List<Object[]> findBySQL(String name);
}

```

```java
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = "classpath:applicationContext.xml")//locationså¯çœç•¥
public class JPQLTest {

    @Autowired
    private CustomerDao customerDao;
    @Test
    public void testFindBySQL() {
        List<Object[]> list = customerDao.findBySQL("ä¼ æ™ºæ’­å®¢%");
        for (Object[] obj : list) {
            System.out.println(Arrays.toString(obj));
        }
    }
}

```





### Specification åŠ¨æ€æŸ¥è¯¢

> ä»¥ä¸‹æ˜¯ç»§æ‰¿äº†JpaSpecificationExecutoræ¥å£åè·å¾—çš„

Spring Data JPAä¸­å¯ä»¥é€šè¿‡`JpaSpecificationExecutor`æ¥å£æŸ¥è¯¢ã€‚ç›¸æ¯”JPQLï¼Œå…¶ä¼˜åŠ¿æ˜¯ç±»å‹å®‰å…¨ï¼Œæ›´åŠ çš„é¢å‘å¯¹è±¡ã€‚

- `T findOne(Specification<T> spec);`  //æŸ¥è¯¢å•ä¸ªå¯¹è±¡
- `List<T> findAll(Specification<T> spec);`  //æŸ¥è¯¢åˆ—è¡¨
- `Page<T> findAll(Specification<T> spec, Pageable pageable);`
    - Pageableï¼šåˆ†é¡µå‚æ•°
    - è¿”å›å€¼ï¼šSpring Data JPAæä¾›çš„åˆ†é¡µBean
- `List<T> findAll(Specification<T> spec, Sort sort);`//æ’åºæŸ¥è¯¢
- `long count(Specification<T> spec);`//ç»Ÿè®¡æŸ¥è¯¢

å¯¹äº`JpaSpecificationExecutor`ï¼Œè¿™ä¸ªæ¥å£åŸºæœ¬æ˜¯å›´ç»•ç€`Specification`æ¥å£æ¥å®šä¹‰çš„ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•çš„ç†è§£ä¸ºï¼Œ**`Specification`æ„é€ çš„å°±æ˜¯æŸ¥è¯¢æ¡ä»¶**ã€‚

```java
/**
  *	root	ï¼šRootæ¥å£ï¼Œä»£è¡¨æŸ¥è¯¢çš„æ ¹å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡rootè·å–å®ä½“ä¸­çš„å±æ€§
  *	query	ï¼šä»£è¡¨ä¸€ä¸ªé¡¶å±‚æŸ¥è¯¢å¯¹è±¡ï¼Œç”¨æ¥è‡ªå®šä¹‰æŸ¥è¯¢ï¼ˆç”¨çš„å°‘ï¼Œä½†æ˜¯å¾ˆå¼ºå¤§ï¼‰
  *	cb		ï¼šç”¨æ¥æ„å»ºæŸ¥è¯¢ï¼Œæ­¤å¯¹è±¡é‡Œæœ‰å¾ˆå¤šæ¡ä»¶æ–¹æ³•
  **/
public Predicate toPredicate(Root<T> root, CriteriaQuery<?> query, CriteriaBuilder cb);

```

```java
/**
 * 1.å®ç°Specificationæ¥å£ï¼ˆæä¾›æ³›å‹ï¼šæŸ¥è¯¢çš„å¯¹è±¡ç±»å‹ï¼‰
 * 2.å®ç°toPredicateæ–¹æ³•ï¼ˆæ„é€ æŸ¥è¯¢æ¡ä»¶ï¼‰
 * 3.éœ€è¦å€ŸåŠ©æ–¹æ³•å‚æ•°ä¸­çš„ä¸¤ä¸ªå‚æ•°ï¼ˆ
 * rootï¼šè·å–éœ€è¦æŸ¥è¯¢çš„å¯¹è±¡å±æ€§ï¼ˆä¸æ˜¯æ•°æ®åº“ä¸­å­—æ®µåï¼ï¼ï¼‰
 * CriteriaBuilderï¼šæ„é€ æŸ¥è¯¢æ¡ä»¶çš„ï¼Œå†…éƒ¨å°è£…äº†å¾ˆå¤šçš„æŸ¥è¯¢æ¡ä»¶ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼Œç²¾å‡†åŒ¹é…ï¼‰
 **/
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration("classpath:applicationContext.xml")
public class SpecTest {

    @Autowired
    private CustomerDao customerDao;

    /**
     * å•æ¡ä»¶æŸ¥è¯¢ï¼Œæ ¹æ®å®¢æˆ·åç§°æŸ¥è¯¢å•ä¸ªå®¢æˆ·å¯¹è±¡ï¼ˆequalï¼‰
     */
    @Test
    public void testFindOne1() {
        Specification<Customer> specification = new Specification<Customer>() {
            public Predicate toPredicate(Root<Customer> root, CriteriaQuery<?> criteriaQuery, CriteriaBuilder criteriaBuilder) {
                //1.è·å–æ¯”è¾ƒçš„å±æ€§
                Path<Object> custName = root.get("custName");
                //2.æ„é€ æŸ¥è¯¢æ¡ä»¶
                //ç¬¬1ä¸ªå‚æ•°ä¸ºæ¯”è¾ƒçš„å±æ€§ï¼ˆPathå¯¹è±¡ï¼‰ï¼›ç¬¬2ä¸ªå‚æ•°ä¸ºè¦æ¯”è¾ƒçš„å€¼
                return criteriaBuilder.equal(custName, "åšå­¦è°·");
            }
        };
        Customer customer = customerDao.findOne(specification);
        System.out.println(customer);
    }

    /**
     * å¤šæ¡ä»¶æŸ¥è¯¢ï¼Œæ ¹æ®å®¢æˆ·åå’Œå®¢æˆ·æ‰€å±è¡Œä¸šæŸ¥è¯¢å•ä¸ªå®¢æˆ·ï¼ˆequalï¼Œandï¼‰
     */
    @Test
    public void testFindOne2() {

        Specification<Customer> specification = (root, criteriaQuery, criteriaBuilder) -> {
            Path<Object> custName = root.get("custName");
            Path<Object> custIndustry = root.get("custIndustry");

            Predicate predicate1 = criteriaBuilder.equal(custName, "ä¼ æ™ºæ’­å®¢");
            Predicate predicate2 = criteriaBuilder.equal(custIndustry, "IT");
            //ç»„åˆè°“è¯
            return criteriaBuilder.and(predicate1, predicate2);//è¿˜æœ‰orç­‰ç­‰æ–¹æ³•æ¥ç»„åˆ
        };
        Customer customer = customerDao.findOne(specification);
        System.out.println(customer);
    }

    /**
     * æ™®é€šæŸ¥è¯¢ï¼›æ’åºæŸ¥è¯¢ï¼›åˆ†é¡µæŸ¥è¯¢ï¼Œæ ¹æ®å®¢æˆ·åæ¨¡ç³ŠåŒ¹é…æŸ¥è¯¢å®¢æˆ·åˆ—è¡¨ï¼ˆlikeï¼‰ï¼›
     * equal ï¼šç›´æ¥çš„åˆ°pathå¯¹è±¡ï¼ˆå±æ€§ï¼‰ï¼Œç„¶åè¿›è¡Œæ¯”è¾ƒå³å¯
     * gtï¼Œlt,ge,le,like : å¾—åˆ°Pathå¯¹è±¡ï¼Œæ ¹æ®PathæŒ‡å®šæ¯”è¾ƒçš„å‚æ•°ç±»å‹ï¼Œå†å»è¿›è¡Œæ¯”è¾ƒ
     */
    @Test
    public void testFindAll1() {
        Specification<Customer> specification = ((root, criteriaQuery, criteriaBuilder) -> {
            Path<Object> custName = root.get("custName");
            return criteriaBuilder.like(custName.as(String.class), "%ä¼ æ™º%");//æˆ–åœ¨è·å–Pathæ—¶ç›´æ¥å°è£…ä¸ºStringç±»å‹
        });
        //æ™®é€šæŸ¥è¯¢
        List<Customer> customerList1 = customerDao.findAll(specification);

        //æ’åºæŸ¥è¯¢
        //ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæ’åºçš„é¡ºåºï¼ˆå€’åºï¼Œæ­£åºï¼‰ï¼›ç¬¬äºŒä¸ªå‚æ•°ï¼šæ’åºçš„å±æ€§åç§°ï¼ˆä¸æ˜¯å­—æ®µåï¼ï¼‰
        Sort sort = new Sort(Sort.Direction.DESC, "custId");
        List<Customer> customerList2 = customerDao.findAll(specification, sort);

        //åˆ†é¡µæŸ¥è¯¢
        Pageable pageable = PageRequest.of(0,2);//é¡µç ï¼ˆä»0å¼€å§‹ï¼‰ï¼Œæ¯é¡µæ˜¾ç¤ºæ¡æ•°
        Page<Customer> customerPage = customerDao.findAll(specification, pageable);
        System.out.println("æ€»è®°å½•æ•°:" + customerPage.getTotalElements());
        System.out.println("æ€»é¡µæ•°:" + customerPage.getTotalPages());
        System.out.println("åˆ†é¡µæŸ¥è¯¢çš„æ•°æ®:" + customerPage.getContent());
    }


    /**
	 * Specificationçš„å¤šè¡¨æŸ¥è¯¢
	 */
    @Test
    public void testFind() {
        Specification<LinkMan> specification = (root, criteriaQuery, criteriaBuilder) ->  {
                //Joinä»£è¡¨é“¾æ¥æŸ¥è¯¢ï¼Œé€šè¿‡rootå¯¹è±¡è·å–
                //åˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå…³è”å¯¹è±¡çš„å±æ€§åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¿æ¥æŸ¥è¯¢çš„æ–¹å¼ï¼ˆinnerï¼Œleftï¼Œrightï¼‰
                //JoinType.LEFT : å·¦å¤–è¿æ¥,JoinType.INNERï¼šå†…è¿æ¥,JoinType.RIGHTï¼šå³å¤–è¿æ¥
                Join<LinkMan, Customer> join = root.join("customer",JoinType.INNER);
                return criteriaBuilder.like(join.get("custName").as(String.class),"ä¼ æ™ºæ’­å®¢1");
            }
        };
        List<LinkMan> list = linkManDao.findAll(specification);
        for (LinkMan linkMan : list) {
            System.out.println(linkMan);
        }
    }
}

```

> æ–¹æ³•å¯¹åº”å…³ç³»
>
> | æ–¹æ³•åç§°                    | Sqlå¯¹åº”å…³ç³»            |
> | --------------------------- | ---------------------- |
> | equle                       | filed =   value        |
> | gtï¼ˆgreaterThan ï¼‰          | filed   > value        |
> | ltï¼ˆlessThan ï¼‰             | filed   < value        |
> | geï¼ˆgreaterThanOrEqualTo ï¼‰ | filed   >= value       |
> | leï¼ˆ lessThanOrEqualToï¼‰    | filed   <= value       |
> | notEqule                    | filed   != value       |
> | like                        | filed   like value     |
> | notLike                     | filed   not like value |





## å¤šè¡¨æ“ä½œ

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ•°æ®åº“çš„è¡¨éš¾å…ä¼šæœ‰ç›¸äº’çš„å…³è”å…³ç³»ï¼Œåœ¨æ“ä½œè¡¨çš„æ—¶å€™å°±æœ‰å¯èƒ½ä¼šæ¶‰åŠåˆ°å¤šå¼ è¡¨çš„æ“ä½œã€‚è€Œåœ¨è¿™ç§å®ç°äº†ORMæ€æƒ³çš„æ¡†æ¶ä¸­ï¼ˆå¦‚JPAï¼‰ï¼Œå¯ä»¥è®©æˆ‘ä»¬é€šè¿‡æ“ä½œå®ä½“ç±»å°±å®ç°å¯¹æ•°æ®åº“è¡¨çš„æ“ä½œã€‚æ‰€ä»¥ä»Šå¤©æˆ‘ä»¬çš„å­¦ä¹ é‡ç‚¹æ˜¯ï¼šæŒæ¡é…ç½®å®ä½“ä¹‹é—´çš„å…³è”å…³ç³»ã€‚

- ç¬¬ä¸€æ­¥ï¼šé¦–å…ˆç¡®å®šä¸¤å¼ è¡¨ä¹‹é—´çš„å…³ç³»ã€‚ï¼ˆå¦‚æœå…³ç³»ç¡®å®šé”™äº†ï¼Œåé¢åšçš„æ‰€æœ‰æ“ä½œå°±éƒ½ä¸å¯èƒ½æ­£ç¡®ã€‚ï¼‰
- ç¬¬äºŒæ­¥ï¼šåœ¨æ•°æ®åº“ä¸­å®ç°ä¸¤å¼ è¡¨çš„å…³ç³»
- ç¬¬ä¸‰æ­¥ï¼šåœ¨å®ä½“ç±»ä¸­æè¿°å‡ºä¸¤ä¸ªå®ä½“çš„å…³ç³»
- ç¬¬å››æ­¥ï¼šé…ç½®å‡ºå®ä½“ç±»å’Œæ•°æ®åº“è¡¨çš„å…³ç³»æ˜ å°„ï¼ˆé‡ç‚¹ï¼‰



### ä¸€å¯¹å¤š

æ¡ˆä¾‹ï¼šå®¢æˆ·å’Œè”ç³»äººçš„æ¡ˆä¾‹ï¼ˆä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€ä¸ªå®¢æˆ·å¯ä»¥å…·æœ‰å¤šä¸ªè”ç³»äººï¼Œä¸€ä¸ªè”ç³»äººä»å±äºä¸€å®¶å…¬å¸ï¼‰

- å®¢æˆ·ï¼šä¸€å®¶å…¬å¸
- è”ç³»äººï¼šè¿™å®¶å…¬å¸çš„å‘˜å·¥

åˆ†ææ­¥éª¤ï¼š

1. æ˜ç¡®è¡¨å…³ç³»ï¼šä¸€å¯¹å¤šå…³ç³»
2. ç¡®å®šè¡¨å…³ç³»ï¼ˆå¤–é”®ï¼‰
    - **ä¸»è¡¨**ï¼šå®¢æˆ·è¡¨
    - **ä»è¡¨**ï¼šè”ç³»äººè¡¨ï¼Œåœ¨ä»è¡¨æ·»åŠ **å¤–é”®**
3. ç¼–å†™å®ä½“ç±»ï¼Œå†å®ä½“ç±»ä¸­æè¿°è¡¨å…³ç³»ï¼ˆ**åŒ…å«å…³ç³»**ï¼‰
    - å®¢æˆ·ï¼šå†å®¢æˆ·çš„å®ä½“ç±»ä¸­åŒ…å«ä¸€ä¸ªè”ç³»äººçš„é›†åˆ
    - è”ç³»äººï¼šåœ¨è”ç³»äººçš„å®ä½“ç±»ä¸­åŒ…å«ä¸€ä¸ªå®¢æˆ·çš„å¯¹è±¡
4. é…ç½®æ˜ å°„å…³ç³»
    - ä½¿ç”¨ **JPA æ³¨è§£é…ç½®ä¸€å¯¹å¤šæ˜ å°„å…³ç³»**

```java
@Entity
@Table(name = "cst_customer")
public class Customer {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "cust_id")
    private Long custId; //å®¢æˆ·çš„ä¸»é”®

    
    @OneToMany(mappedBy = "customer")//ä¸»è¡¨æ”¾å¼ƒç»´æŠ¤å¤–é”®
    private Set<LinkMan> linkMans = new HashSet<>();

    @Column(name = "cust_name")
    private String custName;//å®¢æˆ·åç§°
    
    ...
}

```

```java
@Entity
@Table(name = "cst_linkman")
public class LinkMan implements Serializable {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "lkm_id")
    private Long lkmId;

    @ManyToOne
    @JoinColumn(name = "lkm_cust_id",referencedColumnName = "cust_id")
    private Customer customer;

    @Column(name = "lkm_name")
    private String lkmName;
    ...
}

```

------

```java
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration("classpath:applicationContext.xml")
public class One2ManyTest {

    @Autowired
    private CustomerDao customerDao;

    @Autowired
    private LinkManDao linkManDao;

    @Test
    @Transactional//å¼€å¯äº‹åŠ¡
    @Rollback(false)//ä¸å›æ»š
    public void testSave() {
        Customer customer = new Customer();
        customer.setCustName("è…¾è®¯");
        LinkMan linkMan = new LinkMan();
        linkMan.setLkmName("å°é©¬");

        customer.getLinkMans().add(linkMan);
        linkMan.setCustomer(customer);

        customerDao.save(customer);
        linkManDao.save(linkMan);
    }
    
    @Test
    @Transactional
    @Rollback(false)//è®¾ç½®ä¸ºä¸å›æ»š
    public void testDelete() {
        customerDao.delete(3L);
    }
}

```

**åˆ é™¤æ“ä½œçš„è¯´æ˜å¦‚ä¸‹**

- åˆ é™¤ä»è¡¨æ•°æ®ï¼šå¯ä»¥éšæ—¶ä»»æ„åˆ é™¤

- åˆ é™¤ä¸»è¡¨æ•°æ®ï¼š

    - æ²¡æœ‰ä»è¡¨æ•°æ®å¼•ç”¨ï¼šéšä¾¿åˆ 

    - æœ‰ä»è¡¨æ•°æ®ï¼š

        - åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šæŠŠå¤–é”®å­—æ®µç½®ä¸ºnullï¼Œç„¶ååˆ é™¤ä¸»è¡¨æ•°æ®ã€‚å¦‚æœåœ¨æ•°æ®åº“çš„è¡¨ç»“æ„ä¸Šï¼Œå¤–é”®å­—æ®µæœ‰éç©ºçº¦æŸï¼Œé»˜è®¤æƒ…å†µå°±ä¼šæŠ¥é”™äº†

        - å¦‚æœé…ç½®äº†æ”¾å¼ƒç»´æŠ¤å…³è”å…³ç³»çš„æƒåˆ©ï¼Œåˆ™ä¸èƒ½åˆ é™¤ï¼ˆä¸å¤–é”®å­—æ®µæ˜¯å¦å…è®¸ä¸ºnullï¼Œæ²¡æœ‰å…³ç³»ï¼‰å› ä¸ºåœ¨åˆ é™¤æ—¶ï¼Œå®ƒæ ¹æœ¬ä¸ä¼šå»æ›´æ–°ä»è¡¨çš„å¤–é”®å­—æ®µäº†

        - å¦‚æœè¿˜æƒ³åˆ é™¤ï¼Œä½¿ç”¨çº§è”åˆ é™¤å¼•ç”¨ï¼ˆåœ¨å®é™…å¼€å‘ä¸­ï¼Œçº§è”åˆ é™¤è¯·æ…ç”¨ï¼(åœ¨ä¸€å¯¹å¤šçš„æƒ…å†µä¸‹)ï¼‰

            

**çº§è”**ï¼šæ“ä½œä¸€ä¸ªå¯¹è±¡çš„åŒæ—¶æ“ä½œä»–çš„å…³è”å¯¹è±¡

- çº§è”æ“ä½œï¼š
    1.éœ€è¦**åŒºåˆ†æ“ä½œä¸»ä½“**
    2.éœ€è¦åœ¨æ“ä½œä¸»ä½“çš„å®ä½“ç±»ä¸Šï¼ˆä¸»è¡¨æˆ–ç»´æŠ¤è¡¨ï¼‰ï¼Œæ·»åŠ çº§è”å±æ€§`cascade`ï¼ˆéœ€è¦æ·»åŠ åˆ°å¤šè¡¨æ˜ å°„å…³ç³»çš„æ³¨è§£ä¸Šï¼‰
- çº§è”æ·»åŠ ï¼Œæ¡ˆä¾‹ï¼šå½“æˆ‘ä¿å­˜ä¸€ä¸ªå®¢æˆ·çš„åŒæ—¶ä¿å­˜è”ç³»äººï¼ˆåœ¨ä»£ç ä¸­åªéœ€ä¿å­˜å®¢æˆ·ï¼ï¼‰
- çº§è”åˆ é™¤ï¼Œæ¡ˆä¾‹ï¼šå½“æˆ‘åˆ é™¤ä¸€ä¸ªå®¢æˆ·çš„åŒæ—¶åˆ é™¤æ­¤å®¢æˆ·çš„æ‰€æœ‰è”ç³»äººï¼Œæœ‰ä¸­é—´è¡¨ä¼šå…ˆåˆ é™¤ä¸­é—´è¡¨ï¼ˆåœ¨ä»£ç ä¸­åªéœ€åˆ é™¤å®¢æˆ·ï¼ï¼‰



### å¤šå¯¹å¤š

æ¡ˆä¾‹ï¼šç”¨æˆ·å’Œè§’è‰²ï¼ˆå¤šå¯¹å¤šå…³ç³»ï¼‰

åˆ†ææ­¥éª¤ï¼š

1. æ˜ç¡®è¡¨å…³ç³»ï¼šå¤šå¯¹å¤šå…³ç³»
2. ç¡®å®šè¡¨å…³ç³»ï¼ˆä¸­é—´è¡¨ï¼‰
3. ç¼–å†™å®ä½“ç±»ï¼Œå†å®ä½“ç±»ä¸­æè¿°è¡¨å…³ç³»ï¼ˆ**åŒ…å«å…³ç³»**ï¼‰
    - ç”¨æˆ·ï¼šåŒ…å«è§’è‰²çš„é›†åˆ
    - è§’è‰²ï¼šåŒ…å«ç”¨æˆ·çš„é›†åˆ
4. é…ç½®æ˜ å°„å…³ç³»
    - ä½¿ç”¨ **JPA æ³¨è§£é…ç½®å¤šå¯¹å¤šæ˜ å°„å…³ç³»**

```java
@Entity
@Table//ä¸é…ç½®nameåˆ™ä¸ºç±»ç›®é¦–å­—æ¯å°å†™
public class User {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column//ä¸é…ç½®å­—æ®µååˆ™ä¸ºå±æ€§å
    private Long userId;

    @ManyToMany
    //ç»´æŠ¤ä¸­é—´è¡¨
    @JoinTable(
        name = "sys_user_role",
        //å½“å‰å¯¹è±¡åœ¨ä¸­é—´è¡¨ä¸­çš„å¤–é”®
        joinColumns = {@JoinColumn(name = "sys_user_id",referencedColumnName = "userId")},
        //å¯¹æ–¹å¯¹è±¡åœ¨ä¸­é—´è¡¨ä¸­çš„å¤–é”®
        inverseJoinColumns = {@JoinColumn(name = "sys_role_id",referencedColumnName = "roleId")}
    )
    private Set<Role> roles = new HashSet<>();
    ...
}

```

```java
@Entity
@Table
public class Role {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column
    private Long roleId;
    
    @ManyToMany(mappedBy = "roles")//è¢«ç»´æŠ¤è¡¨æ”¾å¼ƒç»´æŠ¤ä¸­é—´è¡¨ï¼
    private Set<User> users = new HashSet<>();
    ...
}

```

å…¶ä»–åˆ é™¤/çº§è”ç­‰åŒä¸€å¯¹å¤šï¼Œåˆ é™¤æ—¶ä¼šå…ˆåˆ é™¤ä¸­é—´è¡¨æ•°æ®



### å¯¹è±¡å¯¼èˆªæŸ¥è¯¢

å¯¹è±¡å›¾å¯¼èˆªæ£€ç´¢æ–¹å¼æ˜¯æ ¹æ®å·²ç»åŠ è½½çš„å¯¹è±¡ï¼Œå¯¼èˆªåˆ°ä»–çš„å…³è”å¯¹è±¡ã€‚å®ƒåˆ©ç”¨ç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»æ¥æ£€ç´¢å¯¹è±¡ã€‚ä¾‹å¦‚ï¼šæˆ‘ä»¬é€šè¿‡IDæŸ¥è¯¢æ–¹å¼æŸ¥å‡ºä¸€ä¸ªå®¢æˆ·ï¼Œå¯ä»¥è°ƒç”¨Customerç±»ä¸­çš„getLinkMans()æ–¹æ³•æ¥è·å–è¯¥å®¢æˆ·çš„æ‰€æœ‰è”ç³»äººã€‚å¯¹è±¡å¯¼èˆªæŸ¥è¯¢çš„ä½¿ç”¨è¦æ±‚æ˜¯ï¼šä¸¤ä¸ªå¯¹è±¡ä¹‹é—´å¿…é¡»å­˜åœ¨å…³è”å…³ç³»ã€‚

å¯¹è±¡å¯¼èˆªæŸ¥è¯¢

- **ä»ä¸€æ–¹æŸ¥è¯¢å¤šæ–¹ï¼šé»˜è®¤å»¶è¿ŸåŠ è½½**
- **ä»å¤šæ–¹æŸ¥è¯¢ä¸€æ–¹ï¼šé»˜è®¤ç«‹å³åŠ è½½**

å¯ä»¥ä¿®æ”¹é…ç½®å°†å…¶æ”¹ä¸ºç«‹å³åŠ è½½ï¼ˆä¸æ¨èï¼ï¼‰ï¼Œ**fetché…ç½®åœ¨å¤šè¡¨å…³ç³»ä¸­ä¸»ä½“ï¼ˆæˆ–ä¸€æ–¹æˆ–å¤šæ–¹ï¼‰çš„æ³¨è§£ä¸Š**ï¼ŒæŸ¥çœ‹3.3



### Specification åŠ¨æ€æŸ¥è¯¢

å¦‚åŸºæœ¬ CRUD å’Œå¤æ‚æŸ¥è¯¢ç« èŠ‚