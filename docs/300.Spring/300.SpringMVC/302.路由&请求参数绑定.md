---
title: è·¯ç”±&è¯·æ±‚å‚æ•°ç»‘å®š
date: 2020-12-16 01:27:11
permalink: /pages/8393b6/
categories:
  - Spring
  - SpringMVC
tags:
  - 
---
# è·¯ç”±&è¯·æ±‚å‚æ•°ç»‘å®š

## RESTful

RESTfulæ˜¯ä¸€ä¸ªèµ„æºå®šä½åŠèµ„æºæ“ä½œçš„é£æ ¼ã€‚ä½¿ç”¨POSTã€DELETEã€PUTã€GETï¼Œä½¿ç”¨ä¸åŒæ–¹æ³•å¯¹èµ„æºè¿›è¡Œæ“ä½œï¼Œåˆ†åˆ«å¯¹åº”  æ·»åŠ ã€ åˆ é™¤ã€ä¿®æ”¹ã€æŸ¥è¯¢

éœ€æ±‚ï¼šRESTfulæ–¹å¼å®ç°å•†å“ä¿¡æ¯æŸ¥è¯¢ï¼Œè¿”å›jsonæ•°æ®

**ä»URLä¸Šè·å–å‚æ•°**ï¼šæ ¹æ®idæŸ¥è¯¢å•†å“ï¼Œä½¿ç”¨RESTfulé£æ ¼å¼€å‘çš„æ¥å£åœ°å€æ˜¯ï¼šhttp://127.0.0.1/item/1

- æ³¨è§£`@RequestMapping("item/{id}")`å£°æ˜è¯·æ±‚çš„URLï¼Œ`{xxx}`ä¸ºå ä½ç¬¦ï¼Œè¯·æ±‚çš„URLæ˜¯â€œ`item /1`â€

- ä½¿ç”¨`@PathVariable() Integer id`è·å–URLä¸Šçš„æ•°æ®

    ```java
    @RequestMapping("item/{id}")
    public @ResponseBody Item queryItemById(@PathVariable Integer id) {
        Item item = this.itemService.queryItemById(id);
        return item;
    }
    ```

    - å¦‚æœ`@RequestMapping`ä¸­è¡¨ç¤ºä¸º"`item/{id}`"ï¼Œidå’Œå½¢å‚åç§°ä¸€è‡´ï¼Œ`@PathVariable`ä¸ç”¨æŒ‡å®šåç§°ã€‚å¦‚æœä¸ä¸€è‡´ï¼Œä¾‹å¦‚"`item/{ItemId}`"åˆ™éœ€è¦æŒ‡å®šåç§°`@PathVariable("itemId")`

- **æ³¨æ„**ï¼š

    - @PathVariableæ˜¯è·å–urlä¸Šæ•°æ®çš„ã€‚@RequestParamè·å–è¯·æ±‚å‚æ•°çš„ï¼ˆåŒ…æ‹¬postè¡¨å•æäº¤ï¼‰
    - å¦‚æœåŠ ä¸Š@ResponseBodyæ³¨è§£ï¼Œå°±ä¸ä¼šèµ°è§†å›¾è§£æå™¨ï¼Œä¸ä¼šè¿”å›é¡µé¢ï¼Œè¿”å›å¦‚jsonæ•°æ®ã€‚å¦‚æœä¸åŠ ï¼Œå°±èµ°è§†å›¾è§£æå™¨ï¼Œè¿”å›é¡µé¢

* æ³¨æ„ï¼š
    * **è¡¨å•**åªæ”¯æŒGETã€POSTè¯·æ±‚ï¼Œè‹¥è¦å‘é€å…¶ä»–è¯·æ±‚ï¼ˆä¸€èˆ¬ä¹Ÿä¸ä¼šä½¿ç”¨è¡¨å•å‘é€å…¶ä»–è¯·æ±‚ï¼‰ï¼Œ**è¡¨å•**æœ¬èº«è®¾ç½®ä¸ºPOSTè¯·æ±‚ï¼Œå¹¶éœ€è¦inputä¸­å±æ€§`name="_method" value="PUT"`
    * åç«¯ä¸­éœ€è¦é…ç½®è¿‡æ»¤å™¨`org.springframework.web.filter.HiddenHttpMethodFilter`
    * Ajax æ”¯æŒå…¶ä»–ç±»å‹çš„è¯·æ±‚





## è·¯ç”±

### @Controller



### @RestController ğŸ”¥

æ˜¯`@Controller`å’Œ`@ResponseBody`çš„ç»„åˆ

ä½¿ç”¨ @ResponseBody ä¼šè‡ªåŠ¨è®¾ç½®å¦‚ä¸‹ä»£ç ï¼š

*   è®¾ç½® ContentTypeã€MIME Typeã€‚å¦‚ä½¿ç”¨ UTF-8 è§£å†³ä¹±ç 

    ```java
    response.setContentType("application/json;charset=utf-8");// è¿”å›å¯¹è±¡ä¸º Object æ—¶
    response.setContentType("text/plain;charset=utf-8");// è¿”å›å¯¹è±¡ä¸º String æ—¶
    ```

*   åºåˆ—åŒ–ã€è°ƒç”¨ response çš„è¾“å‡ºæ–¹æ³•

    ```java
    response.getWriter().write("hello æµ‹è¯•2");// è‹¥è¾“å‡ºå¯¹è±¡ï¼Œåˆ™çœæ‰æ‰‹åŠ¨åºåˆ—å·æ“ä½œ
    ```

    



### @RequestMapping

å°è£…äº† Servlet çš„ url-partten

ä½œç”¨ï¼šç”¨äº**å»ºç«‹è¯·æ±‚ URL** å’Œ**å¤„ç†è¯·æ±‚æ–¹æ³•**ä¹‹é—´çš„å¯¹åº”**å…³ç³»**ã€‚**æ‰€æœ‰è¯·æ±‚æ–¹æ³•éƒ½ä¼šç»è¿‡æ­¤è·¯ç”±**

```java
@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Mapping
public @interface RequestMapping {
    String name() default "";

    @AliasFor("path")
    String[] value() default {};
    @AliasFor("value")
    String[] path() default {};

    RequestMethod[] method() default {};
    String[] params() default {};
    String[] headers() default {};
    String[] consumes() default {};
    String[] produces() default {};
}
```

å‡ºç°ä½ç½®ï¼š 

* **ç±»**ä¸Šï¼šè¯·æ±‚URLçš„**ç¬¬ä¸€çº§è®¿é—®ç›®å½•**ï¼Œæ¨¡å—åŒ–ç®¡ç†ã€‚æ­¤å¤„ä¸å†™çš„è¯ï¼Œå°±ç›¸å½“äºåº”ç”¨çš„æ ¹ç›®å½•ã€‚å†™çš„è¯éœ€è¦ä»¥`/`å¼€å¤´ï¼Œå¦‚`/user`

* **æ–¹æ³•**ä¸Šï¼šè¯·æ±‚ URL çš„**ç¬¬äºŒçº§è®¿é—®ç›®å½•**ã€‚ å¦‚`/add`ã€‚ä½†æ˜¯RESTfulé£æ ¼çš„å¯ä»¥ä½¿ç”¨`@**Mapping`æ›¿ä»£

    å½“ä½¿ç”¨åˆ†çº§é…ç½®æ—¶ï¼Œå‰ç«¯é¡µé¢çš„è¯·æ±‚è·¯å¾„ä¸­ï¼Œè¦ä¹ˆå†™ç»å¯¹è·¯å¾„å³å¸¦`/`å’Œé¡¹ç›®åï¼Œè¦ä¹ˆå†™**ç›¸å¯¹è·¯å¾„ä¸å¸¦`/`**ï¼ˆè¡¨ç¤ºç›¸å¯¹åº”ç”¨çš„æ ¹ç›®å½•ï¼‰ï¼Œå¦åˆ™404

å±æ€§ï¼š

* `value`ï¼šç”¨äºæŒ‡å®š**è¯·æ±‚çš„ URLæ•°ç»„**ã€‚å®ƒå’Œ **path** å±æ€§çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚**å¤§å°å†™æ•æ„Ÿ**ã€‚

* `method`ï¼šç”¨äºæŒ‡å®š**è¯·æ±‚çš„æ–¹å¼**ï¼Œå€¼ä¸º`RequestMethod`æšä¸¾ç±»**æ•°ç»„**ã€‚

    å¯ä»¥æœ‰**å¤šä¸ªè¯·æ±‚æ–¹å¼æ˜ å°„ä¸€ä¸ªæ–¹æ³•**ï¼Œä½†æ˜¯ä¸‹é¢çš„ç®€å†™æ³¨è§£ä¸å¯ä»¥åœ¨åŒä¸€ä¸ªæ–¹æ³•ä¸­ä½¿ç”¨å¤šä¸ªï¼Œå¦åˆ™**åªæœ‰æœ€å…ˆå†™çš„èµ·ä½œç”¨**ï¼

* `params`ï¼šç”¨äºæŒ‡å®šé™åˆ¶è¯·æ±‚å‚æ•°çš„æ¡ä»¶ã€‚å®ƒæ”¯æŒç®€å•çš„è¡¨è¾¾å¼ã€‚è¦æ±‚è¯·æ±‚å‚æ•°çš„keyå’Œvalueå¿…é¡»å’Œé…ç½®çš„ä¸€æ¨¡ä¸€æ ·ã€‚å¦‚ï¼š

    * `params = {"accountName"}`ï¼Œè¡¨ç¤ºè¯·æ±‚å‚æ•°å¿…é¡»æœ‰ accountName 
    * `params = {"moeny!100"}`ï¼Œè¡¨ç¤ºè¯·æ±‚å‚æ•°ä¸­ money ä¸èƒ½æ˜¯ 100

* `headers`ï¼šç”¨äºé™å®šå‘é€çš„è¯·æ±‚ä¸­å¿…é¡»åŒ…å«æŸè¯·æ±‚å¤´



### @GetMapping

ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œæ›¿ä»£æ–¹æ³•çš„`@RequestMapping`

### @PostMapping

ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œæ›¿ä»£æ–¹æ³•çš„`@RequestMapping`

### @PutMapping

ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œæ›¿ä»£æ–¹æ³•çš„`@RequestMapping`

### @DeleteMapping

ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œæ›¿ä»£æ–¹æ³•çš„`@RequestMapping`

### @PatchMapping

ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œæ›¿ä»£æ–¹æ³•çš„`@RequestMapping`ã€‚éƒ¨åˆ†æ›´æ–°







### è‡ªåŠ¨ RequestMapping ğŸ”¥

è‡ªåŠ¨æ ¹æ®ç›®å½•ç”Ÿæˆ @RequestMapping çš„ value

æ‰‹å†™å¦‚ä¸‹ï¼Œå¾ˆéº»çƒ¦ï¼š

```java
package com.lin.missyou.api.v1;
// ...

@RestController
@RequestMapping("/v1/banner")
public class BannerController {

}
```

å¯ä»¥æ ¹æ®ç›®å½•æ¥è‡ªåŠ¨ç”Ÿæˆ/v1ç­‰

é…ç½®ç±»

```java
@Configuration
public class AutoPrefixConfiguration implements WebMvcRegistrations {

    @Override
    public RequestMappingHandlerMapping getRequestMappingHandlerMapping() {
        return new AutoPrefixUrlMapping();
    }
}
```

è‡ªåŠ¨ç”Ÿæˆç±»

```java
/**
 * RequestMappingHandlerMapping Spring MVC ç”¨äºå¤„ç† @RequestMapping çš„ç±»
 */
public class AutoPrefixUrlMapping extends RequestMappingHandlerMapping {

    @Value("${missyou.api-package}")
    public String apiPackage;


    @Override
    protected RequestMappingInfo getMappingForMethod(Method method, Class<?> handlerType) {

        RequestMappingInfo requestMappingInfo = super.getMappingForMethod(method, handlerType);

        // è¿™é‡Œé™¤äº†è‡ªå·±å†™çš„ @RequestMapping ç­‰æ³¨è§£å’Œç³»ç»Ÿçš„ /error ä¸ä¸º nullï¼Œå…¶ä½™éƒ½ä¸º null
        if (requestMappingInfo == null){
            return null;
        }

        // è¿™é‡Œåªæ‹¦æˆªå¦‚ com.lin.missyou.api çš„åŒ…ä¸‹çš„ @RequestMappingï¼Œ
        // å…¶ä»–çš„ Spring é»˜è®¤é…ç½®çš„ @RequestMapping éƒ½ç›´æ¥æ”¾æ‰ï¼ˆå¦‚, /errorï¼‰
        String packageName = handlerType.getPackage().getName();
        if (!packageName.startsWith(apiPackage))
            return requestMappingInfo;


        // è¿™é‡Œæ‰æ˜¯æ‹¦æˆªåˆ°"è‡ªå·±"æ·»åŠ  @RequestMapping æ³¨è§£çš„æ–¹æ³•
        String prefix = getPrefix(handlerType);
        // æ³¨æ„è¿™é‡Œçš„ RequestMappingInfo åªæœ‰é™æ€æ–¹æ³•å¯ä»¥æ“ä½œè¯¥ç±»
        // combine è”åˆã€‚æ‹¼æ¥å‰ç¼€å’Œ @RequestMapping æ³¨è§£çš„ value
        return RequestMappingInfo.paths(prefix).build().combine(requestMappingInfo);


    }

    private String getPrefix(Class<?> handlerType){
        // è·å–çš„åŒ…åå¦‚ï¼šcom.lin.missyou.api.v1
        String packageName = handlerType.getPackage().getName();
        String dotPath = packageName.replace(apiPackage, "");
        return dotPath.replaceAll("\\.", "/");
    }
}
```

æ­¤æ—¶å°±å¯ä»¥æ ¹æ®







## Url å‚æ•° ğŸ”¥

### ç»å…¸â€” `@RequestParam`

ç”¨äºæ˜ å°„**è¯·æ±‚çš„å‚æ•°å**å’Œ**å¤„ç†å™¨å½¢å‚å**ï¼Œ å½“äºŒè€…ä¸€è‡´æ—¶ï¼ˆ**åŒºåˆ†å¤§å°å†™**ï¼‰å¯çœç•¥è¯¥æ³¨è§£ï¼

æ³¨æ„ï¼š

*   ğŸ”¥å‚æ•°ç±»å‹**æ¨è**ä½¿ç”¨**åŒ…è£…æ•°æ®ç±»å‹**ï¼Œå› ä¸ºåŸºç¡€æ•°æ®ç±»å‹ä¸å¯ä¸ºnullï¼›
*   ğŸ”¥**Boolean å¸ƒå°”ç±»å‹çš„å‚æ•°ï¼Œè¯·æ±‚çš„å‚æ•°å€¼å¯ä»¥ä¸º true æˆ– falseï¼Œ1 æˆ– 0ï¼Œæ¥æ”¶åè‡ªåŠ¨æ˜ å°„ä¸ºå¸ƒå°”ç±»å‹**

å±æ€§ï¼š

* `value`æˆ–`name`ï¼šè¯·æ±‚å‚æ•°ä¸­çš„åç§°ã€‚è‹¥å‚æ•°åç§°å’Œå½¢å‚ä¸€è‡´ï¼Œå¯ä»¥ä¸ç”¨æŒ‡å®š value æˆ– name
* `required`ï¼šè¯·æ±‚å‚æ•°ä¸­æ˜¯å¦å¿…é¡»æä¾›æ­¤å‚æ•°ã€‚é»˜è®¤å€¼ï¼štrueã€‚è¡¨ç¤ºå¿…é¡»æä¾›ï¼Œå¦‚æœä¸æä¾›å°†æŠ¥é”™
* `defaultValue`ï¼šè¯·æ±‚å‚æ•°é»˜è®¤å€¼

Postman è¯·æ±‚å¦‚ä¸‹ï¼ˆç›´æ¥åœ¨ Params ä¸­å†™ Query Paramså³å¯ï¼‰ï¼š

```http
GET /v1/test/url2?name=conanan&flag=1 HTTP/1.1
Host: http://127.0.0.1:80
Content-Type: application/x-www-form-urlencoded
```

å’Œ Content-Type: application/x-www-form-urlencoded æ²¡æœ‰å…³ç³»ï¼Œé»˜è®¤å°±æ˜¯è¯¥ç±»å‹ï¼Œ**åªéœ€æ³¨æ„`?`åçš„é”®å€¼å¯¹**å³å¯

Java åå°å¯ä»¥å¦‚ä¸‹æ–¹å¼æ¥æ”¶ï¼ˆåªéœ€åˆ‡æ¢ä¸‹ url å³å¯ï¼‰

```java
@GetMapping("/url1")
public String url1(String name, Boolean flag){
    return String.format("url1: %s, %s", name, flag);
}

// å¯çœç•¥ @RequestParam
@GetMapping("/url2")
public String url2(@RequestParam String name, Boolean flag){
    return String.format("url2: %s, %s", name, flag);
}
```





### RESTful â€” `@PathVariable`

ç”¨äº**ç»‘å®š url ä¸­çš„å ä½ç¬¦**ã€‚url æ”¯æŒå ä½ç¬¦æ˜¯ spring3.0 ä¹‹ååŠ å…¥çš„ã€‚æ˜¯ springmvc æ”¯æŒ RESTful é£æ ¼ URL çš„ä¸€ä¸ªé‡è¦æ ‡å¿—ã€‚ 

æ³¨æ„ï¼š

*   ğŸ”¥å‚æ•°ç±»å‹**æ¨è**ä½¿ç”¨**åŒ…è£…æ•°æ®ç±»å‹**ï¼Œå› ä¸ºåŸºç¡€æ•°æ®ç±»å‹ä¸å¯ä¸ºnullï¼›ä½†è¿™é‡Œä¸€èˆ¬ä¸ä¼šå‡ºç°`/rest//1`æƒ…å†µ
*   ğŸ”¥**Boolean å¸ƒå°”ç±»å‹çš„å‚æ•°ï¼Œè¯·æ±‚çš„å‚æ•°å€¼å¯ä»¥ä¸º true æˆ– falseï¼Œ1 æˆ– 0ï¼Œæ¥æ”¶åè‡ªåŠ¨æ˜ å°„ä¸ºå¸ƒå°”ç±»å‹**

å±æ€§ï¼š  

- `value`æˆ–`name`ï¼šç”¨äºæŒ‡å®š url ä¸­å ä½ç¬¦åç§°ã€‚è‹¥å ä½ç¬¦åç§°å’Œå½¢å‚ä¸€è‡´ï¼Œå¯ä»¥ä¸ç”¨æŒ‡å®švalueã€‚
- `required`ï¼šæ˜¯å¦å¿…é¡»æä¾›å ä½ç¬¦ã€‚ 

Postman è¯·æ±‚å¦‚ä¸‹ï¼ˆç›´æ¥åœ¨ Params ä¸­å†™ Query Paramså³å¯ï¼‰ï¼š

```http
GET /v1/test/rest/conanan/1 HTTP/1.1
Host: http://127.0.0.1:80
Content-Type: application/x-www-form-urlencoded
```

å’Œ Content-Type: application/x-www-form-urlencoded æ²¡æœ‰å…³ç³»ï¼Œé»˜è®¤å°±æ˜¯è¯¥ç±»å‹

Java åå°å¯ä»¥å¦‚ä¸‹æ–¹å¼æ¥æ”¶ï¼ˆåªéœ€åˆ‡æ¢ä¸‹ url å³å¯ï¼‰

```java
@GetMapping("/rest/{name}/{flag}")
public String rest1(@PathVariable String name,
                    @PathVariable Boolean flag){
    return String.format("url2: %s, %s", name, flag);
}
```





## Body å‚æ•° ğŸ”¥

::: tip æ³¨æ„

GET è¯·æ±‚æ²¡æœ‰ Body å‚æ•°

:::

### GET è¡¨å•â€”åŒ `@RequestParam`

è¡¨å•å‚æ•°ç»‘å®šï¼š

*   è¡¨å•æäº¤çš„æ•°æ®éƒ½æ˜¯k=væ ¼å¼çš„ `username=haha&password=123`ï¼Œ**keyå°±æ˜¯è¡¨å•ä¸­`name`çš„å€¼**ã€‚GET è¯·æ±‚å°†æ•°æ®æ”¾å…¥ Url çš„`?`å
*   SpringMVC çš„å‚æ•°ç»‘å®šè¿‡ç¨‹æ˜¯æŠŠ**è¡¨å•æäº¤çš„è¯·æ±‚å‚æ•°**ï¼Œä½œä¸ºæ§åˆ¶å™¨ä¸­**æ–¹æ³•çš„å‚æ•°**è¿›è¡Œç»‘å®šçš„ 
*   å…¶ä»–å’Œç»å…¸`@RequestParam`ä¸€è‡´ï¼ï¼ï¼

::: tip æ³¨æ„

éœ€è¦**æ³¨æ„**çš„æ˜¯ï¼ŒPostman ä¸­ Body é€‰æ‹© x-www-form-urlencodedï¼Œä¸”æ–¹æ³•ä¸º GET çš„ä¸æ˜¯çœŸæ­£çš„ GET è¡¨å•æäº¤ï¼Œå®ƒä¸ä¼šæŠŠé”®å€¼å¯¹æ”¾å…¥`?`åï¼ï¼ï¼æ‰€ä»¥è¿˜æ˜¯æ¨èä½¿ç”¨`@RequestParam`æ—¶é‡‡ç”¨ Query Params å³å¯

:::





### POST è¡¨å•â€”ç›´æ¥ POJO æ¥æ”¶

è¡¨å•å‚æ•°ç»‘å®šï¼š

*   è¡¨å•æäº¤çš„æ•°æ®éƒ½æ˜¯k=væ ¼å¼çš„ `username=haha&password=123`ï¼Œ**keyå°±æ˜¯è¡¨å•ä¸­`name`çš„å€¼**ã€‚POST è¯·æ±‚å°†æ•°æ®æ”¾å…¥**è¯·æ±‚ä½“**ä¸­

*   SpringMVC çš„å‚æ•°ç»‘å®šè¿‡ç¨‹æ˜¯æŠŠ**è¡¨å•æäº¤çš„è¯·æ±‚å‚æ•°**ï¼Œä½œä¸ºæ§åˆ¶å™¨ä¸­**æ–¹æ³•çš„å‚æ•°**è¿›è¡Œç»‘å®šçš„ 

*   è¦æ±‚è¡¨å•ä¸­**å‚æ•°åç§°**å’Œ POJO ç±»çš„**å±æ€§åç§°**ä¿æŒä¸€è‡´ã€‚å¹¶ä¸”æ§åˆ¶å™¨æ–¹æ³•çš„**å‚æ•°ç±»å‹æ˜¯ POJO ç±»å‹**
*   **ç»™ List é›†åˆä¸­çš„å…ƒç´ èµ‹å€¼ï¼Œä½¿ç”¨ä¸‹æ ‡**
*   **ç»™ Map é›†åˆä¸­çš„å…ƒç´ èµ‹å€¼ï¼Œä½¿ç”¨é”®å€¼å¯¹**

Postman è¯·æ±‚å¦‚ä¸‹ï¼ˆåœ¨ Body ä¸­ x-www-form-urlencoded å†™å‚æ•°å³å¯ï¼‰ï¼š

```http
POST /v1/test/body1 HTTP/1.1
Host: http://127.0.0.1:80
Content-Type: application/x-www-form-urlencoded

name=conanan&
sex=1&
address.provinceName=shannxi&
address.cityName=xian&
petList[0].nikeName=nikeName1&
petList[0].sex=1&
petList[1].nikeName=nikeName2&
petList[1].sex=0&
petMap['one'].nikeName=nikeName3&
petMap['one'].sex=1&
petMap['two'].nikeName=nikeName4&
petMap['two'].sex=0
```

è‹¥å‚æ•°é‡å¤ï¼Œä¼šå‡ºç°å…¶ä»–é—®é¢˜ï¼Œå¦‚æœ€åä¸€ä¸ª petMap['one'].sex=0ï¼Œä¸ä¼šæ›¿æ¢ï¼

Content-Type: application/x-www-form-urlencodedï¼Œçœ‹å…¶ä¸­ Body è¯·æ±‚ä½“ä¸ºé”®å€¼å¯¹æ•°æ®

Java åå°å¯ä»¥å¦‚ä¸‹æ–¹å¼æ¥æ”¶

```java
@Data
public class Student {
    private String name;
    private Boolean sex;
    private Address address;
    private List<Pet> petList;
    private Map<String, Pet> petMap;
}
```

```java
@Data
public class Address {
    private String provinceName;
    private String cityName;
}
```

```java
@Data
public class Pet {
    private String nikeName;
    private Boolean sex;
}
```

```java
@PostMapping("/body1")
public String body1(Student student){
    return String.format("body1: %s, %s, %s, %s, %s, %s",
                         student.getName(),
                         student.getSex(),
                         student.getAddress().getProvinceName(),
                         student.getAddress().getCityName(),
                         student.getPetList(),
                         student.getPetMap());
```

è‹¥æœ‰**å¤šä¸ªå¯¹è±¡**ï¼Œåˆ™è¿˜æ˜¯**æ ¹æ®å±æ€§åç§°æ¥æ¥æ”¶å‚æ•°**ï¼ï¼ï¼

```java
@PostMapping("/body1")
public String body1(Student student, Teacher teacher){
    return "";
}
```

è‹¥ Student å’Œ Teacher æœ‰åŒåå±æ€§ï¼Œåˆ™ç»‘å®šåè¯¥åŒåå±æ€§çš„å€¼ç›¸åŒï¼



### JSONâ€”`@RequestBody`

ä½œç”¨ï¼šç”¨äº**è·å–è¯·æ±‚ä½“**å†…å®¹ï¼ˆ**GET**ä¹Ÿæœ‰ï¼‰ï¼Œå¸¸ç”¨äº**JSONæ•°æ®å°è£…**ã€‚ä¸ä½¿ç”¨åˆ™å¾—åˆ°æ˜¯`key=value&key=value`ç»“æ„çš„æ•°æ®ã€‚

å±æ€§ï¼š

*   `required`æ˜¯å¦å¿…é¡»æœ‰è¯·æ±‚ä½“ï¼Œé»˜è®¤ä¸º trueï¼Œå³ä½¿æ˜¯ GET è¯·æ±‚ä¹Ÿå¿…é¡»æ·»åŠ è¯·æ±‚ä½“ï¼

```html
<form action="springmvc/useRequestBody" method="post">
    ç”¨æˆ·åç§°ï¼š<input type="text" name="username" ><br/>  
    ç”¨æˆ·å¯†ç ï¼š<input type="password" name="password" ><br/>  
    ç”¨æˆ·å¹´é¾„ï¼š<input type="text" name="age" ><br/> 
 <input type="submit" value=" ä¿å­˜ "> </form>
```

```java
@RequestMapping("/useRequestBody") 
public String useRequestBody(@RequestBody(required=false) String body){  
    System.out.println(body);  
    return "success"; 
}
```





### Map æ¥æ”¶å‚æ•°

åœ¨ Controller å±‚ä¸çŸ¥é“å‰ç«¯éƒ½ä¼šä¼ é€’å“ªäº›å‚æ•°ç»™åˆ°åç«¯ï¼Œä¸ºäº†**æ‰©å±•æ–¹ä¾¿**ï¼ˆä½†æ˜¯ï¼Œä¸èƒ½ä¼ åˆ° Service å±‚è¿˜æ˜¯ Map å§ï¼åªèƒ½åœ¨ Controller æ¥æ”¶æ—¶æ–¹ä¾¿ç‚¹ï¼‰ã€‚è®¸å¤šæ¡†æ¶ï¼ˆå¦‚ CXF ä¸å…è®¸æ¥æ”¶ Map å‚æ•°ï¼‰ï¼Œæ¯•ç«Ÿä¸èƒ½æŠŠ Java å†™æˆ JS æ˜¯å§ã€‚

*   SpringMVCå¤„ç†è¯·æ±‚ç”¨Mapç±»å‹æ¥æ”¶å‚æ•°æ—¶ï¼Œå¦‚æœå‚æ•°æ— æ³¨è§£ï¼Œåˆ™ä¼šä¼ å…¥BindingAwareModelMapç±»å‹ï¼Œç­‰ä»·äºModelã€ModelMapå‚æ•°ã€‚æ‰€ä»¥æ— æ³•æ¥å—åˆ°ä¼ å…¥çš„å‚æ•°
*   å‚æ•°æ·»åŠ  **@RequestParam** æ³¨è§£æ—¶ï¼Œæ¥æ”¶ Json ç±»å‹æ•°æ®ï¼Œä¼šå°†å‚æ•°åŒ…è£…ç§° LinkedHashMap å¯¹è±¡ï¼Œå‚æ•°çš„keyä¸ºMapçš„keyï¼Œå‚æ•°å€¼ä¸ºMapçš„keyï¼Œæ”¯æŒGetã€Postæ–¹æ³•ï¼ˆåº”è¯¥æ”¯æŒPutã€Deleteï¼Œæ²¡æœ‰æµ‹ï¼Œä¿©æ–¹æ³•ä¸Postç±»ä¼¼ï¼‰ã€‚å¯ä»¥**å°è£… PageBean å‚æ•°**ï¼
*   æ·»åŠ  **@RequestBody** æ³¨è§£æ—¶ï¼Œæ¥æ”¶ Json ç±»å‹æ•°æ®ï¼Œä¹Ÿä¼šåŒ…è£…æˆ LinkedHashMap å¯¹è±¡ï¼Œè¯¥æ³¨è§£ä¸æ”¯æŒGetè¯·æ±‚ï¼ŒGetè¯·æ±‚æ²¡æœ‰è¯·æ±‚ä½“ä¸èƒ½ä¼ Jsonã€‚







## å…¶ä»–æ¥æ”¶å‚æ•°æ–¹å¼

### `@DateTimeFormat`

ç›´æ¥åœ¨JavaBean**å±æ€§**ä¸Šæ·»åŠ æ³¨é‡Šå³å¯ï¼ˆåœ¨getæˆ–setæ–¹æ³•ä¸Šæ·»åŠ ï¼Œå‘½åè§„èŒƒçš„è¯å­—æ®µä¸Šæ·»åŠ ä¹Ÿè¡Œã€‚ç”±äºä¸€èˆ¬è‡ªåŠ¨ç”Ÿæˆï¼Œæ‰€ä»¥éƒ½è¡Œï¼‰

```java
@DateTimeFormat(pattern="yyyy-MM-dd HH:mm")
private Date creationTime;
```





### é»˜è®¤ç±»å‹è½¬æ¢å™¨

å¦‚ SpringMVC ä¼šå°†`a,b,c`è½¬ä¸º`String[]` ç±»å‹ï¼Œä½†æ˜¯ä¸èƒ½è½¬ä¸º`List<String>`ï¼Œè¿™å°±æ˜¯å®ƒé»˜è®¤çš„ä¸€ä¸ªç±»å‹è½¬æ¢å™¨



### è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨

é™¤äº†ç±»å‹è½¬æ¢å™¨ï¼ŒSpringMVCè¿˜æä¾›äº†**æ³¨è§£`@DateTimeFormate`æ¥è½¬æ¢æ—¥æœŸæ ¼å¼**ã€‚æŸ¥çœ‹5å¸¸ç”¨æ³¨è§£è¿™ä¸€ç« ã€‚

SpringMVCè¿˜å¯ä»¥å®ç°ä¸€äº›**æ•°æ®ç±»å‹è‡ªåŠ¨è½¬æ¢**ã€‚å†…ç½®è½¬æ¢å™¨å…¨éƒ½åœ¨`org.springframework.core.convert.support`åŒ…ä¸‹ã€‚å¦‚Stringè½¬Integerç­‰ç­‰

å¦‚é‡**ç‰¹æ®Šç±»å‹è½¬æ¢**è¦æ±‚ï¼Œæ¯”å¦‚æ—¥æœŸæ•°æ®æœ‰å¾ˆå¤šç§æ ¼å¼ï¼ŒSpringMVCæ²¡åŠæ³•æŠŠå¸¦`-`å­—ç¬¦ä¸²è½¬æ¢æˆæ—¥æœŸç±»å‹ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±ç¼–å†™**è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨**ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š

å®šä¹‰ä¸€ä¸ªç±»ï¼Œ**å®ç° Springæä¾›çš„ `Converter` æ¥å£**ï¼Œè¯¥æ¥å£æœ‰ä¸¤ä¸ªæ³›å‹ã€‚

```java
//Converter<S, T>ï¼š  S:source,éœ€è¦è½¬æ¢çš„æºçš„ç±»å‹ï¼›T:target,éœ€è¦è½¬æ¢çš„ç›®æ ‡ç±»å‹
@Componet
public class StringToDateConverter implements Converter<String, Date> {
    @Override
    public Date convert(String source) {
        DateFormat format = null;
        try {
            if (StringUtils.isEmpty(source)) {
                throw new NullPointerException("è¯·è¾“å…¥è¦è½¬æ¢çš„æ—¥æœŸ");
            }
            format = new SimpleDateFormat("yyyy-MM-dd");
            Date date = format.parse(source);
            return date;
        } catch (Exception e) {
            throw new RuntimeException("è¾“å…¥æ—¥æœŸæœ‰è¯¯");
        }
    }
}
```

```java
@Configuration
public class TimeConverterConfig {

    /**
     * description:LocalDateTimeè½¬æ¢å™¨ï¼Œç”¨äºè½¬æ¢RequestParamå’ŒPathVariableå‚æ•°
     * æ¥æ”¶æ¯«ç§’çº§æ—¶é—´æˆ³å­—ç¬¦ä¸²â€”â€”>LocalDateTime
     */
    @Bean
    public Converter<String, LocalDateTime> localDateTimeConverter() {
        return source -> {
            //æ¯«ç§’çº§æ—¶é—´æˆ³è½¬LocalDateTime
            return LocalDateTimeUtil.of(Long.parseLong(source), ZoneOffset.of("+8"));
        };
    }

    /**
     * description:java.util.Dateè½¬æ¢å™¨
     * æ¥æ”¶æ¯«ç§’çº§æ—¶é—´æˆ³å­—ç¬¦ä¸²â€”â€”>Date
     */
    @Bean
    public Converter<String, Date> dateConverter() {
        return source -> {
            long longTimeStamp = new Long(source);
            return new Date(longTimeStamp);
        };
    }

}
```









### Servlet Api

**æ§åˆ¶å™¨**(å¤„ç†å™¨)**å½¢å‚**ä¸­æ·»åŠ å¦‚ä¸‹ç±»å‹çš„å‚æ•°ï¼Œå¤„ç†é€‚é…å™¨ä¼šé»˜è®¤è¯†åˆ«å¹¶è¿›è¡Œèµ‹å€¼

- `HttpServletRequest`ï¼šé€šè¿‡requestå¯¹è±¡è·å–è¯·æ±‚ä¿¡æ¯
- `HttpServletResponse`ï¼šé€šè¿‡responseå¤„ç†å“åº”ä¿¡æ¯
- `HttpSession`ï¼šé€šè¿‡sessionå¯¹è±¡å¾—åˆ°sessionä¸­å­˜æ”¾çš„å¯¹è±¡



### `@RequestHeader`

ä¸€èˆ¬ä¸æ€ä¹ˆç”¨

* ä½œç”¨ï¼šç”¨äºè·å–è¯·æ±‚æ¶ˆæ¯å¤´ã€‚ 
* å±æ€§ï¼š`value`æä¾›æ¶ˆæ¯å¤´åç§°ã€‚`required`æ˜¯å¦å¿…é¡»æœ‰æ­¤æ¶ˆæ¯å¤´ 



### `@CookieValue`

ä¸€èˆ¬ä¸æ€ä¹ˆç”¨

* ä½œç”¨ï¼šç”¨äºæŠŠæŒ‡å®š cookie åç§°çš„å€¼ä¼ å…¥æ§åˆ¶å™¨æ–¹æ³•å‚æ•°ã€‚ 
* å±æ€§ï¼š`value`æŒ‡å®š cookie çš„åç§°ã€‚`required`æ˜¯å¦å¿…é¡»æœ‰æ­¤ cookie



### `@SessionAttribute`

* ä½œç”¨ï¼šç”¨äºå¤šæ¬¡æ‰§è¡Œæ§åˆ¶å™¨æ–¹æ³•é—´çš„å‚æ•°å…±äº«ã€‚ 

* å±æ€§ï¼š

    * `value`ï¼šç”¨äºæŒ‡å®šå­˜å…¥çš„å±æ€§åç§°  
    * `type`ï¼šç”¨äºæŒ‡å®šå­˜å…¥çš„æ•°æ®ç±»å‹ã€‚ 

    ```java
    @Controller("sessionAttributeController") 
    @RequestMapping("/springmvc") 
    @SessionAttributes(value= {"username","password","age"},types= {String.class,Integer.class})//å­˜å…¥åˆ°sessionåŸŸ 
    public class SessionAttributeController { 
        @RequestMapping("/testPut")    
        public String testPut(Model model){           
            model.addAttribute("username", "æ³°æ–¯ç‰¹");           
            model.addAttribute("password","123456");           
            model.addAttribute("age", 31);   
            //è·³è½¬ä¹‹å‰å°†æ•°æ®ä¿å­˜åˆ° usernameã€password å’Œ age ä¸­ï¼Œå› ä¸ºæ³¨è§£@SessionAttribute ä¸­æœ‰è¿™å‡ ä¸ªå‚æ•° 
            return "success"; 
        }
        
        @RequestMapping("/testGet")       
        public String testGet(ModelMap model){           
            System.out.println(model.get("username")+";"+model.get("password")+";"+model.get("age"));           
            return "success";       
        } 
        
        @RequestMapping("/testClean")        
        public String complete(SessionStatus sessionStatus){         
            sessionStatus.setComplete();            
            return "success";        
        }
    }
    ```



### `@ModelAttribute`

è¯¥æ³¨è§£æ˜¯ SpringMVC4.3 ç‰ˆæœ¬ä»¥åæ–°åŠ å…¥çš„ã€‚å®ƒå¯ä»¥ç”¨äºä¿®é¥°æ–¹æ³•å’Œå‚æ•°ã€‚ 

- å‡ºç°åœ¨**æ–¹æ³•ä¸Š**ï¼Œè¡¨ç¤ºå½“å‰æ–¹æ³•ä¼šåœ¨**æ§åˆ¶å™¨çš„æ–¹æ³•æ‰§è¡Œä¹‹å‰å…ˆæ‰§è¡Œ**ã€‚å®ƒå¯ä»¥ä¿®é¥°æ²¡æœ‰è¿”å›å€¼å’Œæœ‰å…·ä½“è¿”å›å€¼çš„æ–¹æ³•
- å‡ºç°åœ¨**å‚æ•°ä¸Š**ï¼Œè·å–**æŒ‡å®šçš„æ•°æ®ç»™å‚æ•°èµ‹å€¼**

* å±æ€§ï¼š`value`ç”¨äºè·å–æ•°æ®çš„ keyã€‚key å¯ä»¥æ˜¯ **POJO** çš„å±æ€§åç§°ï¼Œä¹Ÿå¯ä»¥æ˜¯ **map** ç»“æ„çš„ keyã€‚ 

* åº”ç”¨åœºæ™¯ï¼šå½“è¡¨å•æäº¤æ•°æ®ä¸æ˜¯å®Œæ•´çš„å®ä½“ç±»æ•°æ®æ—¶ï¼Œä¿è¯**æ²¡æœ‰æäº¤æ•°æ®çš„å­—æ®µ**ä½¿ç”¨**æ•°æ®åº“å¯¹è±¡åŸæ¥çš„æ•°æ®**ã€‚

    æˆ‘ä»¬åœ¨ç¼–è¾‘ä¸€ä¸ªç”¨æˆ·æ—¶ï¼Œç”¨æˆ·æœ‰ä¸€ä¸ªåˆ›å»ºä¿¡æ¯å­—æ®µï¼Œè¯¥å­—æ®µçš„å€¼æ˜¯ä¸å…è®¸è¢«ä¿®æ”¹çš„ã€‚åœ¨æäº¤è¡¨å•æ•°æ®æ˜¯è‚¯å®šæ²¡æœ‰æ­¤å­—æ®µçš„å†…å®¹ï¼Œä¸€æ—¦æ›´æ–°ä¼šæŠŠè¯¥å­—æ®µå†…å®¹ç½®ä¸º nullï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨æ­¤æ³¨è§£è§£å†³é—®é¢˜ã€‚ä½†æ˜¯è¿™ç§é—®é¢˜æœ‰å…¶ä»–åŠæ³•è§£å†³ã€‚

* åŸºäºPOJO å±æ€§çš„åŸºæœ¬ä½¿ç”¨

    ```html
    <a href="springmvc/testModelAttribute?username=test">æµ‹è¯• modelattribute</a> 
    ```

    ```java
    @ModelAttribute  
    public void showModel(User user) {   
        System.out.println("æ‰§è¡Œäº† showModel æ–¹æ³•"+user.getUsername());  
    } 
    @RequestMapping("/testModelAttribute") 
    public String testModelAttribute(User user) {   
        System.out.println("æ‰§è¡Œäº†æ§åˆ¶å™¨çš„æ–¹æ³•"+user.getUsername());   
        return "success";  
    }
    //æ‰§è¡Œäº† showModel æ–¹æ³•
    //æ‰§è¡Œäº†æ§åˆ¶å™¨çš„æ–¹æ³•
    ```

* åŸºäº Map çš„åº”ç”¨åœºæ™¯ç¤ºä¾‹ 1ï¼šModelAttribute ä¿®é¥°æ–¹æ³•å¸¦è¿”å›å€¼ 

    ```html
    <!--éœ€æ±‚ï¼š  ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼Œè¦æ±‚ç”¨æˆ·çš„å¯†ç ä¸èƒ½ä¿®æ”¹ -->
    <form action="springmvc/updateUser" method="post"> 
        ç”¨æˆ·åç§°ï¼š<input type="text" name="username" ><br/>  
        ç”¨æˆ·å¹´é¾„ï¼š<input type="text" name="age" ><br/>  
        <input type="submit" value=" ä¿å­˜ "> 
    </form> 
    ```

    ```java
    // æ¨¡æ‹Ÿä¿®æ”¹ç”¨æˆ·æ–¹æ³• 
    @RequestMapping("/updateUser") 
    public String testModelAttribute(User user) {  
        System.out.println("æ§åˆ¶å™¨ä¸­å¤„ç†è¯·æ±‚çš„æ–¹æ³•ï¼šä¿®æ”¹ç”¨æˆ·ï¼š"+user);  
        return "success"; 
    }
    @ModelAttribute public User showModel(String username) {  
        //æ¨¡æ‹Ÿå»æ•°æ®åº“æŸ¥è¯¢  
        User abc = findUserByName(username); 
        System.out.println("æ‰§è¡Œäº† showModel æ–¹æ³•"+abc);  
        return abc; 
    } 
    // æ¨¡æ‹Ÿå»æ•°æ®åº“æŸ¥è¯¢ 
    private User findUserByName(String username) {  
        User user = new User();  
        user.setUsername(username);
        user.setAge(19);  
        user.setPassword("123456");  
        return user; 
    }
    //è¾“å‡ºä¼šç»™æœªæäº¤çš„ageå­—æ®µèµ‹å€¼19ï¼Œå…¶ä»–çš„ä½¿ç”¨æäº¤çš„æ•°æ®
    ```

* åŸºäº Map çš„åº”ç”¨åœºæ™¯ç¤ºä¾‹ 2ï¼šModelAttribute ä¿®é¥°æ–¹æ³•ä¸å¸¦è¿”å›å€¼ 

    ```java
    @RequestMapping("/updateUser") 
    public String testModelAttribute(@ModelAttribute("abc")User user) {  
        System.out.println("æ§åˆ¶å™¨ä¸­å¤„ç†è¯·æ±‚çš„æ–¹æ³•ï¼šä¿®æ”¹ç”¨æˆ·ï¼š"+user);  
        return "success"; 
    }
    @ModelAttribute 
    public void showModel(String username,Map<String,User> map) { 
     	//æ¨¡æ‹Ÿå»æ•°æ®åº“æŸ¥è¯¢  
        User user = findUserByName(username); 
        System.out.println("æ‰§è¡Œäº† showModel æ–¹æ³•"+user);  
        map.put("abc",user); 
    } 
    // æ¨¡æ‹Ÿå»æ•°æ®åº“æŸ¥è¯¢ 
    private User findUserByName(String username) {  
        User user = new User();  
        user.setUsername(username);
        user.setAge(19);  
        user.setPassword("123456");  
        return user; 
    }
    //è¾“å‡ºä¼šç»™æœªæäº¤çš„ageå­—æ®µèµ‹å€¼19ï¼Œå…¶ä»–çš„ä½¿ç”¨æäº¤çš„æ•°æ®
    ```



## å‚æ•°æ ¡éªŒ JSR303 ç­‰ ğŸ”¥

### æ–‡æ¡£

å‚è€ƒ[å®˜ç½‘](https://beanvalidation.org/)

### ä¾èµ–å¼•å…¥

åœ¨ SpringBoot 2.3.x ä»¥å‰ SpringBoot åŒ…é»˜è®¤å¼•å…¥ spring-boot-starter-validation åŒ…ï¼Œè€Œè‡ª SpringBoot 2.3.x ä»¥åå®˜æ–¹å°†å…¶æ’é™¤ï¼Œéœ€è¦å•ç‹¬å¼•å…¥ã€‚

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-validation</artifactId>
</dependency>
```



### @Valid & @Validated ğŸ”¥

å‚è€ƒ[åšå®¢](https://blog.csdn.net/qq_27680317/article/details/79970590)

*   javaxæä¾›äº†@Validï¼ˆæ ‡å‡†JSR-303è§„èŒƒï¼‰ï¼Œé…åˆBindingResultå¯ä»¥ç›´æ¥æä¾›å‚æ•°éªŒè¯ç»“æœ

*   Spring ValidationéªŒè¯æ¡†æ¶å¯¹å‚æ•°çš„éªŒè¯æœºåˆ¶æä¾›äº†@Validatedï¼ˆSpring's JSR-303è§„èŒƒï¼Œæ˜¯æ ‡å‡†JSR-303çš„ä¸€ä¸ªå˜ç§ï¼‰

åœ¨æ£€éªŒControllerçš„å…¥å‚æ˜¯å¦ç¬¦åˆè§„èŒƒæ—¶ï¼Œä½¿ç”¨@Validatedæˆ–è€…@Validåœ¨åŸºæœ¬éªŒè¯åŠŸèƒ½ä¸Šæ²¡æœ‰å¤ªå¤šåŒºåˆ«ã€‚ä½†æ˜¯åœ¨åˆ†ç»„ã€æ³¨è§£åœ°æ–¹ã€åµŒå¥—éªŒè¯ç­‰åŠŸèƒ½ä¸Šä¸¤ä¸ªæœ‰æ‰€ä¸åŒï¼š

åˆ†ç»„: 

*   @Validï¼šä½œä¸ºæ ‡å‡†JSR-303è§„èŒƒï¼Œè¿˜æ²¡æœ‰å¸æ”¶åˆ†ç»„çš„åŠŸèƒ½ã€‚
*   **@Validated**ï¼šæä¾›äº†ä¸€ä¸ª**åˆ†ç»„**åŠŸèƒ½ï¼Œå¯ä»¥åœ¨å…¥å‚éªŒè¯æ—¶ï¼Œæ ¹æ®ä¸åŒçš„åˆ†ç»„é‡‡ç”¨ä¸åŒçš„éªŒè¯æœºåˆ¶

**æ³¨è§£åœ°æ–¹**:

*   **@Valid**ï¼šå¯ä»¥ç”¨åœ¨æ–¹æ³•ã€æ„é€ å‡½æ•°ã€æ–¹æ³•å‚æ•°å’Œ**æˆå‘˜å±æ€§ï¼ˆå­—æ®µï¼‰**ä¸Š

*   @Validatedï¼šå¯ä»¥ç”¨åœ¨ç±»å‹ã€æ–¹æ³•å’Œæ–¹æ³•å‚æ•°ä¸Šã€‚ä½†æ˜¯ä¸èƒ½ç”¨åœ¨æˆå‘˜å±æ€§ï¼ˆå­—æ®µï¼‰ä¸Š

    **ä¸¤è€…æ˜¯å¦èƒ½ç”¨äºæˆå‘˜å±æ€§ï¼ˆå­—æ®µï¼‰ä¸Šç›´æ¥å½±å“èƒ½å¦æä¾›åµŒå¥—éªŒè¯çš„åŠŸèƒ½ã€‚**

**åµŒå¥—ï¼ˆé›†è”ï¼‰éªŒè¯**ï¼ˆå‚è€ƒä¸Šé¢é‚£ä¸ªåšå®¢ï¼‰

*   @Validatedå’Œ@ValidåŠ åœ¨æ–¹æ³•å‚æ•°å‰ï¼Œéƒ½ä¸ä¼šè‡ªåŠ¨å¯¹å‚æ•°è¿›è¡ŒåµŒå¥—éªŒè¯ã€‚èƒ½å¤Ÿç”¨åœ¨æˆå‘˜å±æ€§ï¼ˆå­—æ®µï¼‰ä¸Šï¼Œæç¤ºéªŒè¯æ¡†æ¶è¿›è¡ŒåµŒå¥—éªŒè¯

**æ€»ç»“**ï¼š

*   **éæˆå‘˜å±æ€§ï¼ˆå­—æ®µï¼‰ç›´æ¥ä½¿ç”¨ @Validatedï¼Œå¼€å¯æ ¡éªŒ**
*   **æˆå‘˜å±æ€§ï¼ˆå­—æ®µï¼‰ç›´æ¥ä½¿ç”¨ @Validï¼ŒåµŒå¥—ï¼ˆé›†è”ï¼‰æ ¡éªŒ**

æ³¨æ„ï¼ŒValidation ä¼š**å°†æ‰€æœ‰éœ€è¦çš„éƒ½æ ¡éªŒ**ï¼Œå³ä½¿ç¬¬ä¸€ä¸ªå‚æ•°ä¸é€šè¿‡ï¼Œè¿˜æ˜¯æ ¡éªŒå…¶ä»–å‚æ•°ã€‚æ‰€ä»¥æ­¤æ—¶éœ€è¦æŠŠæ‰€æœ‰çš„é”™è¯¯æ¶ˆæ¯éƒ½è¿”å›ã€‚



ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ ¡éªŒçš„æ³¨è§£åªèƒ½åœ¨å®ä½“ç±»ä¸Šæ ‡è®°ï¼Œå¦åˆ™ä¸èµ·ä½œç”¨ï¼Œä½†å…¶å®æ˜¯æ²¡æœ‰åœ¨ Controller ä¸Šå†™ Spring æä¾›çš„ @Validated æ³¨è§£ï¼Œè¯¥æ³¨è§£ç”¨äºå¼€å¯æ§åˆ¶å™¨ä¸­çš„ @RequestParams å’Œ @PathVariables çš„éªŒè¯ï¼Œ**æ–¹æ³•çº§åˆ«ä¸Šçš„æ ¡éªŒ**

```java
@RestController
@RequestMapping("/hello")
@Validated
public class HelloController {


    @PostMapping("/test/{id}")
    public ResponseEntity<List<User>> test(
        @PathVariable @Range(min = 1, max = 10, message = "1~10å“¦ï¼") Integer id,
        @RequestBody User user) {
        List<User> list = new ArrayList<>();
        User user1 = User.builder()
            .name("zhangsan")
            .age(3L)
            .build();
        list.add(user1);
        System.out.println("test");
        return new ResponseEntity<>(list, HttpStatus.OK);
    }
}
```

å½“æŸ¥è¯¢å‚æ•°å’Œè·¯å¾„å‚æ•°éƒ½ä¸ç¬¦åˆæ ¡éªŒè§„åˆ™ã€‚åŒæ—¶bodyå‚æ•°ä¹Ÿä¸ç¬¦åˆæ ¡éªŒè§„åˆ™ã€‚åªä¼šå‡ºç°bodyæ ¡éªŒè§„åˆ™çš„é”™è¯¯ä¿¡æ¯ã€‚å¦‚æœbodyå‚æ•°å…¨éƒ¨ç¬¦åˆè§„åˆ™æ‰ä¼šå‡ºç°æŸ¥è¯¢å‚æ•°å’Œè·¯å¾„å‚æ•°æ ¡éªŒå¤±è´¥ä¿¡æ¯ã€‚



### å¸¸ç”¨æ³¨è§£ ğŸ”¥

*   @Range(min = 1, max = 10, message = "æ•°å­—åº”ä¸º1~10å“¦ï¼")ï¼šç”¨äºæ•°å­—
*   @Length(min = 1, max = 10, message = "å­—ç¬¦ä¸²é•¿åº¦åº”åœ¨1~10å“¦ï¼")ï¼šç”¨äºå­—ç¬¦ä¸²



### è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£ ğŸ”¥

å®ä½“ç±»

```java
@Builder
@Getter
// @Setter
// @NoArgsConstructor
// @AllArgsConstructor
@PasswordEqualValid
public class User {

    @Length(min = 3, max = 7, message = "å­—ç¬¦ä¸²é•¿åº¦åº”åœ¨3~7å“¦ï¼")
    private String name;

    @NonNull
    private  Long age;

    @Length(min = 8, max = 16, message = "å¯†ç é•¿åº¦åº”åœ¨8ï½16ä½å“¦ï¼")
    private String password;

    private String password2;
}
```

è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£

```java
/**
 * æ ¡éªŒä¸¤æ¬¡å¯†ç æ˜¯å¦ç›¸åŒï¼Œåº”æ”¾åœ¨ç±»ä¸Šï¼ˆéœ€è¦æ“ä½œå¯¹è±¡çš„ä¸¤ä¸ªå­—æ®µï¼‰ï¼Œå¿…é¡»æœ‰ passwordã€password2 å­—æ®µ
 */
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = PasswordEqualValidator.class)// æ˜¯æ•°ç»„ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ª validatorã€‚ç±»ä¼¼ @Import å…³è”æ¨¡å¼
public @interface PasswordEqualValid {

    String message() default "å¯†ç ä¸ç›¸åŒ";

    /** è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£å¿…é¡»åŠ ä¸Šçš„ */
    Class<?>[] groups() default { };

    /** è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£å¿…é¡»åŠ ä¸Šçš„ */
    Class<? extends Payload>[] payload() default { };

}
```

æ ¡éªŒå™¨

```java
/**
 * æ³›å‹ç¬¬äºŒä¸ªå‚æ•°ç”¨äºè¯¥è‡ªå®šä¹‰æ³¨è§£ä¿®é¥°çš„ç›®æ ‡ç±»å‹ï¼Œè‹¥æ˜¯å­—æ®µï¼Œåˆ™ä¸ºå­—æ®µçš„ç±»å‹ï¼
 * æ— éœ€ä½¿ç”¨ @Configuration ç­‰æ³¨è§£
 */
public class PasswordEqualValidator implements ConstraintValidator<PasswordEqualValid, User> {

    private PasswordEqualValid passwordEqualValid;

    /**
     * è·å–åˆå§‹åŒ–æ—¶æ ¡éªŒæ³¨è§£çš„ä¿¡æ¯
     * @param constraintAnnotation çº¦æŸæ³¨è§£
     */
    @Override
    public void initialize(PasswordEqualValid constraintAnnotation) {
        this.passwordEqualValid = constraintAnnotation;
    }

    @Override
    public boolean isValid(User user, ConstraintValidatorContext constraintValidatorContext) {
        String password = user.getPassword();
        String password2 = user.getPassword2();
        return password.equals(password2);
    }
}
```

æµ‹è¯•

```java
@RestController
@RequestMapping("/hello")
@Validated
public class HelloController {

    @PostMapping("/test/{id}")
    public ResponseEntity<List<User>> test(
            @PathVariable @Range(min = 1, max = 10, message = "1~10å“¦ï¼") Integer id,
            @Length(max = 5, message = "å§“åé•¿åº¦æœ€å¤§ä¸º5") String name,
            @Validated Dog dog,// è¿™é‡Œä¸æµ‹è¯•è¡¨å•æäº¤
            @RequestBody @Validated User user) {
        List<User> list = new ArrayList<>();
        User user1 = User.builder()
                .name("zhangsan")
                .age(3L)
                .build();
        list.add(user1);
        System.out.println("test");
        return new ResponseEntity<>(list, HttpStatus.OK);
    }
}
```



### åˆ†ç»„æ ¡éªŒ









## Multipart æ–‡ä»¶

### æ–‡ä»¶ä¸Šä¼ çš„å›é¡¾

* **formè¡¨å•çš„`enctype`å–å€¼å¿…é¡»æ˜¯`multipart/form-data`**(é»˜è®¤å€¼æ˜¯`application/x-www-form-urlencoded`)ã€‚`enctype`ä»£è¡¨è¡¨å•è¯·æ±‚æ­£æ–‡çš„ç±»å‹
* `method` å±æ€§å–å€¼å¿…é¡»æ˜¯ `Post`
* æä¾›ä¸€ä¸ª**æ–‡ä»¶é€‰æ‹©åŸŸ**`<input type="file" />  `

```html
<form action="user/fileupload" method="post" enctype="multipart/form-data">       
    é€‰æ‹©æ–‡ä»¶ï¼š<input type="file" name="upload"/><br/>        
    <input type="submit" value="ä¸Šä¼ æ–‡ä»¶"/>    
</form>
```

```java
@RequestMapping(value="/fileupload")    
public String fileupload(HttpServletRequest request) throws Exception {        
    // å…ˆè·å–åˆ°è¦ä¸Šä¼ çš„æ–‡ä»¶ç›®å½•        
    String path = request.getSession().getServletContext().getRealPath("/uploads");        
    // åˆ›å»ºFileå¯¹è±¡ï¼Œä¸€ä¼šå‘è¯¥è·¯å¾„ä¸‹ä¸Šä¼ æ–‡ä»¶        
    File file = new File(path);        
    // åˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºè¯¥è·¯å¾„        
    if(!file.exists()) {            
        file.mkdirs();        
    }        
    // åˆ›å»ºç£ç›˜æ–‡ä»¶é¡¹å·¥å‚        
    DiskFileItemFactory factory = new DiskFileItemFactory();        
    ServletFileUpload fileUpload = new ServletFileUpload(factory);        
    // è§£ærequestå¯¹è±¡        
    List<FileItem> list = fileUpload.parseRequest(request);        
    // éå†        
    for (FileItem fileItem : list) {            
        // åˆ¤æ–­æ–‡ä»¶é¡¹æ˜¯æ™®é€šå­—æ®µï¼Œè¿˜æ˜¯ä¸Šä¼ çš„æ–‡ä»¶            
        if(fileItem.isFormField()) {                            

        }else {                
            // ä¸Šä¼ æ–‡ä»¶é¡¹
            // è·å–åˆ°ä¸Šä¼ æ–‡ä»¶çš„åç§°                
            String filename = fileItem.getName();               
            // ä¸Šä¼ æ–‡ä»¶                
            fileItem.write(new File(file, filename));                
            // åˆ é™¤ä¸´æ—¶æ–‡ä»¶                
            fileItem.delete();            
        }        
    }                
    return "success";    
}
```





### SpringMVCä¼ ç»Ÿæ–¹å¼çš„æ–‡ä»¶ä¸Šä¼ 

pom.xmlä¸­æ·»åŠ ä¾èµ–ï¼ˆå¯ä¸åŠ ï¼‰

```xml
<dependency>            
    <groupId>commons-fileupload</groupId>            
    <artifactId>commons-fileupload</artifactId>            
    <version>1.3.1</version>        
</dependency>        
<dependency>            
    <groupId>commons-io</groupId>            
    <artifactId>commons-io</artifactId>            
    <version>2.4</version>        
</dependency
```



ä¼ ç»Ÿæ–¹å¼çš„æ–‡ä»¶ä¸Šä¼ ï¼ŒæŒ‡çš„æ˜¯æˆ‘ä»¬**ä¸Šä¼ çš„æ–‡ä»¶å’Œè®¿é—®çš„åº”ç”¨å­˜åœ¨äºåŒä¸€å°æœåŠ¡å™¨ä¸Š**ã€‚ å¹¶ä¸”ä¸Šä¼ å®Œæˆä¹‹åï¼Œæµè§ˆå™¨å¯èƒ½è·³è½¬ã€‚ 

```java
@RequestMapping(value="/fileupload2")    
public String fileupload2(HttpServletRequest request,MultipartFile upload) throws Exception {        
    System.out.println("SpringMVCæ–¹å¼çš„æ–‡ä»¶ä¸Šä¼ ...");        
    // å…ˆè·å–åˆ°è¦ä¸Šä¼ çš„æ–‡ä»¶ç›®å½•        
    String path = request.getSession().getServletContext().getRealPath("/uploads");        
    // åˆ›å»ºFileå¯¹è±¡ï¼Œä¸€ä¼šå‘è¯¥è·¯å¾„ä¸‹ä¸Šä¼ æ–‡ä»¶        
    File file = new File(path);        
    // åˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºè¯¥è·¯å¾„        
    if(!file.exists()) {            
        file.mkdirs();        
    }        
    // è·å–åˆ°ä¸Šä¼ æ–‡ä»¶çš„åç§°        
    String filename = upload.getOriginalFilename();        
    String uuid = UUID.randomUUID().toString().replaceAll("-", "").toUpperCase();        
    // æŠŠæ–‡ä»¶çš„åç§°å”¯ä¸€åŒ–        
    filename = uuid+"_"+filename;        
    // ä¸Šä¼ æ–‡ä»¶        
    upload.transferTo(new File(file,filename));        
    return "success";    
}
```

* SpringBooté…ç½®

    â€‹    

* JavaConfigé…ç½®**MultipartResolver**æ¥å£çš„å®ç°ç±»

    - `CommonsMultipartResolver`ï¼šä½¿ç”¨Jakarta Commons FileUploadè§£æmultipartè¯·æ±‚

    - **`StandardServletMultipartResolver`**ï¼šä¾èµ–äº**Servlet3.0**å¯¹multipartè¯·æ±‚æ”¯æŒï¼ˆ**å§‹äºSpring3.1**ï¼‰

        é€‰æ‹©è¿™ä¸ªï¼Œå®ƒä½¿ç”¨Servletæ‰€æä¾›çš„åŠŸèƒ½æ”¯æŒï¼Œä¸ä¾èµ–å…¶ä»–é¡¹ç›®ã€‚å®ƒ**æ²¡æœ‰æ„é€ å™¨å‚æ•°å’Œå±æ€§**

        ```java
        @Bean
        public MultipartResolver multipartResolver() throws IOException {
            return new StandardServletMultipartResolver();
        }
        ```

        å¦‚æœé…ç½®DispatcherServletçš„Servletåˆå§‹åŒ–ç±»ç»§æ‰¿äº†**AbstractAnnotationConfigDispatcherServletInitializer**æˆ–AbstractDispatcherServletInitializerçš„è¯ï¼Œé€šè¿‡**é‡è½½customize Registration()æ–¹æ³•**ï¼ˆå®ƒä¼šå¾—åˆ°Dynamicå‚æ•°ï¼‰æ¥é…ç½®multipartçš„å…·ä½“ç»†èŠ‚

        ```java
        //class Config extends AbstractAnnotationConfigDispatcherServletInitializer
        @Override
        protected void customizeRegistration(Dynamic registration) {
            registration.setMultipartConfig(new MultipartConfigElement("/tmp/file/uploads",2097152,4194304,0));
            //location,maxFileSize,maxRequestSize,fileSizeThreshold(ä¸º0åˆ™ä¸Šä¼ æ–‡ä»¶å†™åˆ°ç£ç›˜)
        }
        ```

* åœ¨`spring-config.xml`é…ç½®æ–‡ä»¶è§£æå™¨

    ```xml
    <!-- é…ç½®æ–‡ä»¶ä¸Šä¼ è§£æå™¨ï¼Œidæ˜¯å›ºå®šçš„ï¼ï¼ï¼--> 
    <bean id="multipartResolver"  class="org.springframework.web.multipart.commons.CommonsMultipartResolver"> 
     <!-- è®¾ç½®ä¸Šä¼ æ–‡ä»¶çš„æœ€å¤§å°ºå¯¸ä¸º 5MB -->  
        <property name="maxUploadSize">   
            <value>5242880</value>  
        </property> 
    </bean>
    ```

    



### SpringMVCè·¨æœåŠ¡å™¨æ–¹å¼çš„æ–‡ä»¶ä¸Šä¼ 

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¼šæœ‰å¾ˆå¤šå¤„ç†ä¸åŒåŠŸèƒ½çš„æœåŠ¡å™¨ï¼ˆä¸æ˜¯æœåŠ¡å™¨é›†ç¾¤ï¼‰ï¼Œç›®çš„æ˜¯è®©æœåŠ¡å™¨å„å¸å…¶èŒï¼Œä»è€Œæé«˜æˆ‘ä»¬é¡¹ç›®çš„è¿è¡Œæ•ˆç‡ã€‚ä¾‹å¦‚ï¼š 

* åº”ç”¨æœåŠ¡å™¨ï¼šè´Ÿè´£éƒ¨ç½²æˆ‘ä»¬çš„åº”ç”¨ 
* æ–‡ä»¶æœåŠ¡å™¨ï¼šè´Ÿè´£å­˜å‚¨ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶çš„æœåŠ¡å™¨
* æ•°æ®åº“æœåŠ¡å™¨ï¼šè¿è¡Œæˆ‘ä»¬çš„æ•°æ®åº“ 
* â€¦â€¦

æ­¥éª¤ï¼š

1. **æ­å»ºå›¾ç‰‡æœåŠ¡å™¨** 

    1. æ ¹æ®æ–‡æ¡£é…ç½®tomcat9çš„æœåŠ¡å™¨ï¼Œç°åœ¨æ˜¯2ä¸ªæœåŠ¡å™¨ 
    2. å¯¼å…¥èµ„æ–™ä¸­day02_springmvc5_02imageé¡¹ç›®ï¼Œä½œä¸ºå›¾ç‰‡æœåŠ¡å™¨ä½¿ç”¨ 

2. å®ç°SpringMVCè·¨æœåŠ¡å™¨æ–¹å¼æ–‡ä»¶ä¸Šä¼ 

    1. å¯¼å…¥ä¾èµ–çš„jaråŒ…çš„åæ ‡ï¼ˆsunå…¬å¸æä¾›çš„ï¼Œä¸‹é¢å¯¼åŒ…æ—¶æ³¨æ„ï¼‰

        ```xml
        <dependency>            
            <groupId>com.sun.jersey</groupId>            
            <artifactId>jersey-core</artifactId>            
            <version>1.18.1</version>        
        </dependency>        
        <dependency>            
            <groupId>com.sun.jersey</groupId>            
            <artifactId>jersey-client</artifactId>            
            <version>1.18.1</version>        
        </dependency>
        ```

    2. æ§åˆ¶å™¨

        ```java
        @RequestMapping(value="/fileupload3")
        public String fileupload3(MultipartFile upload) throws Exception {        
            System.out.println("SpringMVCè·¨æœåŠ¡å™¨æ–¹å¼çš„æ–‡ä»¶ä¸Šä¼ ...");                
            // å®šä¹‰å›¾ç‰‡æœåŠ¡å™¨çš„è¯·æ±‚è·¯å¾„        
            String path = "http://localhost:9090/day02_springmvc5_02image/uploads/";//åˆ›å»ºå¥½è¯¥æ–‡ä»¶å¤¹              
            // è·å–åˆ°ä¸Šä¼ æ–‡ä»¶çš„åç§°        
            String filename = upload.getOriginalFilename();        
            String uuid = UUID.randomUUID().toString().replaceAll("-", "").toUpperCase();        
            // æŠŠæ–‡ä»¶çš„åç§°å”¯ä¸€åŒ–        
            filename = uuid+"_"+filename;        
            // å‘å›¾ç‰‡æœåŠ¡å™¨ä¸Šä¼ æ–‡ä»¶                
            // åˆ›å»ºå®¢æˆ·ç«¯å¯¹è±¡        
            Client client = Client.create();        
            // è¿æ¥å›¾ç‰‡æœåŠ¡å™¨        
            WebResource webResource = client.resource(path+filename);        
            // ä¸Šä¼ æ–‡ä»¶        
            webResource.put(upload.getBytes());        
            return "success";    
        }
        ```

    3. **é…ç½®æ–‡ä»¶è§£æå™¨**ï¼ŒåŒä¸Š









