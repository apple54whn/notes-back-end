---
title: å®‰è£…&é…ç½®
date: 2021-06-21 21:25:05
permalink: /pages/21f8cb/
categories:
  - Redis
  - é«˜çº§
tags:
  - 
---
# å®‰è£…&é…ç½®

## å®˜ç½‘

- [å®˜ç½‘](https://redis.io)
- [ä¸­æ–‡ç½‘](http://www.redis.net.cn/)

## ä»æºç å®‰è£… ğŸ”¥

ä¸‹è½½ã€è§£å‹ã€ç¼–è¯‘ Redisï¼š

```bash
$ wget https://download.redis.io/releases/redis-6.2.1.tar.gz
$ tar xzf redis-6.2.1.tar.gz
$ cd redis-6.2.1
$ make
```

ç°åœ¨ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶å¯ä»¥åœ¨ src ç›®å½•ä¸­æ‰¾åˆ°ã€‚è¿è¡Œï¼š

```bash
$ src/redis-server [redis.conf]
```

ä½ å¯ä»¥ä½¿ç”¨å†…ç½®çš„å®¢æˆ·ç«¯ä¸ Redis è¿›è¡Œäº¤äº’

```bash
$ src/redis-cli
redis> set foo bar
OK
redis> get foo
"bar"
```

ä¸€èˆ¬æ¨èåˆ›å»º confã€data ç›®å½•

## Dockerâ€”æš‚ä¸æ¨è ğŸ”¥

ç›®å‰äº†è§£åˆ°çš„é…ç½®ä¸å¤Ÿï¼Œæš‚ä¸æ¨è

å‚è€ƒ[æ–‡æ¡£](https://hub.docker.com/_/redis/)

```bash
docker pull redis
```

ä½¿ç”¨ docker compose å¯ä»¥å‚è€ƒ Google æœç´¢ç»“æœï¼Œæˆ–å¦‚ä¸‹ï¼ˆä¸æ˜¯æœ€æ–°çš„ compose æ–‡ä»¶äº†ï¼‰

```yml
version: '3.1'

services:
  redis:
    image: redis
    restart: 'no'
    ports:
      - 6379:6379
```

å¯åŠ¨ Redis å®¹å™¨

- æ‰§è¡Œ`docker compose up -d`ä¸‹è½½å¯åŠ¨å³å¯

è¿›å…¥ Redis å®¹å™¨ï¼Œä½¿ç”¨ cli

- æ‰§è¡Œ`docker exec -it b2 redis-cli`ã€‚å½“ç„¶ä¹Ÿå¯ä»¥è¿›å…¥ bash åæ‰§è¡Œ`redis-cli`

## Windows ç‰ˆ

åªèƒ½ä½¿ç”¨ [Github](https://github.com/tporadowski/redis) ä¸Šç»´æŠ¤çš„ç‰ˆæœ¬ï¼è¿˜ç®—æ–°ï¼

è§£å‹ç›´æ¥å¯ä»¥ä½¿ç”¨ï¼š

- redis.windows.confï¼šé…ç½®æ–‡ä»¶
- redis-cli.exeï¼šredis çš„å®¢æˆ·ç«¯
- redis-server.exeï¼šredis æœåŠ¡å™¨ç«¯

## é…ç½® ğŸ”¥

### ç®€ä»‹

Redis çš„é…ç½®æ–‡ä»¶ä½äº Redis å®‰è£…ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åä¸º redis.confã€‚ä½ å¯ä»¥é€šè¿‡ **CONFIG** å‘½ä»¤æŸ¥çœ‹æˆ–è®¾ç½®é…ç½®é¡¹ã€‚

```bash
CONFIG GET CONFIG_SETTING_NAME
```

ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¿å­˜é…ç½®åˆ° redis-6379.confï¼Œå¹¶æŸ¥çœ‹

```bash
cat redis.conf | grep -v "#" | grep -v "^$" > redis-6379.conf
```

ä¹Ÿå¯ä»¥ä¹‹é—´ä½¿ç”¨ **\*** å·è·å–æ‰€æœ‰é…ç½®é¡¹

```bash
config get *
```

ä½ å¯ä»¥é€šè¿‡**ä¿®æ”¹ redis.conf æ–‡ä»¶**æˆ–ä½¿ç”¨ **CONFIG SET** å‘½ä»¤æ¥ä¿®æ”¹é…ç½®ã€‚

```bash
CONFIG SET CONFIG_SETTING_NAME NEW_CONFIG_VALUE
```

å¸¸è§é…ç½®

```
protected-mode no # å…è®¸å¤–ç½‘è®¿é—®
# bind 127.0.0.1 # å¿…é¡»å»æ‰ï¼Œå…è®¸å¤–ç½‘è®¿é—®ã€‚å½“ç„¶å¯ä»¥é…ç½®ä¸Šï¼Œåªå…è®¸å†…ç½‘è®¿é—®ã€‚æ ¹æ® ps çš„å†…å®¹å¯ä»¥çœ‹å‡ºåŒºåˆ«
port 6379
daemonize yes
logfile "/usr/local/redis-6.2.1/logs/redis-6379.log"
dir ./data # ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºç»å¯¹è·¯å¾„
```

### æœåŠ¡ç«¯é…ç½®

* bindâ€”IP

  è¿™é‡Œæ˜¯å€¼å…è®¸è®¿é—®çš„ IPï¼Œç±»ä¼¼ç™½åå•ï¼ç»‘å®šååªå…è®¸è¯¥IPè®¿é—®äº†

  ```
  bind 127.0.0.1
  ```
* portâ€”ç«¯å£

  ```
  port 6379
  ```
* daemonizeâ€”å®ˆæŠ¤è¿›ç¨‹

  é»˜è®¤ä¸º noï¼Œä¼šåœ¨å¯åŠ¨åä¼šåœ¨æ§åˆ¶å°æ‰“å°æ—¥å¿—ã€‚æ”¹ä¸º yes åï¼Œéœ€è¦é…ç½®æ—¥å¿—æ–‡ä»¶åç§°

  ```
  daemonize no
  ```
* logfileâ€”æ—¥å¿—æ–‡ä»¶åç§°

  ```
  logfile ""
  ```
* dirâ€”æ•°æ®åº“æ–‡ä»¶å­˜æ”¾ç›®å½•

  ```
  dir ./
  ```
* databasesâ€”æ•°æ®åº“æ•°é‡

  ```
  databases 16
  ```

### æ—¥å¿—é…ç½®

* è®¾ç½®æœåŠ¡å™¨ä»¥æŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«

  ```
  loglevel debug|verbose|notice|warning
  ```
* æ—¥å¿—è®°å½•æ–‡ä»¶å

  ```
  logfile ç«¯å£å·.log
  ```

æ³¨æ„ï¼šæ—¥å¿—çº§åˆ«**å¼€å‘æœŸè®¾ç½®ä¸ºverboseå³å¯**ï¼Œ**ç”Ÿäº§ç¯å¢ƒä¸­é…ç½®ä¸ºnotice**ï¼Œç®€åŒ–æ—¥å¿—è¾“å‡ºé‡ï¼Œé™ä½å†™æ—¥å¿—IOçš„é¢‘åº¦

### å®¢æˆ·ç«¯é…ç½®

* è®¾ç½®åŒä¸€æ—¶é—´æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ï¼Œé»˜è®¤0å³æ— é™åˆ¶ã€‚å½“å®¢æˆ·ç«¯è¿æ¥åˆ°è¾¾ä¸Šé™ï¼ŒRedisä¼šå…³é—­æ–°çš„è¿æ¥

  ```
  maxclients 0
  ```
* å®¢æˆ·ç«¯é—²ç½®ç­‰å¾…æœ€å¤§æ—¶é•¿ï¼Œç§’ï¼Œè¾¾åˆ°æœ€å¤§å€¼åå…³é—­è¿æ¥ã€‚å¦‚éœ€å…³é—­è¯¥åŠŸèƒ½ï¼Œè®¾ç½®ä¸º 0

  ```
  timeout 300
  ```

### å¤šæœåŠ¡å™¨å¿«æ·é…ç½®

* å¯¼å…¥å¹¶åŠ è½½æŒ‡å®šé…ç½®æ–‡ä»¶ä¿¡æ¯ï¼Œç”¨äºå¿«é€Ÿåˆ›å»ºredis**å…¬å…±é…ç½®**è¾ƒå¤šçš„rediså®ä¾‹é…ç½®æ–‡ä»¶ï¼Œä¾¿äºç»´æŠ¤

  ```
  include /path/server-ç«¯å£å·.conf
  ```

### å…¶ä»–é…ç½®è§å…·ä½“ç« èŠ‚

## è¿è¡Œ ğŸ”¥

```bash
src/redis-server [conf/redis.conf]
```

`--port 9999`æŒ‡å®šç«¯å£ï¼Œå¿…é¡»å†™ src/redis-\*ï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œå‘½ä»¤ã€‚ä½†æ˜¯æ¨èåœ¨ conf æ–‡ä»¶ä¸­å†™å¥½é…ç½®ï¼

è¿è¡Œ cli

```bash
src/redis-cli -p 9999
```

## é…ç½®è‡ªå¯åŠ¨ ğŸ”¥

å‚è€ƒ`/usr/local/redis/redis-6.2.1/utils/redis_init_script`è„šæœ¬

```sh
#!/bin/sh

#
# Simple Redis init.d script conceived to work on Linux systems
# as it does use of the /proc filesystem.

### BEGIN INIT INFO
# Provides:     redis_6379
# Default-Start:        2 3 4 5
# Default-Stop:         0 1 6
# Short-Description:    Redis data structure server
# Description:          Redis data structure server. See https://redis.io
### END INIT INFO

REDISPORT=6379
EXEC=/usr/local/redis/redis-6.2.1/src/redis-server
CLIEXEC=/usr/local/redis/redis-6.2.1/src/redis-cli

PIDFILE=/var/run/redis_${REDISPORT}.pid
CONF="/usr/local/redis/redis-6.2.1/conf/${REDISPORT}.conf"

case "$1" in
    start)
        if [ -f $PIDFILE ]
        then
                echo "$PIDFILE exists, process is already running or crashed"
        else
                echo "Starting Redis server..."
                $EXEC $CONF
        fi
        ;;
    stop)
        if [ ! -f $PIDFILE ]
        then
                echo "$PIDFILE does not exist, process is not running"
        else

                PID=$(cat $PIDFILE)

                echo "Stopping ..."
                $CLIEXEC -p $REDISPORT shutdown
                while [ -x /proc/${PID} ]
                do
                    echo "Waiting for Redis to shutdown ..."
                    sleep 1

                done
                echo "Redis stopped"
        fi
        ;;
    *)
        echo "Please use start or stop as first argument"
        ;;
esac

```

æ ¹æ®ä¸Šè¿°æç¤ºåˆ›å»º pid æ–‡ä»¶`/var/run/redis_6379.pid`

```
6379
```

å¤åˆ¶`/usr/local/redis/redis-6.2.1/utils/redis_init_script`è„šæœ¬åˆ°`/etc/init.d`ä¸­