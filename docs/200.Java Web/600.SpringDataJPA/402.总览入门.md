---
title: æ€»è§ˆå…¥é—¨
date: 2021-06-21 21:21:03
permalink: /pages/5427c0/
categories:
  - Java Web
  - SpringDataJPA
tags:
  - 
---
# æ€»è§ˆå…¥é—¨

## æŒä¹…å±‚å¼€å‘çš„é—®é¢˜

### æŒä¹…å±‚å¼€å‘çš„é—®é¢˜

éšç€äº’è”ç½‘æŠ€æœ¯çš„å‘å±•ï¼Œç°åœ¨çš„ä¼ä¸šå¼€å‘ä¸­ç”¨åˆ°çš„ç”¨äºæ•°æ®å­˜å‚¨çš„äº§å“ï¼Œä¸å†ä»…ä»…æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œè€Œæ˜¯è¦æ ¹æ®åœºæ™¯éœ€è¦é€‰æ‹©ä¸åŒçš„å­˜å‚¨æŠ€æœ¯ï¼Œæ¯”å¦‚ç”¨äºç¼“å­˜çƒ­ç‚¹æ•°æ®çš„redisï¼Œç”¨äºå­˜å‚¨æ–‡æ¡£æ•°æ®çš„mongodbï¼Œç”¨äºæ”¯æŒå¼ºå¤§æœç´¢åŠŸèƒ½çš„elasticsearchç­‰ç­‰ã€‚

åœ¨Javaä¸­ï¼Œå¯¹äºä¸Šé¢æ‰€è¯´çš„äº§å“éƒ½æä¾›äº†ä¼˜ç§€çš„è®¿é—®æŠ€æœ¯ã€‚æ¯”å¦‚é’ˆå¯¹å…³ç³»å‹æ•°æ®åº“çš„mybatisã€jpaç­‰æŠ€æœ¯ï¼Œé’ˆå¯¹äºredisçš„jedisæŠ€æœ¯ç­‰ç­‰..... è¿™äº›æŠ€æœ¯è™½ç„¶å¯ä»¥å¾ˆå¥½çš„é’ˆå¯¹å„ä¸ªå­˜å‚¨äº§å“è¿›è¡Œè®¿é—®æ“ä½œï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†æ–°çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸åŒçš„æŒä¹…å±‚æŠ€æœ¯çš„APIæ˜¯ä¸ä¸€æ ·çš„ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¼€å‘äººå‘˜å°±å¿…é¡»åŒæ—¶æŒæ¡å¤šç§æ•°æ®è®¿é—®æŠ€æœ¯ï¼Œè¿™æ— ç–‘å¢åŠ äº†å¼€å‘æˆæœ¬ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¼šæƒ³ï¼Œæœ‰æ²¡æœ‰è¿™æ ·ä¸€ç§æŠ€æœ¯ï¼Œå®ƒå¯ä»¥ä½¿ç”¨**ä¸€å¥—APIæ”¯æŒå„ä¸ªä¸åŒçš„å­˜å‚¨çš„è®¿é—®**å‘¢ï¼Ÿå°±åœ¨è¿™æ ·çš„éœ€æ±‚ä¸‹ï¼ŒSpringDataäº§ç”Ÿäº†ã€‚

### ä»€ä¹ˆæ˜¯ Spring Dataï¼Ÿ

Spring Data é¡¹ç›®æ˜¯ä» 2010 å¹´å¼€å‘å‘å±•èµ·æ¥çš„ï¼ŒSpring Data åˆ©ç”¨ä¸€ä¸ªå¤§å®¶ç†Ÿæ‚‰çš„ã€ä¸€è‡´çš„ã€åŸºäºâ€œæ³¨è§£â€çš„æ•°æ®è®¿é—®ç¼–ç¨‹æ¨¡å‹ï¼Œåšä¸€äº›**å…¬å…±æ“ä½œçš„å°è£…**ï¼Œå®ƒå¯ä»¥è½»æ¾åœ°è®©å¼€å‘è€…ä½¿ç”¨æ•°æ®åº“è®¿é—®æŠ€æœ¯ï¼Œ**ç®€åŒ– DAO å±‚å¼€å‘**ï¼ŒåŒ…æ‹¬**å…³ç³»æ•°æ®åº“ã€éå…³ç³»æ•°æ®åº“**ï¼ˆNoSQLï¼‰ã€‚åŒæ—¶åˆæœ‰ä¸åŒçš„æ•°æ®æ¡†æ¶çš„å®ç°ï¼Œä¿ç•™äº†æ¯ä¸ªåº•å±‚æ•°æ®å­˜å‚¨ç»“æ„çš„ç‰¹æ®Šç‰¹æ€§ã€‚

**Spring Data Common æ˜¯ Spring Data æ‰€æœ‰æ¨¡å—çš„å…¬å…±éƒ¨åˆ†**ï¼Œè¯¥é¡¹ç›®æä¾›äº†åŸºäº Spring çš„å…±äº«åŸºç¡€è®¾æ–½ï¼Œå®ƒæä¾›äº†åŸºäº repository æ¥å£ä»¥ DB æ“ä½œçš„ä¸€äº›å°è£…ï¼Œä»¥åŠä¸€ä¸ªåšæŒåœ¨ Java å®ä½“ç±»ä¸Šæ ‡æ³¨å…ƒæ•°æ®çš„æ¨¡å‹ã€‚

Spring Data ä¸ä»…å¯¹ä¼ ç»Ÿçš„æ•°æ®åº“è®¿é—®æŠ€æœ¯å¦‚ JDBCã€Hibernateã€JDOã€TopLickã€JPAã€MyBatis åšäº†å¾ˆå¥½çš„æ”¯æŒå’Œæ‰©å±•ã€æŠ½è±¡ã€æä¾›æ–¹ä¾¿çš„æ“ä½œæ–¹æ³•ï¼Œè¿˜å¯¹ MongoDbã€KeyValueã€Redisã€LDAPã€Cassandra ç­‰éå…³ç³»æ•°æ®çš„ NoSQL åšäº†ä¸åŒçš„å®ç°ç‰ˆæœ¬ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¼€å‘è€…è§¦ç±»æ—é€šã€‚

### Spring Data çš„å­é¡¹ç›®

ä¸‹å›¾ä¸ºç›®å‰ Spring Data çš„æ¡†æ¶åˆ†ç±»ç»“æ„å›¾ï¼Œé‡Œé¢éƒ½æœ‰å“ªäº›æ¨¡å—å¯ä»¥ä¸€ç›®äº†ç„¶ï¼Œä¹Ÿå¯ä»¥çŸ¥é“å“ªäº›æ˜¯æˆ‘ä»¬éœ€è¦å…³å¿ƒçš„é¡¹ç›®

![img](../images/CgqCHl9fA2iAJZruAAEOKPj_-ZU042.png)

ä¸»è¦é¡¹ç›®ï¼ˆMain Modulesï¼‰ï¼š

* **Spring Data Commons**ï¼Œç›¸å½“äºå®šä¹‰äº†ä¸€å¥—**æŠ½è±¡çš„æ¥å£**
* Spring Data JDBCï¼Œå¯¹JDBCçš„Spring Dataå­˜å‚¨åº“æ”¯æŒ
* **Spring Data JPA**ï¼Œæˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹ï¼Œå¯¹ Spring Data Common çš„æ¥å£çš„ JPA åè®®çš„å®ç°
* Spring Data Gemfire
* Spring Data KeyValue
* Spring Data LDAP
* Spring Data MongoDBï¼Œå¯¹MongoDBçš„åŸºäºSpringå¯¹è±¡æ–‡æ¡£çš„å­˜å‚¨åº“æ”¯æŒ
* Spring Data REST
* Spring Data Redisï¼Œå°è£…JedisæŠ€æœ¯ï¼Œå¯¹rediså®ç°è®¿é—®æ“ä½œ
* Spring Data for Apache Cassandra
* Spring Data for Apache Solr

ç¤¾åŒºæ”¯æŒçš„é¡¹ç›®ï¼ˆCommunity Modulesï¼‰ï¼š

* Spring Data Aerospike
* Spring Data Couchbase
* Spring Data DynamoDB
* Spring Data Elasticsearchï¼Œå¯¹Elasticsearchå®ç°è®¿é—®æ“ä½œï¼ˆä¸€èˆ¬ä¸å¤ªç”¨ï¼Œå› ä¸ºç‰ˆæœ¬æ›´æ–°æ¯”è¾ƒæ…¢ï¼‰
* Spring Data Hazelcast
* Spring Data Jest
* Spring Data Neo4j
* Spring Data Vault

å…¶ä»–ï¼ˆRelated Modulesï¼‰ï¼š

* Spring Data JDBC Extensions
* Spring for Apache Hadoop
* Spring Content

å…³äº Spring Data çš„å­é¡¹ç›®ï¼Œé™¤äº†ä¸Šé¢è¿™äº›ï¼Œè¿˜æœ‰å¾ˆå¤šå¼€æºç¤¾åŒºç‰ˆæœ¬ï¼Œæ¯”å¦‚ Spring Dataã€MyBatis ç­‰

### Spring Data JPA å…³ç³»å›¾ ğŸ”¥

åªéœ€åœ¨ JPA è§„èŒƒä¸Šé¢å†æ·»åŠ ä¸€ä¸ª Spring Data JPA å³å¯

![image-20201217220824953](../images/image-20201217220824953.png)

## Spring Data Common ä¹‹ Repository ğŸ”¥

Spring Data Common å®šä¹‰äº†å¾ˆå¤šå…¬ç”¨çš„æ¥å£å’Œä¸€äº›ç›¸å¯¹æ•°æ®æ“ä½œçš„å…¬å…±å®ç°ï¼ˆå¦‚åˆ†é¡µæ’åºã€ç»“æœæ˜ å°„ã€Autiting ä¿¡æ¯ã€äº‹åŠ¡ç­‰ï¼‰ï¼Œè€Œ Spring Data JPA å°±æ˜¯ Spring Data Common çš„å…³ç³»æ•°æ®åº“çš„æŸ¥è¯¢å®ç°ã€‚æœ¬èŠ‚äº†è§£ä¸‹ Spring Data Common çš„æ ¸å¿ƒå†…å®¹â€”â€”Repositoryï¼Œä» Repository çš„æ‰€æœ‰å­ç±»ç€æ‰‹ï¼Œé€æ­¥æŒæ¡ CrudRepositoryã€PageingAndSortingRepositoryã€JpaRepositoryçš„ä½¿ç”¨ã€‚

### Spring Data JPA çš„ä¾èµ–å…³ç³»

å…ˆæ¥çœ‹çœ‹ Spring Data JPA æ‰€ä¾èµ–çš„ jar åŒ…å…³ç³»æ˜¯ä»€ä¹ˆæ ·çš„

![image-20201219193544969](../images/image-20201219193544969.png)

æ•°æ®åº“è¿æ¥ç”¨çš„æ˜¯ JDBCï¼Œè¿æ¥æ± ç”¨çš„æ˜¯ HikariCPï¼ˆçœ‹ starter-jdbcï¼‰ï¼Œ**å¼ºä¾èµ– Hibernateï¼ˆä¸èƒ½åˆ‡æ¢å®ç°äº†JPAçš„å…¶ä»–æ¡†æ¶ï¼‰**ï¼›Spring Boot Starter Data JPA ä¾èµ– Spring Data JPAï¼›è€Œ Spring Data JPA ä¾èµ– Spring Data Commonsã€‚Spring Data Commons æ˜¯ç»ˆæä¾èµ–ã€‚ä¸‹é¢å­¦ä¹  DB æ“ä½œçš„å…¥å£ RepositoryåŠå…¶å­ç±»

### Repository æ¥å£ã€å±‚æ¬¡å…³ç³» ğŸ”¥

#### Repository æ¥å£

Repository æ˜¯ Spring Data Common é‡Œé¢çš„é¡¶çº§çˆ¶ç±»æ¥å£ï¼Œæ“ä½œ DB çš„å…¥å£ç±»ã€‚é¦–å…ˆä»‹ç» Repository æ¥å£çš„æºç ã€ç±»å±‚æ¬¡å…³ç³»å’Œä½¿ç”¨å®ä¾‹ã€‚

```java
package org.springframework.data.repository;
import org.springframework.stereotype.Indexed;

@Indexed
public interface Repository<T, ID> {

}
```

Resposiory æ˜¯ Spring Data é‡Œé¢è¿›è¡Œæ•°æ®åº“æ“ä½œé¡¶çº§çš„æŠ½è±¡æ¥å£ï¼Œé‡Œé¢ä»€ä¹ˆæ–¹æ³•éƒ½æ²¡æœ‰ï¼Œä½†æ˜¯å¦‚æœä»»ä½•æ¥å£ç»§æ‰¿å®ƒï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ª Repositoryï¼Œè¿˜å¯ä»¥å®ç° JPA çš„ä¸€äº›é»˜è®¤å®ç°æ–¹æ³•ï¼ˆ**å¦‚æ–¹æ³•åç§°è§„åˆ™æŸ¥è¯¢**ï¼‰ã€‚è¿™æ˜¯ Spring åˆ©ç”¨ Respository ä½œä¸º DAO æ“ä½œçš„ Typeï¼Œä»¥åŠåˆ©ç”¨ Java åŠ¨æ€ä»£ç†æœºåˆ¶å®ç°çš„

Spring åœ¨åšåŠ¨æ€ä»£ç†çš„æ—¶å€™ï¼Œåªè¦æ˜¯å®ƒçš„å­ç±»æˆ–è€…å®ç°ç±»ï¼Œå†åˆ©ç”¨ T ç±»ä»¥åŠ T ç±»çš„ ä¸»é”® ID ç±»å‹ä½œä¸ºæ³›å‹çš„ç±»å‹å‚æ•°ï¼Œå°±å¯ä»¥æ¥æ ‡è®°å‡ºæ¥ã€å¹¶æ•è·åˆ°è¦ä½¿ç”¨çš„å®ä½“ç±»å‹ï¼Œå°±èƒ½å¸®åŠ©ä½¿ç”¨è€…è¿›è¡Œæ•°æ®åº“æ“ä½œã€‚

#### Repository ç±»å±‚æ¬¡å…³ç³»

Type hierarchy ç±»çš„å±‚æ¬¡ç»“æ„ï¼Œä½¿ç”¨ Ctrl + Hï¼ˆmacï¼‰å³å¯çœ‹åˆ°

![image-20201219195036228](../images/image-20201219195036228.png)

é€šè¿‡è¯¥å±‚æ¬¡ç»“æ„è§†å›¾ï¼Œä½ å°±ä¼šæ˜ç™½åŸºç±» Repository çš„ç”¨æ„ï¼Œç”±æ­¤å¯çŸ¥ï¼Œå­˜å‚¨åº“åˆ†ä¸ºä»¥ä¸‹ 4 ä¸ªå¤§ç±»ã€‚

- ReactiveCrudRepository è¿™æ¡çº¿æ˜¯å“åº”å¼ç¼–ç¨‹ï¼Œä¸»è¦æ”¯æŒå½“å‰ NoSQL æ–¹é¢çš„æ“ä½œï¼Œå› ä¸ºè¿™æ–¹é¢å¤§éƒ¨åˆ†æ“ä½œéƒ½æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ‰€ä»¥ç”±æ­¤æˆ‘ä»¬å¯ä»¥çœ‹å‡º Spring Data æƒ³ç»Ÿä¸€æ•°æ®æ“ä½œçš„â€œé‡å¿ƒâ€ï¼Œå³æƒ³æä¾›å…³äºæ‰€æœ‰ Data æ–¹é¢çš„æ“ä½œã€‚ç›®å‰ Reactive ä¸»è¦æœ‰ Cassandraã€MongoDBã€Redis çš„å®ç°ã€‚
- RxJava2/3CrudRepository è¿™æ¡çº¿æ˜¯ä¸ºäº†æ”¯æŒ RxJava 2/3 åšçš„æ ‡å‡†å“åº”å¼ç¼–ç¨‹çš„æ¥å£ã€‚
- CoroutineCrudRepository è¿™æ¡ç»§æ‰¿å…³ç³»é“¾æ˜¯ä¸ºäº†æ”¯æŒ Kotlin è¯­æ³•è€Œå®ç°çš„ã€‚
- CrudRepository è¿™æ¡ç»§æ‰¿å…³ç³»é“¾æ­£æ˜¯æœ¬è¯¾æ—¶æˆ‘è¦è¯¦ç»†ä»‹ç»çš„ JPA ç›¸å…³çš„æ“ä½œæ¥å£ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠæˆ‘çš„è¿™ç§æ–¹æ³•åº”ç”¨åˆ°å¦å¤– 3 ç§ç»§æ‰¿å…³ç³»é“¾é‡Œé¢å­¦ä¹ ã€‚

ç‚¹å‡» Show Diagram æ˜¾ç¤ºå±‚æ¬¡ç»“æ„å›¾ï¼Œå…¶ä¸­ JpaSpecificationExecutor ä¹Ÿæ˜¯ç»§æ‰¿äº†å€Ÿå£åå‡ºç°çš„ï¼Œä¹Ÿæ˜¯éœ€è¦å­¦ä¹ çš„ï¼

![image-20201219195652297](../images/image-20201219195652297.png)

éœ€è¦æŒæ¡å’Œä½¿ç”¨åˆ°çš„ç±»å¦‚ä¸‹æ‰€ç¤ºï¼š

**7 å¤§ Repository æ¥å£ï¼š**

* Repository(org.springframework.data.repository)ï¼Œæ²¡æœ‰æš´éœ²ä»»ä½•æ–¹æ³•ï¼›
* CrudRepository(org.springframework.data.repository)ï¼Œç®€å•çš„ Curd æ–¹æ³•ï¼›
* PagingAndSortingRepository(org.springframework.data.repository)ï¼Œå¸¦åˆ†é¡µå’Œæ’åºçš„æ–¹æ³•ï¼›
* QueryByExampleExecutor(org.springframework.data.repository.query)ï¼Œç®€å• Example æŸ¥è¯¢ï¼›
* JpaRepository(org.springframework.data.jpa.repository)ï¼ŒJPA çš„æ‰©å±•æ–¹æ³•ï¼›
* JpaSpecificationExecutor(org.springframework.data.jpa.repository)ï¼ŒJpaSpecification æ‰©å±•æŸ¥è¯¢ï¼›
* QueryDslPredicateExecutor(org.springframework.data.querydsl)ï¼ŒQueryDsl çš„å°è£…ã€‚

**2 å¤§ Repository å®ç°ç±»ï¼š**

- SimpleJpaRepository(org.springframework.data.jpa.repository.support)ï¼ŒJPA æ‰€æœ‰æ¥å£çš„é»˜è®¤å®ç°ç±»ï¼›
- QueryDslJpaRepository(org.springframework.data.jpa.repository.support)ï¼ŒQueryDsl çš„å®ç°ç±»ã€‚

å…³äºå…¶ä»–çš„ç±»ï¼Œåé¢æˆ‘ä¹Ÿä¼šé€šè¿‡ä¸åŒæ–¹å¼çš„è®²è§£

### æµ‹è¯• Entityâ€”User

```java
@Entity
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class User {
    @Id
    @GeneratedValue(strategy= GenerationType.AUTO)
    private Long id;
    private String name;
    private String email;
}
```

### Repository æ¥å£ç¤ºä¾‹â€”æ–¹æ³•åç§°è§„åˆ™æŸ¥è¯¢ ğŸ”¥

åˆ©ç”¨ UserRepository ç»§æ‰¿ Repository æ¥å®ç°å¯¹ User çš„ä¸¤ä¸ªæŸ¥è¯¢æ–¹æ³•ï¼ˆ**æ–¹æ³•åç§°è§„åˆ™æŸ¥è¯¢**ï¼‰

```java
public interface UserRepository extends Repository<User,Long> {
	//æ ¹æ®åç§°è¿›è¡ŒæŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
	List<User> findByName(String name);
	// æ ¹æ®ç”¨æˆ·çš„é‚®ç®±å’Œåç§°æŸ¥è¯¢
	List<User> findByEmailAndName(String email, String name);
}
```

ç”±äº Repository æ¥å£é‡Œé¢æ²¡æœ‰ä»»ä½•æ–¹æ³•ï¼Œæ‰€ä»¥æ­¤ UserRepository å¯¹å¤–åªæœ‰ä¸¤ä¸ªå¯ç”¨æ–¹æ³•

### CrudRepository æ¥å£ç¤ºä¾‹ ğŸ”¥

é€šè¿‡ IDEA å·¥å…·ï¼Œçœ‹ä¸‹ CrudRepository ä¸ºæˆ‘ä»¬æä¾›çš„æ–¹æ³•æœ‰å“ªäº›

![image-20201219200638254](../images/image-20201219200638254.png)

- `<S extends T> S save(S entity);` ä¿å­˜/æ›´æ–°å®ä½“æ–¹æ³•

  Entity ä¸­è‹¥ id ä¸º nullï¼Œåˆ™ persistï¼Œå¦åˆ™æ‰§è¡Œ mergeï¼ˆæºç ä¸­ä¼šè¿›è¡Œ id æ˜¯å¦ä¸º null ç­‰åˆ¤æ–­ã€‚**æœ‰çš„è¯´æ ¹æ®id æŸ¥è¯¢äº†ï¼Ÿä¹è§‚é”**ï¼‰

  å¦‚æœå½“ä¼ é€’çš„å‚æ•°é‡Œé¢æ²¡æœ‰ IDï¼Œåˆ™ç›´æ¥ insertï¼›è‹¥å½“ä¼ é€’çš„å‚æ•°é‡Œé¢æœ‰ IDï¼Œåˆ™ä¼šè§¦å‘ select æŸ¥è¯¢ã€‚æ­¤æ–¹æ³•ä¼šå»çœ‹ä¸€ä¸‹æ•°æ®åº“é‡Œé¢æ˜¯å¦å­˜åœ¨æ­¤è®°å½•ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™ updateï¼Œå¦åˆ™ insert

  æ³¨æ„æ›´æ–°æ—¶å®ä½“ç±»ä¸­å½“å‰ä¸ºnullçš„å­—æ®µä¹Ÿä¼šè¢«æ›´æ–°ä¸ºnullï¼Œå¯ä»¥é…ç½®æ›´æ”¹è¯¥ç­–ç•¥ï¼Œ**DynamicUpdate ç­–ç•¥**

  å‚æ•°å’Œè¿”å›ç»“æœå¯ä»¥æ˜¯å®ä½“çš„å­ç±»

  ```java
  public <S extends T> S save(S entity) {
      if (entityInformation.isNew(entity)) {
          em.persist(entity);
          return entity;
      } else {
          return em.merge(entity);
      }
  }
  ```
- `saveAll(Iterable<S> entities)` : æ‰¹é‡ä¿å­˜/æ›´æ–°ï¼ŒåŸç†å’Œ saveæ–¹æ³•ç›¸åŒï¼Œæˆ‘ä»¬å»çœ‹å®ç°çš„è¯ï¼Œå°±æ˜¯ for å¾ªç¯è°ƒç”¨ä¸Šé¢çš„ save æ–¹æ³•ã€‚

  é‚£è¿™å°±å¾ˆæ‰¯æ·¡äº†ï¼Œå½“ç„¶å¯ä»¥è®¾ç½®ä¸€ä¸‹`spring.jpa.properties.hibernate.jdbc.batch_size=200`ï¼Œå°±ä¼šæ‰¹é‡æ“ä½œäº†ï¼
- `void deleteById(ID id);` æ ¹æ®ä¸»é”®åˆ é™¤ï¼ŒæŸ¥çœ‹æºç ä¼šå‘ç°ï¼Œå…¶æ˜¯å…ˆæ ¹æ®ä¸»é”®æŸ¥è¯¢å‡ºæ¥å†è¿›è¡Œåˆ é™¤ï¼Œ**æ²¡æŸ¥è¯¢åˆ°ç›´æ¥æŠ›å¼‚å¸¸ï¼ˆéœ€è¦å¤„ç†è¯¥å¼‚å¸¸ï¼Œä½†æ˜¯ä¸€èˆ¬åˆ é™¤æ“ä½œä¸ä¼šäº§ç”Ÿå¹¶å‘ï¼‰**ï¼›ï¼ˆå®é™…ä½¿ç”¨æ—¶æ— éœ€æ‰‹åŠ¨æŸ¥è¯¢ï¼ï¼‰

  ```java
  public void deleteById(ID id) {
      Assert.notNull(id, ID_MUST_NOT_BE_NULL);
      // æ²¡æŸ¥è¯¢åˆ°ç›´æ¥æŠ›å¼‚å¸¸
      delete(findById(id).orElseThrow(() -> new EmptyResultDataAccessException(
          String.format("No %s entity with id %s exists!", entityInformation.getJavaType(), id), 1)));
  }
  ```
- `void delete(T entity)` æ ¹æ® Entityï¼ˆå…¶å®æ˜¯ä¸»é”®ï¼‰ è¿›è¡Œåˆ é™¤ï¼ˆåº•å±‚å’Œ deleteById ä¸€æ ·ï¼‰ï¼›
- `void deleteAll(Iterable<? extends T> entities)` æ‰¹é‡åˆ é™¤ï¼Œè¿˜æ˜¯forå¾ªç¯è°ƒç”¨ delete(T entity)ã€‚

  é‚£è¿™å°±å¾ˆæ‰¯æ·¡äº†ï¼Œå½“ç„¶å¯ä»¥ä½¿ç”¨ JpaRepository çš„æ‰¹é‡åˆ é™¤ï¼
- `void deleteAll()` åˆ é™¤æ‰€æœ‰ï¼›åŸç†å¯ä»¥é€šè¿‡åˆšæ‰çš„ç±»å…³ç³»æŸ¥çœ‹ï¼ŒCrudRepository çš„å®ç°æ–¹æ³•å¦‚ä¸‹ï¼š

  ```java
  //SimpleJpaRepositoryé‡Œé¢çš„deleteALLæ–¹æ³•
  // åˆ©ç”¨ for å¾ªç¯è°ƒç”¨ delete æ–¹æ³•è¿›è¡Œåˆ é™¤æ“ä½œ
  public void deleteAll() {
     for (T element : findAll()) {
        delete(element);
     }
  }
  ```
- `boolean existsById(ID id)` æ ¹æ®ä¸»é”®åˆ¤æ–­å®ä½“æ˜¯å¦å­˜åœ¨ï¼›
- `Optional<T> findById(ID id);` æ ¹æ®ä¸»é”®æŸ¥è¯¢å®ä½“ï¼Œè¿”å› JDK 1.8 çš„ Optionalï¼Œè¿™å¯ä»¥é¿å… null exceptionï¼›
- `Iterable<T> findAllById(Iterable ids);` æ ¹æ®ä¸»é”®åˆ—è¡¨æŸ¥è¯¢å®ä½“åˆ—è¡¨ï¼›
- `Iterable<T> findAll();` æŸ¥è¯¢å®ä½“çš„æ‰€æœ‰åˆ—è¡¨ï¼›
- `count()`: long æŸ¥è¯¢æ€»æ•°è¿”å› long ç±»å‹ï¼›

ä¸Šé¢è¿™äº›æ–¹æ³•æ˜¯ CrudRepository å¯¹å¤–æš´éœ²çš„å¸¸è§çš„ Crud æ¥å£ï¼Œæˆ‘ä»¬åœ¨å¯¹æ•°æ®åº“è¿›è¡Œ Crud çš„æ—¶å€™å°±ä¼šè¿ç”¨åˆ°ï¼Œå¦‚ä¸‹æ‰€ç¤º

```java
public interface UserRepository extends CrudRepository<User,Long> {
}
```

### PagingAndSortingRepository æ¥å£ç¤ºä¾‹ ğŸ”¥

ä¸»è¦ç”¨äºåˆ†é¡µæŸ¥è¯¢å’Œæ’åºæŸ¥è¯¢ã€‚æºç å¦‚ä¸‹ï¼š

```java
@NoRepositoryBean
public interface PagingAndSortingRepository<T, ID> extends CrudRepository<T, ID> {
	Iterable<T> findAll(Sort sort); ï¼ˆ1ï¼‰
	Page<T> findAll(Pageable pageable); ï¼ˆ2ï¼‰
}
```

* ç¬¬ä¸€ä¸ªæ–¹æ³• findAll å‚æ•°æ˜¯ Sortï¼Œæ˜¯æ ¹æ®æ’åºå‚æ•°ï¼Œå®ç°ä¸åŒçš„æ’åºè§„åˆ™è·å–æ‰€æœ‰çš„å¯¹è±¡çš„é›†åˆ
* ğŸ”¥ ç¬¬äºŒä¸ªæ–¹æ³• findAll å‚æ•°æ˜¯ Pageableï¼Œæ˜¯æ ¹æ®åˆ†é¡µå’Œæ’åºè¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶ç”¨ Page å¯¹è¿”å›ç»“æœè¿›è¡Œå°è£…ã€‚è€Œ Pageable å¯¹è±¡åŒ…å« Page å’Œ Sort å¯¹è±¡

ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

```java
public interface UserRepository extends PagingAndSortingRepository<User,Long> {
}
```

```java
/**
 * éªŒè¯æ’åºå’Œåˆ†é¡µæŸ¥è¯¢æ–¹æ³•ï¼ŒPageableçš„é»˜è®¤å®ç°ç±»ï¼šPageRequest
 * @return
 */
@GetMapping(path = "/page")
@ResponseBody
public Page<User> getAllUserByPage() {
   return userRepository.findAll(
         PageRequest.of(1, 20,Sort.by(new Sort.Order(Sort.Direction.ASC,"name"))));
}
/**
 * æ’åºæŸ¥è¯¢æ–¹æ³•ï¼Œä½¿ç”¨Sortå¯¹è±¡
 * @return
 */
@GetMapping(path = "/sort")
@ResponseBody
public Iterable<User> getAllUsersWithSort() {
   return userRepository.findAll(Sort.by(new Sort.Order(Sort.Direction.ASC,"name")));
}
```

### JpaRepository æ¥å£ç¤ºä¾‹ ğŸ”¥

åˆ°è¿™é‡Œå¯ä»¥è¿›å…¥åˆ°åˆ†æ°´å²­äº†ï¼Œ**ä¸Šé¢çš„é‚£äº›éƒ½æ˜¯ Spring Data ä¸ºäº†å…¼å®¹ NoSQL è€Œè¿›è¡Œçš„ä¸€äº›æŠ½è±¡å°è£…**ï¼Œè€Œ**ä» JpaRepository å¼€å§‹æ˜¯å¯¹å…³ç³»å‹æ•°æ®åº“è¿›è¡ŒæŠ½è±¡å°è£…**ã€‚ä»ç±»å›¾å¯ä»¥çœ‹å‡ºæ¥å®ƒç»§æ‰¿ PagingAndSortingRepository ç±»ï¼Œä¹Ÿå°±ç»§æ‰¿äº†å…¶æ‰€æœ‰æ–¹æ³•ï¼Œå¹¶ä¸”å…¶å®ç°ç±»ä¹Ÿæ˜¯ SimpleJpaRepositoryã€‚ä»ç±»å›¾ä¸Šè¿˜å¯ä»¥çœ‹å‡º JpaRepository ç»§æ‰¿å’Œæ‹¥æœ‰äº† QueryByExampleExecutor çš„ç›¸å…³æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ JpaRepository æœ‰å“ªäº›æ–¹æ³•ã€‚

![image-20201219224246112](../images/image-20201219224246112.png)

æ¶‰åŠ QueryByExample çš„éƒ¨åˆ†æˆ‘ä»¬åœ¨ 11 è¯¾æ—¶â€œJpaRepository å¦‚ä½•è‡ªå®šä¹‰â€å†è¯¦ç»†ä»‹ç»ï¼Œ

JpaRepository é‡Œé¢é‡ç‚¹æ–°å¢äº†**æ‰¹é‡åˆ é™¤**ï¼Œä¼˜åŒ–äº†æ‰¹é‡åˆ é™¤çš„æ€§èƒ½ï¼Œç±»ä¼¼äºä¹‹å‰ SQL çš„ batch æ“ä½œï¼Œå¹¶ä¸æ˜¯åƒä¸Šé¢çš„ deleteAll æ¥ for å¾ªç¯åˆ é™¤ã€‚

å…¶ä¸­ flush() å’Œ saveAndFlush() æä¾›äº†æ‰‹åŠ¨åˆ·æ–° sessionï¼ŒæŠŠå¯¹è±¡çš„å€¼ç«‹å³æ›´æ–°åˆ°æ•°æ®åº“é‡Œé¢çš„æœºåˆ¶ã€‚JPA æ˜¯ ç”± Hibernate å®ç°çš„ï¼Œæ‰€ä»¥æœ‰ session ä¸€çº§ç¼“å­˜çš„æœºåˆ¶ï¼Œå½“è°ƒç”¨ save() æ–¹æ³•çš„æ—¶å€™ï¼Œæ•°æ®åº“é‡Œé¢æ˜¯ä¸ä¼šç«‹å³å˜åŒ–çš„ï¼Œå…¶åŸç†æˆ‘å°†åœ¨ 21 è¯¾æ—¶â€œPersistence Context æ‰€è¡¨è¾¾çš„æ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆâ€å†è¯¦ç»†è®²è§£

ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

```java
public interface UserRepository extends JpaRepository<User,Long> {
}
```

### å…·ä½“å®ç°ç±» SimpleJpaRepository ğŸ”¥

PagingAndSortingRepository å’Œ CrudRepository éƒ½æ˜¯ Spring Data Common çš„æ ‡å‡†æ¥å£ï¼Œé‚£ä¹ˆå®ç°ç±»æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬é‡‡ç”¨ JPAï¼Œé‚£å¯¹åº”çš„å®ç°ç±»å°±æ˜¯ Spring Data JPA çš„ jar åŒ…é‡Œé¢çš„ SimpleJpaRepositoryã€‚å¦‚æœæ˜¯å…¶ä»– NoSQLçš„ å®ç°å¦‚ MongoDBï¼Œé‚£å®ç°å°±åœ¨ Spring Data MongoDB çš„ jar é‡Œé¢çš„ MongoRepositoryImplã€‚JpaRepository çš„å®ç°ç±»ä¹Ÿæ˜¯ SimpleJpaRepository

å…³ç³»æ•°æ®åº“çš„æ‰€æœ‰ Repository æ¥å£çš„å®ç°ç±»å°±æ˜¯ SimpleJpaRepositoryï¼Œå¦‚æœæœ‰äº›ä¸šåŠ¡åœºæ™¯éœ€è¦è¿›è¡Œæ‰©å±•äº†ï¼Œå¯ä»¥ç»§ç»­ç»§æ‰¿æ­¤ç±»ï¼Œå¦‚ QueryDsl çš„æ‰©å±•ï¼ˆè™½ç„¶ä¸æ¨èä½¿ç”¨äº†ï¼Œä½†æˆ‘ä»¬å¯ä»¥å‚è€ƒå®ƒçš„åšæ³•ï¼Œè‡ªå®šä¹‰è‡ªå·±çš„ SimpleJpaRepositoryï¼‰ï¼Œ**å¦‚æœèƒ½å°†æ­¤ç±»é‡Œé¢çš„å®ç°æ–¹æ³•çœ‹é€äº†ï¼ŒåŸºæœ¬ä¸Š JPA ä¸­çš„ API å°±èƒ½æŒæ¡å¤§éƒ¨åˆ†å†…å®¹**ã€‚

UserRepository çš„å®ç°ç±»æ˜¯ Spring å¯åŠ¨çš„æ—¶å€™ï¼Œåˆ©ç”¨ Java åŠ¨æ€ä»£ç†æœºåˆ¶å¸®æˆ‘ä»¬ç”Ÿæˆçš„å®ç°ç±»ï¼Œè€ŒçœŸæ­£çš„å®ç°ç±»å°±æ˜¯ SimpleJpaRepositoryã€‚

![image-20201219225302748](../images/image-20201219225302748.png)

![image-20201220000423131](../images/image-20201220000423131.png)

å®ƒæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™è¢«åŠ¨æ€ä»£ç†ç”Ÿæˆçš„ï¼Ÿåœ¨ RepositoryFactorySupport è®¾ç½®ä¸€ä¸ªæ–­ç‚¹ï¼Œå¯åŠ¨çš„æ—¶å€™ï¼Œåœ¨æˆ‘ä»¬çš„æ–­ç‚¹å¤„å°±ä¼šå‘ç° UserRepository çš„æ¥å£ä¼šè¢« JdkDynamicAopProxy åŠ¨æ€ä»£ç†æˆ SimpleJapRepository çš„å®ç°ç±»ï¼ˆåº•å±‚è¿˜æ˜¯ InvocationHandler çš„ invoke æ–¹æ³•ï¼›éæ¥å£çš„åŠ¨æ€ä»£ç†ä¼šä½¿ç”¨ Cglibï¼‰ã€‚æ³¨æ„æ¯ä¸€ä¸ª Repository çš„å­ç±»ï¼Œéƒ½ä¼šé€šè¿‡è¿™é‡Œçš„åŠ¨æ€ä»£ç†ç”Ÿæˆå®ç°ç±»

![image-20201219225948290](../images/image-20201219225948290.png)

éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š

```java
@Repository
@Transactional(readOnly = true)
public class SimpleJpaRepository<T, ID> implements JpaRepository<T, ID>, JpaSpecificationExecutor<T> {

    private static final String ID_MUST_NOT_BE_NULL = "The given id must not be null!";

    private final JpaEntityInformation<T, ?> entityInformation;

    private final EntityManager em;

    private final PersistenceProvider provider;

    private @Nullable CrudMethodMetadata metadata;

    // ......
  
    @Transactional
    public void deleteAllInBatch() {
        em.createQuery(getDeleteAllQueryString()).executeUpdate();
    }
    //......
}
```

é€šè¿‡æ­¤ç±»çš„æºç ï¼Œæˆ‘ä»¬å¯ä»¥æŒºæ¸…æ™°åœ°çœ‹å‡º SimpleJpaRepository çš„å®ç°æœºåˆ¶ï¼Œæ˜¯**é€šè¿‡ EntityManger è¿›è¡Œå®ä½“çš„æ“ä½œï¼ˆå°±æ˜¯å’ŒJPAä¸€æ ·ï¼‰**ï¼Œè€Œ JpaEntityInforMation é‡Œé¢å­˜åœ¨å®ä½“çš„ç›¸å…³ä¿¡æ¯å’Œ Crud æ–¹æ³•çš„å…ƒæ•°æ®ç­‰ã€‚

### å¯å‘ ğŸ”¥

* ä¸Šé¢çš„ 7 ä¸ªå¤§ Repository æ¥å£ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™å¯ä»¥æ ¹æ®å®é™…åœºæ™¯**ç»§æ‰¿ä¸åŒçš„æ¥å£**ï¼Œä»è€Œé€‰æ‹©æš´éœ²ä¸åŒçš„ Spring Data Common ç»™æˆ‘ä»¬æä¾›çš„å·²æœ‰æ¥å£ã€‚è¿™å…¶å®åˆ©ç”¨äº† Java è¯­è¨€çš„ interface ç‰¹æ€§ã€‚
* åˆ©ç”¨æºç ä¹Ÿå¯ä»¥å¾ˆå¥½åœ°ç†è§£ä¸€ä¸‹ Spring ä¸­**åŠ¨æ€ä»£ç†**çš„ä½œç”¨ï¼Œå¯ä»¥åˆ©ç”¨è¿™ç§æ€æƒ³ï¼Œåœ¨æ”¹å–„ MyBatis çš„æ—¶å€™ä½¿ç”¨ã€‚

## @Entity ä¸­çš„ JPA æ³¨è§£ ğŸ”¥

### Entity å®ä½“æ˜¯ä»€ä¹ˆï¼Ÿ

* å®ä½“æ˜¯ç›´æ¥è¿›è¡Œæ•°æ®åº“æŒä¹…åŒ–æ“ä½œçš„é¢†åŸŸå¯¹è±¡ï¼ˆå³ä¸€ä¸ªç®€å•çš„ POJOï¼Œå¯ä»¥æŒ‰ç…§ä¸šåŠ¡é¢†åŸŸåˆ’åˆ†ï¼‰ï¼Œå¿…é¡»é€šè¿‡ @Entity æ³¨è§£è¿›è¡Œæ ‡ç¤ºã€‚
* å®ä½“å¿…é¡»æœ‰ä¸€ä¸ª public æˆ–è€… protected çš„æ— å‚æ•°æ„é€ æ–¹æ³•ã€‚
* æŒä¹…åŒ–æ˜ å°„çš„æ³¨è§£å¯ä»¥æ ‡ç¤ºåœ¨ Entity çš„å­—æ®µ field ä¸Šï¼Œä¹Ÿå¯ä»¥å°†æŒä¹…åŒ–æ³¨è§£è¿ç”¨åœ¨ Entity é‡Œé¢çš„ get/set æ–¹æ³•ä¸Šï¼Œé€šå¸¸æˆ‘ä»¬æ˜¯æ”¾åœ¨ get æ–¹æ³•ä¸­ã€‚å³ Entity é‡Œé¢çš„æ³¨è§£ç”Ÿæ•ˆåªæœ‰ä¸¤ç§æ–¹å¼ï¼šå°†æ³¨è§£å†™åœ¨å­—æ®µä¸Šæˆ–è€…å°†æ³¨è§£å†™åœ¨æ–¹æ³•ä¸Šï¼ˆJPA é‡Œé¢ç§° Propertyï¼‰ã€‚ä½†æ˜¯**éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨åŒä¸€ä¸ª Entity é‡Œé¢åªèƒ½æœ‰ä¸€ç§æ–¹å¼ç”Ÿæ•ˆ**ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ³¨è§£è¦ä¹ˆå…¨éƒ¨å†™åœ¨ field ä¸Šé¢ï¼Œè¦ä¹ˆå°±å…¨éƒ¨å†™åœ¨ Property ä¸Šé¢
* åªè¦æ˜¯åœ¨ @Entity çš„å®ä½“é‡Œé¢è¢«æ³¨è§£æ ‡æ³¨çš„å­—æ®µï¼Œéƒ½ä¼šè¢«æ˜ å°„åˆ°æ•°æ®åº“ä¸­ï¼Œé™¤äº†ä½¿ç”¨ **@Transient** æ³¨è§£çš„å­—æ®µä¹‹å¤–ã€‚
* å®ä½“é‡Œé¢**å¿…é¡»è¦æœ‰ä¸€ä¸ªä¸»é”®**ï¼Œä¸»é”®æ ‡ç¤ºçš„å­—æ®µå¯ä»¥æ˜¯å•ä¸ªå­—æ®µï¼Œä¹Ÿå¯ä»¥æ˜¯å¤åˆä¸»é”®å­—æ®µã€‚

JPA åè®®çš„å®˜æ–¹åœ°å€ï¼šhttps://download.oracle.com/otn-pub/jcp/persistence-2_2-mrel-spec/JavaPersistence.pdf

### è¯¦ç»†çš„æ³¨è§£éƒ½æœ‰å“ªäº›ï¼Ÿ

åˆ©ç”¨ IEDA å·¥å…·ï¼Œæ‰“å¼€ @Entity æ‰€åœ¨çš„åŒ…ï¼Œå°±å¯ä»¥çœ‹åˆ° JPA é‡Œé¢æ”¯æŒçš„æ³¨è§£æœ‰å“ªäº›ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼›

![img](../images/Ciqc1F9rLPSAFNw1AAQfaEA3Bgo587.png)

è¿™é‡ŒåªæåŠä¸€äº›æœ€å¸¸è§çš„ï¼ŒåŒ…æ‹¬ @Entityã€@Tableã€@Accessã€@Idã€@GeneratedValueã€@Enumeratedã€@Basicã€@Columnã€@Transientã€@Lobã€@Temporal ç­‰ã€‚

### @Entity

ç”¨äºå®šä¹‰å¯¹è±¡å°†ä¼šæˆä¸ºè¢« JPA ç®¡ç†çš„å®ä½“ï¼Œå¿…å¡«ï¼Œå°†å­—æ®µæ˜ å°„åˆ°æŒ‡å®šçš„æ•°æ®åº“è¡¨ä¸­ï¼Œä½¿ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œç›´æ¥ç”¨åœ¨å®ä½“ç±»ä¸Šé¢å³å¯ï¼Œé€šè¿‡æºç è¡¨è¾¾çš„è¯­æ³•å¦‚ä¸‹ï¼š

```java
@Target(TYPE) //è¡¨ç¤ºæ­¤æ³¨è§£åªèƒ½ç”¨åœ¨classä¸Šé¢
public @interface Entity {
   //å¯é€‰ï¼Œé»˜è®¤æ˜¯å®ä½“ç±»çš„åå­—ï¼Œæ•´ä¸ªåº”ç”¨é‡Œé¢å…¨å±€å”¯ä¸€ã€‚
   String name() default "";
}
```

### @Table

ç”¨äºæŒ‡å®šæ•°æ®åº“çš„è¡¨åï¼Œè¡¨ç¤ºæ­¤å®ä½“å¯¹åº”çš„æ•°æ®åº“é‡Œé¢çš„è¡¨åï¼Œéå¿…å¡«ï¼Œé»˜è®¤è¡¨åå’Œ entity åå­—ä¸€æ ·ã€‚

```java
@Target(TYPE) //ä¸€æ ·åªèƒ½ç”¨åœ¨ç±»ä¸Šé¢
public @interface Table {
   //è¡¨çš„åå­—ï¼Œå¯é€‰ã€‚å¦‚æœä¸å¡«å†™ï¼Œç³»ç»Ÿè®¤ä¸ºå¥½å®ä½“çš„åå­—ä¸€æ ·ä¸ºè¡¨åã€‚
   String name() default "";
   //æ­¤è¡¨æ‰€åœ¨schemaï¼Œå¯é€‰
   String schema() default "";
   //å”¯ä¸€æ€§çº¦æŸï¼Œåœ¨åˆ›å»ºè¡¨çš„æ—¶å€™æœ‰ç”¨ï¼Œè¡¨åˆ›å»ºä¹‹ååé¢å°±ä¸éœ€è¦äº†ã€‚
   UniqueConstraint[] uniqueConstraints() default { };
   //ç´¢å¼•ï¼Œåœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ä½¿ç”¨ï¼Œè¡¨åˆ›å»ºä¹‹ååé¢å°±ä¸éœ€è¦äº†ã€‚
   Index[] indexes() default {};
}
```

### @Access

ç”¨äºæŒ‡å®š entity é‡Œé¢çš„æ³¨è§£æ˜¯å†™åœ¨å­—æ®µä¸Šé¢ï¼Œè¿˜æ˜¯ get/set æ–¹æ³•ä¸Šé¢ç”Ÿæ•ˆï¼Œéå¿…å¡«ã€‚åœ¨é»˜è®¤ä¸å¡«å†™çš„æƒ…å†µä¸‹ï¼Œå½“å®ä½“é‡Œé¢çš„ç¬¬ä¸€ä¸ªæ³¨è§£å‡ºç°åœ¨å­—æ®µä¸Šæˆ–è€… get/set æ–¹æ³•ä¸Šé¢ï¼Œå°±ä»¥ç¬¬ä¸€æ¬¡å‡ºç°çš„æ–¹å¼ä¸ºå‡†ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªå®ä½“é‡Œé¢çš„æ³¨è§£æ—¢æœ‰ç”¨åœ¨ field ä¸Šé¢ï¼Œåˆæœ‰ç”¨åœ¨ properties ä¸Šé¢çš„æ—¶å€™ï¼Œçœ‹ä¸‹é¢çš„ä»£ç ä½ å°±ä¼šæ˜ç™½ã€‚

```java
@Id
private Long id;
@Column(length = 20, nullable = false)
public String getUserName(){
    return userName;
}
```

é‚£ä¹ˆç”±äº @Id æ˜¯å®ä½“é‡Œé¢ç¬¬ä¸€ä¸ªå‡ºç°çš„æ³¨è§£ï¼Œå¹¶ä¸”ä½œç”¨åœ¨å­—æ®µä¸Šé¢ï¼Œæ‰€ä»¥æ‰€æœ‰å†™åœ¨ get/set æ–¹æ³•ä¸Šé¢çš„æ³¨è§£å°±ä¼šå¤±æ•ˆã€‚è€Œ @Access å¯ä»¥å¹²é¢„é»˜è®¤å€¼ï¼ŒæŒ‡å®šæ˜¯åœ¨ fileds ä¸Šé¢ç”Ÿæ•ˆè¿˜æ˜¯åœ¨ properties ä¸Šé¢ç”Ÿæ•ˆã€‚æˆ‘ä»¬é€šè¿‡æºç çœ‹ä¸‹è¯­æ³•ï¼š

```java
@Target( { TYPE, METHOD, FIELD })//è¡¨ç¤ºæ­¤æ³¨è§£å¯ä»¥è¿ç”¨åœ¨classä¸Š(é‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±å¯ä»¥æŒ‡å®šæ­¤å®ä½“çš„é»˜è®¤æ³¨è§£ç”Ÿæ•ˆç­–ç•¥äº†)ï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨æ–¹æ³•ä¸Šæˆ–è€…å­—æ®µä¸Š(è¡¨ç¤ºå¯ä»¥ç‹¬ç«‹è®¾ç½®æŸä¸€ä¸ªå­—æ®µæˆ–è€…æ–¹æ³•çš„ç”Ÿæ•ˆç­–ç•¥)ï¼›
@Retention(RUNTIME)
public @interface Access {
//æŒ‡å®šæ˜¯å­—æ®µä¸Šé¢ç”Ÿæ•ˆè¿˜æ˜¯æ–¹æ³•ä¸Šé¢ç”Ÿæ•ˆ
    AccessType value();
}
public enum AccessType {
    FIELD,
    PROPERTY
}
```

### @Id

å®šä¹‰å±æ€§ä¸ºæ•°æ®åº“çš„ä¸»é”®ï¼Œä¸€ä¸ªå®ä½“é‡Œé¢å¿…é¡»æœ‰ä¸€ä¸ªä¸»é”®ï¼Œä½†ä¸ä¸€å®šæ˜¯è¿™ä¸ªæ³¨è§£ï¼Œå¯ä»¥å’Œ @GeneratedValue é…åˆä½¿ç”¨æˆ–æˆå¯¹å‡ºç°ã€‚

### @GeneratedValue

ä¸»é”®ç”Ÿæˆç­–ç•¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```java
public @interface GeneratedValue {
    //Idçš„ç”Ÿæˆç­–ç•¥
    GenerationType strategy() default AUTO;
    //é€šè¿‡Sequencesç”ŸæˆId,å¸¸è§çš„æ˜¯Orcaleæ•°æ®åº“IDç”Ÿæˆè§„åˆ™ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦é…åˆ@SequenceGeneratorä½¿ç”¨
    String generator() default "";
}
```

å…¶ä¸­ï¼ŒGenerationType ä¸€å…±æœ‰ä»¥ä¸‹å››ä¸ªå€¼ï¼š

```java
public enum GenerationType {
    //é€šè¿‡è¡¨äº§ç”Ÿä¸»é”®ï¼Œæ¡†æ¶å€Ÿç”±è¡¨æ¨¡æ‹Ÿåºåˆ—äº§ç”Ÿä¸»é”®ï¼Œä½¿ç”¨è¯¥ç­–ç•¥å¯ä»¥ä½¿åº”ç”¨æ›´æ˜“äºæ•°æ®åº“ç§»æ¤ã€‚
    TABLE,
    //é€šè¿‡åºåˆ—äº§ç”Ÿä¸»é”®ï¼Œé€šè¿‡ @SequenceGenerator æ³¨è§£æŒ‡å®šåºåˆ—åï¼Œ MySql ä¸æ”¯æŒè¿™ç§æ–¹å¼ï¼›
    SEQUENCE,
    //é‡‡ç”¨æ•°æ®åº“IDè‡ªå¢é•¿ï¼Œ ä¸€èˆ¬ç”¨äºmysqlæ•°æ®åº“
    IDENTITY,
//JPA è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„ç­–ç•¥ï¼Œæ˜¯é»˜è®¤é€‰é¡¹ï¼›
    AUTO
}
```

### @Enumeratedï¼ˆæ²¡å•¥ç”¨ï¼‰

è¿™ä¸ªæ³¨è§£å¾ˆä¸å¥½ç”¨ï¼Œå› ä¸ºå®ƒå¯¹ enum æä¾›äº†ä¸‹æ ‡å’Œ name ä¸¤ç§æ–¹å¼ï¼Œç”¨æ³•ç›´æ¥æ˜ å°„åœ¨ enum æšä¸¾ç±»å‹çš„å­—æ®µä¸Šã€‚è¯·çœ‹ä¸‹é¢æºç ã€‚

```java
@Target({METHOD, FIELD}) //ä½œç”¨åœ¨æ–¹æ³•å’Œå­—æ®µä¸Š
public @interface Enumerated {
//æšä¸¾æ˜ å°„çš„ç±»å‹ï¼Œé»˜è®¤æ˜¯ORDINALï¼ˆå³æšä¸¾å­—æ®µçš„ä¸‹æ ‡ï¼‰ã€‚
    EnumType value() default ORDINAL;
}
public enum EnumType {
    //æ˜ å°„æšä¸¾å­—æ®µçš„ä¸‹æ ‡
    ORDINAL,
    //æ˜ å°„æšä¸¾çš„Name
    STRING
}
```

å†æ¥çœ‹ä¸€ä¸ª User é‡Œé¢å…³äºæ€§åˆ«æšä¸¾çš„ä¾‹å­ï¼Œä½ å°±ä¼šçŸ¥é“ @Enumerated åœ¨è¿™é‡Œ**æ²¡ä»€ä¹ˆä½œç”¨äº†**ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```java
//æœ‰ä¸€ä¸ªæšä¸¾ç±»ï¼Œç”¨æˆ·çš„æ€§åˆ«
public enum Gender {
    MAIL("ç”·æ€§"), FMAIL("å¥³æ€§");
    private String value;
    private Gender(String value) {
        this.value = value;
    }
}
//å®ä½“ç±»@Enumeratedçš„å†™æ³•å¦‚ä¸‹
@Entity
@Table(name = "tb_user")
public class User implements Serializable {
    @Enumerated(EnumType.STRING)
    @Column(name = "user_gender")
    private Gender gender;
    //.......................
}
```

è¿™æ—¶å€™æ’å…¥ä¸¤æ¡æ•°æ®ï¼Œæ•°æ®åº“é‡Œé¢çš„å€¼ä¼šå˜æˆ MAIL/FMAILï¼Œè€Œä¸æ˜¯â€œç”·æ€§â€ / å¥³æ€§ã€‚

**ç»éªŒåˆ†äº«ï¼š** å¦‚æœæˆ‘ä»¬ç”¨ @Enumeratedï¼ˆEnumType.ORDINALï¼‰ï¼Œè¿™æ—¶å€™æ•°æ®åº“é‡Œé¢çš„å€¼æ˜¯ 0ã€1ã€‚ä½†æ˜¯å®é™…å·¥ä½œä¸­ï¼Œä¸å»ºè®®ç”¨æ•°å­—ä¸‹æ ‡ï¼Œå› ä¸ºæšä¸¾é‡Œé¢çš„å±æ€§å€¼æ˜¯ä¼šä¸æ–­æ–°å¢çš„ï¼Œå¦‚æœæ–°å¢ä¸€ä¸ªï¼Œä½ç½®å˜åŒ–äº†å°±æƒ¨äº†ã€‚å¹¶ä¸” 0ã€1ã€2 è¿™ç§ä¸‹æ ‡åœ¨æ•°æ®åº“é‡Œé¢çœ‹ç€éå¸¸ç—›è‹¦ï¼Œæ—¶é—´é•¿äº†å°±ä¼šä¸€ç‚¹ä¹Ÿçœ‹ä¸æ‡‚äº†ã€‚

### @Basic

è¡¨ç¤ºå±æ€§æ˜¯åˆ°æ•°æ®åº“è¡¨çš„å­—æ®µçš„æ˜ å°„ã€‚å¦‚æœå®ä½“çš„å­—æ®µä¸Šæ²¡æœ‰ä»»ä½•æ³¨è§£ï¼Œé»˜è®¤å³ä¸º @Basicã€‚ä¹Ÿå°±æ˜¯è¯´é»˜è®¤æ‰€æœ‰çš„å­—æ®µè‚¯å®šæ˜¯å’Œæ•°æ®åº“è¿›è¡Œæ˜ å°„çš„ï¼Œå¹¶ä¸”é»˜è®¤ä¸º Eager ç±»å‹ã€‚

```java
public @interface Basic {
    //å¯é€‰ï¼ŒEAGERï¼ˆé»˜è®¤ï¼‰ï¼šç«‹å³åŠ è½½ï¼›LAZYï¼šå»¶è¿ŸåŠ è½½ã€‚ï¼ˆLAZYä¸»è¦åº”ç”¨åœ¨å¤§å­—æ®µä¸Šé¢ï¼‰
    FetchType fetch() default EAGER;
    //å¯é€‰ã€‚è¿™ä¸ªå­—æ®µæ˜¯å¦å¯ä»¥ä¸ºnullï¼Œé»˜è®¤æ˜¯trueã€‚
    boolean optional() default true;
}
```

### @Transient

è¡¨ç¤ºè¯¥å±æ€§å¹¶éä¸€ä¸ªåˆ°æ•°æ®åº“è¡¨çš„å­—æ®µçš„æ˜ å°„ï¼Œè¡¨ç¤ºéæŒä¹…åŒ–å±æ€§ã€‚JPA æ˜ å°„æ•°æ®åº“çš„æ—¶å€™å¿½ç•¥å®ƒï¼Œä¸ @Basic æœ‰ç›¸åçš„ä½œç”¨ã€‚ä¹Ÿå°±æ˜¯æ¯ä¸ªå­—æ®µä¸Šé¢ @Transient å’Œ @Basic å¿…é¡»äºŒé€‰ä¸€ï¼Œè€Œä»€ä¹ˆéƒ½ä¸æŒ‡å®šçš„è¯ï¼Œé»˜è®¤æ˜¯ @Basicã€‚

### @Column

å®šä¹‰è¯¥å±æ€§å¯¹åº”æ•°æ®åº“ä¸­çš„åˆ—åã€‚

```java
public @interface Column {
    //æ•°æ®åº“ä¸­çš„è¡¨çš„åˆ—åï¼›å¯é€‰ï¼Œå¦‚æœä¸å¡«å†™è®¤ä¸ºå­—æ®µåå’Œå®ä½“å±æ€§åä¸€æ ·ã€‚
    String name() default "";
    //æ˜¯å¦å”¯ä¸€ã€‚é»˜è®¤flaseï¼Œå¯é€‰ã€‚
    boolean unique() default false;
    //æ•°æ®å­—æ®µæ˜¯å¦å…è®¸ç©ºã€‚å¯é€‰ï¼Œé»˜è®¤trueã€‚
    boolean nullable() default true;
    //æ‰§è¡Œinsertæ“ä½œçš„æ—¶å€™æ˜¯å¦åŒ…å«æ­¤å­—æ®µï¼Œé»˜è®¤ï¼Œtrueï¼Œå¯é€‰ã€‚
    boolean insertable() default true;
    //æ‰§è¡Œupdateçš„æ—¶å€™æ˜¯å¦åŒ…å«æ­¤å­—æ®µï¼Œé»˜è®¤ï¼Œtrueï¼Œå¯é€‰ã€‚
    boolean updatable() default true;
    //è¡¨ç¤ºè¯¥å­—æ®µåœ¨æ•°æ®åº“ä¸­çš„å®é™…ç±»å‹ã€‚
    String columnDefinition() default "";
   //æ•°æ®åº“å­—æ®µçš„é•¿åº¦ï¼Œå¯é€‰ï¼Œé»˜è®¤255
    int length() default 255;
}
```

### @Temporal

ç”¨æ¥è®¾ç½® Date ç±»å‹çš„å±æ€§æ˜ å°„åˆ°å¯¹åº”ç²¾åº¦çš„å­—æ®µï¼Œå­˜åœ¨ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š

- @Temporal(TemporalType.DATE)æ˜ å°„ä¸ºæ—¥æœŸ // date ï¼ˆ**åªæœ‰æ—¥æœŸ**ï¼‰
- @Temporal(TemporalType.TIME)æ˜ å°„ä¸ºæ—¥æœŸ // time ï¼ˆ**åªæœ‰æ—¶é—´**ï¼‰
- @Temporal(TemporalType.TIMESTAMP)æ˜ å°„ä¸ºæ—¥æœŸ // date time ï¼ˆ**æ—¥æœŸ+æ—¶é—´**ï¼‰

### å®Œæ•´çš„ä¾‹å­

```java
@Entity
@Table(name = "user_topic")
@Access(AccessType.FIELD)
@Data
public class UserTopic {
   @Id
   @Column(name = "id", nullable = false)
   @GeneratedValue(strategy = GenerationType.IDENTITY)
   private Integer id;
   @Column(name = "title", nullable = true, length = 200)
   private String title;
   @Basic
   @Column(name = "create_user_id", nullable = true)
   private Integer createUserId;
   @Basic(fetch = FetchType.LAZY)
   @Column(name = "content", nullable = true, length = -1)
   @Lob
   private String content;
   @Basic(fetch = FetchType.LAZY)
   @Column(name = "image", nullable = true)
   @Lob
   private byte[] image;
   @Basic
   @Column(name = "create_time", nullable = true)
   @Temporal(TemporalType.TIMESTAMP)
   private Date createTime;
   @Basic
   @Column(name = "create_date", nullable = true)
   @Temporal(TemporalType.DATE)
   private Date createDate;
   @Enumerated(EnumType.STRING)
   @Column(name = "topic_type")
   private Type type;
   @Transient
   private String transientSimple;
   //éæ•°æ®åº“æ˜ å°„å­—æ®µï¼Œä¸šåŠ¡ç±»å‹çš„å­—æ®µ
   public String getTransientSimple() {
      return title + "auto:jack" + type;
   }
   //æœ‰ä¸€ä¸ªæšä¸¾ç±»ï¼Œä¸»é¢˜çš„ç±»å‹
   public enum Type {
      EN("è‹±æ–‡"), CN("ä¸­æ–‡");
      private final String des;
      Type(String des) {
         this.des = des;
      }
   }
}
```

å…¶å®è¿™é‡Œé¢çš„å¾ˆå¤šæ³¨è§£éƒ½å¯ä»¥çœç•¥ï¼Œç›´æ¥ä½¿ç”¨é»˜è®¤çš„å°±å¯ä»¥ã€‚å¦‚ @Basicã€@Column åå­—æœ‰ä¸€å®šçš„æ˜ å°„ç­–ç•¥ï¼ˆæˆ‘ä»¬åœ¨ç¬¬ 17 è¯¾æ—¶è®² DataSource çš„æ—¶å€™ä¼šè¯¦ç»†è®²è§£æ˜ å°„ç­–ç•¥ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥çœç•¥ã€‚æ­¤å¤–ï¼Œ@Access ä¹Ÿå¯ä»¥çœç•¥ï¼Œæˆ‘ä»¬åªè¦åœ¨è¿™äº›ç±»é‡Œé¢ä¿æŒä¸€è‡´å°±å¯ä»¥äº†ã€‚å­¦ä¼š**åˆ©ç”¨å·¥å…·å»ç”Ÿæˆ Entity ç±»**ï¼Œå°†ä¼šèŠ‚çœå¾ˆå¤šæ—¶é—´ã€‚

é¦–å…ˆï¼Œ**æ‰“å¼€ Persistence è§†å›¾ï¼Œç‚¹å‡» Generate Persistence Mapping**ï¼Œæ¥ç€**ç‚¹å‡»é€‰ä¸­æ•°æ®æº**ï¼Œç„¶åï¼Œ**é€‰æ‹©è¡¨å’Œå­—æ®µï¼Œå¹¶ç‚¹å‡» OK**ã€‚

ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æˆ‘ä»¬è¦æŠŠå¤–é”®å…³è”å…³ç³»å…³é—­ï¼Œä¸ç„¶ä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„ ERRORï¼Œæ¯•ç«Ÿç”Ÿäº§ç¯å¢ƒä¸åŒå¼€å‘ç¯å¢ƒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å¼€å‘ç¯å¢ƒç”Ÿæˆçš„è¡¨å¯¼å‡º DDL åˆ°ç”Ÿäº§æ‰§è¡Œã€‚æˆ‘ç»å¸¸ä¼šåˆ©ç”¨ç”Ÿæˆ DDL æ¥åšæµ‹è¯•å’Œå†™æ¡ˆä¾‹ï¼Œ è¿™æ ·çœå»äº†åˆ›å»ºè¡¨çš„æ—¶é—´ï¼Œåªéœ€è¦å…³æ³¨æˆ‘çš„ä»£ç å°±è¡Œäº†ã€‚

## è”åˆä¸»é”®

å¯ä»¥é€šè¿‡ javax.persistence.EmbeddedId å’Œ javax.persistence.IdClass ä¸¤ä¸ªæ³¨è§£å®ç°è”åˆä¸»é”®çš„æ•ˆæœã€‚

### é€šè¿‡@Id å’Œ @IdClass åšåˆ°è”åˆä¸»é”®

æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æ€ä¹ˆé€šè¿‡ @IdClass åšåˆ°è”åˆä¸»é”®ã€‚

ç¬¬ä¸€æ­¥ï¼šæ–°å»ºä¸€ä¸ª UserInfoID ç±»é‡Œé¢æ˜¯è”åˆä¸»é”®ã€‚

```java
@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class UserInfoID implements Serializable {
   private String name,telephone;
}
```

ç¬¬äºŒæ­¥ï¼šå†æ–°å»ºä¸€ä¸ª UserInfo çš„å®ä½“ï¼Œé‡‡ç”¨ @IdClass å¼•ç”¨è”åˆä¸»é”®ç±»ã€‚

```java
@Entity
@Data
@Builder
@IdClass(UserInfoID.class)
@AllArgsConstructor
@NoArgsConstructor
public class UserInfo {
   private Integer ages;
   @Id
   private String name;
   @Id
   private String telephone;
}
```

ç¬¬ä¸‰æ­¥ï¼šæ–°å¢ä¸€ä¸ª UserInfoReposito ç±»æ¥åš CRUD æ“ä½œã€‚

```java
public interface UserInfoRepository extends JpaRepository<UserInfo,UserInfoID> {
}
```

ç¬¬å››æ­¥ï¼šå†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œæµ‹è¯•ä¸€ä¸‹ã€‚

```java
@DataJpaTest
public class UserInfoRepositoryTest {
   @Autowired
   private UserInfoRepository userInfoRepository;
   @Test
   public void testIdClass() {
   userInfoRepository.save(UserInfo.builder().ages(1).name("jack").telephone("123456789").build());
      Optional<UserInfo> userInfo = userInfoRepository.findById(UserInfoID.builder().name("jack").telephone("123456789").build());
      System.out.println(userInfo.get());
   }
}
```

```
Hibernate: create table user_info (name varchar(255) not null, telephone varchar(255) not null, ages integer, primary key (name, telephone))
Hibernate: select userinfo0_.name as name1_3_0_, userinfo0_.telephone as telephon2_3_0_, userinfo0_.ages as ages3_3_0_ from user_info userinfo0_ where userinfo0_.name=? and userinfo0_.telephone=?
UserInfo(ages=1, name=jack, telephone=123456789)
```

é€šè¿‡ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬çš„è¡¨çš„ä¸»é”®æ˜¯ primary key (name, telephone)ï¼Œè€Œ Entity é‡Œé¢ä¸å†æ˜¯ä¸€ä¸ª @Id å­—æ®µäº†ã€‚é‚£ä¹ˆæˆ‘æ¥ä»‹ç»å¦å¤–ä¸€ä¸ªæ³¨è§£ @Embeddableï¼Œä¹Ÿèƒ½åšåˆ°è¿™ä¸€ç‚¹ã€‚

### @Embeddable ä¸ @EmbeddedId æ³¨è§£ä½¿ç”¨

ç¬¬ä¸€æ­¥ï¼šåœ¨æˆ‘ä»¬ä¸Šé¢ä¾‹å­ä¸­çš„ UserInfoID é‡Œé¢æ·»åŠ  @Embeddable æ³¨è§£ã€‚

```java
@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
@Embeddable
public class UserInfoID implements Serializable {
   private String name,telephone;
}
```

ç¬¬äºŒæ­¥ï¼šæ”¹ä¸€ä¸‹æˆ‘ä»¬åˆšæ‰çš„ User å¯¹è±¡ï¼Œåˆ é™¤ @IdClassï¼Œæ·»åŠ  @EmbeddedId æ³¨è§£ï¼Œå¦‚ä¸‹ï¼š

```java
@Entity
@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class UserInfo {
   private Integer ages;
   @EmbeddedId
   private UserInfoID userInfoID;
   @Column(unique = true)
   private String uniqueNumber;
}
```

ç¬¬ä¸‰æ­¥ï¼šUserInfoRepository ä¸å˜ï¼Œæˆ‘ä»¬ç›´æ¥ä¿®æ”¹ä¸€ä¸‹æµ‹è¯•ç”¨ä¾‹ã€‚

```java
@Test
public void testIdClass() {
  userInfoRepository.save(UserInfo.builder().ages(1).userInfoID(UserInfoID.builder().name("jack").telephone("123456789").build()).build());
   Optional<UserInfo> userInfo = userInfoRepository.findById(UserInfoID.builder().name("jack").telephone("123456789").build());
   System.out.println(userInfo.get());
}
```

è¿è¡Œå®Œä¹‹åï¼Œä½ å¯ä»¥å¾—åˆ°ç›¸åŒçš„ç»“æœã€‚é‚£ä¹ˆ @IdClass å’Œ @EmbeddedId çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢ï¼š

1. å¦‚ä¸Šé¢æµ‹è¯•ç”¨ä¾‹ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼ŒEmbedded ç”¨çš„æ˜¯å¯¹è±¡ï¼Œè€Œ IdClass ç”¨çš„æ˜¯å…·ä½“çš„æŸä¸€ä¸ªå­—æ®µï¼›
2. äºŒè€…çš„JPQL ä¹Ÿä¼šä¸ä¸€æ ·ï¼š

   ç”¨ @IdClass JPQL çš„å†™æ³•ï¼šSELECT u.name FROM UserInfo u

   ç”¨ @EmbeddedId çš„ JPQL çš„å†™æ³•ï¼šselect u.userInfoId.name FROM UserInfo u

è”åˆä¸»é”®è¿˜æœ‰éœ€è¦æ³¨æ„çš„å°±æ˜¯ï¼Œå®ƒä¸å”¯ä¸€æ€§ç´¢å¼•çº¦æŸçš„åŒºåˆ«æ˜¯å†™æ³•ä¸åŒï¼Œå¦‚ä¸Šé¢æ‰€è®²ï¼Œå”¯ä¸€æ€§ç´¢å¼•çš„å†™æ³•å¦‚ä¸‹ï¼š

```java
@Column(unique = true)
private String uniqueNumber;
```

åˆ°è¿™é‡Œï¼Œè”åˆä¸»é”®æˆ‘ä»¬è®²å®Œäº†ï¼Œé‚£ä¹ˆåœ¨é‡åˆ°è”åˆä¸»é”®çš„æ—¶å€™ï¼Œåˆ©ç”¨ @IdClassã€@EmbeddedIdï¼Œä½ å°±å¯ä»¥åº”å¯¹è”åˆä¸»é”®äº†ã€‚

æ­¤å¤–ï¼ŒJava æ˜¯é¢å‘å¯¹è±¡çš„ï¼Œè‚¯å®šä¼šç”¨åˆ°å¤šæ€çš„ä½¿ç”¨åœºæ™¯ï¼Œé‚£ä¹ˆåœºæ™¯éƒ½æœ‰å“ªäº›ï¼Ÿå…¬å…±çˆ¶ç±»åˆè¯¥å¦‚ä½•å†™ï¼Ÿæˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹ã€‚

## å®ä½“ä¹‹é—´çš„ç»§æ‰¿å…³ç³»å¦‚ä½•å®ç°ï¼ŸğŸ”¥

åœ¨ Java é¢å‘å¯¹è±¡çš„è¯­è¨€ç¯å¢ƒä¸­ï¼Œ@Entity ä¹‹é—´çš„å…³ç³»å¤šç§å¤šæ ·ï¼Œè€Œæ ¹æ® JPA çš„è§„èŒƒï¼Œæˆ‘ä»¬å¤§è‡´å¯ä»¥å°†å…¶åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š

1. çº¯ç²¹çš„ç»§æ‰¿ï¼Œå’Œè¡¨æ²¡å…³ç³»ï¼Œ**å¯¹è±¡ä¹‹é—´çš„å­—æ®µå…±äº«**ã€‚åˆ©ç”¨æ³¨è§£ **@MappedSuperclass**ï¼Œ**åè®®è§„å®šçˆ¶ç±»ä¸èƒ½æ˜¯ @Entity**ã€‚
2. å•è¡¨å¤šæ€é—®é¢˜ï¼ŒåŒä¸€å¼  Tableï¼Œè¡¨ç¤ºäº†ä¸åŒçš„å¯¹è±¡ï¼Œé€šè¿‡ä¸€ä¸ªå­—æ®µæ¥è¿›è¡ŒåŒºåˆ†ã€‚åˆ©ç”¨`@Inheritance(strategy = InheritanceType.SINGLE_TABLE)`æ³¨è§£å®Œæˆï¼Œåªæœ‰çˆ¶ç±»æœ‰ @Tableã€‚
3. å¤šè¡¨å¤šæ€ï¼Œæ¯ä¸€ä¸ªå­ç±»ä¸€å¼ è¡¨ï¼Œçˆ¶ç±»çš„è¡¨æ‹¥æœ‰æ‰€æœ‰å…¬ç”¨å­—æ®µã€‚é€šè¿‡`@Inheritance(strategy = InheritanceType.JOINED)`æ³¨è§£å®Œæˆï¼Œçˆ¶ç±»å’Œå­ç±»éƒ½æ˜¯è¡¨ï¼Œæœ‰å…¬ç”¨çš„å­—æ®µåœ¨çˆ¶è¡¨é‡Œé¢ã€‚
4. Object çš„ç»§æ‰¿ï¼Œæ•°æ®åº“é‡Œé¢æ¯ä¸€å¼ è¡¨æ˜¯åˆ†å¼€çš„ï¼Œç›¸äº’ç‹¬ç«‹ä¸å—å½±å“ã€‚é€šè¿‡`@Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)`æ³¨è§£å®Œæˆï¼Œçˆ¶ç±»ï¼ˆå¯ä»¥æ˜¯ä¸€å¼ è¡¨ï¼Œä¹Ÿå¯ä»¥ä¸æ˜¯ï¼‰å’Œå­ç±»éƒ½æ˜¯è¡¨ï¼Œç›¸äº’ä¹‹é—´æ²¡æœ‰å…³ç³»ã€‚

#### @MappedSuperclass ğŸ”¥

å…¶ä¸­ï¼Œç¬¬ä¸€ç§ @MappedSuperclassï¼Œæˆ‘ä»¬æš‚æ—¶ä¸å¤šä»‹ç»ï¼Œåœ¨ç¬¬ 12 è¯¾æ—¶è®²è§£â€œJPA çš„å®¡è®¡åŠŸèƒ½â€æ—¶ï¼Œå†åšè¯¦ç»†ä»‹ç»ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ç¬¬äºŒç§`SINGLE_TABLE`ã€‚

#### @Inheritance(strategy = InheritanceType.SINGLE_TABLE)

çˆ¶ç±»å®ä½“å¯¹è±¡ä¸å„ä¸ªå­å®ä½“å¯¹è±¡å…±ç”¨ä¸€å¼ è¡¨ï¼Œé€šè¿‡ä¸€ä¸ªå­—æ®µçš„ä¸åŒå€¼ä»£è¡¨ä¸åŒçš„å¯¹è±¡ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚

æˆ‘ä»¬æŠ½è±¡ä¸€ä¸ª Book å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```java
@Entity(name="book")
@Data
@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn(name="color", discriminatorType = DiscriminatorType.STRING)
public class Book {
   @Id
   @GeneratedValue(strategy= GenerationType.AUTO)
   private Long id;
   private String title;
}
```

å†æ–°å»ºä¸€ä¸ª BlueBook å¯¹è±¡ï¼Œä½œä¸º Book çš„å­å¯¹è±¡ã€‚

```java
@Entity
@Data
@EqualsAndHashCode(callSuper=false)
@DiscriminatorValue("blue")
public class BlueBook extends Book{
   private String blueMark;
}

```

å†æ–°å»ºä¸€ä¸ª RedBook å¯¹è±¡ï¼Œä½œä¸º Book çš„å¦ä¸€å­å¯¹è±¡ã€‚

```java
//çº¢çš®ä¹¦
@Entity
@DiscriminatorValue("red")
@Data
@EqualsAndHashCode(callSuper=false)
public class RedBook extends Book {
   private String redMark;
}
```

è¿™æ—¶ï¼Œæˆ‘ä»¬ä¸€å…±æ–°å»ºäº†ä¸‰ä¸ª Entity å¯¹è±¡ï¼Œå…¶å®éƒ½æ˜¯æŒ‡ book è¿™ä¸€å¼ è¡¨ï¼Œé€šè¿‡ book è¡¨é‡Œé¢çš„ color å­—æ®µæ¥åŒºåˆ†çº¢ä¹¦è¿˜æ˜¯ç»¿ä¹¦ã€‚æˆ‘ä»¬ç»§ç»­åšä¸€ä¸‹æµ‹è¯•çœ‹çœ‹ç»“æœã€‚

æˆ‘ä»¬å†æ–°å»ºä¸€ä¸ª RedBookRepositor ç±»ï¼Œæ“ä½œä¸€ä¸‹ RedBook ä¼šçœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š

```java
public interface RedBookRepository extends JpaRepository<RedBook,Long>{
}
```

ç„¶åå†æ–°å»ºä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚

```java
@DataJpaTest
public class RedBookRepositoryTest {
   @Autowired
   private RedBookRepository redBookRepository;
   @Test
   public void testRedBook() {
      RedBook redBook = new RedBook();
      redBook.setTitle("redbook");
      redBook.setRedMark("redmark");
      redBook.setId(1L);
      redBookRepository.saveAndFlush(redBook);
      RedBook r = redBookRepository.findById(1L).get();
    System.out.println(r.getId()+":"+r.getTitle()+":"+r.getRedMark());
   }
}
```

æœ€åçœ‹ä¸€ä¸‹æ‰§è¡Œç»“æœã€‚

```
Hibernate: create table book (color varchar(31) not null, id bigint not null, title varchar(255), blue_mark varchar(255), red_mark varchar(255), primary key (id))
```

ä½ ä¼šå‘ç°ï¼Œæˆ‘ä»¬åªåˆ›å»ºäº†ä¸€å¼ è¡¨ï¼Œinsert äº†ä¸€æ¡æ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç° color å­—æ®µé»˜è®¤ç»™çš„æ˜¯ redã€‚

```
Hibernate: insert into book (title, red_mark, color, id) values (?, ?, 'red', ?)
```

é‚£ä¹ˆå†çœ‹ä¸€ä¸‹æ‰“å°ç»“æœã€‚

```
1:redbook:redmark
```

ç»“æœå®Œå…¨å’Œé¢„æœŸçš„ä¸€æ ·ï¼Œè¿™è¯´æ˜äº† RedBookã€BlueBookã€Bookï¼Œéƒ½æ˜¯ä¸€å¼ è¡¨ï¼Œé€šè¿‡å­—æ®µ color çš„å€¼ä¸ä¸€æ ·ï¼Œæ¥åŒºåˆ†ä¸åŒçš„å®ä½“ã€‚
é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹ InheritanceType.JOINEDï¼Œå®ƒçš„æ¯ä¸ªå®ä½“éƒ½æ˜¯ç‹¬ç«‹çš„è¡¨ã€‚

#### @Inheritance(strategy = InheritanceType.JOINED)

åœ¨è¿™ç§æ˜ å°„ç­–ç•¥é‡Œé¢ï¼Œç»§æ‰¿ç»“æ„ä¸­çš„æ¯ä¸€ä¸ªå®ä½“ï¼ˆentityï¼‰ç±»éƒ½ä¼šæ˜ å°„åˆ°æ•°æ®åº“é‡Œä¸€ä¸ªå•ç‹¬çš„è¡¨ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªå®ä½“ï¼ˆentityï¼‰éƒ½ä¼šè¢«æ˜ å°„åˆ°æ•°æ®åº“ä¸­ï¼Œä¸€ä¸ªå®ä½“ï¼ˆentityï¼‰ç±»å¯¹åº”æ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨ã€‚

å…¶ä¸­æ ¹å®ä½“ï¼ˆroot entityï¼‰å¯¹åº”çš„è¡¨ä¸­å®šä¹‰äº†ä¸»é”®ï¼ˆprimary keyï¼‰ï¼Œæ‰€æœ‰çš„å­ç±»å¯¹åº”çš„æ•°æ®åº“è¡¨éƒ½è¦å…±åŒä½¿ç”¨ Book é‡Œé¢çš„ @ID è¿™ä¸ªä¸»é”®ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬æ”¹ä¸€ä¸‹ä¸Šé¢çš„ä¸‰ä¸ªå®ä½“ï¼Œæµ‹è¯•ä¸€ä¸‹InheritanceType.JOINEDï¼Œæ”¹åŠ¨å¦‚ä¸‹ï¼š

```java
@Entity(name="book")
@Data
@Inheritance(strategy = InheritanceType.JOINED)
public class Book {
   @Id
   @GeneratedValue(strategy= GenerationType.AUTO)
   private Long id;
   private String title;
}
```

å…¶æ¬¡ï¼Œæˆ‘ä»¬ Book çˆ¶ç±»ã€æ”¹å˜ Inheritance ç­–ç•¥ã€åˆ é™¤ DiscriminatorColumnï¼Œä½ ä¼šçœ‹åˆ°å¦‚ä¸‹ç»“æœã€‚

```java
@Entity
@Data
@EqualsAndHashCode(callSuper=false)
@PrimaryKeyJoinColumn(name = "book_id", referencedColumnName = "id")
public class BlueBook extends Book{
   private String blueMark;
}


@Entity
@PrimaryKeyJoinColumn(name = "book_id", referencedColumnName = "id")
@Data
@EqualsAndHashCode(callSuper=false)
public class RedBook extends Book {
   private String redMark;
}
```

ç„¶åï¼ŒBlueBookå’ŒRedBookä¹Ÿåˆ é™¤DiscriminatorColumnï¼Œæ–°å¢@PrimaryKeyJoinColumn(name = "book_id", referencedColumnName = "id")ï¼Œå’Œ book çˆ¶ç±»å…±ç”¨ä¸€ä¸ªä¸»é”®å€¼ï¼Œè€Œ RedBookRepository å’Œæµ‹è¯•ç”¨ä¾‹ä¸å˜ï¼Œæˆ‘ä»¬æ‰§è¡Œçœ‹ä¸€ä¸‹ç»“æœã€‚

```
Hibernate: create table blue_book (blue_mark varchar(255), book_id bigint not null, primary key (book_id))
Hibernate: create table book (id bigint not null, title varchar(255), primary key (id))
Hibernate: create table red_book (red_mark varchar(255), book_id bigint not null, primary key (book_id))
Hibernate: alter table blue_book add constraint FK9uuwgq7a924vtnys1rgiyrlk7 foreign key (book_id) references book
Hibernate: alter table red_book add constraint FKk8rvl61bjy9lgsr9nhxn5soq5 foreign key (book_id) references book
```

ä¸Šè¿°ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¸€å…±åˆ›å»ºäº†ä¸‰å¼ è¡¨ï¼Œå¹¶ä¸”æ–°å¢äº†ä¸¤ä¸ªå¤–é”®çº¦æŸï¼›è€Œæˆ‘ä»¬ save çš„æ—¶å€™ä¹Ÿç”Ÿæˆäº†ä¸¤ä¸ª insert è¯­å¥ï¼Œå¦‚ä¸‹ï¼š

```j
Hibernate: insert into book (title, id) values (?, ?)
Hibernate: insert into red_book (red_mark, book_id) values (?, ?)
```

è€Œæ‰“å°ç»“æœä¾ç„¶ä¸å˜ã€‚

```
1:redbook:redmark
```

è¿™å°±æ˜¯ InheritanceType.JOINED çš„ä¾‹å­ï¼Œè¿™ä¸ªæ–¹æ³•å’Œä¸Šé¢çš„ InheritanceType.SINGLE_TABLE åŒºåˆ«åœ¨äºè¡¨çš„æ•°é‡å’Œå…³ç³»ä¸ä¸€æ ·ï¼Œè¿™æ˜¯è¡¨è®¾è®¡çš„å¦ä¸€ç§æ–¹å¼ã€‚

#### @Inheritance(strategy = InheritanceType.TABLE_PER_CLASS) ğŸ”¥

æˆ‘ä»¬åœ¨ä½¿ç”¨ @MappedSuperClass ä¸»é”®çš„æ—¶å€™ï¼Œå¦‚æœä¸æŒ‡å®š @Inhertanceï¼Œé»˜è®¤å°±æ˜¯æ­¤ç§TABLE_PER_CLASSæ¨¡å¼ã€‚å½“ç„¶äº†ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¾ç¤ºæŒ‡å®šï¼Œè¦æ±‚ç»§æ‰¿åŸºç±»çš„éƒ½æ˜¯ä¸€å¼ è¡¨ï¼Œè€Œçˆ¶ç±»ä¸æ˜¯è¡¨ï¼Œæ˜¯ java å¯¹è±¡çš„æŠ½è±¡ç±»ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚

é¦–å…ˆï¼Œè¿˜æ˜¯æ”¹ä¸€ä¸‹ä¸Šé¢çš„ä¸‰ä¸ªå®ä½“ã€‚

```java
@Entity(name="book")
@Data
@Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)
public class Book {
   @Id
   @GeneratedValue(strategy= GenerationType.AUTO)
   private Long id;
   private String title;
}
```

å…¶æ¬¡ï¼ŒBook è¡¨é‡‡ç”¨ TABLE_PER_CLASS ç­–ç•¥ï¼Œå…¶å­å®ä½“ç±»éƒ½ä»£è¡¨å„è‡ªçš„è¡¨ï¼Œå®ä½“ä»£ç å¦‚ä¸‹ï¼š

```java
@Entity
@Data
@EqualsAndHashCode(callSuper=false)
public class RedBook extends Book {
   private String redMark;
}


@Entity
@Data
@EqualsAndHashCode(callSuper=false)
public class BlueBook extends Book{
   private String blueMark;
}
```

è¿™æ—¶ï¼Œä» RedBook å’Œ BlueBook é‡Œé¢å»æ‰ PrimaryKeyJoinColumnï¼Œè€Œ RedBookRepository å’Œæµ‹è¯•ç”¨ä¾‹ä¸å˜ï¼Œæˆ‘ä»¬æ‰§è¡Œçœ‹ä¸€ä¸‹ç»“æœã€‚

```
Hibernate: create table blue_book (id bigint not null, title varchar(255), blue_mark varchar(255), primary key (id))
Hibernate: create table book (id bigint not null, title varchar(255), primary key (id))
Hibernate: create table red_book (id bigint not null, title varchar(255), red_mark varchar(255), primary key (id))
```

è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¿˜æ˜¯åˆ›å»ºäº†ä¸‰å¼ è¡¨ï¼Œä½†ä¸‰å¼ è¡¨ä»€ä¹ˆå…³ç³»ä¹Ÿæ²¡æœ‰ã€‚è€Œ insert è¯­å¥ä¹Ÿåªæœ‰ä¸€æ¡ï¼Œå¦‚ä¸‹ï¼š

```
Hibernate: insert into red_book (title, red_mark, id) values (?, ?, ?)
```

æ‰“å°ç»“æœè¿˜æ˜¯ä¸å˜ã€‚

```
1:redbook:redmark
```

è¿™ä¸ªæ–¹æ³•ä¸ä¸Šé¢ä¸¤ä¸ªç›¸æ¯”è¾ƒï¼Œè¯­ä¹‰æ›´åŠ æ¸…æ™°ï¼Œæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§åšæ³•ã€‚
ä»¥ä¸Šå°±æ˜¯å®ä½“ä¹‹é—´ç»§æ‰¿å…³ç³»çš„å®ç°æ–¹æ³•ï¼Œå¯ä»¥åœ¨æ¶‰åŠ java å¤šæ€çš„æ—¶å€™åŠ ä»¥åº”ç”¨ï¼Œä¸è¿‡è¦æ³¨æ„åŒºåˆ†ä¸‰ç§æ–¹å¼æ‰€è¡¨è¾¾çš„è¡¨çš„æ„æ€ï¼Œå†åŠ ä»¥è¿ç”¨ã€‚

#### å…³äºç»§æ‰¿å…³ç³»çš„ç»éªŒä¹‹è°ˆâ€”@Inheritance è¢«æ·˜æ±° ğŸ”¥

ä»æˆ‘çš„ä¸ªäººç»éªŒæ¥çœ‹ï¼Œ@Inheritance çš„è¿™ç§ä½¿ç”¨æ–¹å¼ä¼šé€æ¸è¢«æ·˜æ±°ï¼Œå› ä¸ºè¿™æ ·çš„è¡¨çš„è®¾è®¡å¾ˆå¤æ‚ï¼Œæœ¬åº”è¯¥åœ¨ä¸šåŠ¡å±‚é¢åšçš„äº‹æƒ…ï¼ˆå¤šæ€ï¼‰ï¼Œè€Œåœ¨ datasoure çš„è¡¨çº§åˆ«åšäº†ã€‚æ‰€ä»¥åœ¨ JPA ä¸­ä½¿ç”¨è¿™ä¸ªçš„æ—¶å€™ä½ å°±ä¼šæƒ³ï¼šâ€œè¿™ä¹ˆå¤æ‚çš„ä¸œè¥¿ï¼Œæˆ‘ç›´æ¥ç”¨ Mybatis ç®—äº†ã€‚â€æˆ‘æƒ³å‘Šè¯‰ä½ ï¼Œå…¶å®å®ƒä»¬æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æˆ‘ä»¬ä½¿ç”¨çš„æ€è·¯ä¸å¯¹ã€‚

é‚£ä¹ˆä¸ºä»€ä¹ˆè¡Œä¸šå†…éƒ½ä¸å»ºè®®ä½¿ç”¨äº†ï¼Œè¿˜è¦ä»‹ç»è¿™ä¹ˆè¯¦ç»†å‘¢ï¼Ÿå› ä¸ºï¼Œå¦‚æœä½ é‡åˆ°çš„æ˜¯è€ä¸€ç‚¹çš„é¡¹ç›®ï¼Œå¦‚æœä¸æ˜¯ç”¨ Java è¯­è¨€å†™çš„ï¼Œä¸ä¸€å®šæœ‰é¢å‘å¯¹è±¡çš„æ€æƒ³ã€‚è¿™ä¸ªæ—¶å€™å¦‚æœè®©ä½ è¿ç§»æˆ Java æ€ä¹ˆåŠï¼Ÿå¦‚æœä½ å¯ä»¥æƒ³åˆ°è¿™ç§ç”¨æ³•ï¼Œå°±ä¸è‡³äºæŸæ‰‹æ— æªã€‚

æ­¤å¤–ï¼Œåœ¨äº’è”ç½‘é¡¹ç›®ä¸­ï¼Œä¸€æ—¦æœ‰å…³è¡¨çš„ä¸šåŠ¡å¯¹è±¡è¿‡å¤šäº†ä¹‹åï¼Œå°±å¯ä»¥æ‹†è¡¨æ‹†åº“äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦æƒ³åˆ°æˆ‘ä»¬çš„@Table æ³¨è§£æŒ‡å®šè¡¨åå’Œ schemaã€‚

å…³äºä¸Šé¢æåˆ°çš„æ–¹æ³•ä¸­ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ç¬¬ä¸€ç§ @MappedSuperclassï¼Œè¿™ä¸ªæˆ‘ä»¬å°†åœ¨ç¬¬ 12 è¯¾æ—¶â€œJPA çš„å®¡è®¡åŠŸèƒ½è§£å†³äº†å“ªäº›é—®é¢˜ï¼Ÿâ€ä¸­è¯¦ç»†ä»‹ç»ï¼Œåˆ°æ—¶å€™ä½ å¯ä»¥ä½“éªŒä¸€ä¸‹å®ƒçš„ä¸åŒä¹‹å¤„ã€‚

### æ€»ç»“

Entity é‡Œé¢å¸¸ç”¨çš„åŸºæœ¬æ³¨è§£æˆ‘ä»¬å°±ä»‹ç»åˆ°è¿™é‡Œï¼Œå› ä¸ºæ³¨è§£å¤ªå¤šæ²¡åŠæ³•ä¸€ä¸€ä»‹ç»ï¼Œä½ å¯ä»¥æŒæ¡ä¸€ä¸‹å­¦ä¹ æ–¹æ³•ã€‚å…ˆé€šè¿‡æºç æŠŠå¤§è‡´æ³¨è§£çœ‹ä¸€ä¸‹ï¼Œæœ‰å“ªäº›ä¸ç†Ÿæ‚‰çš„å¯ä»¥çœ‹çœ‹æºç é‡Œé¢çš„æ³¨é‡Šï¼Œå†é˜…è¯» JPA å®˜æ–¹åè®®ï¼Œè¿˜å¯ä»¥å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹è¯•ï¼Œè·‘ä¸€ä¸‹çœ‹çœ‹ sql è¾“å‡ºå’Œæ—¥å¿—ï¼Œè¿™æ ·å¾ˆå¿«å°±å¯ä»¥çŸ¥é“ç»“æœäº†ã€‚

## é™„. Spring MVC æµ‹è¯•

åœ¨ /src/test/resources ä¸­åˆ›å»º JpaApplication.http æ–‡ä»¶

```h
### æ–°å¢ï¼ˆæ³¨æ„è¯·æ±‚ç©ºè¡Œï¼ï¼‰
POST /api/v1/user HTTP/1.1
Host: 127.0.0.1:10000
Content-Type: application/json
Cache-Control: no-cache

{"name":"jack","email":"123@126.com"}


### æŸ¥è¯¢ï¼ˆæˆ‘ä¹Ÿä¸ç›´åˆ°ä¸ºå•¥è¿™ä¸ªå¿…é¡»åŠ  ip + port
GET http://127.0.0.1:10000/api/v1/users?size=3&page=0
```


## æœªæ•´ç† ğŸ”¥

* saveå¯¹nullï¼ŒDynamicUpdate
* æ§åˆ¶å°æ€ä¹ˆæ‰“å°å‡ºçš„binding parameterï¼šlogging.level.org.hibernate.type.descriptor.sql=TRACE