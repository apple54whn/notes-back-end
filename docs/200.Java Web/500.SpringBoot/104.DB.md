---
title: DB
date: 2021-06-21 21:21:03
permalink: /pages/99d046/
categories:
  - Java Web
  - SpringBoot
tags:
  - 
---
# DB

Spring Boot å¯ä»¥è‡ªåŠ¨é…ç½®åµŒå…¥å¼ï¼ˆembeddedï¼‰æ•°æ®åº“å¦‚ï¼šH2, HSQL, Derby ç­‰ã€‚ä½ ä¸éœ€è¦æä¾›ä»»ä½•è¿æ¥çš„ URLï¼Œä½ åªéœ€è¦åŒ…å«å¯¹è¦ä½¿ç”¨çš„åµŒå…¥å¼æ•°æ®åº“çš„æ„å»ºä¾èµ–é¡¹

## DataSource

é€šè¿‡ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± ä¹Ÿå¯ä»¥**è‡ªåŠ¨é…ç½®**ç”Ÿäº§æ•°æ®åº“ã€‚Spring Boot ä½¿ç”¨ä»¥ä¸‹ç®—æ³•ï¼ˆalgorithmï¼‰æ¥é€‰æ‹©ç‰¹å®šçš„å®ç°ï¼š

1. å¦‚æœ HikariCP å­˜åœ¨ï¼Œæˆ‘ä»¬æ€»æ˜¯é€‰æ‹©å®ƒï¼Œç”±äºå®ƒçš„é«˜æ€§èƒ½å’Œé«˜å¹¶å‘ã€‚
2. å¦å¤–ï¼Œå¦‚æœ Tomcat æ•°æ®åº“è¿æ¥æ± å­˜åœ¨ï¼Œæˆ‘ä»¬é€‰æ‹©å®ƒ
3. å¦‚æœä¸Šè¿° 2 ä¸ªéƒ½ä¸å­˜åœ¨ï¼Œè‹¥ Commons DBCP2 å­˜åœ¨ï¼Œæˆ‘ä»¬é€‰æ‹©å®ƒ
4. å¦‚æœä½ ä½¿ç”¨äº†`spring-boot-starter-jdbc` æˆ– `spring-boot-starter-data-jpa` startersï¼Œä½ å°†è‡ªåŠ¨è·å¾—å¯¹ HikariCP çš„ä¾èµ–

ä½ ä¹Ÿå¯ä»¥å®Œå…¨ç»•è¿‡ï¼ˆbypassï¼‰ä¸Šè¿°ç®—æ³•ï¼Œé€šè¿‡è®¾ç½® `spring.datasource.type` å±æ€§æ¥æŒ‡å®šè¿æ¥æ± ã€‚å¦‚æœæ‚¨åœ¨ Tomcat å®¹å™¨ä¸­è¿è¡Œåº”ç”¨ç¨‹åºï¼Œè¿™ä¸€ç‚¹å°¤å…¶é‡è¦ï¼Œå› ä¸ºç¼ºçœæƒ…å†µä¸‹æä¾›äº†`tomcat-jdbc`ã€‚è‹¥è‡ªå®šä¹‰æ•°æ®æº Beanï¼Œåˆ™ä¸ä¼šå‘ç”Ÿè‡ªåŠ¨é…ç½®ã€‚

## HikariCP

> Hikari Connection Poor
>

### ä»€ä¹ˆæ˜¯ HikariCPâ“

[HiKariCP](https://github.com/brettwooldridge/HikariCP) æ˜¯æ•°æ®åº“è¿æ¥æ± çš„ä¸€ä¸ªåèµ·ä¹‹ç§€ï¼Œå·ç§°æ€§èƒ½æœ€å¥½ï¼Œå¯ä»¥å®Œç¾åœ° PK æ‰å…¶ä»–è¿æ¥æ± ã€‚æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ JDBC è¿æ¥æ± ï¼ŒåŸºäº BoneCP åšäº†ä¸å°‘çš„æ”¹è¿›å’Œä¼˜åŒ–ã€‚è¶…å¿«ï¼Œå¿«åˆ°è¿ Spring Boot 2 éƒ½å®£å¸ƒæ”¯æŒäº†ã€‚

### ä»€ä¹ˆæ˜¯ BoneCPâ“

ä¼ è¯´ä¸­ BoneCP åœ¨å¿«é€Ÿè¿™ä¸ªç‰¹ç‚¹ä¸Šåšåˆ°äº†æè‡´ï¼Œå®˜æ–¹æ•°æ®æ˜¯ C3P0 ç­‰çš„ 25 å€å·¦å³ï¼Œä»¥ä¸‹ä¸ºæ€§èƒ½æµ‹è¯•æŠ¥å‘Šã€‚

#### å•çº¿ç¨‹

- 1,000,000 è·å–è¿æ¥/é‡Šæ”¾è¿æ¥è¯·æ±‚
- è·å–/é‡Šæ”¾è¿æ¥ä¹‹é—´æ²¡æœ‰å»¶è¿Ÿ
- è¿æ¥æ± èŒƒå›´ï¼š20-50
- å¢é‡ï¼š5
- çº¿ç¨‹ï¼š1
- åˆ†åŒºï¼š1

![img](../images/ae19aac80c50404.jpg)

#### å¤šçº¿ç¨‹

- 500 ä¸ªçº¿ç¨‹åˆ†åˆ«è·å–é‡Šæ”¾ 100 ä¸ªè¿æ¥
- åœ¨è·å–è¿æ¥å’Œé‡Šæ”¾è¿æ¥ä¹‹é—´å¼•å…¥äº† 10ms çš„å»¶è¿Ÿ `Thread.sleep()`ï¼Œæ¨¡æ‹Ÿè¿æ¥å®Œæˆå·¥ä½œ
- è¿æ¥æ± èŒƒå›´ï¼š50-200
- å¢é‡ï¼š5
- çº¿ç¨‹ï¼š5

![img](../images/1db8b584e0e7a03.jpg)

#### Prepared Statement

- 500 ä¸ªçº¿ç¨‹åˆ†åˆ«è·å–é‡Šæ”¾ 100 ä¸ªè¿æ¥
- æ— å»¶è¿Ÿ
- è¿æ¥æ± èŒƒå›´ï¼š50-200
- å¢é‡ï¼š5
- çº¿ç¨‹ï¼š5

![img](../images/f976c3fb5ce1233.png)

### HikariCP çš„ Power ğŸ’¥

BoneCP ä½œè€…æ”¾å¼ƒç»´æŠ¤ï¼Œå¹¶åœ¨ Github é¡¹ç›®ä¸»é¡µæ¨èå¤§å®¶ä½¿ç”¨ HikariCPï¼ŒHikariï¼ˆã²ã‹ã‚Š [hiÂ·kaÂ·'lÄ“] ï¼‰ æ¥è‡ªæ—¥æ–‡ï¼Œæ˜¯ **å…‰** çš„æ„æ€ã€‚è¿™ä¸ªäº§å“çš„å£å·æ˜¯ **å¿«é€Ÿã€ç®€å•ã€å¯é **

#### ä¼˜åŒ–

- **å­—èŠ‚ç ç²¾ç®€ ï¼š** ä¼˜åŒ–ä»£ç ï¼Œç›´åˆ°ç¼–è¯‘åçš„å­—èŠ‚ç æœ€å°‘ï¼Œè¿™æ ·ï¼ŒCPU ç¼“å­˜å¯ä»¥åŠ è½½æ›´å¤šçš„ç¨‹åºä»£ç 
- **ä¼˜åŒ–ä»£ç†å’Œæ‹¦æˆªå™¨ ï¼š** å‡å°‘ä»£ç ï¼Œä¾‹å¦‚ HikariCP çš„ Statement proxy åªæœ‰ 100 è¡Œä»£ç ï¼Œåªæœ‰ BoneCP çš„ååˆ†ä¹‹ä¸€
- **è‡ªå®šä¹‰æ•°ç»„ç±»å‹ï¼ˆFastStatementListï¼‰ä»£æ›¿ ArrayList ï¼š** é¿å…æ¯æ¬¡ `get()` è°ƒç”¨éƒ½è¦è¿›è¡Œ range checkï¼Œé¿å…è°ƒç”¨ `remove()` æ—¶çš„ä»å¤´åˆ°å°¾çš„æ‰«æ
- **è‡ªå®šä¹‰é›†åˆç±»å‹ï¼ˆConcurrentBagï¼‰ï¼š** æé«˜å¹¶å‘è¯»å†™çš„æ•ˆç‡
- **å…¶ä»–é’ˆå¯¹ BoneCP ç¼ºé™·çš„ä¼˜åŒ–ï¼š** æ¯”å¦‚å¯¹äºè€—æ—¶è¶…è¿‡ä¸€ä¸ª CPU æ—¶é—´ç‰‡çš„æ–¹æ³•è°ƒç”¨çš„ç ”ç©¶ï¼ˆä½†æ²¡è¯´å…·ä½“æ€ä¹ˆä¼˜åŒ–ï¼‰

#### ä»£ç é‡

å‡ ä¸ªè¿æ¥æ± çš„ä»£ç é‡å¯¹æ¯”ï¼ˆä»£ç é‡è¶Šå°‘ï¼Œä¸€èˆ¬æ„å‘³ç€æ‰§è¡Œæ•ˆç‡è¶Šé«˜ã€å‘ç”Ÿ BUG çš„å¯èƒ½æ€§è¶Šä½ï¼‰

| Pool     | Files | Code  |
| :------- | :---- | :---- |
| Vibur    | 34    | 1927  |
| HikariCP | 21    | 2228  |
| Tomcat   | 31    | 6345  |
| BoneCP   | 49    | 7293  |
| C3P0     | 120   | 15550 |

#### é€Ÿåº¦

åˆ«äººå‘æ¨æ–‡æµ‹è¯• Hikari é€Ÿåº¦

![img](../images/daf29bd1cc47347.jpg)

#### ç¨³å®šæ€§

![img](../images/1396c369655fa4b.png)

#### å¯é æ€§

å¦å¤–ï¼Œå…³äºå¯é æ€§æ–¹é¢ï¼Œä¹Ÿæ˜¯æœ‰å®éªŒå’Œæ•°æ®æ”¯æŒçš„ã€‚å¯¹äºæ•°æ®åº“è¿æ¥ä¸­æ–­çš„æƒ…å†µï¼Œé€šè¿‡æµ‹è¯• `getConnection()`ï¼Œå„ç§ CP çš„ä¸ç›¸åŒå¤„ç†æ–¹æ³•å¦‚ä¸‹ï¼ˆæ‰€æœ‰ CP éƒ½é…ç½®äº†è·Ÿ `connectionTimeout` ç±»ä¼¼çš„å‚æ•°ä¸º 5 ç§’é’Ÿï¼‰

- **HikariCP(A)ï¼š** ç­‰å¾… 5 ç§’é’Ÿåï¼Œå¦‚æœè¿æ¥è¿˜æ˜¯æ²¡æœ‰æ¢å¤ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ª `SQLExceptions` å¼‚å¸¸ï¼›åç»­çš„ `getConnection()` ä¹Ÿæ˜¯ä¸€æ ·å¤„ç†
- **C3P0(C-)ï¼š** å®Œå…¨æ²¡æœ‰ååº”ï¼Œæ²¡æœ‰æç¤ºï¼Œä¹Ÿä¸ä¼šåœ¨ `CheckoutTimeout` é…ç½®çš„æ—¶é•¿è¶…æ—¶åæœ‰ä»»ä½•é€šçŸ¥ç»™è°ƒç”¨è€…ï¼›ç„¶åç­‰å¾… 2 åˆ†é’Ÿåç»ˆäºé†’æ¥äº†ï¼Œè¿”å›ä¸€ä¸ª error
- **Tomcat(F)ï¼š** è¿”å›ä¸€ä¸ª connectionï¼Œç„¶åè°ƒç”¨è€…å¦‚æœåˆ©ç”¨è¿™ä¸ªæ— æ•ˆçš„ connection æ‰§è¡Œ SQL è¯­å¥ ç»“æœå¯æƒ³è€ŒçŸ¥ï¼›å¤§çº¦ 55 ç§’ä¹‹åç»ˆäºé†’æ¥äº†ï¼Œè¿™æ—¶å€™çš„ `getConnection()` ç»ˆäºå¯ä»¥è¿”å›ä¸€ä¸ª errorï¼Œä½†æ²¡æœ‰ç­‰å¾…å‚æ•°é…ç½®çš„ 5 ç§’é’Ÿï¼Œè€Œæ˜¯ç«‹å³è¿”å› error
- **BoneCP(C)ï¼š** è·Ÿ Tomcat çš„å¤„ç†æ–¹æ³•ä¸€æ ·ï¼›ä¹Ÿæ˜¯å¤§çº¦ 55 ç§’ä¹‹åæ‰é†’æ¥ï¼Œæœ‰äº†æ­£å¸¸çš„ååº”ï¼Œå¹¶ä¸”ç»ˆäºä¼šç­‰å¾… 5 ç§’é’Ÿä¹‹åè¿”å› error äº†

### é…ç½® HikariCP ğŸ©

#### POM

å¦‚æœä½ ä½¿ç”¨äº†

`spring-boot-starter[-data]-jdbc` æˆ–

`spring-boot-starter-data-jpa`æˆ–

`mybatis-spring-boot-starter` startersï¼Œä½ å°†è‡ªåŠ¨è·å¾—å¯¹ HikariCP çš„ä¾èµ–ã€‚ä¾‹å¦‚ Mybatis

```xml
<dependency>
  <groupId>org.mybatis.spring.boot</groupId>
  <artifactId>mybatis-spring-boot-starter</artifactId>
  <version>2.1.1</version>
</dependency>
```

#### YAML

```yaml
spring:
  datasource:
    # type: com.zaxxer.hikari.HikariDataSource # å¯çœç•¥ï¼ŒSpring Boot ä¼šè‡ªåŠ¨æ£€æµ‹
    # driver-class-name: com.mysql.cj.jdbc.Driver # å¯çœç•¥ï¼ŒSpring Boot ä¼šè‡ªåŠ¨æ£€æµ‹
    url: jdbc:mysql://172.16.154.11:3306/test?useUnicode=true&characterEncoding=utf-8&useSSL=false
    username: root
    password: 123456
    hikari:
      minimum-idle: 5
      idle-timeout: 600000
      maximum-pool-size: 10
      auto-commit: true
      pool-name: MyHikariCP
      max-lifetime: 1800000
      connection-timeout: 30000
      connection-test-query: SELECT 1
```

> You should at least specify the URL by setting the `spring.datasource.url` property. Otherwise, Spring Boot tries to auto-configure an embedded database.
>
> You often do not need to specify the `driver-class-name`, since Spring Boot can deduce it for most databases from the `url`.
>
> See [`DataSourceProperties`](https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/DataSourceProperties.java) for more of the supported options. These are the standard options that work regardless of the actual implementation. It is also possible to fine-tune implementation-specific settings by using their respective prefix (`spring.datasource.hikari.*`, `spring.datasource.tomcat.*`, and `spring.datasource.dbcp2.*`). Refer to the documentation of the connection pool implementation you are using for more details.
>

## é›†æˆ H2 æ•°æ®åº“

H2 æ˜¯ä¸€ä¸ªå†…å­˜æ•°æ®åº“ï¼Œæ–¹ä¾¿æµ‹è¯•ã€‚

## é›†æˆ Mybatis

### èµ·æ­¥ä¾èµ–

ä½¿ç”¨ Spring Initializr æ·»åŠ  DevToolsã€Webã€MySQLã€**MyBatis**ä¾èµ–

```xml
<!-- MySQLè¿æ¥é©±åŠ¨ -->
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <scope>runtime</scope>
</dependency>
<!--mybatisèµ·æ­¥ä¾èµ–-->
<dependency>
    <groupId>org.mybatis.spring.boot</groupId>
    <artifactId>mybatis-spring-boot-starter</artifactId>
    <version>2.0.0</version>
</dependency>

```

### æ•°æ®åº“è¿æ¥å’Œ MyBatis é…ç½®

åœ¨ application.properties/yml ä¸­æ·»åŠ æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯ã€Spring Boot é›†æˆ MyBatis çš„é…ç½®

```properties
#æ•°æ®åº“è¿æ¥ä¿¡æ¯
spring.datasource.driverClassName=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3308/test?serverTimezone=GMT%2B8&useSSL=false
spring.datasource.username=root
spring.datasource.password=w111151

#springé›†æˆMybatisç¯å¢ƒ
#pojoåˆ«åæ‰«æåŒ…ï¼Œä¸é…ç½®ä¹Ÿè¡Œï¼Œéœ€è¦æŒ‡å®šå…¨ç±»å
mybatis.type-aliases-package=com.example.domain
#åŠ è½½Mybatisæ˜ å°„æ–‡ä»¶ï¼Œä¸é…ç½®ä¹Ÿè¡Œï¼Œåªéœ€è¦*mapper.xmlåœ¨@Mapperæ³¨è§£çš„æ¥å£çš„åŒä¸€åŒ…ä¸­ï¼
mybatis.mapper-locations=classpath:mapper/*Mapper.xml

```

```yaml
#æ•°æ®åº“è¿æ¥ä¿¡æ¯
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3308/test?serverTimezone=GMT%2B8&useSSL=false
    username: root
    password: w111151

#springé›†æˆMybatisç¯å¢ƒ
mybatis:
  #pojoåˆ«åæ‰«æåŒ…
  type-aliases-package: com.example.domain
  #åŠ è½½Mybatisæ˜ å°„æ–‡ä»¶
  mapper-locations: classpath:mapper/*Mapper.xml
```

### åˆ›å»º user è¡¨å¯¹åº”çš„å®ä½“ç±»

åœ¨ test æ•°æ®åº“ä¸­åˆ›å»º user è¡¨

```sql
-- ----------------------------
-- Table structure for `user`
-- ----------------------------
DROP TABLE IF EXISTS `user`;
CREATE TABLE `user` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(50) DEFAULT NULL,
  `password` varchar(50) DEFAULT NULL,
  `name` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of user
-- ----------------------------
INSERT INTO `user` VALUES ('1', 'zhangsan', '123', 'å¼ ä¸‰');
INSERT INTO `user` VALUES ('2', 'lisi', '123', 'æå››');

```

com.example.domain.User

```java
public class User {
    // ä¸»é”®
    private Long id;
    // ç”¨æˆ·å
    private String username;
    // å¯†ç 
    private String password;
    // å§“å
    private String name;

    //æ­¤å¤„çœç•¥getterå’Œsetteræ–¹æ³• .. ..

}

```

### ç¼–å†™ Mapper æ¥å£

com.example.mapper.UserMapper

```java
@Mapper
public interface UserMapper {
	public List<User> queryUserList();
}

```

æ³¨æ„ï¼š`@Mapper`æ ‡è®°è¯¥ç±»æ˜¯ä¸€ä¸ª mybatis çš„ mapper æ¥å£ï¼Œ**å¯ä»¥è¢« spring boot è‡ªåŠ¨æ‰«æåˆ° spring ä¸Šä¸‹æ–‡ä¸­**

### é…ç½® Mapper æ˜ å°„æ–‡ä»¶

åœ¨ src\main\resources\mapper è·¯å¾„ä¸‹åŠ å…¥ UserMapper.xml é…ç½®æ–‡ä»¶

```xml
<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itheima.mapper.UserMapper">
    <select id="queryUserList" resultType="user">
        select * from user
    </select>
</mapper>

```

### ç¼–å†™æµ‹è¯• Controller

com.example.controller.UserController

```java
@RestController
public class UserController {

    @Autowired
    private UserMapper userMapper;//æŠ¥é”™ï¼Œæ²¡æœ‰æ­¤ç±»å‹çš„beanã€‚ä½†æ˜¯å¯ä»¥ä½¿ç”¨ï¼Œåœ¨è¿è¡ŒæœŸä¼šåˆ›å»ºå¥½beanã€‚è¿˜å¯ä»¥æ·»åŠ componentä¹‹ç±»æ³¨è§£

    @RequestMapping("/queryUser")
    public List<User> queryUser() {
        List<User> users = userMapper.queryUserList();
        return users;
    }
}

```

æµ‹è¯•ç•¥

## é›†æˆ JUnit

### æ·»åŠ  JUnit çš„èµ·æ­¥ä¾èµ–

ä¸€èˆ¬ä½¿ç”¨ Spring Initializr æ·»åŠ  Web ä¾èµ–åä¼šè‡ªåŠ¨å¯¼å…¥**JUnit**èµ·æ­¥ä¾èµ–

```xml
<!--æµ‹è¯•çš„èµ·æ­¥ä¾èµ–-->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-test</artifactId>
    <scope>test</scope>
</dependency>

```

### ç¼–å†™æµ‹è¯•ç±»

```java
@RunWith(SpringRunner.class)
@SpringBootTest(classes = SpringbootMybatisApplication.class)//ä¸æŒ‡å®šä¼šä»mainä¸‹æ‰¾å¯åŠ¨ç±»ï¼ŒåŠ è½½Springå®¹å™¨ã€‚ä½†é¡»åœ¨åŒä¸€åŒ…ä¸­ï¼
public class MapperTest {

    @Autowired
    private UserMapper userMapper;

    @Test
    public void test() {
        List<User> users = userMapper.queryUserList();
        System.out.println(users);
    }

}

```

å…¶ä¸­ï¼Œ

SpringRunner ç»§æ‰¿è‡ª SpringJUnit4ClassRunnerï¼Œä½¿ç”¨å“ªä¸€ä¸ª Spring æä¾›çš„æµ‹è¯•æµ‹è¯•å¼•æ“éƒ½å¯ä»¥

```java
public final class SpringRunner extends SpringJUnit4ClassRunner


```

@SpringBootTest çš„å±æ€§æŒ‡å®šçš„æ˜¯å¼•å¯¼ç±»çš„å­—èŠ‚ç å¯¹è±¡

## é›†æˆ Spring Data JPA

### èµ·æ­¥ä¾èµ–

ä½¿ç”¨ Spring Initializr æ·»åŠ  DevToolsã€Webã€MySQLã€**JPA**ä¾èµ–

```xml
<!-- MySQLè¿æ¥é©±åŠ¨ -->
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <scope>runtime</scope>
</dependency>
<!-- Spring Data JPAçš„èµ·æ­¥ä¾èµ– -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>

```

### æ•°æ®åº“è¿æ¥å’Œ JPA é…ç½®

åœ¨ application.properties/yml ä¸­æ·»åŠ æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯ã€Spring Boot é›†æˆ Spring Data JPA çš„é…ç½®

```yaml
spring:
  #DB Configuration:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3308/test?serverTimezone=GMT%2B8&useSSL=false
    username: root
    password: w111151
  #JPA Configuration:
  jpa:
    database: mysql
    show-sql: true
    generate-ddl: true
    hibernate:
      ddl-auto: update
      #å‘½åç­–ç•¥ï¼Œçé€‰çš„
      naming:
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
        implicit-strategy: org.hibernate.boot.model.naming.ImplicitNamingStrategyComponentPathImpl
        #Hibernate 4 naming strategy fully qualified name. Not supported with Hibernate 5
        #strategy: org.hibernate.cfg.ImprovedNamingStrategy
```

```properties
#DB Configuration:
spring.datasource.driverClassName=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3308/test?serverTimezone=GMT%2B8&useSSL=false
spring.datasource.username=root
spring.datasource.password=w111151

#JPA Configuration:
spring.jpa.database=MySQL
spring.jpa.show-sql=true
spring.jpa.generate-ddl=true
spring.jpa.hibernate.ddl-auto=update

#Configure Hibernate Naming Strategyï¼Œçé€‰çš„ï¼Œä¸çŸ¥é“åŒºåˆ«

spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
spring.jpa.hibernate.naming.implicit-strategy=org.hibernate.boot.model.naming.ImplicitNamingStrategyComponentPathImpl

#Hibernate 4 naming strategy fully qualified name. Not supported with Hibernate 5
#spring.jpa.hibernate.naming_strategy=org.hibernate.cfg.ImprovedNamingStrategy


```

### åˆ›å»ºå®ä½“é…ç½®å®ä½“

è‹¥å®ä½“ç±»ä¸åœ¨å¯åŠ¨ç±»åŒ…ä¸­ï¼Œéœ€è¦æ·»åŠ æ³¨è§£å¦‚`@EntityScan("com.xuecheng.domain")`æ¥æ‰«æå®ä½“ç±»

```java
@Entity
public class User {
    // ä¸»é”®
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    //@Columnå¯ä»¥çœç•¥ï¼Œé‡‡ç”¨é»˜è®¤é…ç½®ï¼Œè‹¥è¦å…·ä½“é…ç½®ï¼Œéœ€è¦å†™ä¸Š
    private Long id;
    // ç”¨æˆ·å
    private String username;
    // å¯†ç 
    private String password;
    // å§“å
    private String name;

    //æ­¤å¤„çœç•¥setterå’Œgetteræ–¹æ³•... ...
}

```

### ç¼–å†™ UserRepository

```java
public interface UserRepository extends JpaRepository<User,Long>, JpaSpecificationExecutor<User> {
}

```

### ç¼–å†™æµ‹è¯•ç±»

```java
@RunWith(SpringRunner.class)
@SpringBootTest(classes = SpringbootJpaApplication.class)
public class JpaTest {

    @Autowired
    private UserRepository userRepository;

    @Test
    public void testJpa(){
        List<User> all = userRepository.findAll();
        System.out.println(all);
    }
}

```

æ³¨æ„ï¼šå¦‚æœæ˜¯ jdk9ï¼Œæ‰§è¡ŒæŠ¥é”™å¦‚ä¸‹ï¼š

åŸå› ï¼šjdk ç¼ºå°‘ç›¸åº”çš„ jar

è§£å†³æ–¹æ¡ˆï¼šæ‰‹åŠ¨å¯¼å…¥å¯¹åº”çš„ maven åæ ‡ï¼Œå¦‚ä¸‹ï¼š

```xml
<!--jdk9éœ€è¦å¯¼å…¥å¦‚ä¸‹åæ ‡-->
<dependency>
    <groupId>javax.xml.bind</groupId>
    <artifactId>jaxb-api</artifactId>
    <version>2.3.0</version>
</dependency>

```

## é›†æˆ Spring Data Redis

### èµ·æ­¥ä¾èµ–

ä½¿ç”¨ Spring Initializr æ·»åŠ  DevToolsã€Webã€MySQLã€JPAã€**Redis**ä¾èµ–

```xml
<!-- é…ç½®ä½¿ç”¨rediså¯åŠ¨å™¨ -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>


```

### é…ç½® redis çš„è¿æ¥ä¿¡æ¯

```yaml
spring:
  redis:
    #urlåŒ…æ‹¬ä»¥ä¸‹hostï¼Œportï¼Œpassword
    url: redis://user:password@example.com:6379
    host: localhost
    port: 6379
    password: w111151
```

```properties
#Redis
spring.redis.host=127.0.0.1
spring.redis.port=6379


```

### æ³¨å…¥ RedisTemplate æµ‹è¯• redis æ“ä½œ

```java
@RunWith(SpringRunner.class)
@SpringBootTest(classes = SpringbootJpaApplication.class)
public class RedisTest {

    @Autowired
    private RedisTemplate<String,String> redisTemplate;

    @Autowired
    private UserRepository userRepository;

    @Test
    public void test() throws JsonProcessingException {
        //1.ä»Redisä¸­è·å–æ•°æ®ï¼Œä¸€èˆ¬ä¸ºJSONå­—ç¬¦ä¸²
        String userListJson = redisTemplate.boundValueOps("user.findAll").get();
        //2.åˆ¤æ–­Redisä¸­æ˜¯å¦å­˜åœ¨è¯¥æ•°æ®
        //2.1ä¸å­˜åœ¨ï¼Œä»æ•°æ®åº“æŸ¥ï¼Œå¹¶ä¿å­˜åˆ°Redis
        if (userListJson==null){
            List<User> all = userRepository.findAll();
            //è½¬ä¸ºJSONå­—ç¬¦ä¸²ï¼ŒWebç¯å¢ƒé»˜è®¤å¯¼å…¥äº†Jackson
            ObjectMapper objectMapper = new ObjectMapper();
            userListJson = objectMapper.writeValueAsString(all);
            redisTemplate.boundValueOps("user.findAll").set(userListJson);
            System.out.println("ä»æ•°æ®åº“æŸ¥è¯¢");
        } else {
            //2.2å­˜åœ¨
            System.out.println("ä»RedisæŸ¥è¯¢");
        }
        System.out.println(userListJson);
    }
}
```