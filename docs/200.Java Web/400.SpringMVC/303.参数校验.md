---
title: å‚æ•°æ ¡éªŒ
date: 2021-06-21 21:21:03
permalink: /pages/83209d/
categories:
  - Java Web
  - SpringMVC
tags:
  - 
---
# å‚æ•°æ ¡éªŒ

## æ–‡æ¡£

å‚è€ƒ[å®˜ç½‘](https://beanvalidation.org/)

## ä¾èµ–å¼•å…¥

åœ¨ SpringBoot 2.3.x ä»¥å‰ SpringBoot åŒ…é»˜è®¤å¼•å…¥ spring-boot-starter-validation åŒ…ï¼Œè€Œè‡ª SpringBoot 2.3.x ä»¥åå®˜æ–¹å°†å…¶æ’é™¤ï¼Œéœ€è¦å•ç‹¬å¼•å…¥ã€‚

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-validation</artifactId>
</dependency>
```


## @Valid & @Validated ğŸ”¥

å‚è€ƒ[åšå®¢](https://blog.csdn.net/qq_27680317/article/details/79970590)

* javaxæä¾›äº†@Validï¼ˆæ ‡å‡†JSR-303è§„èŒƒï¼‰ï¼Œé…åˆBindingResultå¯ä»¥ç›´æ¥æä¾›å‚æ•°éªŒè¯ç»“æœ
* Spring ValidationéªŒè¯æ¡†æ¶å¯¹å‚æ•°çš„éªŒè¯æœºåˆ¶æä¾›äº†@Validatedï¼ˆSpring's JSR-303è§„èŒƒï¼Œæ˜¯æ ‡å‡†JSR-303çš„ä¸€ä¸ªå˜ç§ï¼‰

åœ¨æ£€éªŒControllerçš„å…¥å‚æ˜¯å¦ç¬¦åˆè§„èŒƒæ—¶ï¼Œä½¿ç”¨@Validatedæˆ–è€…@Validåœ¨åŸºæœ¬éªŒè¯åŠŸèƒ½ä¸Šæ²¡æœ‰å¤ªå¤šåŒºåˆ«ã€‚ä½†åˆ†ç»„ã€æ³¨è§£åœ°æ–¹ã€åµŒå¥—éªŒè¯ç­‰æœ‰æ‰€ä¸åŒï¼š

åˆ†ç»„:

* @Validï¼šä½œä¸ºæ ‡å‡†JSR-303è§„èŒƒï¼Œè¿˜æ²¡æœ‰å¸æ”¶åˆ†ç»„çš„åŠŸèƒ½ã€‚
* **@Validated**ï¼šæä¾›äº†ä¸€ä¸ª**åˆ†ç»„**åŠŸèƒ½ï¼Œå¯ä»¥åœ¨å…¥å‚éªŒè¯æ—¶ï¼Œæ ¹æ®ä¸åŒçš„åˆ†ç»„é‡‡ç”¨ä¸åŒçš„éªŒè¯æœºåˆ¶

**æ³¨è§£åœ°æ–¹**:

* **@Valid**ï¼šå¯ä»¥ç”¨åœ¨æ„é€ å‡½æ•°ã€æ–¹æ³•ã€æ–¹æ³•å‚æ•°å’Œ**æˆå‘˜å±æ€§ï¼ˆå­—æ®µï¼‰ä¸Š**
* @Validatedï¼šå¯ä»¥ç”¨åœ¨**ç±»**ã€æ–¹æ³•å’Œæ–¹æ³•å‚æ•°ä¸Šã€‚ä½†æ˜¯**ä¸èƒ½ç”¨åœ¨æˆå‘˜å±æ€§ï¼ˆå­—æ®µï¼‰ä¸Š**

  **ä¸¤è€…æ˜¯å¦èƒ½ç”¨äºæˆå‘˜å±æ€§ï¼ˆå­—æ®µï¼‰ä¸Šç›´æ¥å½±å“èƒ½å¦æä¾›åµŒå¥—éªŒè¯çš„åŠŸèƒ½ã€‚**

**åµŒå¥—ï¼ˆé›†è”ï¼‰éªŒè¯**ï¼ˆå‚è€ƒä¸Šé¢é‚£ä¸ªåšå®¢ï¼‰

* @Validatedå’Œ@ValidåŠ åœ¨æ–¹æ³•å‚æ•°å‰ï¼Œéƒ½ä¸ä¼šè‡ªåŠ¨å¯¹å‚æ•°è¿›è¡ŒåµŒå¥—éªŒè¯ã€‚èƒ½å¤Ÿç”¨åœ¨æˆå‘˜å±æ€§ï¼ˆå­—æ®µï¼‰ä¸Šï¼Œæç¤ºéªŒè¯æ¡†æ¶è¿›è¡ŒåµŒå¥—éªŒè¯

**æ€»ç»“**ï¼š

* **éæˆå‘˜å±æ€§ï¼ˆå­—æ®µï¼‰ç›´æ¥ä½¿ç”¨ @Validatedï¼Œå¼€å¯æ ¡éªŒ**
* **æˆå‘˜å±æ€§ï¼ˆå­—æ®µï¼‰ç›´æ¥ä½¿ç”¨ @Validï¼ŒåµŒå¥—ï¼ˆé›†è”ï¼‰æ ¡éªŒ**

æ³¨æ„ï¼ŒValidation ä¼š**å°†æ‰€æœ‰éœ€è¦çš„éƒ½æ ¡éªŒ**ï¼Œå³ä½¿ç¬¬ä¸€ä¸ªå‚æ•°ä¸é€šè¿‡ï¼Œè¿˜æ˜¯æ ¡éªŒå…¶ä»–å‚æ•°ã€‚æ‰€ä»¥æ­¤æ—¶éœ€è¦æŠŠæ‰€æœ‰çš„é”™è¯¯æ¶ˆæ¯éƒ½è¿”å›ã€‚



## Spring Validation

### @RequestParams å’Œ @PathVariables å‚æ•°çš„æ ¡éªŒ ğŸ”¥

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ ¡éªŒçš„æ³¨è§£åªèƒ½åœ¨å®ä½“ç±»ä¸Šæ ‡è®°ï¼Œå¦åˆ™ä¸èµ·ä½œç”¨ï¼Œä½†å…¶å®æ˜¯æ²¡æœ‰åœ¨ Controller ä¸Šå†™ Spring æä¾›çš„ `@Validated` æ³¨è§£ï¼Œè¯¥æ³¨è§£ç”¨äº**å¼€å¯æ§åˆ¶å™¨ä¸­çš„ @RequestParams å’Œ @PathVariables çš„éªŒè¯**ï¼Œ**æ–¹æ³•çº§åˆ«ä¸Šçš„æ ¡éªŒ**

```java
@RestController
@RequestMapping("/hello")
@Validated
public class HelloController {


    @PostMapping("/test/{id}")
    public ResponseEntity<List<User>> test(
        @PathVariable @Range(min = 1, max = 10, message = "1~10å“¦ï¼") Integer id,
        @RequestBody User user) {
        List<User> list = new ArrayList<>();
        User user1 = User.builder()
            .name("zhangsan")
            .age(3L)
            .build();
        list.add(user1);
        System.out.println("test");
        return new ResponseEntity<>(list, HttpStatus.OK);
    }
}
```

**å½“æŸ¥è¯¢å‚æ•°å’Œè·¯å¾„å‚æ•°éƒ½ä¸ç¬¦åˆæ ¡éªŒè§„åˆ™ï¼ŒåŒæ—¶bodyå‚æ•°ä¹Ÿä¸ç¬¦åˆæ ¡éªŒè§„åˆ™ï¼Œåªä¼šå‡ºç°bodyæ ¡éªŒè§„åˆ™çš„é”™è¯¯ä¿¡æ¯ã€‚å¦‚æœbodyå‚æ•°å…¨éƒ¨ç¬¦åˆè§„åˆ™æ‰ä¼šå‡ºç°æŸ¥è¯¢å‚æ•°å’Œè·¯å¾„å‚æ•°æ ¡éªŒå¤±è´¥ä¿¡æ¯ã€‚**

æ³¨æ„ï¼Œå®ƒä¼šæŠ›å‡º `ConstraintViolationException` å¼‚å¸¸ï¼Œå¯ä»¥åœ¨å…¨å±€å¼‚å¸¸å¤„ç†ä¸­æ•è·

```java
/**
 * å‚æ•°æ ¡éªŒå¼‚å¸¸ URL åŠæŸ¥è¯¢å‚æ•°ï¼ˆJSON æ ¼å¼ï¼‰
 * å·²ç»ä½¿ç”¨äº† @ResponseStatus(HttpStatus.BAD_REQUEST) æ‰€ä»¥æ— éœ€è¿”å› HttpEntity
 */
@ExceptionHandler(ConstraintViolationException.class)
@ResponseStatus(HttpStatus.BAD_REQUEST)
public UnifyResponse handleConstraintViolationException(ConstraintViolationException exception,
                                                        HttpServletRequest request,
                                                        HandlerMethod handlerMethod,
                                                        HttpMethod httpMethod) {

    Set<ConstraintViolation<?>> constraintViolations = exception.getConstraintViolations();
    String message = formatAllErrorsMessage(constraintViolations);
    // String message = formatAllErrorsMessage(allErrors);
    UnifyResponse unifyResponse = new UnifyResponse(10001, message, httpMethod + " " + request.getRequestURI());
    log.warn("ç³»ç»ŸæœªçŸ¥å¼‚å¸¸, æ–¹æ³•ä¸ºï¼š{}, å¼‚å¸¸ä¸ºï¼š{}", handlerMethod, exception);
    return unifyResponse;
}

/**
 * æ ¼å¼åŒ–å‚æ•°æ ¡éªŒé”™è¯¯ä¿¡æ¯
 */
private String formatAllErrorsMessage(Set<ConstraintViolation<?>> constraintViolations) {
    StringJoiner stringJoiner = new StringJoiner(";");
    constraintViolations.forEach(error -> {
        String format = String.format("['%s'æ— æ³•é€šè¿‡æ ¡éªŒ, %s]", error.getInvalidValue(), error.getMessage());
        stringJoiner.add(format.toString());
    });
    return stringJoiner.toString();
}
```



### è¡¨å•æäº¤ï¼ŒBean æ¥æ”¶æ ¡éªŒ ğŸ”¥

```java
@Data
public class User {

    @NotNull(message = "idä¸èƒ½ä¸ºç©º")
    private Long id;
  
    @NotNull(message = "å¹´é¾„ä¸èƒ½ä¸ºç©º")
    @Max(value = 35, message = "å¹´é¾„ä¸è¶…è¿‡35")
    @Min(value = 18, message = "å¹´é¾„ä¸å°äº18")
    private Integer age;
}
```

```java
@Slf4j
@RestController
public class UserController {

    /**
     * å¦‚æœéƒ½æ˜¯ç”¨DTOåŒ…è£…å‚æ•°ï¼Œé‚£ä¹ˆControllerå¯ä»¥ä¸åŠ @Validatedï¼ˆä½†å»ºè®®è¿˜æ˜¯éƒ½åŠ ä¸Šå§ï¼‰
     * å‚æ•°åˆ—è¡¨é‡Œç”¨@Validatedæˆ–@Validéƒ½å¯ä»¥
     *
     * @param user
     * @return
     */
    @GetMapping("getUser")
    public Result<User> getUser(@Validated User user) {
        System.out.println("è¿›æ¥äº†");
        return Result.success(null);
    }
}
```

æ³¨æ„ï¼Œå®ƒä¼šæŠ›å‡º `BindException` å¼‚å¸¸ï¼Œå¯ä»¥åœ¨å…¨å±€å¼‚å¸¸å¤„ç†ä¸­æ•è·

```java
/**
 * è¡¨å•æäº¤ï¼ŒBean æ¥æ”¶
 * å·²ç»ä½¿ç”¨äº† @ResponseStatus(HttpStatus.BAD_REQUEST) æ‰€ä»¥æ— éœ€è¿”å› HttpEntity
 */
@ExceptionHandler(BindException.class)
@ResponseStatus(HttpStatus.BAD_REQUEST)
public UnifyResponse handleBindException(ConstraintViolationException exception,
                                         HttpServletRequest request,
                                         HandlerMethod handlerMethod,
                                         HttpMethod httpMethod) {

    Set<ConstraintViolation<?>> constraintViolations = exception.getConstraintViolations();
    String message = formatAllErrorsMessage(constraintViolations);

    UnifyResponse unifyResponse = new UnifyResponse(10001, message, httpMethod + " " + request.getRequestURI());
    log.warn("ç³»ç»ŸæœªçŸ¥å¼‚å¸¸, æ–¹æ³•ä¸ºï¼š{}, å¼‚å¸¸ä¸ºï¼š{}", handlerMethod, exception);
    return unifyResponse;
}

/**
 * æ ¼å¼åŒ–å‚æ•°æ ¡éªŒé”™è¯¯ä¿¡æ¯
 */
private String formatAllErrorsMessage(Set<ConstraintViolation<?>> constraintViolations) {
    StringJoiner stringJoiner = new StringJoiner(";");
    constraintViolations.forEach(error -> {
        String format = String.format("['%s'æ— æ³•é€šè¿‡æ ¡éªŒ, %s]", error.getInvalidValue(), error.getMessage());
        stringJoiner.add(format.toString());
    });
    return stringJoiner.toString();
}
```



### @RequestBody å‚æ•°æ ¡éªŒ

```java
@PostMapping("updateUser")
public Result<Boolean> updateUser(@Validated @RequestBody User user) {
    System.out.println("è¿›æ¥äº†");
    return Result.success(null);
}
```

æ³¨æ„ï¼Œå®ƒä¼šæŠ›å‡º `MethodArgumentNotValidException` å¼‚å¸¸ï¼Œå…¶å®æ˜¯`BindException`çš„å­ç±»ï¼Œå¯ä»¥åœ¨å…¨å±€å¼‚å¸¸å¤„ç†ä¸­æ•è·

```java
/**
 * å‚æ•°æ ¡éªŒå¼‚å¸¸ ï¼ˆJSON æ ¼å¼ï¼‰ã€‚MethodArgumentNotValidException å…¶å®æ˜¯ BindException çš„å­ç±»
 * å·²ç»ä½¿ç”¨äº† @ResponseStatus(HttpStatus.BAD_REQUEST) æ‰€ä»¥æ— éœ€è¿”å› HttpEntity
 */
@ExceptionHandler(MethodArgumentNotValidException.class)
@ResponseStatus(HttpStatus.BAD_REQUEST)
public UnifyResponse handleMethodArgumentNotValidException(MethodArgumentNotValidException exception,
                                                           HttpServletRequest request,
                                                           HandlerMethod handlerMethod,
                                                           HttpMethod httpMethod) {

    // æ—¥ï¼è¿™è·å–åˆ°çš„ error è¿˜æ˜¯éšæœºé¡ºåº ...
    List<ObjectError> allErrors = exception.getBindingResult().getAllErrors();
    String message = formatAllErrorsMessage(allErrors);

    UnifyResponse unifyResponse = new UnifyResponse(10001, message, httpMethod + " " + request.getRequestURI());
    log.warn("ç³»ç»ŸæœªçŸ¥å¼‚å¸¸, æ–¹æ³•ä¸ºï¼š{}, å¼‚å¸¸ä¸ºï¼š{}", handlerMethod, exception);
    return unifyResponse;
}

/**
 * æ ¼å¼åŒ–å‚æ•°æ ¡éªŒé”™è¯¯ä¿¡æ¯
 */
private String formatAllErrorsMessage(Set<ConstraintViolation<?>> constraintViolations) {
    StringJoiner stringJoiner = new StringJoiner(";");
    constraintViolations.forEach(error -> {
        String format = String.format("['%s'æ— æ³•é€šè¿‡æ ¡éªŒ, %s]", error.getInvalidValue(), error.getMessage());
        stringJoiner.add(format.toString());
    });
    return stringJoiner.toString();
}
```




## å¸¸ç”¨æ³¨è§£ ğŸ”¥

* @Range(min = 1, max = 10, message = "æ•°å­—åº”ä¸º1~10å“¦ï¼")ï¼šç”¨äºæ•°å­—
* @Length(min = 1, max = 10, message = "å­—ç¬¦ä¸²é•¿åº¦åº”åœ¨1~10å“¦ï¼")ï¼šç”¨äºå­—ç¬¦ä¸²

* **@Validated**
* **@NotNull**
* **@NotBlank**
* **@NotEmpty**
* **@Positive**
* **@Max**
* **@Min**


## è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£ ğŸ”¥

å®ä½“ç±»

```java
@Builder
@Getter
// @Setter
// @NoArgsConstructor
// @AllArgsConstructor
@PasswordEqualValid
public class User {

    @Length(min = 3, max = 7, message = "å­—ç¬¦ä¸²é•¿åº¦åº”åœ¨3~7å“¦ï¼")
    private String name;

    @NonNull
    private  Long age;

    @Length(min = 8, max = 16, message = "å¯†ç é•¿åº¦åº”åœ¨8ï½16ä½å“¦ï¼")
    private String password;

    private String password2;
}
```

è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£

```java
/**
 * æ ¡éªŒä¸¤æ¬¡å¯†ç æ˜¯å¦ç›¸åŒï¼Œåº”æ”¾åœ¨ç±»ä¸Šï¼ˆéœ€è¦æ“ä½œå¯¹è±¡çš„ä¸¤ä¸ªå­—æ®µï¼‰ï¼Œå¿…é¡»æœ‰ passwordã€password2 å­—æ®µ
 */
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = PasswordEqualValidator.class)// æ˜¯æ•°ç»„ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ª validatorã€‚ç±»ä¼¼ @Import å…³è”æ¨¡å¼
public @interface PasswordEqualValid {

    String message() default "å¯†ç ä¸ç›¸åŒ";

    /** è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£å¿…é¡»åŠ ä¸Šçš„ */
    Class<?>[] groups() default { };

    /** è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£å¿…é¡»åŠ ä¸Šçš„ */
    Class<? extends Payload>[] payload() default { };

}
```

æ ¡éªŒå™¨

```java
/**
 * æ³›å‹ç¬¬äºŒä¸ªå‚æ•°ç”¨äºè¯¥è‡ªå®šä¹‰æ³¨è§£ä¿®é¥°çš„ç›®æ ‡ç±»å‹ï¼Œè‹¥æ˜¯å­—æ®µï¼Œåˆ™ä¸ºå­—æ®µçš„ç±»å‹ï¼
 * æ— éœ€ä½¿ç”¨ @Configuration ç­‰æ³¨è§£
 */
public class PasswordEqualValidator implements ConstraintValidator<PasswordEqualValid, User> {

    private PasswordEqualValid passwordEqualValid;

    /**
     * è·å–åˆå§‹åŒ–æ—¶æ ¡éªŒæ³¨è§£çš„ä¿¡æ¯
     * @param constraintAnnotation çº¦æŸæ³¨è§£
     */
    @Override
    public void initialize(PasswordEqualValid constraintAnnotation) {
        this.passwordEqualValid = constraintAnnotation;
    }

    @Override
    public boolean isValid(User user, ConstraintValidatorContext constraintValidatorContext) {
        String password = user.getPassword();
        String password2 = user.getPassword2();
        return password.equals(password2);
    }
}
```

æµ‹è¯•

```java
@RestController
@RequestMapping("/hello")
@Validated
public class HelloController {

    @PostMapping("/test/{id}")
    public ResponseEntity<List<User>> test(
            @PathVariable @Range(min = 1, max = 10, message = "1~10å“¦ï¼") Integer id,
            @Length(max = 5, message = "å§“åé•¿åº¦æœ€å¤§ä¸º5") String name,
            @Validated Dog dog,// è¿™é‡Œä¸æµ‹è¯•è¡¨å•æäº¤
            @RequestBody @Validated User user) {
        List<User> list = new ArrayList<>();
        User user1 = User.builder()
                .name("zhangsan")
                .age(3L)
                .build();
        list.add(user1);
        System.out.println("test");
        return new ResponseEntity<>(list, HttpStatus.OK);
    }
}
```


## åµŒå¥—æ ¡éªŒ

@Validatedä¸æ”¯æŒåµŒå¥—æ ¡éªŒï¼Œåªèƒ½ç”¨@Valid

```java
@Data
public class User {

    @NotNull(message = "idä¸èƒ½ä¸ºç©º")
    private Long id;

    @NotNull(message = "å¹´é¾„ä¸èƒ½ä¸ºç©º")
    @Max(value = 35, message = "å¹´é¾„ä¸è¶…è¿‡35")
    @Min(value = 18, message = "å¹´é¾„ä¸å°äº18")
    private Integer age;

    @NotNull(message = "æ‰€å±éƒ¨é—¨ä¸èƒ½ä¸ºç©º")
    @Valid
    private Department department;
  
    @Data
    static class Department {
        @NotNull(message = "éƒ¨é—¨ç¼–ç ä¸èƒ½ä¸ºç©º")
        private Integer sn;
        @NotBlank(message = "éƒ¨é—¨åç§°ä¸èƒ½ä¸ºç©º")
        private String name;
    }
}
```


## åˆ†ç»„æ ¡éªŒ

```java
@Data
public class User {

    @NotNull(message = "idä¸èƒ½ä¸ºç©º", groups = {Update.class})
    private Long id;

    @NotNull(message = "å¹´é¾„ä¸èƒ½ä¸ºç©º", groups = {Add.class, Update.class})
    @Max(value = 35, message = "å¹´é¾„ä¸è¶…è¿‡35", groups = {Add.class, Update.class})
    @Min(value = 18, message = "å¹´é¾„ä¸å°äº18", groups = {Add.class, Update.class})
    private Integer age;

    public interface Add {
    }

    public interface Update {
    }
}
```

```java
@Slf4j
@RestController
public class UserController {
  
    @PostMapping("insertUser")
    public Result<Boolean> insertUser(@Validated(User.Add.class) @RequestBody User user) {
        System.out.println("è¿›æ¥äº†");
        return Result.success(null);
    }

    @PostMapping("updateUser")
    public Result<Boolean> updateUser(@Validated(User.Update.class) @RequestBody User user) {
        System.out.println("è¿›æ¥äº†");
        return Result.success(null);
    }
}
```

æœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ï¼š

* interface Addè¿™äº›æ¥å£åªæ˜¯åšä¸ªæ ‡è®°ï¼Œæœ¬èº«æ²¡æœ‰ä»»ä½•å®é™…æ„ä¹‰ï¼Œå¯ä»¥æŠ½å–å‡ºæ¥ï¼Œä½œä¸ºå•ç‹¬çš„æ¥å£å¤ç”¨
* interface Addè¿˜å¯ä»¥ç»§æ‰¿Defaultæ¥å£ï¼ˆDefault Jakarta Bean Validation group.ï¼‰

ç»§æ‰¿Defaultåï¼Œé™¤éæ˜¾ç¤ºæŒ‡å®šï¼Œå¦åˆ™åªè¦åŠ äº†@NotNullç­‰æ³¨è§£ï¼Œå°±ä¼šèµ·æ•ˆã€‚ä½†æ˜¾ç¤ºæŒ‡å®šGroupåï¼Œå°±æŒ‰æŒ‡å®šçš„åˆ†ç»„è¿›è¡Œæ ¡éªŒã€‚æ¯”å¦‚ï¼Œä¸Šé¢çš„idåªä¼šåœ¨updateæ—¶æ ¡éªŒç”Ÿæ•ˆã€‚
ä¸ªäººä¸å»ºè®®ç»§æ‰¿Defaultï¼Œä¸€æ–¹é¢æ˜¯ç†è§£èµ·æ¥æ¯”è¾ƒä¹±ï¼Œå¦ä¸€æ–¹æ˜¯åŠ äº†Defaultåå°±æ— æ³•è¿›è¡Œéƒ¨åˆ†å­—æ®µæ›´æ–°äº†ï¼š

```java
@PostMapping("updateUser")
public Result<Boolean> updateUser(@Validated(User.Update.class) @RequestBody User user) {
    System.out.println("è¿›æ¥äº†");
    return Result.success(null);
}
```

```java
@Data
public class User {

    @NotNull(message = "idä¸èƒ½ä¸ºç©º", groups = {Update.class})
    private Long id;

    @NotNull(message = "å¹´é¾„ä¸èƒ½ä¸ºç©º")
    private Integer age;
  
    @NotBlank(message = "ä½å€ä¸èƒ½ä¸ºç©º")
    private String address;

    public interface Add extends Default {
    }

    public interface Update extends Default {
    }
}
```

æ­¤æ—¶å¦‚æœæƒ³æ›´æ–°nameï¼Œå°±ä¸èƒ½åªä¼ idå’Œnameäº†ï¼Œaddressä¹Ÿè¦ä¼ ï¼ˆé»˜è®¤ä¹Ÿä¼šæ ¡éªŒï¼‰ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥è®¤ä¸ºä¸€èˆ¬æƒ…å†µä¸‹updateå‰éƒ½ä¼šæœ‰getById()ï¼Œæ‰€ä»¥æ›´æ–°æ—¶æ•°æ®ä¹Ÿæ˜¯å…¨é‡çš„ã€‚





## List æ ¡éªŒ

Spring Validationä¸æ”¯æŒä»¥ä¸‹æ–¹å¼æ ¡éªŒï¼š

```java
@Data
public class User {

    @NotNull(message = "idä¸èƒ½ä¸ºç©º")
    private Long id;

    @NotNull(message = "å¹´é¾„ä¸èƒ½ä¸ºç©º")
    private Integer age;
}
```

```java
@PostMapping("updateBatchUser")
public Result<Boolean> updateBatchUser(@Validated @RequestBody List<User> list) {
    System.out.println(list);
    return Result.success(null);
}
```

å³ä½¿ageä¸å¡«ï¼Œè¿˜æ˜¯è¿›æ¥äº†ï¼Œè¯´æ˜å¯¹äºListè€Œè¨€ï¼Œ@Validatedæ ¹æœ¬æ²¡ä½œç”¨

è§£å†³åŠæ³•æ˜¯ï¼Œå€Ÿé‰´åµŒå¥—æ ¡éªŒçš„æ¨¡å¼ï¼Œåœ¨Listå¤–é¢å†åŒ…ä¸€å±‚ï¼š

```java
@PostMapping("updateBatchUser")
public Result<Boolean> updateBatchUser(@Validated @RequestBody ValidationList<User> userList) {
    System.out.println(userList);
    return Result.success(null);
}
```

```java
public class ValidationList<E> implements List<E> {

    @NotEmpty(message = "å‚æ•°ä¸èƒ½ä¸ºç©º")
    @Valid
    private List<E> list = new LinkedList<>();

    @Override
    public int size() {
        return list.size();
    }

    @Override
    public boolean isEmpty() {
        return list.isEmpty();
    }

    @Override
    public boolean contains(Object o) {
        return list.contains(o);
    }

    @Override
    public Iterator<E> iterator() {
        return list.iterator();
    }

    @Override
    public Object[] toArray() {
        return list.toArray();
    }

    @Override
    public <T> T[] toArray(T[] a) {
        return list.toArray(a);
    }

    @Override
    public boolean add(E e) {
        return list.add(e);
    }

    @Override
    public boolean remove(Object o) {
        return list.remove(o);
    }

    @Override
    public boolean containsAll(Collection<?> c) {
        return list.containsAll(c);
    }

    @Override
    public boolean addAll(Collection<? extends E> c) {
        return list.addAll(c);
    }

    @Override
    public boolean addAll(int index, Collection<? extends E> c) {
        return list.addAll(index, c);
    }

    @Override
    public boolean removeAll(Collection<?> c) {
        return list.removeAll(c);
    }

    @Override
    public boolean retainAll(Collection<?> c) {
        return list.retainAll(c);
    }

    @Override
    public void clear() {
        list.clear();
    }

    @Override
    public E get(int index) {
        return list.get(index);
    }

    @Override
    public E set(int index, E element) {
        return list.set(index, element);
    }

    @Override
    public void add(int index, E element) {
        list.add(index, element);
    }

    @Override
    public E remove(int index) {
        return list.remove(index);
    }

    @Override
    public int indexOf(Object o) {
        return list.indexOf(o);
    }

    @Override
    public int lastIndexOf(Object o) {
        return list.lastIndexOf(o);
    }

    @Override
    public ListIterator<E> listIterator() {
        return list.listIterator();
    }

    @Override
    public ListIterator<E> listIterator(int index) {
        return list.listIterator(index);
    }

    @Override
    public List<E> subList(int fromIndex, int toIndex) {
        return list.subList(fromIndex, toIndex);
    }

    public List<E> getList() {
        return list;
    }

    public void setList(List<E> list) {
        this.list = list;
    }

}
```

å®é™…å¼€å‘æ—¶ï¼Œå»ºè®®ä¸“é—¨å»ºä¸€ä¸ªpackageå­˜æ”¾Spring Validationç›¸å…³çš„æ¥å£å’Œç±»





## SpringValidatorUtilså°è£…

```java
public final class SpringValidatorUtils {
    private SpringValidatorUtils() {}
  
    /**
     * æ ¡éªŒå™¨
     */
    private static final Validator validator = Validation.buildDefaultValidatorFactory().getValidator();

    /**
     * æ ¡éªŒå‚æ•°
     *
     * @param param  å¾…æ ¡éªŒçš„å‚æ•°
     * @param groups åˆ†ç»„æ ¡éªŒï¼Œæ¯”å¦‚Update.classï¼ˆå¯ä»¥ä¸ä¼ ï¼‰
     * @param <T>
     */
    public static <T> void validate(T param, Class<?>... groups) {
        Set<ConstraintViolation<T>> validateResult = validator.validate(param, groups);
        if (!CollectionUtils.isEmpty(validateResult)) {
            StringBuilder validateMessage = new StringBuilder();
            for (ConstraintViolation<T> constraintViolation : validateResult) {
                validateMessage.append(constraintViolation.getMessage()).append(" && ");
            }
            // å»é™¤æœ«å°¾çš„ &&
            validateMessage.delete(validateMessage.length() - 4, validateMessage.length());
            // æŠ›ç»™å…¨å±€å¼‚å¸¸å¤„ç†
            throw new ValidatorException(validateMessage.toString());
        }
    }
}
```

ä»£ç å¾ˆç®€å•ï¼Œåšçš„äº‹æƒ…æœ¬è´¨æ˜¯å’Œ@Validatedæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚@Validatedé€šè¿‡æ³¨è§£æ–¹å¼è®©Springä½¿ç”¨Validatorå¸®æˆ‘ä»¬æ ¡éªŒï¼Œè€ŒSpringValidatorUtilsåˆ™æ˜¯æˆ‘ä»¬ä»Springé‚£å€Ÿæ¥Validatorè‡ªå·±æ ¡éªŒï¼š

```java
@PostMapping("insertUser")
public Result<Boolean> insertUser(@RequestBody User user) {
    SpringValidatorUtils.validate(user);
    System.out.println("è¿›æ¥äº†");
    return Result.success(null);
}
```

æ­¤æ—¶ä¸éœ€è¦åŠ @Validatedã€‚

ä¹°ä¸€é€ä¸€ï¼Œçœ‹çœ‹æˆ‘ä¹‹å‰ä¸€ä¸ªåŒäº‹å°è£…çš„å·¥å…·ç±»ï¼ˆæ›´åŠ è‡ªç”±ï¼Œè°ƒç”¨è€…å†³å®šæŠ›å¼‚å¸¸è¿˜æ˜¯è¿”å›é”™è¯¯ä¿¡æ¯ï¼‰ï¼š

```java
public final class ValidationUtils {

    private static final Validator DEFAULT_VALIDATOR = Validation.buildDefaultValidatorFactory().getValidator();

    private ValidationUtils() {
    }

    /**
     * éªŒè¯åŸºäºæ³¨è§£çš„å¯¹è±¡
     *
     * @param target
     */
    public static <T> String validateReq(T target, boolean throwException) {
        if (null == target) {
            return errorProcess("æ ¡éªŒå¯¹è±¡ä¸èƒ½ä¸ºç©º", throwException);
        } else {
            Set<ConstraintViolation<T>> constraintViolations = DEFAULT_VALIDATOR.validate(target);
            ConstraintViolation<T> constraintViolation = Iterables.getFirst(constraintViolations, null);
            if (constraintViolation != null) {
                // ç”¨æˆ·å¯ä»¥æŒ‡å®šæŠ›å¼‚å¸¸è¿˜æ˜¯è¿”å›é”™è¯¯ä¿¡æ¯
                return errorProcess(constraintViolation.getPropertyPath() + ":" + constraintViolation.getMessage(),
                        throwException);
            }
        }
        return "";
    }

    private static String errorProcess(String errorMsg, boolean throwException) {
        if (throwException) {
            throw new InvalidParameterException(errorMsg);
        }
        return errorMsg;
    }
}
```