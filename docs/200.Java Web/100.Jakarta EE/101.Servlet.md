---
title: Servlet
date: 2021-06-21 21:21:03
permalink: /pages/724936/
categories:
  - Java Web
  - Jakarta EE
tags:
  - 
---
# Servlet

Servletï¼ˆserver appletï¼‰æ˜¯è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å°ç¨‹åºã€‚æ˜¯ Java EE è§„èŒƒä¹‹ä¸€ã€‚æ˜¯ **JavaWeb ä¸‰å¤§ç»„ä»¶ä¹‹ä¸€**ï¼ˆServletã€Filterã€Listenerï¼‰ï¼Œå¯ä»¥**æ¥æ”¶è¯·æ±‚æ•°æ®ã€å¤„ç†è¯·æ±‚ã€å®Œæˆå“åº”**ã€‚

Servlet å®è´¨å°±æ˜¯ä¸€ä¸ª**æ¥å£**ï¼Œå®šä¹‰äº†**Java ç±»èƒ½è¢«**æµè§ˆå™¨è®¿é—®åˆ°ï¼ˆ**æˆ–è€…è¯´è¢« Tomcat ç­‰ Servlet å®¹å™¨è¯†åˆ«**ï¼‰çš„**è§„åˆ™**ã€‚é‚£ä¹ˆæµè§ˆå™¨å¦‚ä½•è®¿é—®Servletï¼Ÿ

ç»™ Servlet æŒ‡å®šä¸€ä¸ª**è·¯å¾„**ï¼Œæµè§ˆå™¨é€šè¿‡è®¿é—®è·¯å¾„æ¥è®¿é—®ï¼Œä¸€èˆ¬è·¯å¾„é…ç½®åœ¨**web.xml**ä¸­æˆ–ç›´æ¥**æ³¨è§£**ï¼ˆServlet 3 åï¼‰

## å®ç° Servlet çš„æ–¹å¼

1. å®ç°`javax.servlet.Servlet`æ¥å£
2. ç»§æ‰¿`javax.servlet.GenericServlet`æŠ½è±¡ç±»
3. ç»§æ‰¿`javax.servlet.http.HttpServlet`æŠ½è±¡ç±»

   é€šå¸¸æˆ‘ä»¬ä¼šå»ç»§æ‰¿`HttpServlet`ç±»æ¥å®Œæˆæˆ‘ä»¬çš„Servletï¼Œä½†å­¦ä¹ è¿˜è¦ä»`javax.servlet.Servlet`æ¥å£å¼€å§‹

### å®ç° Servlet æ¥å£

#### å®ç° javax.servlet.Servlet æ¥å£

```java
//åˆå§‹åŒ–ï¼Œåœ¨Servletå¯¹è±¡åˆ›å»ºåé©¬ä¸Šæ‰§è¡Œï¼Œåªæ‰§è¡Œä¸€æ¬¡
public void init(ServletConfig servletConfig) throws ServletException {
	System.out.println("init...");
}
//è·å–Servleté…ç½®ä¿¡æ¯,
public ServletConfig getServletConfig() {
	return null;
}
//æœåŠ¡ï¼Œæ¯æ¬¡å¤„ç†è¯·æ±‚ä¼šè¢«è°ƒç”¨
public void service(ServletRequest servletRequest, ServletResponse servletResponse) 
		throws ServletException,  IOException {
		System.out.println("service...");
		servletResponse.getWriter().write("hello servlet.");
}
//è·å–Servletä¿¡æ¯ï¼Œå¦‚ç‰ˆæœ¬ï¼Œä½œè€…ç­‰ã€‚ä¸€èˆ¬ä¸ä¼šå»å®ç°
public String getServletInfo() {
	return null;
}
//é”€æ¯ï¼ŒæœåŠ¡å™¨æ­£å¸¸å…³é—­ï¼Œåœ¨Servletè¢«é”€æ¯ä¹‹å‰è°ƒç”¨ï¼Œåªä¼šè¢«è°ƒç”¨ä¸€æ¬¡
public void destroy() {
	System.out.println("destroy...");
}
```

#### é…ç½®web.xml

```xml
<servlet>
    <servlet-name>name</servlet-name>//ç›¸åŒä»£å·
    <servlet-class>cn.itcast01.AServlet</servlet-class>//è¦è®¿é—®çš„ç±»ï¼Œå…¨ç±»å
</servlet>
<servlet-mapping>
    <servlet-name>name</servlet-name>//ç›¸åŒä»£å·
    <url-pattern>/MyServlet</url-pattern>//è®¾ç½®URL
</servlet-mapping>
<!--  è®¿é—®æ—¶ï¼šhttp://localhost:8080/MyServlet ï¼Œå‰ææ˜¯IDEAä¸­Application contexté…ç½®çš„æ˜¯â€œ/â€ -->
```

#### æ‰§è¡ŒåŸç†

1. å½“TomcatæœåŠ¡å™¨æ¥å—åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨çš„è¯·æ±‚åï¼Œä¼šè§£æè¯·æ±‚URLè·¯å¾„ï¼Œè·å–è®¿é—®çš„Servletçš„èµ„æºè·¯å¾„
2. æŸ¥æ‰¾web.xmlæ–‡ä»¶ï¼Œæ˜¯å¦æœ‰å¯¹åº”çš„`<url-pattern>`æ ‡ç­¾ä½“å†…å®¹ã€‚
3. å¦‚æœæœ‰ï¼Œåˆ™é€šè¿‡`<servlet-name>`æ‰¾åˆ°å¯¹åº”çš„`<servlet-class>`å…¨ç±»å
4. Tomcatä¼šå°†å­—èŠ‚ç æ–‡ä»¶åŠ è½½è¿›å†…å­˜ï¼Œå¹¶ä¸”é€šè¿‡åå°„åˆ›å»ºå…¶å¯¹è±¡ï¼Œè°ƒç”¨å…¶æ–¹æ³•

   å³Servlet**ç±»**ç”±æˆ‘ä»¬æ¥å†™ï¼Œä½†**å¯¹è±¡ç”±æœåŠ¡å™¨æ¥åˆ›å»º**ï¼Œå¹¶ä¸”**ç”±æœåŠ¡å™¨æ¥è°ƒç”¨ç›¸åº”çš„æ–¹æ³•**

#### ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

* `void init(ServletConfig)`ï¼š**åˆ›å»ºServletå¯¹è±¡å**ç«‹å³æ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•ï¼ˆåª1æ¬¡ï¼‰ï¼›

  * Servletçš„`init`æ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡ï¼Œè¯´æ˜**ä¸€ä¸ªServletåœ¨å†…å­˜ä¸­åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡(å•ä¾‹)**

    * å¤šç”¨æˆ·åŒæ—¶è®¿é—®å¯èƒ½å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜
    * è§£å†³ï¼šå°½é‡ä¸è¦åœ¨Servletä¸­å®šä¹‰æˆå‘˜å˜é‡ã€‚å³ä½¿å®šä¹‰äº†æˆå‘˜å˜é‡ï¼Œä¹Ÿä¸è¦å¯¹å…¶ä¿®æ”¹å€¼
  * Servletä»€ä¹ˆæ—¶å€™è¢«åˆ›å»ºï¼Ÿ

    1. **é»˜è®¤**æƒ…å†µä¸‹ï¼Œ**ç¬¬ä¸€æ¬¡è¢«è®¿é—®æ—¶**ï¼ŒServletè¢«åˆ›å»ºã€‚å³`<load-on-startup>`çš„å€¼é»˜è®¤ä¸ºè´Ÿæ•°ã€‚
    2. å¯ä»¥**é…ç½®**æ‰§è¡ŒServletçš„**åˆ›å»ºæ—¶æœº**ï¼Œåœ¨æ³¨è§£ä¸­é…ç½®`loadOnStartup`ï¼Œç»™å‡ºä¸€ä¸ª**éè´Ÿæ•´æ•°**å³å¯ï¼Œæ•°å­—**è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜**ã€‚
* `void service(ServletRequest request, ServletResponse response)`ï¼š**æ¯æ¬¡å¤„ç†è¯·æ±‚**æ—¶éƒ½ä¼šè¢«è°ƒç”¨ï¼›
* `void destroy()`ï¼šæœåŠ¡å™¨**æ­£å¸¸å…³é—­**ï¼Œ**é”€æ¯Servletå¯¹è±¡å‰**æ‰§è¡Œé‡Šæ”¾èµ„æºçš„æ–¹æ³•ï¼ˆåª1æ¬¡ï¼‰ï¼›

### ç»§æ‰¿ GenericServlet æŠ½è±¡ç±»

#### ç»§æ‰¿javax.servlet.GenericServletæŠ½è±¡ç±»

* `GenericServlet`æ˜¯`Servlet`æ¥å£çš„**å®ç°ç±»**ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ª**æŠ½è±¡ç±»**ï¼Œå®ƒ**å”¯ä¸€çš„æŠ½è±¡æ–¹æ³•å°±æ˜¯`service()`æ–¹æ³•**ï¼Œå®ƒå°†Servletæ¥å£ä¸­çš„å…¶ä»–4ä¸ªæ–¹æ³•åšäº†ç©ºå®ç°ã€‚
* GenericServlet**å®ç°äº†ServletConfigæ¥å£**ï¼ˆ4ä¸ªæ–¹æ³•ï¼‰
* GenericServlet**æ·»åŠ äº†`init()`æ–¹æ³•**ï¼Œè¯¥æ–¹æ³•ä¼š**è¢«`init(ServletConfig)`æ–¹æ³•è°ƒç”¨**

  å¦‚æœå¸Œæœ›å¯¹Servletè¿›è¡Œåˆå§‹åŒ–ï¼Œé‚£ä¹ˆ**åº”è¯¥é‡å†™`init()`æ–¹æ³•**ï¼Œè€Œä¸æ˜¯`init(ServletConfig)`æ–¹æ³•

### ç»§æ‰¿ HttpServlet æŠ½è±¡ç±»

#### ç»§æ‰¿javax.servlet.http.HttpServletæŠ½è±¡ç±»

`HttpServlet`æ˜¯`GenericServlet`æ¥å£çš„å®ç°ç±»ï¼Œä½†å®ƒä¹Ÿæ˜¯ä¸€ä¸ª**æŠ½è±¡ç±»**ã€‚å¯¹HTTPåè®®çš„ä¸€ç§å°è£…ï¼Œç®€åŒ–æ“ä½œ

#### HttpServletå¤„ç†è¯·æ±‚é¡ºåº

1. Tomcat**è°ƒç”¨HttpServletç»§æ‰¿çš„**ç”Ÿå‘½å‘¨æœŸæ–¹æ³•`service(ServletRequest sr, ServletResponse srr)`å¯¹å‚æ•°è¿›è¡Œ**å¼ºè½¬**ä¸ºHTTPåè®®ç›¸å…³çš„å‚æ•°ç±»å‹
2. ç„¶å**è°ƒç”¨HttpServletæœ¬ç±»çš„**`service(HttpServletRequest sr, HttpServletResponse srr)`æ–¹æ³•
3. è·å–è¯·æ±‚æ–¹æ³•ï¼Œ**æ ¹æ®è¯·æ±‚æ–¹å¼**æ¥è°ƒç”¨`doGet()`æˆ–`doPost()`æˆ–å…¶ä»–ï¼Œéœ€è‡ªå·±**é‡å†™**ï¼Œå¦åˆ™è°ƒç”¨åˆ°è¯¥æ–¹æ³•æ—¶è¿”å›`405`

```java
//æ³¨è§£çš„æ–¹å¼ç›´æ¥é…ç½®web.xml
@WebServlet("/ServletAuto")
public class ServletAuto extends HttpServlet {
	protected void doPost(HttpServletRequest request, HttpServletResponse response) 
     throws ServletException,IOException {

    }

    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
        throws ServletException, IOException {
        response.getWriter().write("hello auto");
    }
}
```

## ServletConfig

* ServletConfigæ¥å£æ˜¯Servletä¸­çš„`init()`æ–¹æ³•çš„å‚æ•°ç±»å‹ï¼ŒæœåŠ¡å™¨ä¼šåœ¨è°ƒç”¨`init()`æ–¹æ³•æ—¶ä¼ é€’ServletConfigå¯¹è±¡ç»™`init()`

  **ServletConfigå¯¹è±¡å°è£…**äº†Servletåœ¨`web.xml`ä¸­çš„**é…ç½®ä¿¡æ¯**ï¼Œå®ƒå¯¹åº”`<servlet>`å…ƒç´ 

  ```xml
  <servlet>
      <servlet-name>daihao1</servlet-name>
      <servlet-class>cn.itcast01.AServlet</servlet-class>
      <init-param>
          <param-name>name</param-name>
          <param-value>zhangsan</param-value>
      </init-param>
  </servlet>
  <servlet-mapping>
      <servlet-name>daihao1</servlet-name>
      <url-pattern>/Aservlet</url-pattern>
  </servlet-mapping>
  ```
* APIå¦‚ä¸‹ï¼š

  * String **getInitParameter**(String name)ï¼šè·å–**åˆå§‹åŒ–å‚æ•°**
  * Enumeration **getInitParameterNames**()ï¼šè·å–**æ‰€æœ‰åˆå§‹åŒ–å‚æ•°çš„åç§°**
  * ServletContext **getServletContext**()ï¼š**è·å–ServletContextå¯¹è±¡**ï¼Œè¿™ä¸ªå¯¹è±¡ç¨åä»‹ç»
  * String getServletName()ï¼šè·å–Servleté…ç½®åï¼Œå³`<servlet-name>`çš„å€¼ï¼›ä¸å¸¸ç”¨

## ServletContext

* Java Webå››å¤§åŸŸå¯¹è±¡ï¼ˆå‰ä¸‰ä¸ªä¸ºServletä¸‰å¤§åŸŸå¯¹è±¡ï¼‰ï¼š

  * application(å½“å‰webåº”ç”¨)ï¼š**ServletContext**
  * session(ä¸€æ¬¡ä¼šè¯)ï¼š**HttpSession**
  * request(ä¸€æ¬¡è¯·æ±‚)ï¼š**ServletRequest**
  * page(jspæœ‰æ•ˆ)ï¼š**PageContext**
* ServletContextï¼š**ä»£è¡¨æ•´ä¸ªwebåº”ç”¨**ï¼Œå¯ä»¥**å’Œç¨‹åºçš„å®¹å™¨**(æœåŠ¡å™¨)æ¥**é€šä¿¡**ï¼ŒæœåŠ¡å™¨ä¼šä¸ºæ¯ä¸ªåº”ç”¨/WEBç«™ç‚¹åˆ›å»ºä¸€ä¸ªServletContextå¯¹è±¡ã€‚**åˆ›å»ºåœ¨æœåŠ¡å™¨å¯åŠ¨å**å®Œæˆï¼Œ**é”€æ¯åœ¨æœåŠ¡å™¨æ­£å¸¸åƒå…³é—­å‰**å®Œæˆã€‚**ä¸€ä¸ªé¡¹ç›®åªæœ‰ä¸€ä¸ªServletContextå¯¹è±¡**ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Nå¤šä¸ªServletä¸­æ¥è·å–è¿™ä¸ªå”¯ä¸€çš„å¯¹è±¡ï¼Œä»¥ä¼ é€’æ•°æ®
* è·å–

  * é€šè¿‡**`HttpServlet`**æˆ–`GenericServlet`è·å–ï¼š`this.getServletContext();`
  * é€šè¿‡**`request`**å¯¹è±¡è·å–ï¼š`request.getServletContext();`
* åŠŸèƒ½ï¼š

  1. **è·å–MIMEç±»å‹**ï¼š`String getMimeType(String file)  `

     * MIMEç±»å‹ï¼šåœ¨äº’è”ç½‘é€šä¿¡è¿‡ç¨‹ä¸­å®šä¹‰çš„ä¸€ç§æ–‡ä»¶æ•°æ®ç±»å‹ã€‚æ ¼å¼ï¼š`å¤§ç±»å‹/å°ç±»å‹`ï¼Œ`text/html`ã€`image/jpeg`
  2. **åŸŸå¯¹è±¡**ï¼š**å…±äº«æ•°æ®**ã€‚ServletContextå¯¹è±¡èŒƒå›´æ˜¯**æ‰€æœ‰ç”¨æˆ·æ‰€æœ‰è¯·æ±‚çš„æ•°æ®**

     * `getAttribute(String name)`ï¼š**è·å–**åŸŸå¯¹è±¡ä¸­çš„æ•°æ®
     * `setAttribute(String name,Object value)`ï¼š**å­˜å‚¨**ä¸€ä¸ªåŸŸå±æ€§
     * `removeAttribute(String name)`ï¼š**ç§»é™¤**åŸŸå¯¹è±¡ä¸­çš„åŸŸå±æ€§ï¼ŒnameæŒ‡å®šåŸŸå±æ€§ä¸å­˜åœ¨æ—¶ä¸å˜åŒ–
     * `Enumeration getAttributeNames()`ï¼šè·å–æ‰€æœ‰åŸŸå±æ€§çš„åç§°`
  3. ğŸ”¥è·å–**æ–‡ä»¶çš„çœŸå®**(æœåŠ¡å™¨)**è·¯å¾„**ï¼š`String getRealPath(String path)`ï¼Œå³å½“å‰Webåº”ç”¨ä¸‹çš„èµ„æºè·¯å¾„ï¼Œä¾‹å­å¦‚ä¸‹ï¼š

     - webç›®å½•ä¸‹èµ„æºè®¿é—®ï¼š`getRealPath("/b.txt")`
     - WEB-INFç›®å½•ä¸‹çš„èµ„æºè®¿é—®ï¼š`getRealPath("/WEB-INF/c.txt")`
     - srcç›®å½•ä¸‹çš„èµ„æºè®¿é—®ï¼š`getRealPath("/WEB-INF/classes/a.txt")`ï¼Œç”±äºsrcä¸­çš„æ–‡ä»¶æœ€ç»ˆéƒ½ä¼šæ”¾åœ¨classesä¸‹
* **è·å–èµ„æºç›¸å…³æ–¹æ³•å¯¹æ¯”**

  * **è·å–çœŸå®(æœåŠ¡å™¨)è·¯å¾„ï¼š`getRealPath(String path)`**ï¼Œå¯æŸ¥æ‰¾èŒƒå›´æœ€å¹¿æ³›
  * **é€šè¿‡ç±»åŠ è½½å™¨è·å–èµ„æº**ï¼š`getResourceAsStream(String path);`ï¼Œæ ¹æ®classesæˆ–srcæ¥åˆ¤æ–­è·¯å¾„

    * `/WEB-INF/classes`ï¼ˆsrcä¸­çš„æ–‡ä»¶æœ€ç»ˆéƒ½ä¼šæ”¾åœ¨classesä¸‹ï¼‰å’Œ`/WEB-INF/lib`æ¯ä¸ª**jar**åŒ…ï¼
  * **Classç±»è·å–èµ„æº**ï¼š`InputStream getResourceAsStream(String path)`ï¼Œ

    * è·¯å¾„ä»¥`/`å¼€å¤´ï¼Œç›¸å¯¹classesè·¯å¾„ï¼›è·¯å¾„ä¸ä»¥`/`å¼€å¤´ï¼Œç›¸å¯¹å½“å‰classæ–‡ä»¶è·¯å¾„
* ç½‘ç«™è®¿é—®é‡

  ```java
  ServletContext servletContext = this.getServletContext();
  Integer count = (Integer) servletContext.getAttribute("count");
  if(count==null){
      servletContext.setAttribute("count",1);
  }else {
      servletContext.setAttribute("count",count+1);
  }
  count = (Integer) servletContext.getAttribute("count");
  resp.getWriter().write("invite:"+count+"times");
  ```
* è·å–åº”ç”¨/WEBç«™ç‚¹åˆå§‹åŒ–å‚æ•°ï¼ˆgetInitParameter()ï¼‰

  * Servletä¹Ÿå¯ä»¥è·å–åˆå§‹åŒ–å‚æ•°ï¼Œä½†å®ƒæ˜¯å±€éƒ¨çš„å‚æ•°(ä¸€ä¸ªServletåªèƒ½è·å–è‡ªå·±çš„åˆå§‹åŒ–å‚æ•°ï¼Œä¸èƒ½è·å–åˆ«äººçš„ï¼Œå³åˆå§‹åŒ–å‚æ•°åªä¸ºä¸€ä¸ªServletå‡†å¤‡)
  * å¯ä»¥é…ç½®**åº”ç”¨çš„åˆå§‹åŒ–å‚æ•°**ï¼Œä¸ºæ‰€æœ‰Servletè€Œç”¨ï¼è¿™éœ€è¦ä½¿ç”¨ServletContextæ‰èƒ½ä½¿ç”¨
  * å¯ä»¥ä½¿ç”¨ServletContextæ¥è·å–åœ¨web.xmlæ–‡ä»¶ä¸­é…ç½®çš„**åº”ç”¨åˆå§‹åŒ–å‚æ•°**ï¼æ³¨æ„ï¼Œåº”ç”¨åˆå§‹åŒ–å‚æ•°ä¸Servletåˆå§‹åŒ–å‚æ•°ä¸åŒï¼ˆSpringä¸­æœ‰ä½¿ç”¨ï¼‰

```xml
<context-param>
    <param-name>name</param-name>
    <param-value>zhangsan</param-value>
</context-param>
```

```java
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    ServletContext servletContext = this.getServletContext();
    String msg =(String)servletContext.getInitParameter("name");
    response.getWriter().write(msg);
}
```


## Servlet3.0

> JavaEE 6.0 ç‰ˆæœ¬åŠä¹‹åçš„æ–°ç‰ˆæœ¬éƒ½æ”¯æŒ
>

* å¥½å¤„ï¼š

  * æ”¯æŒ**æ³¨è§£é…ç½®**ã€‚å¯ä»¥**ä¸éœ€è¦web.xmläº†**ã€‚
* æ­¥éª¤ï¼š

  1. åˆ›å»ºJavaEEé¡¹ç›®ï¼Œé€‰æ‹©Servletçš„ç‰ˆæœ¬3.0ä»¥ä¸Šï¼Œå¯ä»¥ä¸åˆ›å»ºweb.xml
  2. å®šä¹‰ä¸€ä¸ªç±»ï¼Œå®ç°Servletæ¥å£å¹¶é‡å†™æ–¹æ³•
  3. åœ¨ç±»ä¸Šä½¿ç”¨`@WebServlet`æ³¨è§£ï¼Œè¿›è¡Œé…ç½®ã€‚`@WebServlet("èµ„æºè·¯å¾„")`ï¼Œå¯ä»¥çœç•¥`value`æˆ–`urlPatterns`

     ```JAVA
     @Target({ElementType.TYPE})
     @Retention(RetentionPolicy.RUNTIME)
     @Documented
     public @interface WebServlet {
         String name() default "";//ç›¸å½“äº<Servlet-name>

         String[] value() default {};//ä»£è¡¨urlPatterns()å±æ€§é…ç½®

         String[] urlPatterns() default {};//ç›¸å½“äº<url-pattern>

         int loadOnStartup() default -1;//ç›¸å½“äº<load-on-startup>
         WebInitParam[] initParams() default {};
         boolean asyncSupported() default false;
         String smallIcon() default "";
         String largeIcon() default "";
         String description() default "";
         String displayName() default "";
     }
     ```
* **urlpartten**ï¼š**Servletè®¿é—®è·¯å¾„**ï¼Œç”¨**value**æ›¿ä»£äº†ï¼Œæ‰€ä»¥å¯ä»¥ä¸å†™

  - **ä¸€ä¸ªServlet**å¯ä»¥å®šä¹‰**å¤šä¸ªè®¿é—®è·¯å¾„** ï¼š `@WebServlet({"/d4","/dd4","/ddd4"})`
  - **è·¯å¾„å®šä¹‰è§„åˆ™**ï¼š

    - **`/`**ï¼š**ä»…ä¸ä¼šåŒ¹é….jsp**ï¼Œéœ€è¦**é‡Šæ”¾é™æ€èµ„æº**ï¼Œï¼ˆæŸ¥çœ‹Tomcatä¸­web.xmlä¸­ä»‹ç»ï¼‰

      - å®ƒçš„**ä¼˜å…ˆçº§æœ€ä½**ï¼Œå¦‚æœä¸€ä¸ªè¯·æ±‚æ²¡æœ‰äººå¤„ç†ï¼Œä¼šæ‰§è¡Œè¯¥DefaultServletï¼å…¶å®æˆ‘ä»¬åœ¨è®¿é—®index.htmlæ—¶ä¹Ÿæ˜¯åœ¨æ‰§è¡Œè¯¥DefaultServletã€‚
      - **ä¸ä¼šé‡å†™å…¶ä»–Servlet**ï¼šå³ä¸åŒ¹é…JSPæ˜¯å› ä¸ºä»»ä½•URLåç¼€ä¸ºjspçš„è®¿é—®ï¼Œéƒ½ä¼šæ‰§è¡Œåä¸ºjspçš„Servlet
    - **`/*`**ï¼šå¸¦é€šé…ç¬¦ï¼ˆåŒ¹é…æ‰€æœ‰**è·¯å¾„å‹å’Œåç¼€å‹**URLï¼ŒåŒ…æ‹¬.htmlã€.jspç­‰ï¼‰ï¼Œ**ä¸å»ºè®®ä½¿ç”¨**ï¼Œ**é™¤éç”¨åœ¨Filterä¸­**

      - **ä¼šé‡å†™å…¶ä»–Servlet**ï¼šåœ¨è®¿é—®jspæ—¶ä¼šæŠ¥404
    - `/xxx`ï¼šè·¯å¾„åŒ¹é…
    - `/xxx/xxx`ï¼šå¤šå±‚è·¯å¾„ï¼Œç§°ä¹‹ä¸ºç›®å½•ç»“æ„
    - `*.do`ï¼šæ‰©å±•ååŒ¹é…ï¼Œ*å‰ä¸èƒ½æœ‰/ï¼Œå¦åˆ™æŠ¥é”™

## Request

### Requestç»§æ‰¿ä½“ç³»

```
ServletRequest æ¥å£
      |
     ç»§æ‰¿
      |
HttpServletRequest æ¥å£
      |
     å®ç°
      |
org.apache.catalina.connector.RequestFacade ç±»ï¼Œç”± Tomcat æä¾›ï¼Œè‹¥æ˜¯å…¶ä»–å®¹å™¨åˆ™ä¸ä¸€æ ·
```

ä»¥ä¸Šä½“ç³»Responseä¹Ÿé€‚ç”¨

### è·å–è¯·æ±‚æ¶ˆæ¯æ•°æ®

* è·å–**è¯·æ±‚è¡Œ**æ•°æ®ï¼šå¦‚`GET /day14/login?name=zhangsan HTTP/1.1`

  * è·å–è¯·æ±‚æ–¹å¼ï¼š`String getMethod()`ï¼Œå¦‚`GET` ã€‚HttpServletå·²ç»åœ¨å†…éƒ¨ä½¿ç”¨äº†ï¼Œä»¥åç”¨ä¸åˆ°
  * è·å–**è¯·æ±‚URL**ï¼š`StringBuffer getRequestURL()`ï¼Œå¦‚`http://localhost/day14/login/a.html`ã€‚**ç»Ÿä¸€èµ„æºå®šä½ç¬¦**
  * è·å–**è¯·æ±‚URI**ï¼š`String getRequestURI()`ï¼Œå¦‚`/day14/login`ã€‚**ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦**ï¼Œå®ƒ**åŒ…æ‹¬URL**
  * è·å–**è™šæ‹Ÿç›®å½•**ï¼š`String getContextPath()`ï¼Œå¦‚`/day14`
  * è·å–Servletè·¯å¾„ï¼š`String getServletPath()`ï¼Œå¦‚`/login`
  * è·å–getæ–¹å¼è¯·æ±‚å‚æ•°ï¼š`String getQueryString()`ï¼Œå¦‚`name=zhangsan`ï¼Œä»¥åç”¨ä¸åˆ°
  * è·å–åè®®åŠç‰ˆæœ¬ï¼š`String getProtocol()`ï¼Œå¦‚`HTTP/1.1`
  * è·å–å®¢æˆ·æœºçš„**IPåœ°å€**ï¼š`String getRemoteAddr()`
* è·å–**è¯·æ±‚å¤´**æ•°æ®

  * é€šè¿‡**è¯·æ±‚å¤´çš„åç§°è·å–è¯·æ±‚å¤´çš„å€¼**ï¼š`String getHeader(String name)`ï¼Œä¸åŒºåˆ†å¤§å°å†™ã€‚å¦‚User-Agentã€Referer
  * è·å–æ‰€æœ‰çš„è¯·æ±‚å¤´åç§°ï¼š`Enumeration<String> getHeaderNames()`ï¼š
* è·å–**è¯·æ±‚ä½“**æ•°æ®ï¼ˆåªæœ‰POSTè¯·æ±‚æ–¹å¼ï¼Œæ‰æœ‰è¯·æ±‚ä½“ï¼Œåœ¨è¯·æ±‚ä½“ä¸­å°è£…äº†POSTè¯·æ±‚çš„è¯·æ±‚å‚æ•°ï¼‰ã€‚æ­¥éª¤ï¼š

  1. **è·å–æµå¯¹è±¡**

     * `BufferedReader getReader()`ï¼šè·å–**å­—ç¬¦è¾“å…¥æµ**ï¼Œåªèƒ½æ“ä½œå­—ç¬¦æ•°æ®
     * `ServletInputStream getInputStream()`ï¼šè·å–**å­—èŠ‚è¾“å…¥æµ**ï¼Œå¯ä»¥æ“ä½œæ‰€æœ‰ç±»å‹æ•°æ®ã€‚ç»§æ‰¿äº†InputStreamã€‚åœ¨**æ–‡ä»¶ä¸Šä¼ **çŸ¥è¯†ç‚¹åè®²è§£
  2. **å†ä»æµå¯¹è±¡ä¸­æ‹¿æ•°æ®**

### è·å–**è¯·æ±‚å‚æ•°é€šç”¨æ–¹**å¼

* è·å–**è¯·æ±‚å‚æ•°é€šç”¨æ–¹**å¼ï¼ˆä¸è®ºgetè¿˜æ˜¯postè¯·æ±‚æ–¹å¼éƒ½å¯ä»¥ä½¿ç”¨ï¼‰

  * **`String getParameter(String name)`**ï¼š==æ ¹æ®**å‚æ•°åç§°è·å–å‚æ•°å€¼**==    username=zs&password=123
  * `String[] getParameterValues(String name)`ï¼šæ ¹æ®å‚æ•°åç§°è·å–å‚æ•°å€¼çš„**æ•°ç»„** hobby=xx&hobby=game
  * **`Map<String,String[]> getParameterMap()`**ï¼š==è·å–**æ‰€æœ‰å‚æ•°çš„mapé›†åˆ**==
  * `Enumeration<String> getParameterNames()`ï¼šè·å–æ‰€æœ‰è¯·æ±‚çš„å‚æ•°åç§°
  * **ä¸­æ–‡ä¹±ç é—®é¢˜**ï¼š

    * GETæ–¹å¼ï¼šTomcat 8åŠä»¥ä¸Šç‰ˆæœ¬å·²ç»å°†getæ–¹å¼ä¹±ç é—®é¢˜è§£å†³äº†
    * POSTæ–¹å¼ï¼šä¼šä¹±ç ã€‚åœ¨è·å–å‚æ•°å‰ï¼Œ**è®¾ç½®requestçš„ç¼–ç `request.setCharacterEncoding("utf-8");`**
  * è·å–çš„**å‚æ•°å°è£…ä¸ºJavaBean**å¯ä»¥åˆ©ç”¨ Spring æˆ–å…¶ä»–æä¾›çš„ BeanUtils å·¥å…·ç±»ï¼Œ**ç®€åŒ–æ•°æ®å°è£…**

    * JavaBeanï¼šæ ‡å‡†çš„Javaç±»ï¼ŒåŠŸèƒ½ä¸ºå°è£…æ•°æ®ã€‚è¦æ±‚å¦‚ä¸‹ï¼š

      1. **ç±»**å¿…é¡»è¢«**public**ä¿®é¥°
      2. å¿…é¡»æä¾›**å…¬æœ‰çš„ç©ºå‚çš„æ„é€ å™¨**
      3. å±æ€§ä¸€èˆ¬ä½¿ç”¨privateä¿®é¥°
      4. å¯¹å±æ€§æä¾›**å…¬å…±get(æˆ–is)å’Œsetæ–¹æ³•**ï¼Œè‹¥åªæœ‰getæ–¹æ³•æˆ–setæ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§æ˜¯åªè¯»æˆ–åªå†™å±æ€§ï¼

         * **å±æ€§**ï¼š**setterå’Œgetteræ–¹æ³•æˆªå–åçš„äº§ç‰©ï¼Œä¸æˆå‘˜å˜é‡åæ— å…³**ã€‚getName() --> Name--> name
    * æ–¹æ³•

      * `setProperty(Object bean, String propName)`
      * `getProperty(Object bean,String propName,String propValue)`ï¼šæ“ä½œçš„æ˜¯**å±æ€§**
      * **`populate(Object obj , Map map)`**ï¼šå°†**map**é›†åˆçš„é”®å€¼å¯¹ä¿¡æ¯ï¼Œå°è£…åˆ°å¯¹åº”çš„**JavaBean**å¯¹è±¡ä¸­

        ```java
        User user = new User();
        Map<String, String[]> map = request.getParameterMap();
        BeanUtils.populate(user,map); //populateéœ€è¦try...catchã€‚springçš„beanutilså¯èƒ½ä¸ä¸€æ ·
        ```

### è¯·æ±‚è½¬å‘

* **è¯·æ±‚è½¬å‘**ï¼šä¸€ç§åœ¨æœåŠ¡å™¨**å†…éƒ¨**çš„èµ„æºè·³è½¬æ–¹å¼

  * æ­¥éª¤ï¼š

    1. **requestè·å–è¯·æ±‚è½¬å‘å™¨å¯¹è±¡**ï¼š**`RequestDispatcher getRequestDispatcher(String path)`**ï¼Œ**Servletè·¯å¾„**
    2. ä½¿ç”¨RequestDispatcherå¯¹è±¡æ¥è¿›è¡Œ**è½¬å‘**ï¼š`forward(ServletRequest request, ServletResponse response) `

       - è¯·æ±‚åŒ…å«ï¼š`include(request,response)`

         > è¯·æ±‚è½¬å‘ï¼šç”±ä¸‹ä¸€ä¸ªServletå®Œæˆå“åº”ä½“ï¼å½“å‰Servletå¯ä»¥è®¾ç½®å“åº”å¤´ï¼ï¼ˆ<span style="font-family:monaco;color:red;font-weight:bold">ç•™å¤´ä¸ç•™ä½“</span>ï¼‰
         > è¯·æ±‚åŒ…å«ï¼šç”±ä¸¤ä¸ªServletå…±åŒæœªå®Œæˆå“åº”ä½“ï¼ï¼ˆ<span style="font-family:monaco;color:red;font-weight:bold">éƒ½ç•™</span>ï¼‰
         >
  * ç‰¹ç‚¹ï¼š

    1. æµè§ˆå™¨**åœ°å€æ è·¯å¾„ä¸å‘ç”Ÿå˜åŒ–**
    2. è½¬å‘æ˜¯**ä¸€æ¬¡è¯·æ±‚ä¸€æ¬¡å“åº”**ï¼Œä½¿ç”¨åŒä¸€ä¸ªrequestå’Œresponseï¼
    3. åªèƒ½è½¬å‘åˆ°**å½“å‰æœåŠ¡å™¨å†…éƒ¨èµ„æº**ä¸­ã€‚

### requeståŸŸ

* åŸŸå¯¹è±¡ï¼šä¸€ä¸ªæœ‰ä½œç”¨èŒƒå›´çš„å¯¹è±¡ï¼Œå¯ä»¥åœ¨èŒƒå›´å†…å…±äº«æ•°æ®
* **requeståŸŸ**ï¼šä»£è¡¨**ä¸€æ¬¡è¯·æ±‚çš„èŒƒå›´**ï¼Œä¸€èˆ¬ç”¨äº**è¯·æ±‚è½¬å‘**çš„å¤šä¸ªèµ„æºä¸­**å…±äº«æ•°æ®**

  * æ–¹æ³•ï¼š

    1. **`void setAttribute(String name,Object obj)`**ï¼šå­˜å‚¨æ•°æ®
    2. **`Object getAttitude(String name)`**ï¼šé€šè¿‡é”®è·å–å€¼
    3. **`void removeAttribute(String name)`**ï¼šé€šè¿‡é”®ç§»é™¤é”®å€¼å¯¹

### ç”¨æˆ·ç™»å½•æ¡ˆä¾‹éœ€æ±‚

* ç¼–å†™login.htmlç™»å½•é¡µé¢ï¼šusername & password ä¸¤ä¸ªè¾“å…¥æ¡†

  login.htmlä¸­formè¡¨å•çš„actionè·¯å¾„çš„å†™æ³•ï¼š**è™šæ‹Ÿç›®å½•+Servletçš„èµ„æºè·¯å¾„**
* ä½¿ç”¨Druidæ•°æ®åº“è¿æ¥æ± æŠ€æœ¯,æ“ä½œmysqlï¼Œday14æ•°æ®åº“ä¸­userè¡¨
* ä½¿ç”¨JdbcTemplateæŠ€æœ¯å°è£…JDBC
* ç™»å½•æˆåŠŸè·³è½¬åˆ°SuccessServletå±•ç¤ºï¼šç™»å½•æˆåŠŸï¼ç”¨æˆ·å,æ¬¢è¿æ‚¨
* ç™»å½•å¤±è´¥è·³è½¬åˆ°FailServletå±•ç¤ºï¼šç™»å½•å¤±è´¥ï¼Œç”¨æˆ·åæˆ–å¯†ç é”™è¯¯

## Response

### Responseç»§æ‰¿ä½“ç³»

```
```

`ServletResponse`           â€”â€” æ¥å£
|	ç»§æ‰¿
`HttpServletResponse`	  â€”â€” æ¥å£
|	å®ç°
`org.apache.catalina.connector.ResponseFacade`  â€”â€”ç±»  (Tomcatç¼–å†™çš„)

### è®¾ç½®å“åº”è¡Œä¸­çŠ¶æ€ç 

* **<span style="background:yellow">setStatus(int sc)</span>** --> **è®¾ç½®æ­¤å“åº”çš„çŠ¶æ€ç **ï¼Œå¯ä»¥ç”¨æ¥å‘é€302ã€200æˆ–è€…404ã€500ç­‰

  * sendError(int sc [,String msg]) --> å‘é€é”™è¯¯çŠ¶æ€ç ï¼Œè¿˜å¯ä»¥å¸¦ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼

### è®¾ç½®å“åº”å¤´

å¤´å°±æ˜¯ä¸€ä¸ª**é”®å€¼å¯¹**ï¼å¯èƒ½ä¼šå­˜åœ¨ä¸€ä¸ªå¤´ï¼ˆä¸€ä¸ªåç§°ï¼Œä¸€ä¸ªå€¼ï¼‰ï¼Œä¹Ÿå¯èƒ½ä¼šå­˜åœ¨ä¸€ä¸ªå¤´ï¼ˆä¸€ä¸ªåç§°ï¼Œå¤šä¸ªå€¼ï¼ï¼‰

* **<span style="background:yellow">setHeader(String n, String val)</span>**ï¼šé€‚ç”¨äº<span style="background:yellow">**å•å€¼**</span>çš„å“åº”å¤´ï¼Œä¾‹å¦‚ï¼šresponse.setHeader("aaa", "AAA")

  * addHeader(String name, String value)ï¼šé€‚ç”¨äºå¤šå€¼çš„å“åº”å¤´ï¼Œä¸ºæ¯ä¸ªå€¼åˆ†åˆ«è°ƒç”¨
  * `<meta>`**æ ‡ç­¾ä»£æ›¿å“åº”å¤´**

    ```html
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    ```
* **Refreshæ¡ˆä¾‹**ï¼ˆ3ç§’åè·³è½¬è‡³å¦ä¸€ä¸ªé¡µé¢ï¼‰ä¹Ÿå¯ä»¥ç†è§£ä¸ºå®šæ—¶é‡å®šå‘

  ```java
  response.getWriter().write("after 3s ...");
  //urlä¹Ÿå¯ä»¥æ”¹ä¸ºwww.baidu.comï¼Œè‹¥ä¸è®¾ç½®è¿™ä¸ªå‚æ•°ï¼Œå°±è·³è½¬è‡³å½“å‰é¡µé¢
  response.setHeader("Refresh","3,url='DServlet'");
  ```
* **ç¦ç”¨æµè§ˆå™¨ç¼“å­˜**(Cache-Controlã€pragmaã€expires)

  ```java
  response.setHeader("Cache-Control","no-cache");
  response.setHeader("Pragma", "no-cache");//ç¼–è¯‘æŒ‡ç¤º
  response.setDateHeader("Expires", -1);//å¤±æ•ˆæ—¶é—´
  ```

### è®¾ç½®å“åº”ä½“

> responseçš„ä¸¤ä¸ªæµï¼Œç”¨æ¥å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼ˆä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼Œå¦åˆ™æŠ›**IllegalStateException**å¼‚å¸¸ï¼‰
>

* **ServletOutputStreamï¼ˆå­—èŠ‚è¾“å‡ºæµï¼‰ï¼š`resopnse.getOutputStream()`**
* **PrintWriterï¼ˆå­—ç¬¦è¾“å‡ºæµï¼Œéœ€è¦è®¾ç½®ç¼–ç ï¼‰ï¼š`response.getWriter()`**ï¼Œä¸éœ€è¦åˆ·æ–°ç¼“å†²åŒº

### é‡å®šå‘

* **é‡å®šå‘**ï¼š**èµ„æºè·³è½¬çš„æ–¹å¼**
* è®¾ç½®**çŠ¶æ€ç **ä¸º302ï¼Œè®¾ç½®**å“åº”å¤´**`Location`

  ```java
  response.setStatus(302);
  response.setHeader("location","/day15/responseDemo2");
  ```
* ç®€å•çš„é‡å®šå‘æ–¹æ³•ï¼š**`response.sendRedirect()`**

  ```java
  response.sendRedirect("/day15/responseDemo2");
  ```
* **forwardå’Œredirectçš„åŒºåˆ«**

  * è½¬å‘çš„ç‰¹ç‚¹ï¼šforward

    1. **åœ°å€æ è·¯å¾„ä¸å˜**
    2. è½¬å‘æ˜¯**ä¸€æ¬¡è¯·æ±‚**ï¼Œå¯ä»¥**ä½¿ç”¨requeståŸŸ**æ¥å…±äº«æ•°æ®
    3. è½¬å‘åªèƒ½**è®¿é—®å½“å‰æœåŠ¡å™¨ä¸‹çš„èµ„æº**
  * é‡å®šå‘çš„ç‰¹ç‚¹ï¼šredirect

    1. **åœ°å€æ **å‘ç”Ÿ**å˜**åŒ–
    2. é‡å®šå‘æ˜¯**ä¸¤æ¬¡è¯·æ±‚**ã€‚**ä¸èƒ½ä½¿ç”¨requeståŸŸ**æ¥å…±äº«æ•°æ®
    3. é‡å®šå‘**å¯ä»¥è®¿é—®å…¶ä»–ç«™ç‚¹**(æœåŠ¡å™¨)çš„èµ„æº

### è·¯å¾„çš„å†™æ³•

* **ç›¸å¯¹è·¯å¾„**ï¼šé€šè¿‡ç›¸å¯¹è·¯å¾„ä¸å¯ä»¥ç¡®å®šå”¯ä¸€èµ„æºï¼Œä»¥**`./`å¼€å¤´ï¼ˆæˆ–ä¸å†™å®ƒï¼‰çš„è·¯å¾„**ã€‚å¦‚ï¼š`./index.html`

  * è§„åˆ™ï¼šæ‰¾åˆ°å½“å‰èµ„æºæ‰€å±ç›®å½•å’Œç›®æ ‡èµ„æºæ‰€å±ç›®å½•ä¹‹é—´çš„ç›¸å¯¹ä½ç½®å…³ç³»ã€‚`./`ï¼šå½“å‰ç›®å½•ï¼›`../`:åé€€ä¸€çº§ç›®å½•
* **ç»å¯¹è·¯å¾„**ï¼šé€šè¿‡ç»å¯¹è·¯å¾„å¯ä»¥ç¡®å®šå”¯ä¸€èµ„æºï¼Œä»¥**`/`å¼€å¤´çš„è·¯å¾„**ã€‚å¦‚ï¼š`/day15/responseDemo2`

  * è§„åˆ™ï¼šåˆ¤æ–­å®šä¹‰çš„è·¯å¾„æ˜¯**ç»™è°ç”¨**çš„ï¼Ÿ**åˆ¤æ–­å°†æ¥è¯·æ±‚ä»å“ªå„¿å‘å‡º**

    * **ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ä½¿ç”¨**ï¼šéœ€è¦**åŠ è™šæ‹Ÿç›®å½•**(é¡¹ç›®çš„è®¿é—®è·¯å¾„)ï¼Œå»ºè®®**åŠ¨æ€è·å–ï¼š`request.getContextPath()`**

      * `<a>`ï¼Œ`<form>`ï¼Œ`redirectè·¯å¾„`ã€‚ã€‚ã€‚
    * **ç»™æœåŠ¡å™¨ä½¿ç”¨**ï¼š**ä¸éœ€è¦åŠ è™šæ‹Ÿç›®å½•**

      * `forwardè·¯å¾„`

### è¾“å‡ºå­—ç¬¦æ•°æ®åˆ°æµè§ˆå™¨â€”ä¹±ç 

ç”±äºæµè§ˆå™¨é»˜è®¤ä½¿ç”¨ GBK æˆ– GB2312 æˆ– UTF-8ï¼Œè€ŒæœåŠ¡å™¨è·å–çš„**æµ**é»˜è®¤ä½¿ç”¨ ISO8859-1ï¼ˆåº”è¯¥æ˜¯ä½¿ç”¨çš„ Servlet å®¹å™¨å¦‚ Tomcat è®¾ç½®çš„ï¼‰ï¼Œä¸æ”¯æŒä¸­æ–‡ã€‚ä¸”ç¼–ç è§£ç ä¸åŒï¼Œå¿…ä¹±ç ã€‚

å¯é€šè¿‡å¦‚ä¸‹ä»£ç æŸ¥åˆ°æœåŠ¡å™¨è·å–çš„**æµ**çš„ç¼–ç 

```java
response.getCharacterEncoding()
```

å¦‚ä½•è§£å†³ä¸­æ–‡ä¹±ç å‘¢ï¼Ÿ

**è·å–å­—ç¬¦è¾“å‡ºæµä¹‹å‰**è®¾ç½®è¯¥**æµçš„é»˜è®¤ç¼–ç **ï¼Œå‘Šè¯‰æµè§ˆå™¨**å“åº”ä½“ä½¿ç”¨çš„ç¼–ç **

```java
System.out.println(response.getCharacterEncoding());// ISO-8859-1
System.out.println(response.getContentType());// null

// response.setCharacterEncoding("UTF-8");

// è®¾ç½® setContentType åä¼šè‡ªåŠ¨è®¾ç½® CharacterEncoding
// response.setHeader("Content-type","text/html;charset=utf-8");// setHeader å°è£…åçš„æ–¹æ³•å¦‚ä¸‹
response.setContentType("application/json;charset=utf-8");// çº¯æ–‡æœ¬ä¹Ÿå¯ä»¥è®¾ç½®ä¸º text/plain;charset=utf-8

System.out.println(response.getCharacterEncoding());// UTF-8
System.out.println(response.getContentType());// application/json;charset=utf-8
```

### è¾“å‡ºå­—èŠ‚æ•°æ®åˆ°æµè§ˆå™¨

* `getBytes()`ï¼Œè·å–å­—èŠ‚è¾“å‡ºæµå¤–ï¼Œå…¶ä»–å’Œè¾“å‡ºå­—ç¬¦æ•°æ®æ²¡ä»€ä¹ˆåŒºåˆ«

### éªŒè¯ç æ¡ˆä¾‹

> æœ¬è´¨ï¼šå›¾ç‰‡
> ç›®çš„ï¼š**é˜²æ­¢æ¶æ„è¡¨å•æ³¨å†Œ**
>

```java
//1.åˆ›å»ºéªŒè¯ç å›¾ç‰‡å¯¹è±¡
BufferedImage image = new BufferedImage(100,50,BufferedImage.TYPE_INT_RGB);

//2.ç¾åŒ–å›¾ç‰‡
//2.1 å¡«å……èƒŒæ™¯è‰²
Graphics g = image.getGraphics();//ç”»ç¬”å¯¹è±¡
g.setColor(Color.PINK);//è®¾ç½®ç”»ç¬”é¢œè‰²
g.fillRect(0,0,width,height);

//2.2ç”»è¾¹æ¡†
g.setColor(Color.BLUE);
g.drawRect(0,0,width - 1,height - 1);

String str = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghigklmnopqrstuvwxyz0123456789";
//ç”Ÿæˆéšæœºè§’æ ‡
Random ran = new Random();
for (int i = 1; i <= 4; i++) {
    int index = ran.nextInt(str.length());
    char ch = str.charAt(index);//éšæœºå­—ç¬¦
    g.drawString(ch+"",width/5*i,height/2);//å†™éªŒè¯ç 
}

//2.4ç”»å¹²æ‰°çº¿
g.setColor(Color.GREEN);
//éšæœºç”Ÿæˆåæ ‡ç‚¹
for (int i = 0; i < 10; i++) {
    int x1 = ran.nextInt(width);
    int x2 = ran.nextInt(width);
    int y1 = ran.nextInt(height);
    int y2 = ran.nextInt(height);
    g.drawLine(x1,y1,x2,y2);
}

//3.å°†å›¾ç‰‡è¾“å‡ºåˆ°é¡µé¢å±•ç¤º
ImageIO.write(image,"jpg",response.getOutputStream());
```

```javascript
//ç‚¹å‡»å›¾ç‰‡æ›´æ¢ä¸‹ä¸€å¼ 
document.getElementById("verifyCode").onclick = function () {
    //åŠ æ—¶é—´æˆ³çš„æ¯«ç§’å€¼
    var date = new Date().getTime();
    this.src = "/day15/checkCodeServlet?" + date;
}
```

## URLç¼–ç 

* è¡¨å•çš„ç±»å‹ï¼šContent-Type: application/x-www-form-urlencodedï¼Œå°±æ˜¯æŠŠä¸­æ–‡è½¬æ¢æˆ%åé¢è·Ÿä¸¤ä½çš„16è¿›åˆ¶

  ä¸ºä»€ä¹ˆè¦ç”¨å®ƒï¼šåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ é€’ä¸­æ–‡æ—¶éœ€è¦æŠŠå®ƒè½¬æ¢æˆç½‘ç»œé€‚åˆçš„æ–¹å¼
* **å®ƒä¸æ˜¯å­—ç¬¦ç¼–ç **ï¼Œå®ƒæ˜¯ç”¨æ¥åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ä¼ é€’å‚æ•°ç”¨çš„ä¸€ç§æ–¹å¼
* URLç¼–ç éœ€è¦å…ˆæŒ‡å®šä¸€ç§å­—ç¬¦ç¼–ç ï¼ŒæŠŠ**å­—ç¬¦ä¸²è§£ç åï¼Œå¾—åˆ°byte[]ï¼Œç„¶åæŠŠå°äº0çš„å­—èŠ‚+256ï¼Œå†è½¬æ¢æˆ16è¿›åˆ¶ã€‚å‰é¢å†æ·»åŠ ä¸€ä¸ª%**
* **POST**è¯·æ±‚é»˜è®¤å°±ä½¿ç”¨URLç¼–ç ï¼tomcatä¼šè‡ªåŠ¨ä½¿ç”¨URLè§£ç 

  ```java
  String username = URLEncoder.encode(username, "utf-8");//URLç¼–ç ï¼š
  String username = URLDecoder.decode(username, "utf-8");//URLè§£ç ï¼š
  ```

  æœ€åæˆ‘ä»¬éœ€è¦æŠŠé“¾æ¥ä¸­çš„ä¸­æ–‡å‚æ•°ï¼Œä½¿ç”¨urlæ¥ç¼–ç ï¼å­¦äº†jspå°±å¯ä»¥

## æ–‡ä»¶ä¸‹è½½æ¡ˆä¾‹

* æ–‡ä»¶ä¸‹è½½éœ€æ±‚ï¼š

  1. é¡µé¢æ˜¾ç¤ºè¶…é“¾æ¥
  2. ç‚¹å‡»è¶…é“¾æ¥åå¼¹å‡ºä¸‹è½½æç¤ºæ¡†
  3. å®Œæˆå›¾ç‰‡æ–‡ä»¶ä¸‹è½½
* åˆ†æï¼š

  1. è¶…é“¾æ¥æŒ‡å‘çš„èµ„æºå¦‚æœèƒ½å¤Ÿè¢«æµè§ˆå™¨è§£æï¼Œåˆ™åœ¨æµè§ˆå™¨ä¸­å±•ç¤ºï¼Œå¦‚æœä¸èƒ½è§£æï¼Œåˆ™å¼¹å‡ºä¸‹è½½æç¤ºæ¡†ã€‚ä¸æ»¡è¶³éœ€æ±‚
  2. è¦æ±‚ä»»ä½•èµ„æºéƒ½å¿…é¡»å¼¹å‡ºä¸‹è½½æç¤ºæ¡†
  3. ä½¿ç”¨å“åº”å¤´è®¾ç½®èµ„æºçš„æ‰“å¼€æ–¹å¼ï¼š`content-disposition:attachment;filename=xxx`
* æ­¥éª¤ï¼š

  1. å®šä¹‰é¡µé¢ï¼Œç¼–è¾‘è¶…é“¾æ¥hrefå±æ€§ï¼ŒæŒ‡å‘Servletï¼Œ**ä¼ é€’èµ„æºåç§°`?filename=xxx`**
  2. å®šä¹‰Servlet
     3. è·å–æ–‡ä»¶åç§°
     4. ä½¿ç”¨å­—èŠ‚è¾“å…¥æµåŠ è½½æ–‡ä»¶è¿›å†…å­˜
     5. æŒ‡å®šresponseçš„å“åº”å¤´ï¼š `content-disposition:attachment;filename=xxx`6. å°†æ•°æ®å†™å‡ºåˆ°responseè¾“å‡ºæµ
* ä¸­æ–‡æ–‡ä»¶åé—®é¢˜

  * è§£å†³æ€è·¯ï¼š

    1. è·å–å®¢æˆ·ç«¯ä½¿ç”¨çš„æµè§ˆå™¨ç‰ˆæœ¬ä¿¡æ¯
    2. æ ¹æ®ä¸åŒçš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œè®¾ç½®filenameçš„ç¼–ç æ–¹å¼ä¸åŒ

  ```java
  //1.è·å–è¯·æ±‚å‚æ•°ï¼Œæ–‡ä»¶åç§°
  String filename = request.getParameter("filename");
  //2.ä½¿ç”¨å­—èŠ‚è¾“å…¥æµåŠ è½½æ–‡ä»¶è¿›å†…å­˜
  //2.1æ‰¾åˆ°æ–‡ä»¶æœåŠ¡å™¨è·¯å¾„
  String realPath = this.getServletContext().getRealPath("/img/" + filename);
  //2.2ç”¨å­—èŠ‚æµå…³è”
  FileInputStream fis = new FileInputStream(realPath);

  //3.è®¾ç½®responseçš„å“åº”å¤´
  //3.1è®¾ç½®å“åº”å¤´ç±»å‹ï¼šcontent-type
  String mimeType = servletContext.getMimeType(filename);//è·å–æ–‡ä»¶çš„mimeç±»å‹
  response.setHeader("content-type",mimeType);
  //3.2è®¾ç½®å“åº”å¤´æ‰“å¼€æ–¹å¼:content-disposition

  //è§£å†³ä¸­æ–‡æ–‡ä»¶åé—®é¢˜
  //1.è·å–user-agentè¯·æ±‚å¤´ã€
  String agent = request.getHeader("user-agent");
  //2.ä½¿ç”¨å·¥å…·ç±»æ–¹æ³•ç¼–ç æ–‡ä»¶åå³å¯
  filename = DownLoadUtils.getFileName(agent, filename);
  response.setHeader("content-disposition","attachment;filename="+filename);

  //4.å°†è¾“å…¥æµçš„æ•°æ®å†™å‡ºåˆ°è¾“å‡ºæµä¸­
  ServletOutputStream sos = response.getOutputStream();
  byte[] buff = new byte[1024 * 8];
  int len = 0;
  while((len = fis.read(buff)) != -1){
      sos.write(buff,0,len);
  }
  fis.close();
  ```