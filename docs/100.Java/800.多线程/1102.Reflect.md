---
title: 12 Reflect
date: 2020-12-14 23:04:19
permalink: /pages/2a2bbe/
categories:
  - Java
  - Core
tags:
  -
---

# Reflectâ€”java.lang.reflect

## åå°„ç®€ä»‹

### åŠ¨æ€è¯­è¨€ & é™æ€è¯­è¨€

Reflection(åå°„)æ˜¯è¢«è§†ä¸ºåŠ¨æ€è¯­è¨€çš„å…³é”®ï¼Œåå°„æœºåˆ¶å…è®¸ç¨‹åºåœ¨**æ‰§è¡ŒæœŸ**å€ŸåŠ©äº Reflection API å–å¾—ä»»ä½•ç±»çš„å†…éƒ¨ä¿¡æ¯ï¼Œå¹¶èƒ½ç›´æ¥æ“ä½œä»»æ„å¯¹è±¡çš„å†…éƒ¨å±æ€§åŠæ–¹æ³•ã€‚

- åŠ¨æ€è¯­è¨€ï¼šæ˜¯ä¸€ç±»åœ¨è¿è¡Œæ—¶å¯ä»¥æ”¹å˜å…¶ç»“æ„çš„è¯­è¨€ã€‚ä¾‹å¦‚æ–°çš„å‡½æ•°ã€å¯¹è±¡ã€ç”šè‡³ä»£ç å¯ä»¥è¢«å¼•è¿›ï¼Œå·²æœ‰çš„å‡½æ•°å¯ä»¥è¢«åˆ é™¤æˆ–æ˜¯å…¶ä»–ç»“æ„ä¸Šçš„å˜åŒ–ã€‚é€šä¿—ç‚¹è¯´å°±æ˜¯åœ¨è¿è¡Œæ—¶ä»£ç å¯ä»¥æ ¹æ®æŸäº›æ¡ä»¶æ”¹å˜è‡ªèº«ç»“æ„ã€‚ ä¸»è¦åŠ¨æ€è¯­è¨€æœ‰ Object-Cã€C#ã€JavaScriptã€PHPã€Pythonã€Erlang

- é™æ€è¯­è¨€ï¼šä¸åŠ¨æ€è¯­è¨€ç›¸å¯¹åº”çš„ï¼Œè¿è¡Œæ—¶ç»“æ„ä¸å¯å˜çš„è¯­è¨€å°±æ˜¯é™æ€è¯­è¨€ã€‚å¦‚ Javaã€Cã€ C++ã€‚

Java ä¸æ˜¯åŠ¨æ€è¯­è¨€ï¼Œä½† Java å¯ä»¥ç§°ä¹‹ä¸ºâ€œå‡†åŠ¨æ€è¯­è¨€â€ã€‚å³ Java æœ‰ä¸€å®šçš„åŠ¨ æ€æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨åå°„æœºåˆ¶ã€å­—èŠ‚ç æ“ä½œè·å¾—ç±»ä¼¼åŠ¨æ€è¯­è¨€çš„ç‰¹æ€§ã€‚ Java çš„åŠ¨æ€æ€§è®©ç¼–ç¨‹çš„æ—¶å€™æ›´åŠ çµæ´»!

### ç”¨å¤„

åå°„æ˜¯æ¡†æ¶è®¾è®¡çš„çµé­‚ã€‚æ¡†æ¶ï¼šåŠæˆå“è½¯ä»¶ã€‚å¯ä»¥åœ¨æ¡†æ¶çš„åŸºç¡€ä¸Šè¿›è¡Œè½¯ä»¶å¼€å‘ï¼Œç®€åŒ–ç¼–ç 

é€šè¿‡ç›´æ¥ new çš„æ–¹å¼æˆ–åå°„çš„æ–¹å¼éƒ½å¯ä»¥è°ƒç”¨å…¬å…±çš„ç»“æ„ï¼Œå¼€å‘ä¸­åˆ°åº•ç”¨é‚£ä¸ªï¼Ÿ

- æ¨è newï¼Œé™¤éç¼–è¯‘æœŸä¸ç¡®å®š new çš„å¯¹è±¡ï¼Œå¦‚ SpringMVC ä¸­ URL æ˜ å°„

## Java çš„åå°„æœºåˆ¶

### ç®€ä»‹ ğŸ”¥

Java åå°„æœºåˆ¶æ˜¯åœ¨**è¿è¡ŒçŠ¶æ€ä¸­**ï¼Œå¯¹äºä»»æ„ä¸€ä¸ª**ç±»**ï¼Œéƒ½èƒ½å¤Ÿ**è·å¾—**è¿™ä¸ªç±»çš„**æ‰€æœ‰å±æ€§å’Œæ–¹æ³•**ï¼›å¯¹äºä»»æ„ä¸€ä¸ª**å¯¹è±¡**ï¼Œéƒ½èƒ½å¤Ÿ**è°ƒç”¨**å®ƒçš„ä»»æ„ä¸€ä¸ª**å±æ€§å’Œæ–¹æ³•**ï¼›**èƒ½å¤Ÿåˆ†æç±»èƒ½åŠ›çš„ç¨‹åºç§°ä¸ºåå°„**ã€‚

åŠ è½½å®Œç±»ä¹‹åï¼Œåœ¨å †å†…å­˜çš„æ–¹æ³•åŒºä¸­å°±äº§ç”Ÿäº†ä¸€ä¸ª Class ç±»å‹çš„å¯¹è±¡ï¼ˆä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ª Class å¯¹è±¡ï¼Œå†…éƒ¨ç±»ç®—å¤šä¸ªï¼‰ï¼Œè¿™ä¸ªå¯¹è±¡å°±åŒ…å«äº†å®Œæ•´çš„ç±»çš„ç»“æ„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå¯¹è±¡çœ‹åˆ°åŸå§‹ç±»çš„ç»“æ„ï¼Œè¿™ä¸ªå¯¹è±¡å°±åƒåŸå§‹ç±»è¢«é•œå­åå°„å‡ºæ¥ä¸€æ ·ã€‚

### åŸç† & è¿‡ç¨‹ ğŸ”¥

1.  `javac`å‘½ä»¤ç¼–è¯‘`.java`æ–‡ä»¶ï¼Œç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ª`.class`æ–‡ä»¶
2.  JVM é€šè¿‡ç±»åŠ è½½å™¨å°†`.class`æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç”¨`Class`ç±»è¡¨ç¤ºï¼ˆJava ä¸­ä¸‡äº‹ä¸‡ç‰©çš†å¯¹è±¡ï¼‰ï¼Œå¯é€šè¿‡ `java` å‘½ä»¤è§£é‡Šè¿è¡Œ
3.  å¾—åˆ°äº†è¿™ä¸ª`Class`ç±»ä¹‹åï¼Œå°±å¯ä»¥å¾—åˆ°`.class`æ–‡ä»¶é‡Œé¢çš„æ‰€æœ‰å†…å®¹

### å¥½å¤„

- å¯ä»¥åœ¨**ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ“ä½œè¿™äº›å¯¹è±¡**ã€‚å¦‚ IDE ä¸­ä»£ç æç¤º
- å¯ä»¥**è§£è€¦ï¼Œæé«˜ç¨‹åºçš„å¯æ‰©å±•æ€§**

### åå°„ç›¸å…³çš„ä¸»è¦ API

- `java.lang.Class`:ä»£è¡¨ä¸€ä¸ªç±»
- `java.lang.reflect.Field`:ä»£è¡¨ç±»çš„æˆå‘˜å˜é‡
- `java.lang.reflect.Constructor`:ä»£è¡¨ç±»çš„æ„é€ å™¨
- `java.lang.reflect.Method`:ä»£è¡¨ç±»çš„æ–¹æ³•

## ClassLoader ç±»åŠ è½½å™¨

### åˆ†ç±» ğŸ”¥

**ç±»åŠ è½½å™¨**ï¼ˆè´Ÿè´£å°†`.class`æ–‡ä»¶**åŠ è½½åˆ°å†…å­˜ä¸­**ï¼Œå¹¶ä¸ºä¹‹**ç”Ÿæˆ**å¯¹åº”çš„`Class`**å¯¹è±¡**ï¼‰

- Bootstrap ClassLoaderï¼š**å¼•å¯¼ç±»åŠ è½½å™¨**

  è´Ÿè´£ JDK ä¸­`jre/lib`ç›®å½•ä¸‹`rt.jar`æ–‡ä»¶ä¸­**Java æ ¸å¿ƒç±»çš„åŠ è½½**ï¼Œæ¯”å¦‚ Systemã€String ç­‰

- Extension ClassLoaderï¼š**æ‰©å±•ç±»åŠ è½½å™¨**

  è´Ÿè´£ JDK ä¸­`jre/lib/ext`ç›®å½•ä¸‹æˆ–`-D java.ext.dirs`æŒ‡å®šç›®å½•ä¸‹**jar åŒ…**çš„åŠ è½½

- System(Application) ClassLoaderï¼š**ç³»ç»Ÿç±»åŠ è½½å™¨**

  JVM å¯åŠ¨æ—¶ï¼Œè´Ÿè´£`java -classpath`æˆ–`-D java.class.path`æ‰€æŒ‡ç›®å½•ä¸‹çš„ç±»ä¸ jar åŒ…çš„åŠ è½½

  ![image-20191103231822517](../images/image-20191103231822517.png)

### å¸¸ç”¨æ–¹æ³•

- `clazz.getClassLoader()`

  **è·å¾—ç±»åŠ è½½å™¨**

- `classLoader.getParent()`

  è·å–ç±»åŠ è½½å™¨çš„ç±»åŠ è½½å™¨

  ```java
  // å¦‚ä¸‹åœ¨ OpenJDK11 æµ‹è¯•
  ClassLoader classLoader1 = ReflectTest.class.getClassLoader();
  System.out.println(classLoader1);// jdk.internal.loader.ClassLoaders$AppClassLoader@2c13da15

  ClassLoader classLoader2 = classLoader1.getParent();
  System.out.println(classLoader2);// jdk.internal.loader.ClassLoaders$PlatformClassLoader@2d209079

  ClassLoader classLoader3 = classLoader2.getParent();
  System.out.println(classLoader3);// nullï¼ŒBootstrap ClassLoader æ— æ³•è·å–åˆ°

  // åœ¨ OpenJDK8 ä¸­æµ‹è¯•å¦‚ä¸‹
  // sun.misc.Launcher$AppClassLoader@18b4aac2
  // sun.misc.Launcher$ExtClassLoader@6d6f6e28
  // null
  ```

- `classLoader.getResource(name)`

  ```java
  URL url = clazz.getResource("test.txt")ï¼›
  String path = url.getPath();
  ```

- `InputStream classLoader.getResourceAsStream`å°±æ˜¯ä¸Šé¢çš„è¿›è¡Œäº†å°è£…ç®€åŒ–åçš„ç‰ˆæœ¬

::: tip

è¯»å–é…ç½®æ–‡ä»¶æ–¹å¼ï¼š

- IDEA ä¸­`@Test` **ç›¸å¯¹äº Module**ï¼Œè‹¥æ˜¯ `main` æ–¹æ³•åˆ™**ç›¸å¯¹äº Project**
- ClassLoader çš„ getResource æˆ– getResourceAsStream æ–¹æ³•è·å–ç›¸å¯¹ classesï¼ˆout æˆ– srcï¼‰ä¸‹çš„ä»»ä½• URL èµ„æºï¼Œä¸èƒ½ä»¥`/`å¼€å¤´

:::

## ç±»çš„åŠ è½½è¿‡ç¨‹ ğŸ”¥

å½“ç¨‹åºè¦ä½¿ç”¨æŸä¸ªç±»æ—¶ï¼Œå¦‚æœè¯¥ç±»è¿˜æœªè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œåˆ™ç³»ç»Ÿä¼šé€šè¿‡åŠ è½½ï¼Œè¿æ¥ï¼Œåˆå§‹åŒ–ä¸‰æ­¥æ¥å®ç°å¯¹è¿™ä¸ªç±»è¿›è¡Œåˆå§‹åŒ–

### åŠ è½½

- å°†`.class`æ–‡ä»¶å­—èŠ‚ç å†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶å°†è¿™äº›é™æ€æ•°æ®è½¬æ¢æˆ**æ–¹æ³•åŒº**çš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„`java.lang.Class`å¯¹è±¡ï¼Œä½œä¸º**æ–¹æ³•åŒº**ä¸­ç±»æ•°æ®çš„è®¿é—®å…¥å£ï¼ˆå³å¼•ç”¨åœ°å€ï¼‰ã€‚æ‰€æœ‰éœ€è¦è®¿é—®å’Œä½¿ç”¨ç±»æ•°æ®åªèƒ½é€šè¿‡è¿™ä¸ª`Class`å¯¹è±¡ã€‚è¿™ä¸ªåŠ è½½çš„è¿‡ç¨‹éœ€è¦ç±»åŠ è½½å™¨å‚ä¸ã€‚
- ç±»ç¼“å­˜ï¼šæ ‡å‡†çš„ JavaSE ç±»åŠ è½½å™¨å¯ä»¥æŒ‰è¦æ±‚æŸ¥æ‰¾ç±»ï¼Œä½†ä¸€æ—¦æŸä¸ªç±»è¢«åŠ è½½åˆ°ç±»åŠ è½½å™¨ä¸­ï¼Œå®ƒå°†ç»´æŒåŠ è½½(ç¼“å­˜)ä¸€æ®µæ—¶é—´ã€‚ä¸è¿‡ JVM åƒåœ¾å›æ”¶æœºåˆ¶å¯ä»¥å›æ”¶è¿™äº› Class å¯¹è±¡ã€‚

### è¿æ¥

å°† Java ç±»çš„äºŒè¿›åˆ¶ä»£ç åˆå¹¶åˆ° JVM çš„è¿è¡ŒçŠ¶æ€ä¹‹ä¸­çš„è¿‡ç¨‹

- éªŒè¯ï¼šç¡®ä¿åŠ è½½çš„ç±»ä¿¡æ¯ç¬¦åˆ JVM è§„èŒƒï¼Œä¾‹å¦‚ä»¥ cafe å¼€å¤´ï¼Œæ²¡æœ‰å®‰å…¨æ–¹é¢çš„é—®é¢˜
- å‡†å¤‡ï¼šæ­£å¼ä¸ºç±»å˜é‡(static)åˆ†é…å†…å­˜å¹¶è®¾ç½®**ç±»å˜é‡é»˜è®¤åˆå§‹å€¼**çš„é˜¶æ®µï¼Œè¿™äº›å†…å­˜ éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œåˆ†é…ã€‚
- è§£æï¼šè™šæ‹Ÿæœºå¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨(å¸¸é‡å)æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨(åœ°å€)çš„è¿‡ç¨‹

### åˆå§‹åŒ–

- æ‰§è¡Œ**ç±»æ„é€ å™¨**`<clinit>()`æ–¹æ³•çš„è¿‡ç¨‹ã€‚**ç±»æ„é€ å™¨`<clinit>()`æ–¹æ³•æ˜¯ç”±ç¼–è¯‘æœŸè‡ªåŠ¨æ”¶é›†ç±»ä¸­æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€ä»£ç å—ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„**ã€‚(ç±»æ„é€ å™¨æ˜¯æ„é€ ç±»ä¿¡æ¯çš„ï¼Œä¸æ˜¯æ„é€ è¯¥ç±»å¯¹è±¡çš„æ„é€ å™¨)ã€‚
- å½“åˆå§‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»è¿˜æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚
- è™šæ‹Ÿæœºä¼šä¿è¯ä¸€ä¸ªç±»çš„`<clinit>()`æ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è¢«æ­£ç¡®åŠ é”å’ŒåŒæ­¥ã€‚

* **ç±»åˆå§‹åŒ–æ—¶æœº**

  - ç±»çš„ä¸»åŠ¨å¼•ç”¨ï¼ˆä¸€å®šä¼šå‘ç”Ÿç±»çš„åˆå§‹åŒ–ï¼‰
    - ç›´æ¥ä½¿ç”¨ java.exe å‘½ä»¤æ¥è¿è¡ŒæŸä¸ªä¸»ç±»ï¼Œå½“è™šæ‹Ÿæœºå¯åŠ¨ï¼Œå…ˆåˆå§‹åŒ–`main`æ–¹æ³•æ‰€åœ¨çš„ç±»
    - new ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼ˆåˆ›å»ºç±»çš„å®ä¾‹ï¼‰
    - è°ƒç”¨ç±»çš„é™æ€æˆå‘˜ï¼ˆé™¤äº† final å¸¸é‡ï¼‰ï¼Œæˆ–è€…ä¸ºé™æ€å˜é‡èµ‹å€¼
    - è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•
    - ä½¿ç”¨`java.lang.reflect`åŒ…çš„æ–¹æ³•æ¥å¼ºåˆ¶åˆ›å»ºæŸä¸ªç±»æˆ–æ¥å£å¯¹åº”çš„`java.lang.Class`å¯¹è±¡
    - å½“åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œå¦‚æœå…¶çˆ¶ç±»æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆ™å…ˆä¼šåˆå§‹åŒ–å®ƒçš„çˆ¶ç±»
  - ç±»çš„è¢«åŠ¨å¼•ç”¨ï¼ˆä¸ä¼šå‘ç”Ÿç±»çš„åˆå§‹åŒ–ï¼‰
    - å½“è®¿é—®ä¸€ä¸ªé™æ€åŸŸæ—¶ï¼Œ**åªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªåŸŸçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ–**
      å½“é€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œä¸ä¼šå¯¼è‡´å­ç±»åˆå§‹åŒ–
    - é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘æ­¤ç±»çš„åˆå§‹åŒ–
    - å¼•ç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»çš„åˆå§‹åŒ–ï¼ˆå¸¸é‡åœ¨é“¾æ¥é˜¶æ®µå°±å­˜å…¥è°ƒç”¨ç±»çš„å¸¸é‡æ± ä¸­äº†ï¼‰

## Class ğŸ”¥

### è·å–å­—èŠ‚ç æ–‡ä»¶çš„`Class`å¯¹è±¡ ğŸ”¥

- `Calss<Student> c = Student.class`é€šè¿‡**ç±»å**å¾—åˆ°ã€‚å¤šç”¨äºå‚æ•°ä¼ é€’
- `Class<Student> c = stu.getClass()`é€šè¿‡**å¯¹è±¡**å¾—åˆ°ï¼ŒObject ç±»ä¸­çš„æ–¹æ³•ã€‚å¤šç”¨äºå¯¹è±¡è·å–å­—èŠ‚ç 
- `Class<Student> c = Class.forName(String name)`ï¼šåŒ…æ‹¬åŒ…åçš„å…¨ç±»åã€‚å¤šç”¨äºé…ç½®æ–‡ä»¶
  - `String getName();`è·å–å…¨ç±»å
  - `String getPackageName();`è·å–åŒ…å
- `Class<Student> c = clazz.getClassLoader().loadClass(String name)` ç±»åŠ è½½å™¨

**åŒä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶`*.class`åœ¨ä¸€æ¬¡ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­åªä¼šè¢«åŠ è½½ä¸€æ¬¡ï¼Œä»¥ä¸Šæ–¹å¼è·å–çš„`Class`å¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªã€‚**

### å“ªäº›ç±»å‹å¯ä»¥æœ‰ `Class` å¯¹è±¡ ğŸ”¥

- classï¼šå¤–éƒ¨ç±»ï¼Œæˆå‘˜ï¼ˆæˆå‘˜å†…éƒ¨ç±»ï¼Œé™æ€å†…éƒ¨ç±»ï¼‰ï¼Œå±€éƒ¨å†…éƒ¨ç±»ï¼ŒåŒ¿åå†…éƒ¨ç±»ï¼Œå¦‚`Object.class`
- interfaceï¼šæ¥å£ï¼Œå¦‚`Comparable.class`
- Arrayï¼šæ•°ç»„ï¼Œå¦‚`int[][].class`ã€‚ğŸ”¥
- Enumï¼šæšä¸¾ï¼Œå¦‚`ElementType.class`
- Annotationï¼šæ³¨è§£@interfaceï¼Œå¦‚`Override.class`
- primitive typeï¼šåŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¦‚`int.class`
- voidï¼šå¦‚`void.class`
- Classï¼šå¦‚`Class.class`æœ¬èº«

- **æ³›å‹çš„ Class å¯¹è±¡æ˜¯ä»€ä¹ˆï¼Ÿ** ğŸ”¥

  é¦–å…ˆè¦æ˜ç¡®æ³›å‹ä»…å­˜åœ¨äºç¼–è¯‘æ—¶æœŸï¼Œåå°„å­˜åœ¨äºè¿è¡Œæ—¶æœŸï¼Œåœ¨**è¿è¡Œæ—¶æ³›å‹å·²ç»è¢«è½¬ä¸º Object æˆ–å…¶ä»–çš„ç±»å‹**

  è‹¥å‚æ•°ä¸ºï¼š

  ```java
  public static <E extends Comparable<E>> void sort(E[] arr)
  ```

  åˆ™æœ€ç»ˆè½¬ä¸º`Comparable[].class`ç±»å‹

  è‹¥å‚æ•°ä¸ºï¼š

  ```java
  public static <E> void sort(E[] arr, Comparator<E> comparator)
  ```

  åˆ™æœ€ç»ˆè½¬ä¸º`Object[].class`å’Œ`Comparator.class`ç±»å‹ï¼ˆè¿™é‡Œæ˜¯ä¿©å‚æ•°ï¼‰

- çœ‹ä¸‹é¢ä»£ç ã€‚ç»“è®ºï¼šåªè¦æ•°ç»„çš„**å…ƒç´ ç±»å‹**å’Œ**çº¬åº¦**ä¸€æ ·ï¼Œå°±æ˜¯åŒä¸€ä¸ª Class

  ```java
  int[] a = new int[10];
  int[] b = new int[100];

  System.out.println(a.getClass());// class [I
  System.out.println(b.getClass());// class [I

  System.out.println(a.getClass() == b.getClass());// true
  System.out.println(a.getClass() == int[].class);// true
  ```

### åˆ†æç±»ï¼š**åŸŸ(æˆå‘˜å˜é‡)**ã€**æ„é€ å™¨**ã€æ–¹æ³• ğŸ”¥

- **ä¸å¸¦ Declare**è¿”å›ç±»æä¾›çš„**public**åŸŸã€æ–¹æ³•å’Œæ„é€ å™¨çš„**æ•°ç»„**ï¼ŒåŒ…æ‹¬**è¶…ç±»çš„å…¬æœ‰æˆå‘˜**

- **å¸¦ Declare**è¿”å›ç±»æä¾›çš„**å…¨éƒ¨**åŸŸã€æ–¹æ³•å’Œæ„é€ å™¨ï¼Œ**åŒ…æ‹¬ç§æœ‰å’Œä¿æŠ¤æˆå‘˜**ï¼Œä½†ä¸åŒ…æ‹¬è¶…ç±»çš„æˆå‘˜ã€‚

- æ“ä½œç§æœ‰æˆå‘˜æ—¶`setAccessible(flag)`ä¸­è®¾ç½®ä¸º true

  ```java
  //è‹¥ç±»ä¸­æ²¡æœ‰åŸŸ(æˆå‘˜å˜é‡)æˆ–è€…Classå¯¹è±¡æè¿°çš„æ˜¯åŸºæœ¬ç±»å‹æˆ–æ•°ç»„ç±»å‹ï¼Œåˆ™è¿”å›ä¸€ä¸ªé•¿åº¦ä¸º0çš„æ•°ç»„
  Field get(Declare)Field(String name)
  Field[] get(Declare)Fields()

  Method get(Declare)Method(String name, Class<?>... parameterTypes)
  Method[] get(Declare)Methods()

  //ä½¿ç”¨Classå¯¹è±¡çš„newInstance()æ¥åˆ›å»ºï¼ä½†è¯¥ç±»å¿…é¡»æä¾›ç©ºå‚æ„é€ å™¨ï¼Œä¸”æƒé™å¿…é¡»å¤Ÿï¼Œé€šå¸¸ä¸º publicã€‚Java9 åŠä¹‹åè¿‡æ—¶
  Person o = clazz.getInstance();
  //å¯ä»¥é€šè¿‡Constructorå¯¹è±¡çš„newInstance(å¯ä¼ é€’å‚æ•°åˆ—è¡¨)æ¥åˆ›å»ºå¯¹è±¡ï¼›
  Constructor<T> get(Declare)Construcotr(Class<?>... parameterTypes)//è¿”å›ä¸€ä¸ªæ„é€ å™¨
  Constructor[] get(Declare)Construcotrs()
  //ä»¥ä¸Šå…¶åº•å±‚éƒ½æ˜¯è°ƒç”¨æ„é€ å™¨æ¥åˆ›å»ºå¯¹è±¡

  setAccessible(boolean b)//ä¸ºä»¥ä¸Šä¸‰ç§åå°„å¯¹è±¡è®¾ç½®å¯è®¿é—®æ ‡å¿—ï¼Œtrueä¸ºå±è”½javaè¯­è¨€è®¿é—®æ£€æŸ¥


  // ============================================
  // å•ä¸ªæ„é€ ,æ— å‚æ„é€ å¯ä¸å¸¦.class;ä¼ é€’å‚æ•°ç±»å‹
  Constructor<Person> con = clazz.getConstructor(String.class, int.class, String.class);
  Person obj = con.newInstance("zhangsan", 33, "beijing");
  //Object o = c.newInstance();//è‹¥è°ƒç”¨ç©ºå‚æ„é€ å¯ä»¥ç›´æ¥ä½¿ç”¨Classç±»çš„newInstance()æ–¹æ³•ã€‚åœ¨Java9å¼€å§‹å¼ƒç”¨
  String name = con.getName();//è·å–æ„é€ æ–¹æ³•åç§°

  // å•ä¸ªåŸŸã€å±æ€§
  Field field = clazz.getDeclaredField("name");
  field.setAccessible(true);
  field.set(obj, "lisi");//set
  Object objField = field.get(obj);//get
  String name = field.getName();//è·å–åŸŸåå³æˆå‘˜å˜é‡å
  System.out.println(objField);

  // å•ä¸ªæ–¹æ³•,ä¸å¸¦å‚å¯ä¸å†™.class;ä¼ é€’å‚æ•°ç±»å‹
  Method method = clazz.getDeclaredMethod("add", int.class, int.class);
  Object objMethod = method.invoke(obj, 10, 20);
  //æ“ä½œé™æ€æ–¹æ³•æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºnullï¼Œä¸éœ€è¦å®ä¾‹
  Object objMethod = method.invoke(null, 10, 20);
  //è·å–æ–¹æ³•å
  String name = method.getName();
  System.out.println(objMethod);
  ```

### è·å–è¿è¡Œæ—¶ç±»çš„æŒ‡å®šç»“æ„ ğŸ”¥

#### è°ƒç”¨æŒ‡å®šæ–¹æ³•

é€šè¿‡åå°„ï¼Œè°ƒç”¨ç±»ä¸­çš„æ–¹æ³•ï¼Œé€šè¿‡ Method ç±»å®Œæˆã€‚æ­¥éª¤:

1.  é€šè¿‡`Class`ç±»çš„`getMethod(String name,Class...parameterTypes)`æ–¹æ³•å–å¾— ä¸€ä¸ª`Method`å¯¹è±¡ï¼Œå¹¶è®¾ç½®æ­¤æ–¹æ³•æ“ä½œæ—¶æ‰€éœ€è¦çš„å‚æ•°ç±»å‹ã€‚
2.  ä¹‹åä½¿ç”¨`Object invoke(Object obj, Object[] args)`è¿›è¡Œè°ƒç”¨ï¼Œå¹¶å‘æ–¹æ³•ä¸­ä¼ é€’è¦è®¾ç½®çš„ obj å¯¹è±¡çš„å‚æ•°ä¿¡æ¯ã€‚

`Object invoke(Object obj, Object ... args)`

- `Object` å¯¹åº”åŸæ–¹æ³•çš„è¿”å›å€¼ï¼Œè‹¥åŸæ–¹æ³•æ— è¿”å›å€¼ï¼Œæ­¤æ—¶è¿”å›`null`
- è‹¥åŸæ–¹æ³•è‹¥ä¸ºé™æ€æ–¹æ³•ï¼Œæ­¤æ—¶å½¢å‚`Object obj`å¯ä¸º`null`ï¼Œå³ä¸éœ€è¦å®ä¾‹å¯¹è±¡
- è‹¥åŸæ–¹æ³•å½¢å‚åˆ—è¡¨ä¸ºç©ºï¼Œåˆ™`Object[] args`ä¸º`null`
- è‹¥åŸæ–¹æ³•å£°æ˜ä¸º`private`ï¼Œåˆ™éœ€è¦åœ¨è°ƒç”¨æ­¤`invoke()`æ–¹æ³•å‰ï¼Œæ˜¾å¼è°ƒç”¨æ–¹æ³•å¯¹è±¡çš„`setAccessible(true)`æ–¹æ³•ï¼Œå°†å¯è®¿é—®`private`çš„æ–¹æ³•ã€‚

#### è°ƒç”¨æŒ‡å®šå±æ€§

åœ¨åå°„æœºåˆ¶ä¸­ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ Field ç±»æ“ä½œç±»ä¸­çš„å±æ€§ï¼Œé€šè¿‡ Field ç±»æä¾›çš„ set()å’Œ get()æ–¹æ³•å°±å¯ä»¥å®Œæˆè®¾ç½®å’Œå–å¾—å±æ€§å†…å®¹çš„æ“ä½œã€‚

- `public Field getField(String name)`

  è¿”å›æ­¤`Class`å¯¹è±¡è¡¨ç¤ºçš„ç±»æˆ–æ¥å£çš„æŒ‡å®šçš„`public`çš„`Field`ã€‚

- `public Field getDeclaredField(String name)`

  è¿”å›æ­¤`Class`å¯¹è±¡è¡¨ç¤ºçš„ç±»æˆ–æ¥å£çš„æŒ‡å®šçš„`Field`ã€‚

- åœ¨ Field ä¸­ï¼š

  - `public Object get(Object obj)` å–å¾—æŒ‡å®šå¯¹è±¡`obj`ä¸Šæ­¤`Field`çš„å±æ€§å†…å®¹
  - `public void set(Object obj,Object value)` è®¾ç½®æŒ‡å®šå¯¹è±¡`obj`ä¸Šæ­¤`Field`çš„å±æ€§å†…å®¹

#### å…³äº setAccessible æ–¹æ³•çš„ä½¿ç”¨

- `Method`å’Œ`Field`ã€`Constructor`å¯¹è±¡éƒ½æœ‰`setAccessible()`æ–¹æ³•ã€‚
- `setAccessible`å¯åŠ¨å’Œç¦ç”¨è®¿é—®å®‰å…¨æ£€æŸ¥çš„å¼€å…³ã€‚
- å‚æ•°å€¼ä¸º`true`åˆ™æŒ‡ç¤ºåå°„çš„å¯¹è±¡åœ¨ä½¿ç”¨æ—¶åº”è¯¥å–æ¶ˆ Java è¯­è¨€è®¿é—®æ£€æŸ¥ã€‚
  - æé«˜åå°„çš„æ•ˆç‡ã€‚å¦‚æœä»£ç ä¸­å¿…é¡»ç”¨åå°„ï¼Œè€Œè¯¥å¥ä»£ç éœ€è¦é¢‘ç¹çš„è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆè¯·è®¾ç½®ä¸º trueã€‚
  - ä½¿å¾—åŸæœ¬æ— æ³•è®¿é—®çš„ç§æœ‰æˆå‘˜ä¹Ÿå¯ä»¥è®¿é—®
- å‚æ•°å€¼ä¸º`false`åˆ™æŒ‡ç¤ºåå°„çš„å¯¹è±¡åº”è¯¥å®æ–½ Java è¯­è¨€è®¿é—®æ£€æŸ¥ã€‚

### å‡†å¤‡çš„ç±»

```java
public class Creature<T> implements Serializable {
    private char gender;
    public double weight;

    private void breath() {
        System.out.println("ç”Ÿç‰©å‘¼å¸");
    }

    public void eat() {
        System.out.println("ç”Ÿç‰©åƒä¸œè¥¿");
    }
}
```

```java
@Target({TYPE, FIELD, METHOD, PARAMETER, CONSTRUCTOR, LOCAL_VARIABLE})
@Retention(RetentionPolicy.RUNTIME)
public @interface MyAnnotation {
    String value() default "hello";

}
```

```java
public interface MyInterface {
    void info();
}
```

```java
@MyAnnotation(value = "hi")
public class Person extends Creature<String> implements Comparable<String>, MyInterface {

    private String name;
    int age;
    public int id;

    public Person() {
    }

    Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    @MyAnnotation(value = "abc")
    private Person(String name) {
        this.name = name;
    }

    @MyAnnotation
    private String show(String nation) {
        System.out.println("æˆ‘çš„å›½ç±æ˜¯ï¼š" + nation);
        return nation;
    }

    public String display(String interests, int age) throws NullPointerException, ClassCastException {
        return interests + age;
    }

    @Override
    public void info() {
        System.out.println("æˆ‘æ˜¯ä¸€ä¸ªäºº");
    }

    @Override
    public int compareTo(String o) {
        return 0;
    }

    private static void showDesc() {
        System.out.println("æˆ‘æ˜¯ä¸€ä¸ªå¯çˆ±çš„äºº");
    }

    @Override
    public String toString() {
        return "Person{" +
                "name='" + name + '\'' +
                ", age=" + age +
                ", id=" + id +
                '}';
    }
}
```

### Field

```java
public class FieldTest {

    /**
     * è·å– Field
     */
    @Test
    public void test1(){

        Class<Person> clazz = Person.class;

        // getFields():è·å–å½“å‰è¿è¡Œæ—¶ç±»åŠå…¶çˆ¶ç±»ä¸­å£°æ˜ä¸ºpublicè®¿é—®æƒé™çš„å±æ€§
        Field[] fields = clazz.getFields();
        System.out.println(Arrays.toString(fields));
        // [public int pojo.Person.id, public double pojo.Creature.weight]

        // getDeclaredFields():è·å–å½“å‰è¿è¡Œæ—¶ç±»ä¸­å£°æ˜çš„æ‰€æœ‰å±æ€§ã€‚ï¼ˆä¸åŒ…å«çˆ¶ç±»ä¸­å£°æ˜çš„å±æ€§ï¼‰
        Field[] declaredFields = clazz.getDeclaredFields();
        System.out.println(Arrays.toString(declaredFields));
        // [private java.lang.String pojo.Person.name, int pojo.Person.age, protected java.lang.String pojo.Person.sex, public int pojo.Person.id]

    }

    /**
     * æƒé™ä¿®é¥°ç¬¦  æ•°æ®ç±»å‹ å˜é‡å
     */
    @Test
    public void test2(){
        Class<Person> clazz = Person.class;

        Field[] declaredFields = clazz.getDeclaredFields();
        for(Field f : declaredFields){

            //1.æƒé™ä¿®é¥°ç¬¦
            int modifier = f.getModifiers();// å¯åœ¨ Modifier ç±»ä¸­æ‰¾åˆ° int å¯¹åº”çš„æƒé™ä¿®é¥°ç¬¦
            System.out.print(Modifier.toString(modifier) + "\t");// è¿™æ ·ä¹Ÿå¯ä»¥è·å–æƒé™ä¿®é¥°ç¬¦åç§°

            //2.æ•°æ®ç±»å‹
            Class<?> type = f.getType();
            System.out.print(type.getName() + "\t");

            //3.å˜é‡å
            String fName = f.getName();
            System.out.print(fName);
            System.out.println();
        }
        // private      java.lang.String	name
        //              int	age
        // protected    java.lang.String	sex
        // public       int                 id
    }


    /**
     * æ“ä½œ
     */
    @Test
    public void test3() throws Exception {
        Class<Person> clazz = Person.class;

        Constructor<Person> personConstructor = clazz.getDeclaredConstructor(String.class, int.class);
        personConstructor.setAccessible(true);
        Person person = personConstructor.newInstance("conanan", 22);

        Field nameField = clazz.getDeclaredField("name");
        nameField.setAccessible(true);
        String name = (String) nameField.get(person);
        System.out.println(name);// conanan

        nameField.set(person, "conan");
        name = (String) nameField.get(person);
        System.out.println(name);// conan
    }
}
```

### Method

```java
public class MethodTest {

    /**
     * è·å–æ–¹æ³•
     */
    @Test
    public void test1() {

        Class<Person> clazz = Person.class;

        // getMethods():è·å–å½“å‰è¿è¡Œæ—¶ç±»åŠå…¶æ‰€æœ‰çˆ¶ç±»ä¸­å£°æ˜ä¸ºpublicæƒé™çš„æ–¹æ³•
        Method[] methods = clazz.getMethods();
        System.out.println(Arrays.toString(methods));

        // getDeclaredMethods():è·å–å½“å‰è¿è¡Œæ—¶ç±»ä¸­å£°æ˜çš„æ‰€æœ‰æ–¹æ³•ã€‚ï¼ˆä¸åŒ…å«çˆ¶ç±»ä¸­å£°æ˜çš„æ–¹æ³•ï¼‰
        Method[] declaredMethods = clazz.getDeclaredMethods();
        System.out.println(Arrays.toString(declaredMethods));

    }


    /**
     * @Xxxx æƒé™ä¿®é¥°ç¬¦  è¿”å›å€¼ç±»å‹  æ–¹æ³•å(å‚æ•°ç±»å‹1 å½¢å‚å1,...) throws XxxException{}
     */
    @Test
    public void test2() {
        Class<Person> clazz = Person.class;
        Method[] declaredMethods = clazz.getDeclaredMethods();
        for (Method m : declaredMethods) {
            //1.è·å–æ–¹æ³•å£°æ˜çš„æ³¨è§£
            Annotation[] annos = m.getAnnotations();
            Arrays.stream(annos).forEach(System.out::println);

            //2.æƒé™ä¿®é¥°ç¬¦
            System.out.print(Modifier.toString(m.getModifiers()) + "\t");

            //3.è¿”å›å€¼ç±»å‹
            System.out.print(m.getReturnType().getName() + "\t");

            //4.æ–¹æ³•å
            System.out.print(m.getName());
            System.out.print("(");

            //5.å½¢å‚åˆ—è¡¨
            Class<?>[] parameterTypes = m.getParameterTypes();
            if (parameterTypes.length > 0){
                for (int i = 0; i < parameterTypes.length; i++) {

                    if (i == parameterTypes.length - 1) {
                        System.out.print(parameterTypes[i].getName() + " args_" + i);
                        break;
                    }

                    System.out.print(parameterTypes[i].getName() + " args_" + i + ", ");
                }
            }
            System.out.print(")");

            //6.æŠ›å‡ºçš„å¼‚å¸¸
            Class<?>[] exceptionTypes = m.getExceptionTypes();
            if (exceptionTypes.length > 0) {
                System.out.print("throws ");
                for (int i = 0; i < exceptionTypes.length; i++) {
                    if (i == exceptionTypes.length - 1) {
                        System.out.print(exceptionTypes[i].getName());
                        break;
                    }
                    System.out.print(exceptionTypes[i].getName() + ", ");
                }
            }
            System.out.println();
        }
    }


    /**
     * æ“ä½œ
     */
    @Test
    public void test3() throws Exception {
        Class<Person> clazz = Person.class;
        Constructor<Person> personConstructor = clazz.getDeclaredConstructor(String.class, int.class);
        personConstructor.setAccessible(true);
        Person person = personConstructor.newInstance("conanan", 22);

        // private æ–¹æ³•
        // æ³›å‹ å’Œ æ•°ç»„ å‚æ•°æ³¨æ„æ€ä¹ˆå†™ï¼
        Method show = clazz.getDeclaredMethod("show", String.class);
        show.setAccessible(true);
        String  returnValue = (String) show.invoke(person, "ä¸­å›½");
        System.out.println(returnValue);// ä¸­å›½


        // é™æ€æ–¹æ³•
        Method showDesc = clazz.getDeclaredMethod("showDesc");
        showDesc.setAccessible(true);
        showDesc.invoke(person);// æˆ‘æ˜¯ä¸€ä¸ªå¯çˆ±çš„äºº
        // æ“ä½œé™æ€æ–¹æ³•æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºnullï¼Œä¸éœ€è¦å®ä¾‹
        showDesc.invoke(null);// æˆ‘æ˜¯ä¸€ä¸ªå¯çˆ±çš„äºº

    }
}
```

### Other

```java
public class OtherTest {

    /**
     * è·å–æ„é€ å™¨ç»“æ„
     */
    @Test
    public void test1() {

        Class<Person> clazz = Person.class;
        // getConstructors():è·å–å½“å‰è¿è¡Œæ—¶ç±»ä¸­å£°æ˜ä¸ºpublicçš„æ„é€ å™¨
        Constructor<?>[] constructors = clazz.getConstructors();
        System.out.println(Arrays.toString(constructors));
        // [public pojo.Person()]

        System.out.println();
        // getDeclaredConstructors():è·å–å½“å‰è¿è¡Œæ—¶ç±»ä¸­å£°æ˜çš„æ‰€æœ‰çš„æ„é€ å™¨
        Constructor<?>[] declaredConstructors = clazz.getDeclaredConstructors();
        System.out.println(Arrays.toString(declaredConstructors));
        // [private pojo.Person(java.lang.String), pojo.Person(java.lang.String,int), public pojo.Person()]
    }

    /**
     * è·å–è¿è¡Œæ—¶ç±»çš„çˆ¶ç±»
     */
    @Test
    public void test2() {
        Class<Person> clazz = Person.class;

        Class<? super Person> superclass = clazz.getSuperclass();
        System.out.println(superclass);
        // class pojo.Creature
    }

    /**
     * è·å–è¿è¡Œæ—¶ç±»çš„å¸¦æ³›å‹çš„çˆ¶ç±»
     */
    @Test
    public void test3() {
        Class<Person> clazz = Person.class;

        Type genericSuperclass = clazz.getGenericSuperclass();
        System.out.println(genericSuperclass);
        // pojo.Creature<java.lang.String>
    }

    /**
     * è·å–è¿è¡Œæ—¶ç±»çš„å¸¦æ³›å‹çš„çˆ¶ç±»çš„æ³›å‹
     * ä»£ç ï¼šé€»è¾‘æ€§ä»£ç   vs åŠŸèƒ½æ€§ä»£ç 
     */
    @Test
    public void test4() {
        Class<Person> clazz = Person.class;

        Type genericSuperclass = clazz.getGenericSuperclass();
        ParameterizedType paramType = (ParameterizedType) genericSuperclass;
        //è·å–æ³›å‹ç±»å‹
        Type[] actualTypeArguments = paramType.getActualTypeArguments();
        //System.out.println(actualTypeArguments[0].getTypeName());
        System.out.println(((Class) actualTypeArguments[0]).getName());
        // java.lang.String
    }

    /**
     * è·å–è¿è¡Œæ—¶ç±»å®ç°çš„æ¥å£
     */
    @Test
    public void test5() {
        Class<Person> clazz = Person.class;

        Class<?>[] interfaces = clazz.getInterfaces();
        Arrays.stream(interfaces).forEach(System.out::println);
        // interface java.lang.Comparable
        // interface pojo.MyInterface
        System.out.println();


        // è·å–è¿è¡Œæ—¶ç±»çš„çˆ¶ç±»å®ç°çš„æ¥å£
        Class<?>[] interfaces1 = clazz.getSuperclass().getInterfaces();
        Arrays.stream(interfaces1).forEach(System.out::println);
        // interface java.io.Serializable

    }

    /*
     è·å–è¿è¡Œæ—¶ç±»æ‰€åœ¨çš„åŒ…
      */
    @Test
    public void test6() {
        Class<Person> clazz = Person.class;

        Package pack = clazz.getPackage();
        System.out.println(pack);
        // package pojo
    }

    /*
      è·å–è¿è¡Œæ—¶ç±»å£°æ˜çš„æ³¨è§£
     */
    @Test
    public void test7() {
        Class<Person> clazz = Person.class;

        Annotation[] annotations = clazz.getAnnotations();
        Arrays.stream(annotations).forEach(System.out::println);
        // @pojo.MyAnnotation(value=hi)
    }

}
```

### æ–‡å­—ç‰ˆ

#### è·å–ç±»å®ç°çš„å…¨éƒ¨æ¥å£

- `public Class<?>[] getInterfaces()`

  ç¡®å®šæ­¤å¯¹è±¡æ‰€è¡¨ç¤ºçš„ç±»æˆ–æ¥å£å®ç°çš„æ¥å£ã€‚

#### è·å–ç±»æ‰€ç»§æ‰¿çš„çˆ¶ç±»

- `public Class<? Super T> getSuperclass()`

  è¿”å›è¡¨ç¤ºæ­¤ Class æ‰€è¡¨ç¤ºçš„å®ä½“(ç±»ã€æ¥å£ã€åŸºæœ¬ç±»å‹)çš„çˆ¶ç±»çš„ Classã€‚

#### è·å–ç±»å…¨éƒ¨çš„æ„é€ å™¨

- `public Constructor<T>[] getConstructors()`

  è¿”å›æ­¤ Class å¯¹è±¡æ‰€è¡¨ç¤ºçš„ç±»çš„æ‰€æœ‰ public æ„é€ æ–¹æ³•ã€‚

- `public Constructor<T>[] getDeclaredConstructors()`

  è¿”å›æ­¤ Class å¯¹è±¡è¡¨ç¤ºçš„ç±»å£°æ˜çš„æ‰€æœ‰æ„é€ æ–¹æ³•ã€‚

- Constructor ç±»ä¸­ï¼š

  - å–å¾—ä¿®é¥°ç¬¦ï¼š`public int getModifiers()`
  - å–å¾—æ–¹æ³•åç§°ï¼š`public String getName()`
  - å–å¾—å‚æ•°çš„ç±»å‹ï¼š`public Class<?>[] getParameterTypes()`

- å…¨éƒ¨çš„æ–¹æ³•

  - `public Method[] getMethods()`

    è¿”å›æ­¤ Class å¯¹è±¡æ‰€è¡¨ç¤ºçš„ç±»æˆ–æ¥å£çš„ public çš„æ–¹æ³•

  - `public Method[] getDeclaredMethods()`

    è¿”å›æ­¤ Class å¯¹è±¡æ‰€è¡¨ç¤ºçš„ç±»æˆ–æ¥å£çš„å…¨éƒ¨æ–¹æ³•

  - Method ç±»ä¸­ï¼š

    - `public Class<?> getReturnType()`å–å¾—å…¨éƒ¨çš„è¿”å›å€¼
    - `public Class<?>[] getParameterTypes()`å–å¾—å…¨éƒ¨çš„å‚æ•°
    - `public int getModifiers()`å–å¾—ä¿®é¥°ç¬¦
    - `public Class<?>[] getExceptionTypes()`å–å¾—å¼‚å¸¸ä¿¡æ¯

#### è·å–ç±»å…¨éƒ¨çš„ Field

- `public Field[] getFields()`

  è¿”å›æ­¤ Class å¯¹è±¡æ‰€è¡¨ç¤ºçš„ç±»æˆ–æ¥å£çš„ public çš„ Fieldã€‚

- `public Field[] getDeclaredFields()`

  è¿”å›æ­¤ Class å¯¹è±¡æ‰€è¡¨ç¤ºçš„ç±»æˆ–æ¥å£çš„å…¨éƒ¨ Fieldã€‚

- Field æ–¹æ³•ä¸­ï¼š

  - `public int getModifiers()` ä»¥æ•´æ•°å½¢å¼è¿”å›æ­¤ Field çš„ä¿®é¥°ç¬¦
  - `public Class<?> getType()` å¾—åˆ° Field çš„å±æ€§ç±»å‹
  - `public StringgetName()` è¿”å› Field çš„åç§°ã€‚

#### è·å–ç±» Annotation ç›¸å…³

- `get Annotation(Class<T> annotationClass)`
- `getDeclaredAnnotations()`

#### è·å–ç±» Generic

- è·å–çˆ¶ç±»æ³›å‹ç±»å‹ï¼š`Type getGenericSuperclass()`
- æ³›å‹ç±»å‹ï¼š`ParameterizedType`ï¼Œå¼ºè½¬
- è·å–å®é™…çš„æ³›å‹ç±»å‹å‚æ•°æ•°ç»„ï¼š`getActualTypeArguments()`

#### è·å–ç±»æ‰€åœ¨çš„åŒ…

- `Package getPackage()`

### ä¹ é¢˜

#### é€šè¿‡é…ç½®æ–‡ä»¶è¿è¡Œç±»ä¸­æ–¹æ³•

```java
public class Demo{
	//main
	public static void main(String[] args) throws Exception{
    	//ä¹‹å‰çš„æ–¹æ³•è°ƒç”¨è°çš„æ–¹æ³•åˆ›å»ºè°çš„å¯¹è±¡ï¼Œå±äºç¡¬ç¼–ç 
    	//é€šè¿‡Propertiesé›†åˆæ¥åŠ è½½class.txté…ç½®æ–‡ä»¶
   	 	Properties properties = new Properties();
        ClassLoader classLoader = UserTest.class.getClassLoader();
        InputStream is = classLoader.getResourceAsStream("prop.properties");
        properties.load(is);

    	//è·å–é”®å€¼å¯¹æ•°æ®
        String className = properties.getProperty("className");
        String methodName = properties.getProperty("methodName");

        Class c = Class.forName(className);
        Constructor con = c.getConstructor();
        Object o = con.newInstance();
        Method show = c.getMethod(methodName, String.class);
        show.invoke(o,"ç‰›é€¼");
	}
}
```

#### é€šè¿‡åå°„è¶Šè¿‡æ³›å‹æ£€æŸ¥

- ArrayList`<Integer>`å¯¹è±¡ï¼Œæ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¸²æ•°æ®
- **æ³›å‹æœºåˆ¶æ˜¯ç»™ç¼–è¯‘å™¨çœ‹çš„ï¼Œè¿è¡Œæ—¶æ²¡æœ‰**ã€‚é€šè¿‡çœ‹ add åº•å±‚ä»£ç å‘ç°ä¼ å…¥çš„æ˜¯`<E>`æ˜¯ Object å‹

```java
ArrayList<Integer> arrayList = new ArrayList<>();
arrayList.add(10);

Class c = arrayList.getClass();//è·å–å¯¹è±¡æ‰€å±ç±»çš„å­—èŠ‚ç æ–‡ä»¶å¯¹è±¡
Method method = c.getMethod("add", Object.class);
method.invoke(arrayList, "hello");
```

#### é€šè¿‡åå°„ç»™ä»»æ„çš„ä¸€ä¸ªå¯¹è±¡çš„ä»»æ„çš„å±æ€§èµ‹å€¼ä¸ºæŒ‡å®šçš„å€¼

```java
public void setProperty(Object obj, String propertyName, Object value) throws Exception{
	Class c= obj.getClass();
	Field field = c.getDeclaredField(propertyName);
	field.setAccessible(true);
	field.set(obj, value);
}

public static void main(String[] args) throws Exception {
	Tool t = new Tool();
	Student s = new Student();
	t.setProperty(s, "name", "å¼ ä¸‰");
	t.setProperty(s, "age", 10);
	s.show();
}
```

## ä»£ç†æ¨¡å¼

- **ä»£ç†**ï¼šä½¿ç”¨ä¸€ä¸ªä»£ç†å°†å¯¹è±¡åŒ…è£…èµ·æ¥ï¼Œç„¶åç”¨è¯¥ä»£ç†å¯¹è±¡å–ä»£åŸå§‹å¯¹è±¡ã€‚ä»»ä½•å¯¹åŸå§‹å¯¹è±¡çš„è°ƒç”¨éƒ½è¦é€šè¿‡ä»£ç†ï¼Œä»£ç†å¯¹è±¡å†³å®šæ˜¯å¦ä»¥åŠä½•æ—¶å°†æ–¹æ³•è°ƒç”¨è½¬åˆ°åŸå§‹å¯¹è±¡ä¸Šã€‚
- é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ä¸¤è€…åŒºåˆ«åœ¨äºä»£ç†å¯¹è±¡çš„ç”Ÿæˆæ¨¡å¼

### é™æ€ä»£ç†

ä»£ç†ç±»å’Œç›®æ ‡å¯¹è±¡çš„ç±»ï¼ˆå­—èŠ‚ç æ–‡ä»¶ï¼‰éƒ½æ˜¯åœ¨**ç¼–è¯‘æœŸé—´**ç¡®å®šä¸‹æ¥ï¼Œä¸åˆ©äºç¨‹åºçš„æ‰©å±•ã€‚åŒæ—¶æ¯ä¸€ä¸ªä»£ç†ç±»åªèƒ½ä¸ºä¸€ä¸ªæ¥å£æœåŠ¡ï¼Œè¿™æ ·ä¸€æ¥ç¨‹åºå¼€å‘ä¸­å¿…ç„¶äº§ç”Ÿè¿‡å¤šçš„ä»£ç†ã€‚æœ€å¥½å¯ä»¥é€šè¿‡ä¸€ä¸ªä»£ç†ç±»å®Œæˆå…¨éƒ¨çš„ä»£ç†åŠŸèƒ½ã€‚ **è£…é¥°è€…æ¨¡å¼**å°±æ˜¯é™æ€ä»£ç†çš„ä¸€ç§ä½“ç°ã€‚

```java
interface ClothFactory{
  void produceCloth();
}

//ä»£ç†ç±»
class ProxyClothFactory implements ClothFactory{

  private ClothFactory factory;//ç”¨è¢«ä»£ç†ç±»å¯¹è±¡è¿›è¡Œå®ä¾‹åŒ–

  public ProxyClothFactory(ClothFactory factory){
    this.factory = factory;
  }

  @Override
  public void produceCloth() {
    System.out.println("ä»£ç†å·¥å‚åšä¸€äº›å‡†å¤‡å·¥ä½œ");

    factory.produceCloth();

    System.out.println("ä»£ç†å·¥å‚åšä¸€äº›åç»­çš„æ”¶å°¾å·¥ä½œ");
  }
}

//è¢«ä»£ç†ç±»
class NikeClothFactory implements ClothFactory{

  @Override
  public void produceCloth() {
    System.out.println("Nikeå·¥å‚ç”Ÿäº§ä¸€æ‰¹è¿åŠ¨æœ");
  }
}

public class StaticProxyTest {
  public static void main(String[] args) {
    //åˆ›å»ºè¢«ä»£ç†ç±»çš„å¯¹è±¡
    ClothFactory nike = new NikeClothFactory();
    //åˆ›å»ºä»£ç†ç±»çš„å¯¹è±¡
    ClothFactory proxyClothFactory = new ProxyClothFactory(nike);

    proxyClothFactory.produceCloth();
  }
}
```

### åŠ¨æ€ä»£ç†

**ç¨‹åºè¿è¡Œè¿‡ç¨‹**ï¼Œåœ¨**å†…å­˜ä¸­**åŠ¨æ€çš„ä¸ºç›®æ ‡å¯¹è±¡**åˆ›å»º**ä¸€ä¸ªè™šæ‹Ÿçš„ä»£ç†å¯¹è±¡ã€‚å­—èŠ‚ç éšç”¨éšåˆ›å»ºï¼Œéšç”¨éšåŠ è½½ã€‚

ä½¿ç”¨åœºæ™¯ï¼š

- è°ƒè¯•
- è¿œç¨‹æ–¹æ³•è°ƒç”¨

ç›¸æ¯”é™æ€ä»£ç†çš„ä¼˜ç‚¹ï¼šæŠ½è±¡è§’è‰²ä¸­(æ¥å£)å£°æ˜çš„æ‰€æœ‰æ–¹æ³•éƒ½è¢«è½¬ç§»åˆ°è°ƒç”¨å¤„ç†å™¨ä¸€ä¸ªé›†ä¸­çš„æ–¹æ³•ä¸­å¤„ç†ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æ›´åŠ çµæ´»å’Œç»Ÿä¸€çš„å¤„ç†ä¼—å¤šçš„æ–¹æ³•ã€‚

### JDK ä¸­åŠ¨æ€ä»£ç†

`java.lang.reflect`åŒ…ä¸‹æä¾›äº†ä¸€ä¸ª`Proxy`ç±»å’Œä¸€ä¸ª`InvocationHandler`æ¥å£ï¼Œé€šè¿‡ä½¿ç”¨è¿™ä¸ªç±»å’Œæ¥å£å°±å¯ä»¥ç”ŸæˆåŠ¨æ€ä»£ç†å¯¹è±¡ã€‚JDK æä¾›çš„ä»£ç†è¦æ±‚**è¢«ä»£ç†ç±»æœ€å°‘å®ç°ä¸€ä¸ªæ¥å£**ã€‚

- å®ç°æ­¥éª¤ï¼š

  1. ä»£ç†å¯¹è±¡å’ŒçœŸå®å¯¹è±¡å®ç°ç›¸åŒæ¥å£
  2. `ä»£ç†å¯¹è±¡ = Proxy.newProxyInstance();`
  3. ä½¿ç”¨ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•
  4. å¢å¼ºæ–¹æ³•

- **åˆ›å»ºæŒ‡å®šæ¥å£çš„ä»£ç†ç±»å¯¹è±¡å®ä¾‹**ï¼ˆç±»åŠ è½½å™¨ï¼ŒClass å¯¹è±¡æ•°ç»„ï¼Œè°ƒç”¨å¤„ç†å™¨ï¼‰

  ```java
  static Object newProxyInstance(ClassLoader loader,Class<?>[] interfaces,InvocationHander hander)
  //å…¶ä¸­loaderæ˜¯ä¸ç›®æ ‡å¯¹è±¡ç›¸åŒçš„ç±»åŠ è½½å™¨
  //interfacesæ˜¯æ¥å£çš„å­—èŠ‚ç å¯¹è±¡æ•°ç»„ new Class<?>[]{interface.class}
  ```

  å…¶ä¸­ç¬¬ä¸‰ä¸ªå‚æ•°ä¸º**è°ƒç”¨å¤„ç†å™¨**ï¼Œæ˜¯å®ç°äº†`InvocationHandler`æ¥å£çš„ç±»å¯¹è±¡ï¼Œé‡å†™`invoke`æ–¹æ³•

  ```java
  public static void main(String[] args) {

    // è¢«ä»£ç†å¯¹è±¡
    /*final*/ Target target = new Target();// Java 8ä¸­ï¼Œåªè¦å±€éƒ¨å˜é‡äº‹å®ä¸å˜ï¼Œé‚£ä¹ˆfinalå…³é”®å­—å¯ä»¥çœç•¥

    // åŠ¨æ€åˆ›å»ºä»£ç†å¯¹è±¡
    TargetInterface proxy = (TargetInterface) Proxy.newProxyInstance(
      target.getClass().getClassLoader(),
      target.getClass().getInterfaces(),
      new InvocationHandler() {
        /**
               * è¢«æ‰§è¡Œå‡ æ¬¡ï¼Ÿ---çœ‹ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•å‡ æ¬¡;ä»£ç†å¯¹è±¡è°ƒç”¨æ¥å£ç›¸åº”æ–¹æ³•ï¼Œéƒ½æ˜¯è°ƒç”¨è¯¥invokeæ–¹æ³•
               * proxyï¼šæ˜¯ä»£ç†å¯¹è±¡ï¼Œä¸€èˆ¬ä¸ç”¨
               * methodï¼šä»£ç†å¯¹è±¡è°ƒç”¨çš„æ–¹æ³•è¢«å°è£…ä¸ºMethodå¯¹è±¡
               * argsï¼šä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•æ—¶ä¼ é€’çš„å®é™…å‚æ•°ï¼Œå°è£…ä¸ºæ•°ç»„ï¼Œå³å‚æ•°åˆ—è¡¨
               */
        @Override
        public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
          // åå°„çŸ¥è¯†ç‚¹ã€‚ä½¿ç”¨ç›®æ ‡å¯¹è±¡è°ƒç”¨ç›®æ ‡æ–¹æ³•å¹¶ä¼ é€’å‚æ•°ï¼Œè¿”å›ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼ã€‚
          Object value = method.invoke(target, args);
          // retrunè¿”å›çš„å€¼ç»™ä»£ç†å¯¹è±¡
          return value;
        }

      });
    //è°ƒç”¨ä»£ç†å¯¹è±¡
    int add = proxy.add(1, 2);
  }
  ```

  ```java
  public interface TargetInterface {
      int add(int a, int b);
  }
  ```

  ```java
  public class Target implements TargetInterface {
      @Override
      public int add(int a, int b) { return a + b; }
  }
  ```

* å¢å¼ºæ–¹å¼ï¼šï¼ˆinvoke æ–¹æ³•ä¸­ï¼‰

  1. å¢å¼º**è¿”å›å€¼**ï¼šé€šè¿‡**å¯¹`return`è¿”å›å€¼çš„ä¿®æ”¹**
  2. å¢å¼º**å‚æ•°åˆ—**è¡¨ï¼šé€šè¿‡**`method.getName()`åˆ¤æ–­è¦å¢å¼ºçš„æ–¹æ³•**ï¼Œå¹¶å¯¹**å‚æ•°`args[]`æ•°ç»„è¿›è¡Œä¿®æ”¹**
  3. å¢å¼º**æ–¹æ³•ä½“**æ‰§è¡Œé€»è¾‘ï¼š**åå°„æ–¹æ³•`invoke()`æ‰§è¡Œå‰åä¿®æ”¹**

- ç¤ºä¾‹

  ```java
  interface Human{
    String getBelief();
    void eat(String food);
  }

  //è¢«ä»£ç†ç±»
  class SuperMan implements Human{

    @Override
    public String getBelief() {
      return "I believe I can fly!";
    }

    @Override
    public void eat(String food) {
      System.out.println("æˆ‘å–œæ¬¢åƒ" + food);
    }
  }

  /*
  è¦æƒ³å®ç°åŠ¨æ€ä»£ç†ï¼Œéœ€è¦è§£å†³çš„é—®é¢˜ï¼Ÿ
  é—®é¢˜ä¸€ï¼šå¦‚ä½•æ ¹æ®åŠ è½½åˆ°å†…å­˜ä¸­çš„è¢«ä»£ç†ç±»ï¼ŒåŠ¨æ€çš„åˆ›å»ºä¸€ä¸ªä»£ç†ç±»åŠå…¶å¯¹è±¡ã€‚
  é—®é¢˜äºŒï¼šå½“é€šè¿‡ä»£ç†ç±»çš„å¯¹è±¡è°ƒç”¨æ–¹æ³•aæ—¶ï¼Œå¦‚ä½•åŠ¨æ€çš„å»è°ƒç”¨è¢«ä»£ç†ç±»ä¸­çš„åŒåæ–¹æ³•aã€‚
   */

  class ProxyFactory{
    //è°ƒç”¨æ­¤æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªä»£ç†ç±»çš„å¯¹è±¡ã€‚è§£å†³é—®é¢˜ä¸€
    public static Object getProxyInstance(Object obj){//obj:è¢«ä»£ç†ç±»çš„å¯¹è±¡
      MyInvocationHandler handler = new MyInvocationHandler();
      handler.bind(obj);
      return Proxy.newProxyInstance(obj.getClass().getClassLoader(),obj.getClass().getInterfaces(),handler);
    }
  }

  class MyInvocationHandler implements InvocationHandler{

    private Object obj;//éœ€è¦ä½¿ç”¨è¢«ä»£ç†ç±»çš„å¯¹è±¡è¿›è¡Œèµ‹å€¼

    public void bind(Object obj){
      this.obj = obj;
    }

    //å½“æˆ‘ä»¬é€šè¿‡ä»£ç†ç±»çš„å¯¹è±¡ï¼Œè°ƒç”¨æ–¹æ³•aæ—¶ï¼Œå°±ä¼šè‡ªåŠ¨çš„è°ƒç”¨å¦‚ä¸‹çš„æ–¹æ³•ï¼šinvoke()
    //å°†è¢«ä»£ç†ç±»è¦æ‰§è¡Œçš„æ–¹æ³•açš„åŠŸèƒ½å°±å£°æ˜åœ¨invoke()ä¸­
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {

      //method:å³ä¸ºä»£ç†ç±»å¯¹è±¡è°ƒç”¨çš„æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä¹Ÿå°±ä½œä¸ºäº†è¢«ä»£ç†ç±»å¯¹è±¡è¦è°ƒç”¨çš„æ–¹æ³•
      //obj:è¢«ä»£ç†ç±»çš„å¯¹è±¡
      Object returnValue = method.invoke(obj,args);

      util.method2();

      //ä¸Šè¿°æ–¹æ³•çš„è¿”å›å€¼å°±ä½œä¸ºå½“å‰ç±»ä¸­çš„invoke()çš„è¿”å›å€¼ã€‚
      return returnValue;
    }
  }


  public class ProxyTest {

    public static void main(String[] args) {
      SuperMan superMan = new SuperMan();
      //proxyInstance:ä»£ç†ç±»çš„å¯¹è±¡
      Human proxyInstance = (Human) ProxyFactory.getProxyInstance(superMan);
      //å½“é€šè¿‡ä»£ç†ç±»å¯¹è±¡è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼šè‡ªåŠ¨çš„è°ƒç”¨è¢«ä»£ç†ç±»ä¸­åŒåçš„æ–¹æ³•
      String belief = proxyInstance.getBelief();
      System.out.println(belief);
      proxyInstance.eat("å››å·éº»è¾£çƒ«");

      System.out.println("*****************************");

      NikeClothFactory nikeClothFactory = new NikeClothFactory();
      ClothFactory proxyClothFactory = (ClothFactory) ProxyFactory.getProxyInstance(nikeClothFactory);
      proxyClothFactory.produceCloth();
    }
  }
  ```

### åŸºäºå­ç±»çš„åŠ¨æ€ä»£ç† cglib

- æä¾›è€…ï¼šç¬¬ä¸‰æ–¹çš„ CGLibï¼Œå¦‚æœæŠ¥ asmxxxx å¼‚å¸¸ï¼Œéœ€è¦å¯¼å…¥ `asm.jar`æˆ–`org.springframework.cglib.proxy`

- è¦æ±‚ï¼šè¢«ä»£ç†ç±»ä¸èƒ½ç”¨ final ä¿®é¥°çš„ç±»ï¼ˆæœ€ç»ˆç±»ï¼‰ã€‚

  ```java
  public static void  main(String[] args) {
      final Actor actor = new Actor();
      Actor cglibActor = (Actor) Enhancer.create(actor.getClass(), new MethodInterceptor() {
          /**
  		 * æ‰§è¡Œè¢«ä»£ç†å¯¹è±¡çš„ä»»ä½•æ–¹æ³•ï¼Œéƒ½ä¼šç»è¿‡è¯¥æ–¹æ³•ã€‚åœ¨æ­¤æ–¹æ³•å†…éƒ¨å°±å¯ä»¥å¯¹è¢«ä»£ç†å¯¹è±¡çš„ä»»ä½• æ–¹æ³•è¿›è¡Œå¢å¼ºã€‚
  		 * å‚æ•°ï¼š
  		   *  å‰ä¸‰ä¸ªå’ŒåŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†æ˜¯ä¸€æ ·çš„ã€‚
  		   *  MethodProxyï¼šå½“å‰æ‰§è¡Œæ–¹æ³•çš„ä»£ç†å¯¹è±¡ã€‚
  		   *  è¿”å›å€¼ï¼šå½“å‰æ‰§è¡Œæ–¹æ³•çš„è¿”å›å€¼
  		 */
          @Override
          public Object intercept(Object proxy,
                                  Method method,
                                  Object[] args,
                                  MethodProxy methodProxy) throws Throwable {
              String name = method.getName();
              Float money = (Float) args[0];
              Object rtValue = null;
              if("basicAct".equals(name)){
                  //åŸºæœ¬æ¼”å‡º
                  if(money > 2000){
                      rtValue = method.invoke(actor, money/2);
                  }
              }
              if("dangerAct".equals(name)){
                  //å±é™©æ¼”å‡º
                  if(money > 5000){
                      rtValue = method.invoke(actor, money/2);
                  }
              }
              return rtValue;
          }
      });
      cglibActor.basicAct(10000);
      cglibActor.dangerAct(100000);
  }
  ```

### AOPâ€”Aspect Orient Programming

å‰é¢ä»‹ç»çš„ Proxy å’Œ InvocationHandlerï¼Œå¾ˆéš¾çœ‹å‡ºè¿™ç§åŠ¨æ€ä»£ç†çš„ä¼˜åŠ¿ï¼Œä¸‹é¢ä»‹ç»ä¸€ç§æ›´å®ç”¨çš„åŠ¨æ€ä»£ç†æœºåˆ¶ã€‚

- ä½¿ç”¨ Proxy ç”Ÿæˆä¸€ä¸ªåŠ¨æ€ä»£ç†æ—¶ï¼Œå¾€å¾€å¹¶ä¸ä¼šå‡­ç©ºäº§ç”Ÿä¸€ä¸ªåŠ¨æ€ä»£ç†ï¼Œè¿™æ ·æ²¡æœ‰å¤ªå¤§çš„æ„ä¹‰ã€‚é€šå¸¸éƒ½æ˜¯ä¸ºæŒ‡å®šçš„ç›®æ ‡å¯¹è±¡ç”ŸæˆåŠ¨æ€ä»£ç†

- è¿™ç§åŠ¨æ€ä»£ç†åœ¨ AOP ä¸­è¢«ç§°ä¸º AOP ä»£ç†ï¼ŒAOP ä»£ç†å¯ä»£æ›¿ç›®æ ‡å¯¹è±¡ï¼ŒAOP ä»£ç†åŒ…å«äº†ç›®æ ‡å¯¹è±¡çš„å…¨éƒ¨æ–¹æ³•ã€‚ä½† AOP ä»£ç†ä¸­çš„æ–¹æ³•ä¸ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•å­˜åœ¨å·®å¼‚ : AOP ä»£ç†é‡Œçš„æ–¹æ³•å¯ä»¥åœ¨æ‰§è¡Œç›®æ ‡æ–¹æ³•ä¹‹å‰ã€ä¹‹åæ’å…¥ä¸€äº›é€šç”¨å¤„ç†

  <img src="../images/image-20191105004811049.png" style="zoom:50%;" />

```java
interface Human{
  String getBelief();
  void eat(String food);
}

//è¢«ä»£ç†ç±»
class SuperMan implements Human{

  @Override
  public String getBelief() {
    return "I believe I can fly!";
  }

  @Override
  public void eat(String food) {
    System.out.println("æˆ‘å–œæ¬¢åƒ" + food);
  }
}

class HumanUtil{

  public void method1(){
    System.out.println("====================é€šç”¨æ–¹æ³•ä¸€====================");
  }
  public void method2(){
    System.out.println("====================é€šç”¨æ–¹æ³•äºŒ====================");
  }
}

/*
è¦æƒ³å®ç°åŠ¨æ€ä»£ç†ï¼Œéœ€è¦è§£å†³çš„é—®é¢˜ï¼Ÿ
é—®é¢˜ä¸€ï¼šå¦‚ä½•æ ¹æ®åŠ è½½åˆ°å†…å­˜ä¸­çš„è¢«ä»£ç†ç±»ï¼ŒåŠ¨æ€çš„åˆ›å»ºä¸€ä¸ªä»£ç†ç±»åŠå…¶å¯¹è±¡ã€‚
é—®é¢˜äºŒï¼šå½“é€šè¿‡ä»£ç†ç±»çš„å¯¹è±¡è°ƒç”¨æ–¹æ³•aæ—¶ï¼Œå¦‚ä½•åŠ¨æ€çš„å»è°ƒç”¨è¢«ä»£ç†ç±»ä¸­çš„åŒåæ–¹æ³•aã€‚
 */

class ProxyFactory{
  //è°ƒç”¨æ­¤æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªä»£ç†ç±»çš„å¯¹è±¡ã€‚è§£å†³é—®é¢˜ä¸€
  public static Object getProxyInstance(Object obj){//obj:è¢«ä»£ç†ç±»çš„å¯¹è±¡
    MyInvocationHandler handler = new MyInvocationHandler();
    handler.bind(obj);
    return Proxy.newProxyInstance(obj.getClass().getClassLoader(),obj.getClass().getInterfaces(),handler);
  }
}

class MyInvocationHandler implements InvocationHandler{

  private Object obj;//éœ€è¦ä½¿ç”¨è¢«ä»£ç†ç±»çš„å¯¹è±¡è¿›è¡Œèµ‹å€¼

  public void bind(Object obj){
    this.obj = obj;
  }

  //å½“æˆ‘ä»¬é€šè¿‡ä»£ç†ç±»çš„å¯¹è±¡ï¼Œè°ƒç”¨æ–¹æ³•aæ—¶ï¼Œå°±ä¼šè‡ªåŠ¨çš„è°ƒç”¨å¦‚ä¸‹çš„æ–¹æ³•ï¼šinvoke()
  //å°†è¢«ä»£ç†ç±»è¦æ‰§è¡Œçš„æ–¹æ³•açš„åŠŸèƒ½å°±å£°æ˜åœ¨invoke()ä¸­
  @Override
  public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {

    HumanUtil util = new HumanUtil();
    util.method1();

    //method:å³ä¸ºä»£ç†ç±»å¯¹è±¡è°ƒç”¨çš„æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä¹Ÿå°±ä½œä¸ºäº†è¢«ä»£ç†ç±»å¯¹è±¡è¦è°ƒç”¨çš„æ–¹æ³•
    //obj:è¢«ä»£ç†ç±»çš„å¯¹è±¡
    Object returnValue = method.invoke(obj,args);

    util.method2();

    //ä¸Šè¿°æ–¹æ³•çš„è¿”å›å€¼å°±ä½œä¸ºå½“å‰ç±»ä¸­çš„invoke()çš„è¿”å›å€¼ã€‚
    return returnValue;
  }
}


public class ProxyTest {

  public static void main(String[] args) {
    SuperMan superMan = new SuperMan();
    //proxyInstance:ä»£ç†ç±»çš„å¯¹è±¡
    Human proxyInstance = (Human) ProxyFactory.getProxyInstance(superMan);
    //å½“é€šè¿‡ä»£ç†ç±»å¯¹è±¡è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼šè‡ªåŠ¨çš„è°ƒç”¨è¢«ä»£ç†ç±»ä¸­åŒåçš„æ–¹æ³•
    String belief = proxyInstance.getBelief();
    System.out.println(belief);
    proxyInstance.eat("å››å·éº»è¾£çƒ«");

    System.out.println("*****************************");

    NikeClothFactory nikeClothFactory = new NikeClothFactory();
    ClothFactory proxyClothFactory = (ClothFactory) ProxyFactory.getProxyInstance(nikeClothFactory);
    proxyClothFactory.produceCloth();
  }
}
```
