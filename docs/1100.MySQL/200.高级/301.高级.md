---
title: 高级
date: 2021-01-28 00:01:07
permalink: /pages/b60e0d/
categories:
  - MySQL
  - 高级
tags:
  -
---

# 高级

## 系统是如何与 MySQL 打交道？

### 图示

<iframe id="embed_dom" name="embed_dom" frameborder="0" style="display:block;width:100%; height:345px;" src="https://www.processon.com/embed/6011900ce401fd6d26c261d6"></iframe>









### 驱动的引入—建立连接

都知道，**访问数据库必须得跟数据库建立网络连接**。回忆 IDEA 中的数据库工具建立连接时是不是需要下载 driver，这个就是 **MySQL 的驱动，它会在底层跟数据库建立网络连接**。

当然 Java 代码如何使用该驱动呢？看如下 maven 依赖：

```xml
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <scope>runtime</scope>
</dependency>
```

这就是 mysql 适配的 java 版本的连接驱动，当然还会有 Go、Python、JS 等版本



### 连接池（应用）—连接数量、复用

一个Java系统难道只会跟数据库建立一个连接吗？不可能，例如一个部署在 Tomcat 中的 Web 应用，**Tomcat 本身肯定是由多个线程来并发的处理同时接收到的多个请求**的。

这个时候，如果Tomcat中的多个线程并发处理多个请求的时候，都要去抢夺一个连接去访问数据库的话，那效率肯定是很低下的

若 Tomcat中的每个线程在每次访问数据库的时候，都基于MySQL驱动去创建一个数据库连接，然后执行SQL语句，然后执行完之后再销毁这个数据库连接。导致可能Tomcat中上百个线程会并发的频繁创建数据库连接，执行SQL语句，然后频繁的销毁数据库连接。这也是非常不好的，因为**每次建立一个数据库连接都很耗时**

所以一般我们必须要使用一个数据库连接池，也就是说在一个池子里维持多个数据库连接，让多个线程使用里面的不同的数据库连接去执行SQL语句，然后执行完SQL语句之后，不要销毁这个数据库连接，而是把连接放回池子里，后续还可以继续使用。

基于这样的一个数据库连接池的机制，就可以解决多个线程并发的使用多个数据库连接去执行SQL语句的问题，而且还避免了数据库连接使用完之后就销毁的问题，我们看下图的说明。





### 连接池（MySQL）

任何一个系统都会有一个数据库连接池去访问数据库，也就是说这个系统会有多个数据库连接，供多线程并发的使用。同时我们可能会有**多个系统同时去访问一个数据库**，这都是有可能的。那就是会有很多系统要与MySQL数据库建立很多个连接，那么MySQL也必然要**维护MySQL与系统之间的多个连接**，所以**MySQL架构体系中的第一个环节，就是连接池**。

实际上MySQL中的连接池就是维护了与系统之间的多个数据库连接。除此之外，你的系统每次跟MySQL建立连接的时候，还会根据你传递过来的账号和密码，进行账号密码的验证，库表权限的验证。







## MySQL 架构

