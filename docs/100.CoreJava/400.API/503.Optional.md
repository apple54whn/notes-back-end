---
title: 15 Optional
date: 2020-12-14 23:04:19
permalink: /pages/5f83d1/
categories:
  - Java
  - Core
tags:
  -
---

# Optional

## ç®€ä»‹

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè‡­åæ˜­è‘—çš„ç©ºæŒ‡é’ˆå¼‚å¸¸æ˜¯å¯¼è‡´ Java åº”ç”¨ç¨‹åºå¤±è´¥çš„æœ€å¸¸è§åŸå› ã€‚ ä»¥å‰ï¼Œä¸ºäº†è§£å†³ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ŒGoogle å…¬å¸è‘—åçš„ Guava é¡¹ç›®å¼•å…¥äº†`Optional`ç±»ï¼Œ Guava é€šè¿‡ä½¿ç”¨æ£€æŸ¥ç©ºå€¼çš„æ–¹å¼æ¥é˜²æ­¢ä»£ç æ±¡æŸ“ï¼Œå®ƒé¼“åŠ±ç¨‹åºå‘˜å†™æ›´å¹²å‡€çš„ä»£ ç ã€‚å—åˆ° Google Guava çš„å¯å‘ï¼Œ`Optional`ç±»å·²ç»æˆä¸º Java 8 ç±»åº“çš„ä¸€éƒ¨åˆ†ã€‚

`java.util.Optional<T>` æ˜¯ä¸€ä¸ª**å®¹å™¨ç±»**ï¼Œå®ƒå¯ä»¥ä¿å­˜ç±»å‹ T çš„å€¼ï¼Œä»£è¡¨è¿™ä¸ªå€¼å­˜åœ¨ï¼›æˆ–è€…ä»…ä»…ä¿å­˜ nullï¼Œè¡¨ç¤ºè¿™ä¸ªå€¼ä¸å­˜åœ¨ã€‚åŸæ¥ç”¨ null è¡¨ç¤ºä¸€ä¸ªå€¼ä¸å­˜åœ¨ï¼Œç°åœ¨ `Optional` å¯ä»¥æ›´å¥½çš„è¡¨è¾¾è¿™ä¸ªæ¦‚å¿µã€‚å¹¶ä¸”å¯ä»¥é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚

`Optional`ç±»çš„ Javadoc æè¿°å¦‚ä¸‹ï¼šè¿™æ˜¯ä¸€ä¸ªå¯ä»¥ä¸º`null`çš„å®¹å™¨å¯¹è±¡ã€‚å¦‚æœå€¼å­˜åœ¨ åˆ™`isPresent()`æ–¹æ³•ä¼šè¿”å›`true`ï¼Œè°ƒç”¨`get()`æ–¹æ³•ä¼šè¿”å›è¯¥å¯¹è±¡ã€‚

## ä½¿ç”¨

### åˆ›å»º

**åˆ›å»º`Optional`ç±»å¯¹è±¡çš„æ–¹æ³•**

- `Optional.of(T t)`

  åˆ›å»ºä¸€ä¸ª `Optional` å®ä¾‹ï¼Œ`t`å¿…é¡»**éç©º**;

- `Optional.ofNullable(T t)`

  `t`å¯ä»¥ä¸º`null`

- `Optional.empty()`

  åˆ›å»ºä¸€ä¸ªç©ºçš„ `Optional` å®ä¾‹

### åˆ¤æ–­ã€Consumer

**åˆ¤æ–­`Optional`å®¹å™¨ä¸­æ˜¯å¦åŒ…å«å¯¹è±¡**

- `boolean isPresent()`

  åˆ¤æ–­æ˜¯å¦åŒ…å«å¯¹è±¡ã€‚ä¸æ¨èè¿™æ ·ç”¨ï¼å’Œ if else æ²¡åŒºåˆ«ï¼

- `void ifPresent(Consumer<? super T> consumer)` ğŸ”¥

  å¦‚æœæœ‰å€¼ï¼Œå°±æ‰§è¡Œ Consumer æ¥å£çš„å®ç°ä»£ç ï¼Œå¹¶ä¸”è¯¥å€¼ä¼šä½œä¸ºå‚æ•°ä¼ ç»™å®ƒï¼Œæ¶ˆè´¹æ‰ã€‚

### è·å–ã€Supplier

**è·å–`Optional`å®¹å™¨çš„å¯¹è±¡**

- `T get()`

  å¦‚æœè°ƒç”¨å¯¹è±¡åŒ…å«å€¼ï¼Œè¿”å›è¯¥å€¼ï¼Œå¦åˆ™æŠ›å¼‚å¸¸ã€‚æ³¨æ„ï¼Œè¿™é‡Œ**ç›´æ¥ä½¿ç”¨ get IDEA ä¼šæœ‰é»„è‰²è­¦å‘Š**ï¼Œå› ä¸ºè¿™æ ·å°±å’Œæ™®é€šç”¨æ³•ä¸€æ ·äº†ï¼Œå¤±å» Optional å­˜åœ¨çš„æ„ä¹‰ã€‚ä¸”æ³¨æ„ï¼Œè¿™é‡Œ get åè‹¥æ²¡æœ‰å€¼ï¼Œåˆ™ç›´æ¥æŠ›å¼‚å¸¸ï¼Œ**å°†å¯èƒ½äº§ç”Ÿçš„ NPE æå‰**ï¼ˆç±»ä¼¼ fast fail æœºåˆ¶ï¼›æ³›å‹çš„æå‰åˆ°ç¼–è¯‘æœŸï¼›ï¼‰

  è¿™ä¸ªæ–¹æ³•å°è£…çš„å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯ä¸€èˆ¬æ¨èä¸‹é¢çš„ç”¨æ³•

- `T orElse(T other)` ğŸ”¥

  å¦‚æœæœ‰å€¼åˆ™å°†å…¶è¿”å›ï¼Œå¦åˆ™**ç›´æ¥è¿”å›æŒ‡å®š**çš„ other å¯¹è±¡ã€‚

- `T orElseGet(Supplier<? extends T> other)` ğŸ”¥

  å¦‚æœæœ‰å€¼åˆ™å°†å…¶è¿”å›ï¼Œå¦åˆ™è¿”å›ç”±`Supplier`æ¥å£**å®ç°æä¾›**çš„å¯¹è±¡ã€‚

- `T orElseThrow(Supplier<? extends X> exceptionSupplier)` ğŸ”¥

  å¦‚æœæœ‰å€¼åˆ™å°†å…¶è¿”å›ï¼Œå¦åˆ™æŠ›å‡ºç”±`Supplier`æ¥å£**å®ç°æä¾›**çš„å¼‚å¸¸ã€‚

## ç¤ºä¾‹

### ç¤ºä¾‹ 1

```java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class Girl {
    private String name;
}
```

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Boy {

    private Girl girl;
}
```

```java
@Test
void test1() {
    // å¯èƒ½æ˜¯å…¶ä»–åœ°æ–¹ä¼ æ¥çš„å€¼ï¼Œä¸ç¡®å®šå…¶æ˜¯å¦ä¸ºnull
    Girl girl = null;

    //of(T t):ä¿è¯tæ˜¯éç©ºçš„ï¼Œå¯¹äº null æ‰§è¡Œä¼šæŠ¥ NPE
    // Optional<Girl> optionalGirl1 = Optional.of(girl);

    //ofNullable(T t)ï¼štå¯ä»¥ä¸ºnullï¼Œæ‰§è¡Œè¾“å‡ºä¸ºOptional.empty
    Optional<Girl> optionalGirl2 = Optional.ofNullable(girl);
    System.out.println(optionalGirl2);// Optional.empty


    //orElse(T t1):å¦‚æœå½“å‰çš„Optionalå†…éƒ¨å°è£…çš„tæ˜¯éç©ºçš„ï¼Œåˆ™è¿”å›å†…éƒ¨çš„tï¼›å¦‚æœå†…éƒ¨çš„tæ˜¯ç©ºçš„ï¼Œåˆ™è¿”å›orElse()æ–¹æ³•ä¸­çš„å‚æ•°t1.
    Girl girl1 = optionalGirl2.orElse(new Girl("èµµä¸½é¢–"));
    System.out.println(girl1);// Girl(name=èµµä¸½é¢–)
}
```

```java
@Test
public void test2(){
    // å¯èƒ½å…¶ä»–åœ°æ–¹ä¼ å…¥çš„å€¼ï¼Œæ— æ³•ç¡®å®šå…¶æ˜¯å¦ä¸º null
    Boy boy = new Boy();
    boy = null;

    String girlName = getGirlName(boy);
    System.out.println(girlName);

}

//ä¼˜åŒ–ä¹‹å‰çš„ getGirlName():
public String getGirlName(Boy boy){
    return boy.getGirl().getName();
}


//ä¼˜åŒ–ä»¥åçš„ getGirlName():
public String getGirlName1(Boy boy){
    if(boy != null){
        Girl girl = boy.getGirl();
        if(girl != null){
            return girl.getName();
        }
    }
    return null;
}

@Test
public void test3(){
    // åˆ†åˆ«æ³¨é‡Šå¦‚ä¸‹å¯å¾—ç»“æœ
    Boy boy = null;// è¿ªä¸½çƒ­å·´
    boy = new Boy();// å¤åŠ›å¨œæ‰
    boy = new Boy(new Girl("æ¡¥æœ¬æœ‰èœ"));// æ¡¥æœ¬æœ‰èœ
    String girlName = getGirlName2(boy);
    System.out.println(girlName);
}


//ä½¿ç”¨ Optional å®¹å™¨åçš„ getGirlName():
public String getGirlName2(Boy boy){

    Optional<Boy> boyOptional = Optional.ofNullable(boy);
    // æ­¤æ—¶çš„boy1ä¸€å®šé null
    Boy boy1 = boyOptional.orElse(new Boy(new Girl("è¿ªä¸½çƒ­å·´")));
    // ä½†æ˜¯ girl å¯èƒ½ä¸º null
    Girl girl = boy1.getGirl();

    Optional<Girl> girlOptional = Optional.ofNullable(girl);
    // girl1ä¸€å®šéç©º
    Girl girl1 = girlOptional.orElse(new Girl("å¤åŠ›å¨œæ‰"));
    return girl1.getName();
}
```
