---
title: 14 Stream API
date: 2020-12-14 23:04:19
permalink: /pages/381de5/
categories:
  - Java
  - Core
tags:
  -
---

# Stream

Stream æ˜¯ Java8 ä¸­å¤„ç†é›†åˆçš„å…³é”®æŠ½è±¡æ¦‚å¿µï¼Œå®ƒå¯ä»¥æŒ‡å®šä½ å¸Œæœ›å¯¹é›†åˆè¿›è¡Œçš„æ“ä½œï¼Œå¯ä»¥æ‰§è¡Œéå¸¸å¤æ‚çš„æŸ¥æ‰¾ã€è¿‡æ»¤å’Œæ˜ å°„æ•°æ®ç­‰æ“ä½œã€‚ ä½¿ç”¨ Stream API **å¯¹é›†åˆæ•°æ®è¿›è¡Œæ“ä½œ**ï¼Œå°±**ç±»ä¼¼äºä½¿ç”¨ SQL** æ‰§è¡Œçš„æ•°æ®åº“æŸ¥è¯¢ã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨ Stream API æ¥**å¹¶è¡Œæ‰§è¡Œæ“ä½œ**ã€‚ç®€è¨€ä¹‹ï¼ŒStream API æä¾›äº†ä¸€ç§é«˜æ•ˆä¸”æ˜“äºä½¿ç”¨çš„å¤„ç†æ•°æ®çš„æ–¹å¼ã€‚

## ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Stream API

- å®é™…å¼€å‘ä¸­ï¼Œé¡¹ç›®ä¸­å¤šæ•°æ•°æ®æºéƒ½æ¥è‡ªäº Mysqlï¼ŒOracle ç­‰ã€‚ä½†ç°åœ¨æ•°æ®æºå¯ä»¥æ›´å¤šäº†ï¼Œæœ‰ MongDBï¼ŒRadis ç­‰ï¼Œè€Œè¿™äº› NoSQL çš„æ•°æ®å°±éœ€è¦ Java å±‚é¢å»å¤„ç†ã€‚
- Stream å’Œ Collection é›†åˆçš„åŒºåˆ«ï¼šCollection æ˜¯ä¸€ç§**é™æ€çš„å†…å­˜æ•°æ®ç»“æ„**ï¼Œè€Œ Stream æ˜¯æœ‰å…³**è®¡ç®—**çš„ã€‚å‰è€…æ˜¯ä¸»è¦é¢å‘å†…å­˜ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œ åè€…ä¸»è¦æ˜¯é¢å‘ CPUï¼Œé€šè¿‡ CPU å®ç°è®¡ç®—ã€‚

> Java 8 çš„ Lambda è®©æˆ‘ä»¬å¯ä»¥æ›´åŠ ä¸“æ³¨äºåšä»€ä¹ˆï¼ˆWhatï¼‰ï¼Œè€Œä¸æ˜¯æ€ä¹ˆåšï¼ˆHowï¼‰ï¼Œè¿™ç‚¹æ­¤å‰å·²ç»ç»“åˆå†…éƒ¨ç±»è¿›è¡Œäº†å¯¹æ¯”è¯´æ˜ã€‚ç»“åˆé›†åˆä¸­éå†æ“ä½œï¼Œå¯ä»¥å‘ç°å¾ªç¯éå†çš„å¼Šç«¯ï¼š
>
> - for å¾ªç¯çš„è¯­æ³•å°±æ˜¯â€œæ€ä¹ˆåšâ€
> - for å¾ªç¯çš„å¾ªç¯ä½“æ‰æ˜¯â€œåšä»€ä¹ˆâ€
>
> å¦‚æœå¸Œæœ›å¯¹é›†åˆä¸­çš„å…ƒç´ è¿›è¡Œç­›é€‰è¿‡æ»¤ï¼š
>
> - å°†é›†åˆ A æ ¹æ®æ¡ä»¶ä¸€è¿‡æ»¤ä¸ºå­é›† Bï¼›
> - ç„¶åå†æ ¹æ®æ¡ä»¶äºŒè¿‡æ»¤ä¸ºå­é›† Cã€‚
>
> ä½¿ç”¨çº¿æ€§å¾ªç¯å°±æ„å‘³ç€åªèƒ½éå†ä¸€æ¬¡ï¼Œé‚£ä¹ˆéœ€å¤šæ¬¡å¾ªç¯æ¥è§£å†³ï¼›å¹¶ä¸”å¾ªç¯æ˜¯åšäº‹æƒ…çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ç›®çš„ã€‚

```java
//ç­›é€‰ä»¥å¼ å¼€å§‹ï¼Œé•¿åº¦ä¸º3ï¼Œéå†æ‰“å°
list.stream()
    .filter(s->s.startsWith("å¼ "))
    .filter(s->s.length()==3)
    .forEach(s -> System.out.println(s));
```

## æµå¼æ€æƒ³æ¦‚è¿°

æ•´ä½“æ¥çœ‹ï¼Œæµå¼æ€æƒ³ç±»ä¼¼äºå·¥å‚è½¦é—´çš„â€œ**ç”Ÿäº§æµæ°´çº¿**â€ã€‚å½“éœ€è¦**å¯¹å¤šä¸ªå…ƒç´ è¿›è¡Œæ“ä½œï¼ˆç‰¹åˆ«æ˜¯å¤šæ­¥æ“ä½œï¼‰**çš„æ—¶å€™ï¼Œè€ƒè™‘åˆ°æ€§èƒ½åŠä¾¿åˆ©æ€§ï¼Œæˆ‘ä»¬åº”è¯¥**é¦–å…ˆæ‹¼å¥½ä¸€ä¸ªâ€œæ¨¡å‹â€æ­¥éª¤æ–¹æ¡ˆ**ï¼Œç„¶åå†æŒ‰ç…§æ–¹æ¡ˆå»**æ‰§è¡Œ**å®ƒã€‚

è¿™å¼ å›¾ä¸­å±•ç¤ºäº†è¿‡æ»¤ã€æ˜ å°„ã€è·³è¿‡ã€è®¡æ•°ç­‰å¤šæ­¥æ“ä½œï¼Œè¿™æ˜¯ä¸€ç§**é›†åˆå…ƒç´ çš„å¤„ç†æ–¹æ¡ˆ**ï¼Œè€Œæ–¹æ¡ˆå°±æ˜¯ä¸€ç§â€œ**å‡½æ•°æ¨¡å‹**â€ã€‚å›¾ä¸­çš„**æ¯ä¸€ä¸ªæ–¹æ¡†éƒ½æ˜¯ä¸€ä¸ªâ€œæµâ€**ï¼Œè°ƒç”¨æŒ‡å®šçš„æ–¹æ³•ï¼Œå¯ä»¥**ä»ä¸€ä¸ªæµæ¨¡å‹è½¬æ¢ä¸ºå¦ä¸€ä¸ªæµæ¨¡å‹**ã€‚è€Œå³ä¾§çš„æ•°å­— 3 æ˜¯ç»ˆç»“æœã€‚

è¿™é‡Œçš„ filter ã€ map ã€ skip éƒ½æ˜¯åœ¨**å¯¹å‡½æ•°æ¨¡å‹è¿›è¡Œæ“ä½œ**ï¼Œ**é›†åˆå…ƒç´ å¹¶æ²¡æœ‰çœŸæ­£è¢«å¤„ç†**ã€‚**åªæœ‰å½“ç»ˆç»“æ–¹æ³• count æ‰§è¡Œ**çš„æ—¶å€™ï¼Œ**æ•´ä¸ªæ¨¡å‹æ‰ä¼šæŒ‰ç…§æŒ‡å®šç­–ç•¥æ‰§è¡Œæ“ä½œ**ã€‚è€Œè¿™å¾—ç›Šäº**Lambda çš„å»¶è¿Ÿæ‰§è¡Œç‰¹æ€§**ã€‚

```
![stream-model](../images/stream-model.png)
```

- Stream æµå…¶å®æ˜¯ä¸€ä¸ª**é›†åˆå…ƒç´ çš„å‡½æ•°æ¨¡å‹**ï¼Œå®ƒå¹¶ä¸æ˜¯é›†åˆï¼Œä¹Ÿä¸æ˜¯æ•°æ®ç»“æ„ã€‚

- å’Œä»¥å‰çš„ Collection æ“ä½œä¸åŒï¼Œ Stream æ“ä½œè¿˜æœ‰å‡ ä¸ªåŸºç¡€çš„ç‰¹å¾ï¼š
  - **å…¶æœ¬èº«å¹¶ä¸å­˜å‚¨ä»»ä½•å…ƒç´ ï¼ˆæˆ–å…¶åœ°å€å€¼ï¼‰**ï¼Œè€Œæ˜¯æŒ‰éœ€è®¡ç®—ã€‚
  - **Pipelining**ï¼šä¸­é—´æ“ä½œéƒ½ä¼š**è¿”å›æµå¯¹è±¡æœ¬èº«**ï¼Œä¸”ä¸æ”¹å˜åŸå¯¹è±¡ã€‚ è¿™æ ·å¤šä¸ªæ“ä½œå¯ä»¥**ä¸²è”æˆä¸€ä¸ªç®¡é“**ï¼Œ å¦‚åŒæµå¼é£æ ¼ï¼ˆï¬‚uent styleï¼‰ã€‚ å¹¶å¯ä»¥å¯¹æ“ä½œè¿›è¡Œä¼˜åŒ–ï¼Œ æ¯”å¦‚**å»¶è¿Ÿæ‰§è¡Œ**ï¼ˆlazinessï¼‰å’Œ**çŸ­è·¯**ï¼ˆshort-circuitingï¼‰ã€‚
  - **å†…éƒ¨è¿­ä»£**ï¼šä»¥å‰å¯¹é›†åˆéå†éƒ½æ˜¯é€šè¿‡ Iterator æˆ–è€…å¢å¼º for çš„æ–¹å¼ï¼Œæ˜¾å¼çš„åœ¨é›†åˆå¤–éƒ¨è¿›è¡Œè¿­ä»£ï¼Œ è¿™å«åšå¤–éƒ¨è¿­ä»£ã€‚ **Stream æä¾›äº†å†…éƒ¨è¿­ä»£çš„æ–¹å¼ï¼Œæµå¯ä»¥ç›´æ¥è°ƒç”¨éå†æ–¹æ³•**ã€‚

## Stream çš„æ“ä½œä¸‰ä¸ªæ­¥éª¤

1.  åˆ›å»º Streamï¼š**ä»ä¸€ä¸ªæ•°æ®æºï¼ˆå¦‚é›†åˆã€æ•°ç»„ï¼‰ï¼Œè·å–ä¸€ä¸ªæµ**
2.  ä¸­é—´æ“ä½œï¼šä¸€ä¸ªä¸­é—´æ“ä½œé“¾ï¼Œå¯¹æ•°æ®æºçš„**æ•°æ®è¿›è¡Œå¤„ç†**
3.  **ç»ˆæ­¢æ“ä½œï¼ˆç»ˆç«¯æ“ä½œï¼‰**ï¼šä¸€æ—¦æ‰§è¡Œç»ˆæ­¢æ“ä½œï¼Œå°±æ‰§è¡Œä¸­é—´æ“ä½œé“¾ï¼Œå¹¶äº§ç”Ÿç»“æœï¼Œä¹‹å Stream ä¸èƒ½å†è¢«ä½¿ç”¨

## åˆ›å»º Stream çš„æ–¹æ³•

### Stream.of

é€šè¿‡`Stream`ç±»çš„**é™æ€æ–¹æ³•**`of()`ï¼Œé€šè¿‡æ˜¾ç¤ºå€¼åˆ›å»ºä¸€ä¸ªæµã€‚å®ƒå¯ä»¥æ¥æ”¶ä»»æ„æ•°é‡çš„å‚æ•°ã€‚

- `public static<T> Stream<T> of(T... values)`ï¼š è¿”å›ä¸€ä¸ªæµ

### Stream.iterate/generate

é€šè¿‡`Stream`ç±»çš„**é™æ€æ–¹æ³•**åˆ›å»º**æ— é™æµ**ï¼ˆäº†è§£ï¼‰

- è¿­ä»£`public static<T> Stream<T> iterate(final T seed, final UnaryOperator<T> f)`

  ```java
  Stream<Integer> stream = Stream.iterate(0, x -> x + 2);
  stream.limit(10).forEach(System.out::println);// éå†å‰10ä¸ª
  ```

- ç”Ÿæˆ`public static<T> Stream<T> generate(Supplier<T> s)`

  ```java
  Stream<Double> stream1 = Stream.generate(Math::random);
  stream1.limit(10).forEach(System.out::println);// ç”Ÿæˆéšæœºæ•°10ä¸ª
  ```

### Arrays.stream ğŸ”¥

Java8 ä¸­çš„ `Arrays` çš„**é™æ€æ–¹æ³•** `stream()` å¯ä»¥è·å–æ•°ç»„æµ

- `static <T> Stream<T> stream(T[] array)`ï¼šè¿”å›ä¸€ä¸ªæµ

  é‡è½½å½¢å¼ï¼Œèƒ½å¤Ÿå¤„ç†å¯¹åº”åŸºæœ¬ç±»å‹çš„æ•°ç»„ï¼š

  - `public static IntStream stream(int[] array)`
  - `public static LongStream stream(long[] array)`
  - `public static DoubleStream stream(double[] array)`

### collection.stream ğŸ”¥

Java8 ä¸­çš„ `Collection` æ¥å£è¢«æ‰©å±•ï¼Œæä¾›äº†ä¸¤ä¸ªè·å–æµçš„**æ™®é€šæˆå‘˜æ–¹æ³•**

- `default Stream<E> stream()`ï¼šè¿”å›ä¸€ä¸ªé¡ºåºæµ
- `default Stream<E> parallelStream()`ï¼šè¿”å›ä¸€ä¸ªå¹¶è¡Œæµï¼›`stream.parallel()`ä¹Ÿå¯ä»¥è·å–å¹¶è¡Œæµ

## Stream çš„ä¸­é—´æ“ä½œ

**Stream å±äºç®¡é“æµ**ï¼Œ**åªèƒ½è¢«ä½¿ç”¨ä¸€æ¬¡**ï¼Œæ•°æ®ä»ä¸Šä¸€ä¸ª Stream ä¼ åˆ°ä¸‹ä¸€ä¸ª Stream ä¸Šï¼Œä¸Šä¸€ä¸ª Stream å·²ç»å…³é—­ã€‚å¤šä¸ªä¸­é—´æ“ä½œå¯ä»¥è¿æ¥èµ·æ¥å½¢æˆä¸€ä¸ªæµæ°´çº¿ï¼Œé™¤éæµæ°´çº¿ä¸Šè§¦å‘ç»ˆæ­¢æ“ä½œï¼Œå¦åˆ™ä¸­é—´æ“ä½œä¸ä¼šæ‰§è¡Œä»»ä½•çš„å¤„ç†ï¼Œè€Œåœ¨ç»ˆæ­¢æ“ä½œæ—¶ä¸€æ¬¡æ€§å…¨éƒ¨å¤„ç†ï¼Œç§°ä¸ºâ€œ**æƒ°æ€§æ±‚å€¼ï¼ˆå»¶è¿Ÿæ–¹æ³•ï¼‰**â€ã€‚

### ç­›é€‰ä¸åˆ‡ç‰‡

- `filter(Predicate p)`

  æ¥æ”¶ Lambdaï¼Œ ä»æµä¸­**æ’é™¤è¿‡æ»¤æŸäº›å…ƒç´ **

- `limit(long maxSize)`

  **æˆªæ–­æµ**ï¼Œä½¿å…¶å…ƒç´ ä¸è¶…è¿‡ç»™å®šæ•°é‡ï¼Œæˆªå–å‰ maxSize ä¸ª

- `skip(long n)`

  è¿”å›ä¸€ä¸ª**æ‰”æ‰äº†å‰ n ä¸ªå…ƒç´ çš„æµ**ã€‚è‹¥æµä¸­å…ƒç´ ä¸è¶³ n ä¸ªï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºæµã€‚ä¸ `limit(n)` äº’è¡¥

- `distinct()`

  ç­›é€‰ï¼Œé€šè¿‡æµæ‰€ç”Ÿæˆå…ƒç´ çš„ `hashCode()` å’Œ `equals()` **å»é™¤é‡å¤å…ƒç´ **

  ```java
  @Test
  public void test1(){
      List<Employee> list = EmployeeData.getEmployees();
      //filter(Predicate p)â€”â€”æ¥æ”¶ Lambda ï¼Œ ä»æµä¸­æ’é™¤æŸäº›å…ƒç´ ã€‚
      // æ¯æ¬¡éƒ½éœ€è¦é‡æ–°è·å– Stream

      //ç»ƒä¹ ï¼šæŸ¥è¯¢å‘˜å·¥è¡¨ä¸­è–ªèµ„å¤§äº7000çš„å‘˜å·¥ä¿¡æ¯
      list.stream();.filter(e -> e.getSalary() > 7000).forEach(System.out::println);
  
      //limit(n)â€”â€”æˆªæ–­æµï¼Œä½¿å…¶å…ƒç´ ä¸è¶…è¿‡ç»™å®šæ•°é‡ã€‚
      list.stream().limit(3).forEach(System.out::println);
  
      //skip(n) â€”â€” è·³è¿‡å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ‰”æ‰äº†å‰ n ä¸ªå…ƒç´ çš„æµã€‚è‹¥æµä¸­å…ƒç´ ä¸è¶³ n ä¸ªï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºæµã€‚ä¸ limit(n) äº’è¡¥
      list.stream().skip(3).forEach(System.out::println);
  
      //distinct()â€”â€”ç­›é€‰ï¼Œé€šè¿‡æµæ‰€ç”Ÿæˆå…ƒç´ çš„ hashCode() å’Œ equals() å»é™¤é‡å¤å…ƒç´ 
      list.add(new Employee(1010,"åˆ˜å¼ºä¸œ",40,8000));
      list.add(new Employee(1010,"åˆ˜å¼ºä¸œ",41,8000));
      list.add(new Employee(1010,"åˆ˜å¼ºä¸œ",40,8000));
      list.add(new Employee(1010,"åˆ˜å¼ºä¸œ",40,8000));
      list.add(new Employee(1010,"åˆ˜å¼ºä¸œ",40,8000));
      list.stream().distinct().forEach(System.out::println);
  }
  ```



### æ˜ å°„

- `map(Function f)`
  æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶å°†å…¶æ˜ å°„æˆä¸€ä¸ªæ–°çš„å…ƒç´ ã€‚

  `mapToDouble(ToDoubleFunction f)`
  æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„ DoubleStreamã€‚

  `mapToInt(ToIntFunction f)`
  æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„ IntStreamã€‚

  `mapToLong(ToLongFunction f)`
  æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„ LongStreamã€‚

- `flatMap(Function f)`
  æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå°†æµä¸­çš„æ¯ä¸ªå€¼éƒ½æ¢æˆå¦ä¸€ä¸ªæµï¼Œç„¶åæŠŠæ‰€æœ‰æµè¿æ¥æˆä¸€ä¸ªæµï¼Œç±»ä¼¼ List ä¸­çš„ `addAll()` æ–¹æ³•

  ```java
  @Test
  public void test2(){
      // map(Function f)â€”â€”æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå°†å…ƒç´ è½¬æ¢æˆå…¶ä»–å½¢å¼æˆ–æå–ä¿¡æ¯ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶å°†å…¶æ˜ å°„æˆä¸€ä¸ªæ–°çš„å…ƒç´ ã€‚
      List<String> list = Arrays.asList("aa", "bb", "cc", "dd");
      list.stream().map(str -> str.toUpperCase()).forEach(System.out::println);

      // ç»ƒä¹ 1ï¼šè·å–å‘˜å·¥å§“åé•¿åº¦å¤§äº3çš„å‘˜å·¥çš„å§“åã€‚
      List<Employee> employees = EmployeeData.getEmployees();
      Stream<String> namesStream = employees.stream().map(Employee::getName);
      namesStream.filter(name -> name.length() > 3).forEach(System.out::println);
      // -----------------------------------------------------
      //ç»ƒä¹ 2ï¼š
      Stream<Stream<Character>> streamStream = list.stream().map(StreamAPITest1::fromStringToStream);
      streamStream.forEach(s ->{
          s.forEach(System.out::println);
      });
  
      // flatMap(Function f)â€”â€”æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå°†æµä¸­çš„æ¯ä¸ªå€¼éƒ½æ¢æˆå¦ä¸€ä¸ªæµï¼Œç„¶åæŠŠæ‰€æœ‰æµè¿æ¥æˆä¸€ä¸ªæµã€‚
      Stream<Character> characterStream = list.stream().flatMap(StreamAPITest1::fromStringToStream);
      characterStream.forEach(System.out::println);
  }
  
  //å°†å­—ç¬¦ä¸²ä¸­çš„å¤šä¸ªå­—ç¬¦æ„æˆçš„é›†åˆè½¬æ¢ä¸ºå¯¹åº”çš„Streamçš„å®ä¾‹
  public static Stream<Character> fromStringToStream(String str){//aa
      ArrayList<Character> list = new ArrayList<>();
      for(Character c : str.toCharArray()){
          list.add(c);
      }
      return list.stream();
  }
  ```





### æ’åº

- `sorted()`
  äº§ç”Ÿä¸€ä¸ªæ–°æµï¼ŒæŒ‰è‡ªç„¶é¡ºåºæ’åº
- `sorted(Comparator com)`
  äº§ç”Ÿä¸€ä¸ªæ–°æµï¼ŒæŒ‰æ¯”è¾ƒå™¨é¡ºåºæ’åº

## Stream çš„ç»ˆæ­¢æ“ä½œ

ç»ˆç«¯æ“ä½œä¼šä»æµçš„æµæ°´çº¿ç”Ÿæˆç»“æœã€‚å…¶ç»“æœå¯ä»¥æ˜¯ä»»ä½•ä¸æ˜¯æµçš„å€¼ï¼Œä¾‹å¦‚ï¼šListã€Integerï¼Œç”šè‡³æ˜¯ void ã€‚æµè¿›è¡Œäº†ç»ˆæ­¢æ“ä½œåï¼Œä¸èƒ½å†æ¬¡ä½¿ç”¨ã€‚

### åŒ¹é…ä¸æŸ¥æ‰¾

- `boolean allMatch(Predicate p)`
  æ£€æŸ¥æ˜¯å¦åŒ¹é…æ‰€æœ‰å…ƒç´ 

- `boolean anyMatch(Predicate p)`
  æ£€æŸ¥æ˜¯å¦è‡³å°‘åŒ¹é…ä¸€ä¸ªå…ƒç´ 

- `boolean noneMatch(Predicate p)`
  æ£€æŸ¥æ˜¯å¦æ²¡æœ‰åŒ¹é…æ‰€æœ‰å…ƒç´ 

- `Optional<T> findFirst()`
  è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ 

- `Optional<T> findAny()`
  è¿”å›å½“å‰æµä¸­çš„ä»»æ„å…ƒç´ 

- `long count()`
  è¿”å›æµä¸­å…ƒç´ æ€»æ•°

- `Optional<T> max(Comparator c)`
  è¿”å›æµä¸­æœ€å¤§å€¼

- `Optional<T> min(Comparator c)`
  è¿”å›æµä¸­æœ€å°å€¼

- `void forEach(Consumer c)`
  **å†…éƒ¨è¿­ä»£**(ä½¿ç”¨ Collection æ¥å£éœ€è¦ç”¨æˆ·å»åšè¿­ä»£ç§°ä¸ºå¤–éƒ¨è¿­ä»£ã€‚ç›¸å Stream API ä½¿ç”¨å†…éƒ¨è¿­ä»£â€”â€”å®ƒå¸®ä½ æŠŠè¿­ä»£åšäº†)

  ```java
  @Test
  public void test1(){
    List<Employee> employees = EmployeeData.getEmployees();

    // allMatch(Predicate p)â€”â€”æ£€æŸ¥æ˜¯å¦åŒ¹é…æ‰€æœ‰å…ƒç´ ã€‚
    // ç»ƒä¹ ï¼šæ˜¯å¦æ‰€æœ‰çš„å‘˜å·¥çš„å¹´é¾„éƒ½å¤§äº18
    boolean allMatch = employees.stream().allMatch(e -> e.getAge() > 18);
    System.out.println(allMatch);

    // anyMatch(Predicate p)â€”â€”æ£€æŸ¥æ˜¯å¦è‡³å°‘åŒ¹é…ä¸€ä¸ªå…ƒç´ ã€‚
    // ç»ƒä¹ ï¼šæ˜¯å¦å­˜åœ¨å‘˜å·¥çš„å·¥èµ„å¤§äº 10000
    boolean anyMatch = employees.stream().anyMatch(e -> e.getSalary() > 10000);
    System.out.println(anyMatch);

    // noneMatch(Predicate p)â€”â€”æ£€æŸ¥æ˜¯å¦æ²¡æœ‰åŒ¹é…çš„å…ƒç´ ã€‚
    // ç»ƒä¹ ï¼šæ˜¯å¦å­˜åœ¨å‘˜å·¥å§“â€œé›·â€
    boolean noneMatch = employees.stream().noneMatch(e -> e.getName().startsWith("é›·"));
    System.out.println(noneMatch);

    // findFirstâ€”â€”è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ 
    Optional<Employee> employee = employees.stream().findFirst();
    System.out.println(employee);

    // findAnyâ€”â€”è¿”å›å½“å‰æµä¸­çš„ä»»æ„å…ƒç´ 
    Optional<Employee> employee1 = employees.parallelStream().findAny();
    System.out.println(employee1);
  }

  @Test
  public void test2(){
    List<Employee> employees = EmployeeData.getEmployees();

    // countâ€”â€”è¿”å›æµä¸­å…ƒç´ çš„æ€»ä¸ªæ•°
    long count = employees.stream().filter(e -> e.getSalary() > 5000).count();
    System.out.println(count);

    // max(Comparator c)â€”â€”è¿”å›æµä¸­æœ€å¤§å€¼
    // ç»ƒä¹ ï¼šè¿”å›æœ€é«˜çš„å·¥èµ„ï¼š
    Stream<Double> salaryStream = employees.stream().map(e -> e.getSalary());
    Optional<Double> maxSalary = salaryStream.max(Double::compare);
    System.out.println(maxSalary);

    // min(Comparator c)â€”â€”è¿”å›æµä¸­æœ€å°å€¼
    // ç»ƒä¹ ï¼šè¿”å›æœ€ä½å·¥èµ„çš„å‘˜å·¥
    Optional<Employee> employee = employees.stream().min((e1, e2) -> Double.compare(e1.getSalary(), e2.getSalary()));
    System.out.println(employee);

    // forEach(Consumer c)â€”â€”å†…éƒ¨è¿­ä»£
    employees.stream().forEach(System.out::println);

    //ä½¿ç”¨é›†åˆçš„éå†æ“ä½œ
    employees.forEach(System.out::println);
  }
  ```

### å½’çº¦

- `reduce(T iden, BinaryOperator b)`
  å¯ä»¥å°†æµä¸­å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ï¼Œè¿”å› `T`ï¼Œ`iden`ä¸ºåˆå§‹å€¼

- `reduce(BinaryOperator b)`
  å¯ä»¥å°†æµä¸­å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ã€‚è¿”å› `Optional<T>`

  > map å’Œ reduce çš„è¿æ¥é€šå¸¸ç§°ä¸º map-reduce æ¨¡å¼ï¼Œå›  Google ç”¨å®ƒæ¥è¿›è¡Œç½‘ç»œæœç´¢è€Œå‡ºåã€‚

  ```java
  @Test
  public void test3(){
      // reduce(T identity, BinaryOperator)â€”â€”å¯ä»¥å°†æµä¸­å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ã€‚è¿”å› T

      // ç»ƒä¹ 1ï¼šè®¡ç®—1-10çš„è‡ªç„¶æ•°çš„å’Œ
      List<Integer> list = Arrays.asList(1,2,3,4,5,6,7,8,9,10);
      Integer sum = list.stream().reduce(0, Integer::sum);// 0 ä¸ºåˆå§‹å€¼
      System.out.println(sum);// 55
  
      // reduce(BinaryOperator) â€”â€”å¯ä»¥å°†æµä¸­å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ã€‚è¿”å› Optional<T>
      // ç»ƒä¹ 2ï¼šè®¡ç®—å…¬å¸æ‰€æœ‰å‘˜å·¥å·¥èµ„çš„æ€»å’Œ
      List<Employee> employees = EmployeeData.getEmployees();
      Stream<Double> salaryStream = employees.stream().map(Employee::getSalary);
      Optional<Double> sumMoney = salaryStream.reduce(Double::sum);
      // Optional<Double> sumMoney = salaryStream.reduce((d1,d2) -> d1 + d2);
      System.out.println(sumMoney.get());
  }
  ```



### æ”¶é›†

- `collect(Collector c)`
  å°†æµè½¬æ¢ä¸ºå…¶ä»–å½¢å¼ã€‚æ¥æ”¶ä¸€ä¸ª `Collector` æ¥å£çš„å®ç°ï¼Œç”¨äºç»™`Stream`ä¸­å…ƒç´ åšæ±‡æ€»çš„æ–¹æ³•ã€‚Collector æ¥å£ä¸­æ–¹æ³•çš„å®ç°å†³å®šäº†å¦‚ä½•å¯¹æµæ‰§è¡Œæ”¶é›†çš„æ“ä½œ(å¦‚æ”¶é›†åˆ° Listã€Setã€ Map)ã€‚å¦å¤–ï¼Œ`Collectors` å®ç”¨ç±»æä¾›äº†å¾ˆå¤šé™æ€æ–¹æ³•ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºå¸¸è§æ”¶é›†å™¨å®ä¾‹ï¼Œ å…·ä½“æ–¹æ³•ä¸å®ä¾‹å¦‚ä¸‹è¡¨:

- `static List<T> toList`

  **æŠŠæµä¸­å…ƒç´ æ”¶é›†åˆ° List**
  
  ```java
  List<Employee> emps= list.stream().collect(Collectors.toList());
  ```

- `static Set<T> toSet`

  **æŠŠæµä¸­å…ƒç´ æ”¶é›†åˆ° Set**

  ```java
  Set<Employee> emps= list.stream().collect(Collectors.toSet());
  ```

- `static Collection<T> toCollection`

  **æŠŠæµä¸­å…ƒç´ æ”¶é›†åˆ°åˆ›å»ºçš„é›†åˆ**

  ```java
  Collection<Employee> emps =list.stream().collect(Collectors.toCollection(ArrayList::new));
  ```

- `Object[] toArray()`

  **è½¬ä¸ºæ•°ç»„**ï¼Œè¿”å›åŒ…å«æ­¤æµçš„å…ƒç´ çš„æ•°ç»„

  ```java
  //ç•¥
  ```

- `<A> A[] toArray(IntFunction<A[]> generator)`

  é€šè¿‡**æ–¹æ³•å¼•ç”¨æŒ‡å®šåˆ›å»ºæ•°ç»„**ç±»å‹å¦‚`String[]::new`

  ```java
  // ç•¥
  ```

- `static <T> Stream<T> concat(Stream<? extends T> a, Stream<? extends T> b)`

  **åˆå¹¶æµ**

  ```java
  Stream<String> one2 = one.stream().filter(name -> name.length() == 3).limit(3);
  Stream<String> two2 = two.stream().filter(name -> name.startsWith("å¼ ")).skip(2);
  Stream.concat(one2, two2).map(name -> new Person(name)).forEach(name -> System.out.println(name));
  ```

- `Long counting`

  è®¡ç®—æµä¸­å…ƒç´ çš„ä¸ªæ•°

  ```java
  long count = list.stream().collect(Collectors.counting());
  ```

- `Integer summingInt`

  å¯¹æµä¸­å…ƒç´ çš„æ•´æ•°å±æ€§æ±‚å’Œ

  ```java
  int total=list.stream().collect(Collectors.summingInt(Employee::getSalary));
  ```

- `Double averagingInt`

  è®¡ç®—æµä¸­å…ƒç´  Integer å±æ€§çš„å¹³å‡å€¼

  ```java
  double avg = list.stream().collect(Collectors.averagingInt(Employee::getSalary));
  ```

- `IntSummaryStatistics summarizingInt`

  æ”¶é›†æµä¸­ Integer å±æ€§çš„ç»Ÿè®¡å€¼ã€‚å¦‚å¹³å‡å€¼

  ```java
  int SummaryStatisticsiss= list.stream().collect(Collectors.summarizingInt(Employee::getSalary));
  ```

- `String joining([CharSequence delimiter])`

  è¿æ¥æµä¸­æ¯ä¸ªå­—ç¬¦ä¸²

  æ³¨æ„ï¼Œä½¿ç”¨`delimiter`æ—¶è¦ç¡®å®š`map`ä¸­æ•°æ®ç±»å‹

  ```java
  String str= list.stream().map(Employee::getName).collect(Collectors.joining());
  ```

- `Optional<T> maxBy`

  æ ¹æ®æ¯”è¾ƒå™¨é€‰æ‹©æœ€å¤§å€¼

  ```java
  Optional<Emp>max= list.stream().collect(Collectors.maxBy(comparingInt(Employee::getSalary)));
  ```

- `Optional<T> minBy`

  æ ¹æ®æ¯”è¾ƒå™¨é€‰æ‹©æœ€å°å€¼

  ```java
  Optional<Emp> min = list.stream().collect(Collectors.minBy(comparingInt(Employee::getSalary)));
  ```

- `å½’çº¦äº§ç”Ÿçš„ç±»å‹ reducing`

  ä»ä¸€ä¸ªä½œä¸ºç´¯åŠ å™¨çš„åˆå§‹å€¼å¼€å§‹ï¼Œ åˆ©ç”¨ BinaryOperator ä¸æµä¸­å…ƒç´ é€ä¸ªç»“åˆï¼Œä»è€Œå½’çº¦æˆå•ä¸ªå€¼

  ```java
  int total=list.stream().collect(Collectors.reducing(0, Employee::getSalar, Integer::sum));
  ```

- `è½¬æ¢å‡½æ•°è¿”å›çš„ç±»å‹ collectingAndThen`

  åŒ…è£¹å¦ä¸€ä¸ªæ”¶é›†å™¨ï¼Œå¯¹å…¶ç»“æœè½¬æ¢å‡½æ•°

  ```java
  int how= list.stream().collect(Collectors.collectingAndThen(Collectors.toList(), List::size));
  ```

- `Map<K, List<T>> groupingBy`

  æ ¹æ®æŸå±æ€§å€¼å¯¹æµåˆ†ç»„ï¼Œå±æ€§ä¸º K ç»“æœä¸º V

  ```java
  Map<Emp.Status, List<Emp>> map= list.stream() .collect(Collectors.groupingBy(Employee::getStatus));
  ```

- `Map<Boolean, List<T>> partitioningBy`

  æ ¹æ® true æˆ– false è¿›è¡Œåˆ†åŒº

  ```java
  Map<Boolean,List<Emp>> vd = list.stream().collect(Collectors.partitioningBy(Employee::getManage));
  ```

  ```java
  @Test
  public void test4(){
    // collect(Collector c)â€”â€”å°†æµè½¬æ¢ä¸ºå…¶ä»–å½¢å¼ã€‚æ¥æ”¶ä¸€ä¸ª Collectoræ¥å£çš„å®ç°ï¼Œç”¨äºç»™Streamä¸­å…ƒç´ åšæ±‡æ€»çš„æ–¹æ³•
    // ç»ƒä¹ 1ï¼šæŸ¥æ‰¾å·¥èµ„å¤§äº6000çš„å‘˜å·¥ï¼Œç»“æœè¿”å›ä¸ºä¸€ä¸ªListæˆ–Set

    List<Employee> employees = EmployeeData.getEmployees();
    List<Employee> employeeList = employees.stream().filter(e -> e.getSalary() >6000).collect(Collectors.toList());

    employeeList.forEach(System.out::println);
    System.out.println();
    Set<Employee> employeeSet = employees.stream().filter(e -> e.getSalary() > 6000).collect(Collectors.toSet());

    employeeSet.forEach(System.out::println);
  }
  ```

## ä¹ é¢˜

### è¿”å›ä¸€ä¸ªç”±æ¯ä¸ªæ•°çš„å¹³æ–¹ ğŸ”¥

ç»™å®šä¸€ä¸ªæ•°å­—åˆ—è¡¨ï¼Œå¦‚ä½•è¿”å›ä¸€ä¸ªç”±æ¯ä¸ªæ•°çš„å¹³æ–¹æ„æˆçš„åˆ—è¡¨å‘¢ï¼Ÿ

ä¾‹å¦‚ï¼Œç»™å®šã€1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ã€‘ï¼Œ åº”è¯¥è¿”å›ã€1ï¼Œ4ï¼Œ9ï¼Œ16ï¼Œ25ã€‘ã€‚

```java
@Test
void test1() {
    // ArrayList<Integer> list = new ArrayList<>(Arrays.asList(1, 2, 3, 4, 5));
    List<Integer> list = Arrays.asList(1, 2, 3, 4, 5);

    // é•¿åº¦ä¸å˜ï¼Œæ‰€ä»¥å¯ä»¥æ“ä½œ Arrays.asList ç”Ÿæˆçš„
    List<Integer> list2 = list.stream().map(i -> i * i).collect(Collectors.toList());
    System.out.println(list2);
}
```

### reduce & BinaryOperatorğŸ”¥

æ€æ ·ç”¨ map å’Œ reduce æ–¹æ³•æ•°ä¸€æ•°æµä¸­æœ‰å¤šå°‘ä¸ª Employee å‘¢ï¼Ÿ

```java
List<Employee> emps = Arrays.asList(
    new Employee(102, "æå››", 59, 6666.66, Status.BUSY),
    new Employee(101, "å¼ ä¸‰", 18, 9999.99, Status.FREE),
    new Employee(103, "ç‹äº”", 28, 3333.33, Status.VOCATION),
    new Employee(104, "èµµå…­", 8, 7777.77, Status.BUSY),
    new Employee(104, "èµµå…­", 8, 7777.77, Status.FREE),
    new Employee(104, "èµµå…­", 8, 7777.77, Status.FREE),
    new Employee(105, "ç”°ä¸ƒ", 38, 5555.55, Status.BUSY)
);

@Test
void test2() {
    long count = emps.stream().count();
    System.out.println(count);

    // BinaryOperator å‡½æ•°å¼æ¥å£ä½¿ç”¨ï¼ŒT apply(T t1, T t2)
    Integer count2 = emps.stream().map(i -> 1).reduce(Integer::sum).get();
    System.out.println(count2);
}
```

### äº¤æ˜“æ“ä½œ ğŸ”¥

```java
/**
 * äº¤æ˜“å‘˜ç±»
 */

@Data
@NoArgsConstructor
@AllArgsConstructor
public class Trader {
    private String name;
    private String city;
}
```

```java
/**
 * äº¤æ˜“ç±»
 */
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Transaction {
    private Trader trader;
    private int year;
    private int value;
}
```

1.  æ‰¾å‡º 2011 å¹´å‘ç”Ÿçš„æ‰€æœ‰äº¤æ˜“ï¼Œ å¹¶æŒ‰äº¤æ˜“é¢æ’åºï¼ˆä»ä½åˆ°é«˜ï¼‰

2.  äº¤æ˜“å‘˜éƒ½åœ¨å“ªäº›ä¸åŒçš„åŸå¸‚å·¥ä½œè¿‡

3.  æŸ¥æ‰¾æ‰€æœ‰æ¥è‡ªå‰‘æ¡¥çš„äº¤æ˜“å‘˜ï¼Œå¹¶æŒ‰å§“åæ’åº

4.  è¿”å›æ‰€æœ‰äº¤æ˜“å‘˜çš„å§“åå­—ç¬¦ä¸²ï¼ŒæŒ‰å­—æ¯é¡ºåºæ’åº

5.  æœ‰æ²¡æœ‰äº¤æ˜“å‘˜æ˜¯åœ¨ç±³å…°å·¥ä½œçš„

6.  æ‰“å°ç”Ÿæ´»åœ¨å‰‘æ¡¥çš„äº¤æ˜“å‘˜çš„æ‰€æœ‰äº¤æ˜“é¢

7.  æ‰€æœ‰äº¤æ˜“ä¸­ï¼Œæœ€é«˜çš„äº¤æ˜“é¢æ˜¯å¤šå°‘

8.  æ‰¾åˆ°äº¤æ˜“é¢æœ€å°çš„äº¤æ˜“

```java
public class TransactionTest {

    List<Transaction> transactions;

    @BeforeEach
    void setUp() {
        Trader raoul = new Trader("Raoul", "Cambridge");
        Trader mario = new Trader("Mario", "Milan");
        Trader alan = new Trader("Alan", "Cambridge");
        Trader brian = new Trader("Brian", "Cambridge");

        transactions = Arrays.asList(
                new Transaction(brian, 2011, 300),
                new Transaction(raoul, 2012, 1000),
                new Transaction(raoul, 2011, 400),
                new Transaction(mario, 2012, 710),
                new Transaction(mario, 2012, 700),
                new Transaction(alan, 2012, 950)
        );
    }

    /**
     * æ‰¾å‡º2011å¹´å‘ç”Ÿçš„æ‰€æœ‰äº¤æ˜“ï¼Œå¹¶æŒ‰äº¤æ˜“é¢æ’åºï¼ˆä»ä½åˆ°é«˜ï¼‰
     */
    @Test
    void test1() {
        transactions
                .stream()
                .filter(transaction -> transaction.getYear() == 2011)
                .sorted(Comparator.comparingInt(Transaction::getValue))
                .forEach(System.out::println);
    }

    /**
     * äº¤æ˜“å‘˜éƒ½åœ¨å“ªäº›ä¸åŒçš„åŸå¸‚å·¥ä½œè¿‡
     */
    @Test
    void test2() {
        transactions
                .stream()
                .map(transaction -> transaction.getTrader().getCity())
                .distinct()
                .forEach(System.out::println);
    }

    /**
     * æŸ¥æ‰¾æ‰€æœ‰æ¥è‡ªå‰‘æ¡¥çš„äº¤æ˜“å‘˜ï¼Œå¹¶æŒ‰å§“åæ’åº
     */
    @Test
    void test3() {
        transactions
                .stream()
                .filter(transaction -> "Cambridge".equals(transaction.getTrader().getCity()))
                .map(transaction -> transaction.getTrader().getName())
                .distinct()
                .sorted(String::compareTo)
                .forEach(System.out::println);
    }

    /**
     * è¿”å›æ‰€æœ‰äº¤æ˜“å‘˜çš„å§“åå­—ç¬¦ä¸²ï¼ŒæŒ‰å­—æ¯é¡ºåºæ’åº
     */
    @Test
    void test4() {
        transactions
                .stream()
                .map(transaction -> transaction.getTrader().getName())
                .distinct()
                .sorted(String::compareTo)
                .forEach(System.out::print);
        // AlanBrianMarioRaoul
        System.out.println();


        String reduce = transactions
                .stream()
                .map(transaction -> transaction.getTrader().getName())
                .distinct()
                .sorted(String::compareTo)
                .reduce("", String::concat);
        System.out.println(reduce);
        // AlanBrianMarioRaoul

        // è¿™ä¸ªåªæ˜¯ç»ƒä¹ äº†ä¸‹ flatMap è½¬æ¢ä¸ºæµ
        transactions.stream()
                .map((t) -> t.getTrader().getName())
                .flatMap(TransactionTest::filterCharacter)
                // .sorted(String::compareToIgnoreCase)
                .forEach(System.out::print);
        // BrianRaoulRaoulMarioMarioAlan

    }

    private static Stream<String> filterCharacter(String str){
        List<String> list = new ArrayList<>();

        for (Character ch : str.toCharArray()) {
            list.add(ch.toString());
        }

        return list.stream();
    }

    /**
     * æœ‰æ²¡æœ‰äº¤æ˜“å‘˜æ˜¯åœ¨ç±³å…°å·¥ä½œçš„
     */
    @Test
    void test5() {
        boolean b = transactions
                .stream()
                .anyMatch(transaction -> "Milan".equals(transaction.getTrader().getCity()));
        System.out.println(b);
    }


    /**
     * æ‰“å°ç”Ÿæ´»åœ¨å‰‘æ¡¥çš„äº¤æ˜“å‘˜çš„æ‰€æœ‰äº¤æ˜“é¢
     */
    @Test
    void test6() {
        Optional<Integer> reduce = transactions
                .stream()
                .filter(transaction -> "Cambridge".equals(transaction.getTrader().getCity()))
                .map(Transaction::getValue)
                .reduce(Integer::sum);

        System.out.println(reduce.orElse(0));
    }

    /**
     * æ‰€æœ‰äº¤æ˜“ä¸­ï¼Œæœ€é«˜çš„äº¤æ˜“é¢æ˜¯å¤šå°‘
     */
    @Test
    void test7() {
        Optional<Integer> max = transactions
                .stream()
                .map(Transaction::getValue)
                .max(Comparator.naturalOrder());// è‡ªç„¶æ’åº
                // .min(Comparator.reverseOrder());// é€†åº
                // .max(Integer::compare);
                // .max(Integer::compareTo);
                // .max(Comparator.comparingInt(o -> o));
        System.out.println(max.orElse(0));
    }

    /**
     * æ‰¾åˆ°äº¤æ˜“é¢æœ€å°çš„äº¤æ˜“
     */
    @Test
    void test8() {
        Optional<Transaction> min = transactions
                .stream()
                .min(Comparator.comparingInt(Transaction::getValue));
        System.out.println(min.orElse(null));

    }
}
```
