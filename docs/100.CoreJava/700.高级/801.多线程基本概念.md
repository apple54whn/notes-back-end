---
title: å¤šçº¿ç¨‹åŸºæœ¬æ¦‚å¿µ
date: 2020-12-14 23:04:18
permalink: /pages/9fcc8d/
categories:
  - Java
  - Core
tags:
  -
---

# å¤šçº¿ç¨‹åŸºæœ¬æ¦‚å¿µ

## æ“ä½œç³»ç»Ÿã€ç¨‹åºã€è¿›ç¨‹ã€çº¿ç¨‹

### æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰

æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰æ˜¯åŒ…å«å¤šä¸ªè¿›ç¨‹çš„å®¹å™¨ï¼Œè€Œæ¯ä¸ªè¿›ç¨‹åˆéƒ½æ˜¯å®¹çº³å¤šä¸ªçº¿ç¨‹çš„å®¹å™¨



### ç¨‹åºï¼ˆProgramï¼‰

ç¨‹åºæ˜¯ä¸ºå®Œæˆç‰¹å®šä»»åŠ¡ã€ç”¨æŸç§è¯­è¨€ç¼–å†™çš„ä¸€ç»„**æŒ‡ä»¤çš„é›†åˆ**ã€‚å³æŒ‡**ä¸€æ®µé™æ€çš„ä»£ç **ï¼Œ**é™æ€å¯¹è±¡**ã€‚



### è¿›ç¨‹ï¼ˆProcessï¼‰ğŸ”¥

**è¿›ç¨‹æ˜¯æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªç¨‹åºã€‚æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹**ï¼Œæ˜¯**ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½**

- æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ª**ç‹¬ç«‹çš„å†…å­˜ç©ºé—´**ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå¤šæ¬¡è¿è¡Œå¯¹åº”å¤šä¸ªè¿›ç¨‹ã€‚
- å®ƒæ˜¯ä¸€ä¸ª**åŠ¨æ€çš„è¿‡ç¨‹**ï¼Œç³»ç»Ÿè¿è¡Œä¸€ä¸ªç¨‹åºå³æ˜¯ä¸€ä¸ªè¿›ç¨‹ä»åˆ›å»ºã€è¿è¡Œåˆ°æ¶ˆäº¡çš„è¿‡ç¨‹ï¼Œå³ç”Ÿå‘½å‘¨æœŸã€‚

Oracle æ–‡æ¡£ä¸­å®šä¹‰è¿›ç¨‹æ˜¯ï¼šä½¿ç”¨forkï¼ˆ2ï¼‰ç³»ç»Ÿè°ƒç”¨åˆ›å»ºçš„UNIXç¯å¢ƒï¼ˆä¾‹å¦‚æ–‡ä»¶æè¿°ç¬¦ï¼Œç”¨æˆ·IDç­‰ï¼‰ï¼Œå®ƒè¢«è®¾ç½®ä¸ºè¿è¡Œç¨‹åº

å¯ä»¥ä½¿ç”¨æ´»åŠ¨ç›‘è§†å™¨æŸ¥çœ‹ï¼Œæœ‰è¿›ç¨‹ã€çº¿ç¨‹æ•°é‡ç­‰

![image-20210206215726196](../images/image-20210206215726196.png)



### çº¿ç¨‹ï¼ˆThreadï¼‰ğŸ”¥

**çº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªæ‰§è¡Œå•å…ƒ/è·¯å¾„**ï¼Œè´Ÿè´£å½“å‰è¿›ç¨‹ä¸­ç¨‹åºçš„æ‰§è¡Œï¼Œæ˜¯**å¤„ç†æœºè°ƒåº¦çš„åŸºæœ¬å•ä½**

Oracle æ–‡æ¡£ä¸­å®šä¹‰çº¿ç¨‹æ˜¯ï¼šåœ¨è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œçš„ä¸€ç³»åˆ—æŒ‡ä»¤

- **æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„è¿è¡Œæ ˆå’Œç¨‹åºè®¡æ•°å™¨**

- **ä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹å…±äº«ç›¸åŒçš„å†…å­˜å•å…ƒ/å†…å­˜åœ°å€ç©ºé—´**ï¼šå®ƒä»¬ä»åŒä¸€å †ä¸­åˆ†é…å¯¹è±¡ï¼Œå¯ä»¥è®¿é—®ç›¸åŒçš„å˜é‡å’Œå¯¹è±¡ã€‚è¿™å°±ä½¿å¾—çº¿ç¨‹é—´é€šä¿¡æ›´ç®€ä¾¿ã€é«˜æ•ˆã€‚ä½†å¤šä¸ªçº¿ç¨‹æ“ä½œå…±äº«çš„ç³»ç»Ÿèµ„æºå¯èƒ½ä¼šå¸¦æ¥**å®‰å…¨éšæ‚£**

- **çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€å°**

- çº¿ç¨‹**ä¸€å¯¹ä¸€æ˜ å°„**åˆ°OSçš„å†…æ ¸çº¿ç¨‹ï¼Œä½¿ç”¨JNIå®ç°çš„ã€‚è‹¥æ˜¯æ”¯æŒåç¨‹çš„è¯­è¨€ï¼Œå¯èƒ½å‡ åä¸ªåç¨‹å¯¹åº”ä¸€ä¸ªOSçº¿ç¨‹

    ![image-20210208002102861](../images/image-20210208002102861.png)











### ã€é¢è¯•ã€‘è¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³»å’ŒåŒºåˆ«ï¼ŸğŸ”¥

<iframe id="embed_dom" name="embed_dom" frameborder="0" style="display:block;width:100%; height:645px;" src="https://www.processon.com/embed/601eac54e0b34d41a74224b6"></iframe>







### ã€å®ä¾‹ã€‘ä¸€ä¸ª Java åº”ç”¨ç¨‹åºè‡³å°‘æœ‰ä¸‰ä¸ªçº¿ç¨‹ğŸ”¥

ä¸€ä¸ª Java åº”ç”¨ç¨‹åºï¼Œè‡³å°‘æœ‰ä¸‰ä¸ªçº¿ç¨‹ï¼Ÿï¼š**main()ä¸»çº¿ç¨‹**ï¼Œ**gc()åƒåœ¾å›æ”¶çº¿ç¨‹**ï¼Œ**å¼‚å¸¸å¤„ç†çº¿ç¨‹**ã€‚å½“ç„¶å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œä¼šå½±å“ä¸»çº¿ç¨‹ã€‚æŸ¥çœ‹debugger æ¨¡å¼æ—¶å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä»£ç çš„çº¿ç¨‹

```java
public class Test {
    public static void main(String[] args) {
        System.out.println();
    }
}
```

![image-20210207224614131](../images/image-20210207224614131.png)

*   mainï¼šä¸»çº¿ç¨‹ï¼Œç¨‹åºçš„å…¥å£
*   Finalizerï¼šè´Ÿè´£å¯¹è±¡çš„ finalize() æ–¹æ³•ï¼Œåƒåœ¾å›æ”¶ï¼Œä¸æ¨èä¸»åŠ¨ä½¿ç”¨
*   Reference Handlerï¼šå’Œ GCã€å¼•ç”¨ç›¸å…³çš„çº¿ç¨‹
*   Signal Dispatcherï¼šä¿¡å·è°ƒåº¦ï¼ŒæŠŠæ“ä½œç³»ç»Ÿå‘æ¥çš„ä¿¡å·åˆ†å‘ç»™é€‚å½“çš„å¤„ç†ç¨‹åº



### ã€å®ä¾‹ã€‘æˆ¿å­

*   å®¢å…ï¼šæ¯ä¸ªçº¿ç¨‹éšæ—¶è¿›å‡º
*   å¨æˆ¿ï¼šçº¿ç¨‹å¹¶å‘ï¼Œçº¿ç¨‹é—´é€šä¿¡
*   å«ç”Ÿé—´ï¼šéœ€æœ‰é”
*   å§å®¤ï¼šçº¿ç¨‹ç‹¬ç«‹èµ„æºï¼Œå¦‚å †æ ˆ





## å¤šçº¿ç¨‹

### æ¦‚å¿µ

è‹¥**ä¸€ä¸ªè¿›ç¨‹åŒä¸€æ—¶é—´å¹¶è¡Œæ‰§è¡Œå¤šä¸ªçº¿ç¨‹**ï¼Œå°±æ˜¯æ”¯æŒå¤šçº¿ç¨‹çš„ã€‚ä¸€ä¸ªè¿›ç¨‹ä¸­**è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹**



### ä¸ºä»€ä¹ˆéœ€è¦å¤šçº¿ç¨‹ã€ä¼˜ç‚¹ ğŸ”¥

è‹¥æ˜¯å•æ ¸ CPUï¼Œåªä½¿ç”¨å•ä¸ªçº¿ç¨‹å…ˆåå®Œæˆå¤šä¸ªä»»åŠ¡(è°ƒç”¨å¤šä¸ªæ–¹æ³•)ï¼Œè‚¯å®šæ¯”ç”¨å¤šä¸ªçº¿ç¨‹æ¥å®Œæˆç”¨çš„æ—¶é—´æ›´çŸ­ï¼ˆçº¿ç¨‹åˆ‡æ¢æ—¶é—´é•¿ï¼‰ï¼Œä½†æ˜¯ç›®å‰å¤§éƒ¨åˆ†éƒ½æ˜¯å¤šæ ¸ CPUï¼Œé‚£å¤šçº¿ç¨‹ç©¶ç«Ÿæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ

*   æœ€ä¸»è¦çš„ç›®çš„å°±æ˜¯**æé«˜CPUåˆ©ç”¨ç‡**
    *   æé«˜**å¤„ç†é€Ÿåº¦**
    *   é¿å…**æ— æ•ˆç­‰å¾…**ï¼ˆIOæ—¶å¯ä»¥åšå…¶ä»–äº‹ï¼‰
    *   **æé«˜ç”¨æˆ·ä½“éªŒ**ï¼Œåº”ç”¨ç¨‹åºå“åº”å¿«ï¼Œé¿å…å¡é¡¿ï¼Œç¼©çŸ­ç­‰å¾…æ—¶é—´
        *   å¹¶è¡Œå¤„ç†ï¼Œæé«˜æ€§èƒ½ï¼Œé€šå¸¸æ˜¯æœåŠ¡å™¨é¢†åŸŸï¼ˆä¾‹å¦‚Tomcatï¼‰ï¼Œç”¨å¤šä¸ªçº¿ç¨‹å»æ¥æ”¶è¿›æ¥çš„HTTPè¯·æ±‚ï¼Œè€Œä¸æ˜¯æ’é˜Ÿç­‰å¾…å•ä¸€çš„çº¿ç¨‹å¤„ç†
        *   åœ¨Androidå¼€å‘ä¸­ï¼Œä¸»çº¿ç¨‹çš„é‡è¦ä»»åŠ¡ä¹‹ä¸€æ˜¯ç»˜åˆ¶å±å¹•ç•Œé¢ï¼Œå³ UI çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹ä¸­ä¸å…è®¸è¿›è¡ŒIOæ“ä½œæˆ–ç½‘ç»œè¯·æ±‚ï¼Œç›®çš„å°±æ˜¯é¿å…å¡é¡¿ï¼Œå½±å“ç”¨æˆ·çš„äº¤äº’

*   **ä¾¿äºç¼–ç¨‹å»ºæ¨¡ï¼Œæ”¹å–„ç¨‹åºç»“æ„**

    æŠŠè¿™ä¸ªå¤§çš„ä»»åŠ¡Aåˆ†è§£æˆå‡ ä¸ªå°ä»»åŠ¡ï¼Œä»»åŠ¡Bã€ä»»åŠ¡Cã€ä»»åŠ¡Dï¼Œåˆ†åˆ«å»ºç«‹ç¨‹åºæ¨¡å‹ï¼Œå¹¶é€šè¿‡å¤šçº¿ç¨‹åˆ†åˆ«è¿è¡Œè¿™å‡ ä¸ªä»»åŠ¡ï¼Œä¾¿äºç†è§£å’Œä¿®æ”¹

* **è®¡ç®—æœºæ€§èƒ½å®šå¾‹ï¼šæ‘©å°”å®šå¾‹å¤±æ•ˆï¼Œé˜¿å§†è¾¾å°”å®šå¾‹ç™»ä¸Šèˆå°**

    *   æ‘©å°”å®šå¾‹ï¼šå½“ä»·æ ¼ä¸å˜æ—¶ï¼Œé›†æˆç”µè·¯ä¸Šå¯å®¹çº³çš„**å…ƒå™¨ä»¶çš„æ•°ç›®**ï¼Œçº¦æ¯éš”18-24ä¸ªæœˆä¾¿ä¼š**å¢åŠ ä¸€å€**ï¼Œ**æ€§èƒ½ä¹Ÿå°†æå‡ä¸€å€**ã€‚
    *   é˜¿å§†è¾¾å°”å®šå¾‹ï¼š
        *   ç»“è®ºï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¤„ç†å™¨è¶Šå¤šï¼Œç¨‹åºæ‰§è¡Œçš„é€Ÿåº¦å°±ä¼šè¶Šå¿«ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªä¸Šé™ï¼Œä¸Šé™å–å†³äºç¨‹åºä¸­ä¸²è¡Œéƒ¨åˆ†çš„æ¯”ä¾‹ï¼Œ**å¹¶è¡Œçš„æ¯”ä¾‹è¶Šé«˜ï¼Œå¤šå¤„ç†å™¨çš„æ•ˆæœè¶Šæ˜æ˜¾**ã€‚ä½†æ˜¯å¤§éƒ¨åˆ†ç¨‹åºéƒ½æ˜¯ä¸²è¡Œå æ¯”å¤šï¼

![image-20210207231426774](../images/image-20210207231426774.png)



### å•æ ¸ã€å¤šæ ¸ CPU

- å•æ ¸ CPUï¼Œå…¶å®æ˜¯ä¸€ç§å‡çš„å¤šçº¿ç¨‹ï¼Œå› ä¸ºåœ¨ä¸€ä¸ªæ—¶é—´å•å…ƒå†…ï¼Œä¹Ÿåªèƒ½æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹çš„ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼šè™½ç„¶æœ‰å¤šè½¦é“ï¼Œä½†æ˜¯æ”¶è´¹ç«™åªæœ‰ä¸€ä¸ªå·¥ä½œäººå‘˜åœ¨æ”¶è´¹ï¼Œåªæœ‰æ”¶äº†è´¹æ‰èƒ½é€šè¿‡ï¼Œé‚£ä¹ˆ CPU å°±å¥½æ¯”æ”¶è´¹äººå‘˜ã€‚å¦‚æœæœ‰æŸä¸ªäººä¸æƒ³äº¤é’±ï¼Œé‚£ä¹ˆæ”¶è´¹äººå‘˜å¯ä»¥ æŠŠä»–â€œæŒ‚èµ·â€ï¼ˆæ™¾ç€ä»–ï¼Œç­‰ä»–æƒ³é€šäº†ï¼Œå‡†å¤‡å¥½äº†é’±ï¼Œå†å»æ”¶è´¹ï¼‰ã€‚ä½†æ˜¯å› ä¸º CPU æ—¶é—´å•å…ƒç‰¹åˆ«çŸ­ï¼Œå› æ­¤æ„Ÿè§‰ä¸å‡ºæ¥ã€‚
- å¤šæ ¸ CPUï¼Œèƒ½æ›´å¥½çš„å‘æŒ¥å¤šçº¿ç¨‹çš„æ•ˆç‡ã€‚ç°åœ¨çš„æœåŠ¡å™¨éƒ½æ˜¯å¤šæ ¸çš„ã€‚



### å¤šçº¿ç¨‹çš„ä½¿ç”¨åœºæ™¯ ğŸ”¥

- ä¸ºäº†**åŒæ—¶åšå¤šä»¶ä¸åŒçš„äº‹**ï¼šå¼€ç½‘é¡µåŒæ—¶å¬æ­Œï¼›åå°å®šæ—¶ä»»åŠ¡

- **ä¸ºäº†æé«˜å·¥ä½œæ•ˆç‡ã€å¤„ç†èƒ½åŠ›**ï¼šTomcatï¼›å¹¶è¡Œä¸‹è½½ï¼›NIO

    ç¨‹åºéœ€è¦å®ç°ä¸€äº›éœ€è¦**ç­‰å¾…çš„ä»»åŠ¡**æ—¶ï¼Œå¦‚ç”¨æˆ·è¾“å…¥ã€æ–‡ä»¶è¯»å†™æ“ä½œã€ç½‘ç»œæ“ä½œã€æœç´¢ç­‰

- éœ€è¦åŒæ—¶æœ‰å¾ˆå¤§å¹¶å‘é‡çš„æ—¶å€™ï¼šå‹æµ‹



### å¤šçº¿ç¨‹å±€é™ ğŸ”¥

*   æ€§èƒ½é—®é¢˜ï¼š**ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¶ˆè€—**
*   å¸¦æ¥**çº¿ç¨‹å®‰å…¨é—®é¢˜**ï¼š
    *   **æ•°æ®å®‰å…¨**é—®é¢˜ï¼ši++æ€»æ•°ä¸ä¸€è‡´
    *   **çº¿ç¨‹æ´»è·ƒæ€§**é—®é¢˜ï¼šçº¿ç¨‹é¥¥é¥¿ã€æ­»é”
*   å¼‚æ„åŒ–ä»»åŠ¡ï¼ˆä»»åŠ¡ç»“æ„ä¸ä¸€æ ·ï¼‰å¾ˆéš¾é«˜æ•ˆå¹¶è¡Œã€‚å³å¯¹äºä¸²è¡Œä»»åŠ¡æ— æ³•æ”¹é€ ä¸ºå¤šçº¿ç¨‹





## ä¸²è¡Œã€å¹¶å‘ã€å¹¶è¡Œ

### å¼‚åŒ ğŸ”¥

*   ä¸²è¡Œï¼šæŒ‰é¡ºåºæ‰§è¡Œ
*   **å¹¶å‘**ï¼šæŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹åœ¨**åŒä¸€ä¸ªæ—¶é—´æ®µå†…**å‘ç”Ÿï¼Œ**é€»è¾‘ä¸Š**åŒæ—¶å‘ç”Ÿï¼Œå•æ ¸å³å¯å®ç°ã€‚å·¦å›¾

- **å¹¶è¡Œ**ï¼šæŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹åœ¨**åŒä¸€æ—¶åˆ»**å‘ç”Ÿï¼ˆåŒæ—¶å‘ç”Ÿï¼‰ï¼Œ**ç‰©ç†ä¸Š**åŒæ—¶å‘ç”Ÿï¼Œå¤šæ ¸å¯ä»¥å®ç°ã€‚**å¹¶è¡Œä¸€å®šæ˜¯å¹¶å‘ï¼Œåä¹‹ä¸æ˜¯**ã€‚å³å›¾

![image-20210207232912767](../images/image-20210207232912767.png)



### æ˜¯ä»€ä¹ˆè®©å¹¶å‘å’Œå¹¶è¡Œç§°ä¸ºå¯èƒ½ï¼ŸğŸ”¥

*   CPU å‡çº§ï¼Œå•æ ¸é€Ÿåº¦è¶Šæ¥è¶Šå¿«ï¼Œå¤šæ ¸
*   æ“ä½œç³»ç»Ÿå‡çº§ï¼ŒæŠ¢å å¼ä»»åŠ¡å¤„ç†ï¼Œæ—¶é—´ç‰‡è½®è½¬ï¼›å¤šæ ¸æ“ä½œå‡çº§
*   ç¼–ç¨‹è¯­è¨€å‡çº§ï¼Œæ”¯æŒå¹¶å‘



## é«˜å¹¶å‘

### ä»€ä¹ˆæ˜¯é«˜å¹¶å‘ï¼Ÿ

æœåŠ¡å™¨çŸ­æ—¶é—´å¯ä»¥å¤„ç†éå¸¸å¤šä¸ªè¯·æ±‚ï¼Œå¦‚åŒåä¸€ã€è¿‡å¹´å¾®ä¿¡æ‘‡ä¸€æ‘‡çº¢åŒ…



### é«˜å¹¶å‘å’Œå¤šçº¿ç¨‹çš„è”ç³»å’Œä¸åŒï¼ŸğŸ”¥

*   **å¤šçº¿ç¨‹**æ˜¯é«˜å¹¶å‘å…¶ä¸­ä¸€ç§é‡è¦çš„**è§£å†³æ–¹æ¡ˆ**ï¼Œ**é«˜å¹¶å‘**æ˜¯ä¸€ç§æœåŠ¡å™¨**çŠ¶æ€**
*   é«˜å¹¶å‘å¹¶ä¸æ„å‘³ç€æ˜¯å¤šçº¿ç¨‹ï¼Œå¦‚ Redis



### é«˜å¹¶å‘çš„æŒ‡æ ‡

*   QPSï¼ˆQueries Per Secondï¼‰ï¼šæ¯ç§’æŸ¥è¯¢æ•°

*   TPSï¼šæ¯ç§’å¤„ç†äº‹åŠ¡æ•°

*   å¸¦å®½

*   PVï¼ˆPage Viewï¼‰ï¼šä¸€å¤©è®¿é—®é‡ã€‚ã€‚ã€‚

*   UVï¼ˆUnique Visitorï¼‰ï¼šä¸€å¤©è®¿é—®é‡å»é‡

*   IPï¼šä¸åŒ IP è®¿é—®é‡

*   å¹¶å‘è¿æ¥æ•°ï¼ˆThe number of concurrent connectionsï¼‰

*   æœåŠ¡å™¨å¹³å‡è¯·æ±‚ç­‰å¾…æ—¶é—´ TPRï¼ˆTime per requestï¼‰ï¼šacross all concurrent request

    





## åŒæ­¥å¼‚æ­¥ã€é˜»å¡éé˜»å¡

### åŒæ­¥ã€å¼‚æ­¥ ğŸ”¥

**è¢«è°ƒç”¨è€…**æ˜¯å¦**ä¸»åŠ¨å‘Šè¯‰**è°ƒç”¨è€…ç»“æœï¼Œä¸ä¸»åŠ¨å°±éœ€è¦è°ƒç”¨è€…ä¸æ–­å»æ£€æŸ¥äº†

é¸£ç¬›çƒ§æ°´å£¶å°±æ˜¯å¼‚æ­¥çš„ç¤ºä¾‹

![image-20210207235724348](../images/image-20210207235724348.png)

![image-20210207235751625](../images/image-20210207235751625.png)



### é˜»å¡ã€éé˜»å¡ ğŸ”¥

**è°ƒç”¨è€…**ï¼ˆçº¿ç¨‹å‘å‡ºè¯·æ±‚ï¼Œå¦‚HTTPï¼‰æ˜¯å¦é˜»å¡ç­‰å¾…





### ç»„åˆ ğŸ”¥

*   åŒæ­¥é˜»å¡ï¼šå¼€å§‹çƒ§æ°´åï¼Œæˆ‘ä»¬ä¸€ç›´ç›¯ç€æ°´å£¶
*   åŒæ­¥éé˜»å¡ï¼šå¼€å§‹çƒ§æ°´åï¼Œæˆ‘ä»¬æ¯éš”ä¸‰äº”åˆ†é’Ÿè¿‡æ¥çœ‹ä¸€ä¸‹æ°´å£¶
*   å¼‚æ­¥é˜»å¡ï¼šå¸¦æœ‰é¸£ç¬›çš„æ°´å£¶å¼€å§‹çƒ§æ°´åï¼Œæˆ‘ä»¬ä¸€ç›´ç›¯ç€æ°´å£¶ã€‚å¸¸ç”¨äºç»“æœå½±å“åç»­è¿›ç¨‹
*   å¼‚æ­¥éé˜»å¡ï¼šå¸¦æœ‰é¸£ç¬›çš„æ°´å£¶å¼€å§‹çƒ§æ°´åï¼Œæˆ‘ä»¬å¹²å…¶ä»–äº‹å»äº†ï¼Œé¸£ç¬›åå†è¿‡æ¥





## çº¿ç¨‹çš„åˆ›å»ºå’Œä½¿ç”¨

### java.lang.Thread

**é™æ€å¸¸é‡**

- `Thread.MAX_PRIORITY`ï¼š10
- `Thread.MIN _PRIORITY`ï¼š1
- `Thread.NORM_PRIORITY`ï¼š5ï¼Œé»˜è®¤

**æ„é€ æ–¹æ³•**

- **`Thread()`**ï¼šåˆ†é…ä¸€ä¸ªæ–°çš„çº¿ç¨‹å¯¹è±¡ã€‚
- **`Thread(String name)`**ï¼šåˆ†é…ä¸€ä¸ªæŒ‡å®šåå­—çš„æ–°çš„çº¿ç¨‹å¯¹è±¡
- **`Thread(Runnable target)`**ï¼šåˆ†é…ä¸€ä¸ªå¸¦æœ‰æŒ‡å®šç›®æ ‡æ–°çš„çº¿ç¨‹å¯¹è±¡ï¼Œå®ƒå®ç°äº† Runnable æ¥å£ä¸­çš„`run`æ–¹æ³•
- **`Thread(Runnable target,String name)`**ï¼šåˆ†é…ä¸€ä¸ªå¸¦æœ‰æŒ‡å®šç›®æ ‡æ–°çš„çº¿ç¨‹å¯¹è±¡å¹¶æŒ‡å®šåå­—

**å¸¸ç”¨æ–¹æ³• 1**

- `void run()`ï¼š**çº¿ç¨‹åœ¨è¢«è°ƒåº¦æ—¶æ‰§è¡Œçš„æ“ä½œ**ï¼Œè‹¥ target æœ‰å€¼ï¼Œåˆ™è°ƒç”¨ target çš„`run()` æ–¹æ³•
- `void start()`ï¼š**å¯åŠ¨çº¿ç¨‹ï¼ŒJVM æ‰§è¡Œæ­¤çº¿ç¨‹å¯¹è±¡çš„`run()`æ–¹æ³•**
- `static Thread currentThread()`ï¼šè¿”å›å½“å‰çº¿ç¨‹ï¼Œåœ¨ Thread å­ç±»ä¸­å°±æ˜¯ thisï¼Œé€šå¸¸ç”¨äºä¸»çº¿ç¨‹å’Œ Runnable å®ç°ç±»
- `String getName()`ï¼š**è·å–å½“å‰çº¿ç¨‹åç§°**
- `void setName()`ï¼š**è®¾ç½®å½“å‰çº¿ç¨‹åç§°**ï¼Œæˆ–é€šè¿‡çº¿ç¨‹**ç±»çš„æœ‰å‚æ„é€ è®¾ç½®**

**å¸¸ç”¨æ–¹æ³• 2**

- çº¿ç¨‹**ä¼˜å…ˆçº§**ï¼šé€šè¿‡`getPriority()`è·å–ï¼Œé€šè¿‡`setPriority()`è®¾ç½®ã€‚

* `static void yield()`ï¼š**çº¿ç¨‹è®©æ­¥**

  **æš‚åœ**å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼ˆç³»ç»ŸæŒ‡å®šçš„æ¯«ç§’æ•°ï¼‰ï¼ŒæŠŠæ‰§è¡Œæœºä¼šè®©ç»™ä¼˜å…ˆçº§ç›¸åŒæˆ–æ›´é«˜çš„çº¿ç¨‹ï¼Œå¹¶æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚è‹¥é˜Ÿåˆ—ä¸­æ²¡æœ‰åŒä¼˜å…ˆçº§çš„çº¿ç¨‹ï¼Œå¿½ç•¥æ­¤æ–¹æ³•ã€‚**è½¬ä¸ºå°±ç»ªçŠ¶æ€**ï¼Œè¯¥çº¿ç¨‹ä¸ä¼šå¤±å»ä»»ä½•ç›‘è§†å™¨çš„æ‰€æœ‰æƒï¼ˆ**ä¸é‡Šæ”¾é”**ï¼‰ï¼Œä¸ä¼šé˜»å¡è¯¥çº¿ç¨‹ã€‚ä¸ç¡®ä¿çœŸæ­£è®©å‡ºï¼Œå¾ˆå°‘ç”¨ã€‚

* `th.join()`ï¼š**çº¿ç¨‹æ’é˜Ÿ**

  å½“æŸä¸ªç¨‹åºæ‰§è¡Œæµä¸­è°ƒç”¨å…¶ä»–çº¿ç¨‹çš„`join()`æ–¹æ³•æ—¶ï¼Œè°ƒç”¨çº¿ç¨‹å°†è¢«**é˜»å¡**ï¼Œç›´åˆ°`join()`æ–¹æ³•åŠ å…¥çš„ join çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå…¶ä»–çº¿ç¨‹æ‰å¯ä»¥æŠ¢å èµ„æºã€‚

* `static void sleep(long millis)`ï¼š**çº¿ç¨‹ç¡çœ **

  ä½¿**å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹**ä»¥æŒ‡å®šçš„æ¯«ç§’æ•°**ç¡çœ **ï¼Œ**ä¸é‡Šæ”¾é”**ï¼Œ~~ä¹‹åè¿›å…¥**é˜»å¡**çŠ¶æ€~~

- `th.interrupt()`ï¼š**ä¸­æ–­çº¿ç¨‹**

  **è¯·æ±‚ç»ˆæ­¢çº¿ç¨‹**ï¼Œä»…è®¾ç½®äº†ä¸€ä¸ªæ ‡å¿—ä½ï¼Œä¸­æ–­ä¸€ä¸ªä¸åœ¨æ´»åŠ¨çŠ¶æ€ï¼ˆé˜»å¡ï¼‰çš„çº¿ç¨‹æ²¡æ„ä¹‰å¹¶ä¼šæŠ›å¼‚å¸¸

  - é™æ€æ–¹æ³•`interrupted()`-->**ä¼šæ¸…é™¤ä¸­æ–­æ ‡å¿—ä½**
  - æ™®é€šæ–¹æ³•`isInterrupted()`-->**ä¸ä¼šæ¸…é™¤ä¸­æ–­æ ‡å¿—ä½**

- `boolean isAlive()`ï¼šåˆ¤æ–­çº¿ç¨‹æ˜¯å¦è¿˜**å­˜æ´»**

- ~~`th.stop()`ï¼š`@Deprecated(since="1.2")`~~

### çº¿ç¨‹çš„åˆ†ç±»

å®ˆæŠ¤çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹åœ¨å‡ ä¹æ¯ä¸ªæ–¹é¢éƒ½æ˜¯ç›¸åŒçš„ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯**åˆ¤æ–­ JVM ä½•æ—¶ç¦»å¼€**

- å®ˆæŠ¤çº¿ç¨‹ï¼ˆåå°çº¿ç¨‹ï¼Œå¦‚å¦å…‹å¤§æˆ˜ï¼‰
  - **å®ˆæŠ¤çº¿ç¨‹æ˜¯ç”¨æ¥æœåŠ¡ç”¨æˆ·çº¿ç¨‹çš„**ï¼Œé€šè¿‡åœ¨`start()`æ–¹æ³•å‰è°ƒç”¨`th.setDaemon(true)`å¯ä»¥æŠŠä¸€ä¸ªç”¨æˆ·çº¿ç¨‹å˜æˆä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹
  - **Java åƒåœ¾å›æ”¶**å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å®ˆæŠ¤çº¿ç¨‹
  - **è‹¥ JVM ä¸­éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œå½“å‰ JVM å°†é€€å‡º**
- ç”¨æˆ·çº¿ç¨‹

### çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼

#### ç»§æ‰¿ Thread ç±»

1.  å®šä¹‰å­ç±»ç»§æ‰¿ Thread ç±»ã€‚å¯ä»¥å†™æ— å‚å’Œå¸¦å‚æ„é€ ä»¥ä¾¿ç›´æ¥å®šä¹‰çº¿ç¨‹åç§°ã€‚
2.  å­ç±»ä¸­ Override é‡å†™ Thread ç±»çš„`run()`æ–¹æ³•ï¼Œå°†çº¿ç¨‹çš„ä»»åŠ¡ä»£ç å°è£…åˆ°`run()`æ–¹æ³•ä¸­ã€‚
3.  åˆ›å»º Thread çš„å­ç±»å¯¹è±¡ï¼Œå³åˆ›å»ºäº†çº¿ç¨‹å¯¹è±¡ã€‚
4.  è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„**`start()`**ï¼ŒJVM å°†è°ƒç”¨è¯¥çº¿ç¨‹çš„**`run()`**æ–¹æ³•æ‰§è¡Œï¼ˆå¤šæ¬¡å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹éæ³•ï¼Œå³ä½¿æ‰§è¡Œå®Œæ¯•ï¼‰

#### å®ç° Runnable æ¥å£

1.  å®šä¹‰ç±»å®ç° Runnable æ¥å£
2.  @Override é‡å†™æ¥å£ä¸­çš„`run()`æ–¹æ³•ï¼Œå°†çº¿ç¨‹çš„ä»»åŠ¡ä»£ç å°è£…åˆ°`run()`æ–¹æ³•ä¸­
3.  é€šè¿‡ Thread ç±»åˆ›å»ºçº¿ç¨‹å¯¹è±¡ï¼Œå¹¶å°† Runnable æ¥å£çš„å­ç±»å¯¹è±¡ä½œä¸º Thread ç±»çš„æ„é€ å‡½æ•°çš„å‚æ•°è¿›è¡Œä¼ é€’ã€‚**çº¿ç¨‹çš„ä»»åŠ¡éƒ½å°è£…åœ¨ Runnable æ¥å£å®ç°ç±»å¯¹è±¡çš„ run æ–¹æ³•ä¸­ï¼Œæ‰€ä»¥è¦åœ¨çº¿ç¨‹å¯¹è±¡åˆ›å»ºæ—¶å°±å¿…é¡»æ˜ç¡®è¦è¿è¡Œçš„ä»»åŠ¡**
4.  è°ƒç”¨**`start()`å¼€å¯çº¿ç¨‹**ï¼ŒJVM è°ƒç”¨è¯¥çº¿ç¨‹çš„**`run()`**æ–¹æ³•æ‰§è¡Œï¼ˆå¤šæ¬¡å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹éæ³•ï¼Œå³ä½¿æ‰§è¡Œå®Œæ¯•ï¼‰

#### å®ç° Callable æ¥å£

ä¸ä½¿ç”¨ Runnable ç›¸æ¯”ï¼Œ Callable åŠŸèƒ½æ›´å¼ºå¤§äº›ï¼ˆJDK5.0 æ–°å¢ï¼‰ï¼š

- ä½¿ç”¨`FutureTask`ç±»å°è£…å®ç°äº† `Callable` æ¥å£çš„å®ç°ç±»ï¼Œå¹¶ä¼ å…¥ `Thread` çš„æ„é€ æ–¹æ³•ä¸­ï¼Œè°ƒç”¨ `start` æ–¹æ³•

- ç›¸æ¯”`run()`æ–¹æ³•éœ€è¦å®ç° `call()` æ–¹æ³•ï¼Œå¯ä»¥æœ‰**è¿”å›å€¼**ï¼ˆæ”¯æŒ**æ³›å‹**ï¼‰ï¼Œå¯ä»¥**æŠ›å‡ºå¼‚å¸¸**

  è°ƒç”¨`FutureTask`çš„`get()`**é˜»å¡ç­‰å¾…ä»»åŠ¡ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œè·å–è¿”å›å€¼**

`Future`æ¥å£ï¼š

- å¯ä»¥å¯¹å…·`Runnable`ã€`Callable`ä»»åŠ¡çš„æ‰§è¡Œç»“æœè¿›è¡Œå–æ¶ˆã€æŸ¥è¯¢æ˜¯å¦å®Œæˆã€è·å–ç»“æœç­‰ã€‚
- `FutrueTask`æ˜¯`Futrue`æ¥å£çš„**å”¯ä¸€çš„å®ç°ç±»**
- `FutureTask`åŒæ—¶å®ç°äº†`Runnable`,`Future`æ¥å£ã€‚å®ƒæ—¢å¯ä»¥ä½œä¸º`Runnable`è¢«çº¿ç¨‹æ‰§è¡Œï¼Œåˆå¯ä»¥ä½œä¸º`Future`å¾—åˆ°`Callable`çš„è¿”å›å€¼

#### çº¿ç¨‹æ± 

- èƒŒæ™¯ï¼šç»å¸¸åˆ›å»ºå’Œé”€æ¯ã€ä½¿ç”¨é‡ç‰¹åˆ«å¤§çš„èµ„æºï¼Œæ¯”å¦‚å¹¶å‘æƒ…å†µä¸‹çš„çº¿ç¨‹ï¼Œ å¯¹æ€§èƒ½å½±å“å¾ˆå¤§ã€‚
- **çº¿ç¨‹æ± **ï¼šå…¶å®å°±æ˜¯ä¸€ä¸ª**å®¹çº³å¤šä¸ªçº¿ç¨‹çš„å®¹å™¨**ï¼Œå…¶ä¸­çš„**çº¿ç¨‹å¯ä»¥åå¤ä½¿ç”¨**ï¼Œä½¿ç”¨å®Œ**è‡ªåŠ¨å½’è¿˜**ï¼Œçœå»äº†é¢‘ç¹åˆ›å»ºçº¿ç¨‹å¯¹è±¡çš„æ“ä½œï¼Œ æ— éœ€åå¤åˆ›å»ºçº¿ç¨‹è€Œæ¶ˆè€—è¿‡å¤šèµ„æºã€‚
- å¥½å¤„ï¼š
  - **é™ä½èµ„æºæ¶ˆè€—**ï¼ˆé‡å¤åˆ©ç”¨çº¿ç¨‹æ± ä¸­çº¿ç¨‹ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½åˆ›å»ºï¼‰
  - **æé«˜å“åº”é€Ÿåº¦**ï¼ˆå‡å°‘äº†åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶é—´ï¼‰
  - **ä¾¿äºçº¿ç¨‹ç®¡ç†**
- **JDK 5.0 èµ·**æä¾›äº†çº¿ç¨‹æ± çš„é¡¶çº§**æ¥å£**æ˜¯ `java.util.concurrent.Executor`ï¼Œä½†æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šè®²å®ƒåªæ˜¯ä¸€ä¸ª**æ‰§è¡Œçº¿ç¨‹çš„å·¥å…·**ã€‚**çœŸæ­£çš„çº¿ç¨‹æ± æ¥å£æ˜¯ `java.util.concurrent.ExecutorService`** ï¼ˆå®˜æ–¹å»ºè®®**ä½¿ç”¨`java.util.concurrent.Executors`çº¿ç¨‹æ± å·¥å‚ç±»**æ¥åˆ›å»ºçº¿ç¨‹æ± å¯¹è±¡ï¼‰ï¼š
  - `void execute(Runnable command)`ï¼šæ‰§è¡Œä»»åŠ¡/å‘½ä»¤ï¼Œæ²¡æœ‰è¿”å›å€¼ï¼Œä¸€èˆ¬ç”¨æ¥æ‰§è¡Œ `Runnable`
  - `<T> Future<T> submit(Callable<T> task)`ï¼šæ‰§è¡Œä»»åŠ¡ï¼Œæœ‰è¿”å›å€¼ï¼Œä¸€èˆ¬åˆæ¥æ‰§è¡Œ `Callable`
  - `void shutdown()`ï¼šå…³é—­çº¿ç¨‹æ± ï¼Œä¸å»ºè®®æ‰§è¡Œ
- å¸¸è§`ExecutorService`çº¿ç¨‹æ± å¯¹è±¡æœ‰ï¼š
  - `ExecutorService static newCachedThreadPool()`ï¼šå¯æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± 
  - `ExecutorService static newFixedThreadPool(int maxThreads)`ï¼šå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± 
  - `ExecutorService static newSingleThreadExecutor()`ï¼šåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± 
  - `ExecutorService static newScheduledThreadPool(n)`ï¼šå¯å®‰æ’åœ¨ç»™å®šå»¶è¿Ÿåè¿è¡Œå‘½ä»¤æˆ–è€…å®šæœŸåœ°æ‰§è¡Œ
- å‚æ•°ï¼ˆå¸¸è€ƒï¼‰ï¼š
  - corePoolSizeï¼šæ ¸å¿ƒæ± çš„å¤§å°
  - maximumPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•°
  - keepAliveTimeï¼šçº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ—¶æœ€å¤šä¿æŒå¤šé•¿æ—¶é—´åä¼šç»ˆæ­¢
  - setRejectedExecutionHandler
  - setThreadFactory

**åŒ¿åå†…éƒ¨ç±»å®ç°å¤šçº¿ç¨‹**

- **ç»§æ‰¿ Thread ç±»**

  ```java
  new Thread() {
  	@Override
  	public void run() {
  		for (int i = 0; i < 100; i++) {
  			System.out.println(getName() + "---" + i);
  		}
  	}
  }.start();
  ```

- **å®ç° Runnable æ¥å£**

  ```java
  //lambdaè¡¨è¾¾å¼å®ç°
  new Thread(() -> {
      for (int i = 0; i < 100; i++) {
          System.out.println(Thread.currentThread().getName() + "---" + i);
      }
  }).start();
  //æ™®é€šå®ç°
  new Thread(new Runnable() {
  	@Override
  	public void run() {
  		for (int i = 0; i < 100; i++) {
  			System.out.println(Thread.currentThread().getName() + "---" + i);
  		}
  	}
  }).start();
  ```

* **å®ç° Callable æ¥å£**

  ```java
  //æ™®é€šå®ç°
  class CallableThread implements Callable<Integer> {

      @Override
      public Integer call() throws Exception {
          int sum = 0;
          for (int i = 0; i < 100; i++) {
              System.out.println(Thread.currentThread().getName() + ":" + i);
              sum += i;
          }
          return sum;
      }
  }

  public class CallableTest {

      public static void main(String[] args) {
          CallableThread callableThread = new CallableThread();
          FutureTask<Integer> futureTask = new FutureTask<>(callableThread);
          new Thread(futureTask).start();
          Integer o = null;
          try {
              o = futureTask.get();
          } catch (InterruptedException | ExecutionException e) {
              e.printStackTrace();
          }
          System.out.println(o);
      }
  }

  //lambdaè¡¨è¾¾å¼å®ç°->æ–¹æ³•å¼•ç”¨
  public class CallableTest {

      public static void main(String[] args) {

          FutureTask<Integer> futureTask = new FutureTask(CallableTest::call);
          new Thread(futureTask).start();
          Integer o = null;
          try {
              o = futureTask.get();
          } catch (InterruptedException | ExecutionException e) {
              e.printStackTrace();
          }
          System.out.println(o);
      }

      private static Integer call() {
          int sum = 0;
          for (int i = 0; i < 100; i++) {
              System.out.println(Thread.currentThread().getName() + ":" + i);
              sum += i;
          }
          return sum;
      }
  }
  ```

* **çº¿ç¨‹æ± **

  ```java
  ExecutorService service = Executors.newFixedThreadPool(10);
  ThreadPoolExecutor service1 = (ThreadPoolExecutor) service;
  // è®¾ç½®çº¿ç¨‹æ± çš„å±æ€§
  // System.out.println(service.getClass());
  // service1.setCorePoolSize(15);
  // service1.setKeepAliveTime();
  service.execute(new NumberThread());//é€‚åˆé€‚ç”¨äºRunnable
  service.execute(new NumberThread1());//é€‚åˆé€‚ç”¨äºRunnable
  service.submit(Callable callable);//é€‚åˆä½¿ç”¨äºCallable
  //å…³é—­è¿æ¥æ± 
  service.shutdown();
  ```

**åŒºåˆ«**ï¼ˆå®ç° Runnable æ¥å£çš„å¥½å¤„ï¼Œå…¶å® Thread ç±»ä¹Ÿå®ç°äº† Runnable æ¥å£ï¼‰

1.  é¿å…äº† Java**å•ç»§æ‰¿çš„å±€é™æ€§**

2.  å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åŒä¸€ä¸ªæ¥å£å®ç°ç±»çš„å¯¹è±¡ï¼Œéå¸¸é€‚åˆå¤šä¸ªç›¸åŒçº¿ç¨‹æ¥**å¤„ç†åŒä¸€ä¸ªèµ„æº**

    å¢åŠ ç¨‹åºçš„å¥å£®æ€§ï¼Œå®ç°**è§£è€¦**æ“ä½œï¼Œä»£ç å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œ**ä»£ç å’Œçº¿ç¨‹ç‹¬ç«‹**

3.  **çº¿ç¨‹æ± **åªèƒ½æ”¾å…¥å®ç° Runable æˆ– Callable ç±»çº¿ç¨‹ï¼Œä¸èƒ½ç›´æ¥æ”¾å…¥ç»§æ‰¿ Thread çš„ç±»

**`run()`å’Œ`start()`çš„åŒºåˆ«**

- `run()`ï¼šä»…ä»…æ˜¯å°è£…è¢«çº¿ç¨‹æ‰§è¡Œçš„ä»£ç ï¼Œç›´æ¥è°ƒç”¨æ˜¯æ™®é€šæ–¹æ³•ã€‚
- `start()`ï¼šé¦–å…ˆå¯åŠ¨äº†çº¿ç¨‹ï¼Œç„¶åå†ç”± jvm å»è°ƒç”¨è¯¥çº¿ç¨‹çš„ run()æ–¹æ³•ã€‚

**å¤šçº¿ç¨‹çš„è¿è¡Œè¿‡ç¨‹**

> **Java ç¨‹åºè¿è¡ŒåŸç†ï¼ˆå¤šçº¿ç¨‹ï¼‰**ï¼šç”± Java å‘½ä»¤å¯åŠ¨ JVMï¼ˆç›¸å½“äºå¯åŠ¨äº†ä¸€ä¸ªè¿›ç¨‹ï¼‰ï¼Œæ¥ç€ç”±è¯¥è¿›ç¨‹åˆ›å»ºå¯åŠ¨å¤šä¸ªçº¿ç¨‹ï¼Œè‡³å°‘ä¸‰ä¸ªçº¿ç¨‹å¯ä»¥åˆ†æå‡ºæ¥ï¼š**æ‰§è¡Œ main()å‡½æ•°çš„ä¸»çº¿ç¨‹**ï¼Œè¯¥çº¿ç¨‹çš„ä»»åŠ¡ä»£ç éƒ½å®šä¹‰åœ¨ main å‡½æ•°ä¸­ï¼Œ**è´Ÿè´£åƒåœ¾å›æ”¶çš„ GC çº¿ç¨‹**ï¼Œä»¥åŠ**å¼‚å¸¸å¤„ç†çº¿ç¨‹**

- å¤šçº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œå…¶å®**æ¯ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹**éƒ½æœ‰ä¸€ç‰‡è‡ªå·±**æ‰€å±çš„æ ˆå†…å­˜**ç©ºé—´ï¼ˆè¿˜æœ‰ PCï¼‰ã€‚è¿›è¡Œ**æ–¹æ³•çš„å‹æ ˆå’Œå¼¹æ ˆ**ã€‚

![](../images/stack.png)

### çº¿ç¨‹è°ƒåº¦

- **çº¿ç¨‹è°ƒåº¦æ¨¡å‹**ï¼ˆåº”ç”¨ç¨‹åºçš„æ‰§è¡Œéƒ½æ˜¯**CPU åœ¨å¤šä¸ªçº¿ç¨‹é—´å¿«é€Ÿåˆ‡æ¢**å®Œæˆçš„ï¼‰
  - **åˆ†æ—¶è°ƒåº¦æ¨¡å‹ï¼ˆæ—¶é—´ç‰‡ï¼‰**ï¼šæ‰€æœ‰çº¿ç¨‹è½®æµä½¿ç”¨ CPU çš„ä½¿ç”¨æƒï¼Œå¹³å‡åˆ†é…æ¯ä¸ªçº¿ç¨‹å ç”¨ CPU çš„æ—¶é—´ç‰‡
  - **æŠ¢å å¼è°ƒåº¦æ¨¡å‹**ï¼šä¼˜å…ˆè®©**ä¼˜å…ˆçº§é«˜**çš„çº¿ç¨‹ä½¿ç”¨ CPUï¼Œå¦‚æœçº¿ç¨‹çš„ä¼˜å…ˆçº§ç›¸åŒï¼Œé‚£ä¹ˆä¼šéšæœºé€‰æ‹©ä¸€ä¸ªï¼Œä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹è·å–çš„ CPU æ—¶é—´ç‰‡ç›¸å¯¹å¤šä¸€äº›
- **Java çš„çº¿ç¨‹è°ƒåº¦æ–¹æ³•**
  - **åŒä¼˜å…ˆçº§**çº¿ç¨‹ç»„æˆ**å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—**ï¼ˆå…ˆåˆ°å…ˆæœåŠ¡ï¼‰ï¼Œä½¿ç”¨**æ—¶é—´ç‰‡**ç­–ç•¥
  - å¯¹**é«˜ä¼˜å…ˆçº§**ï¼Œä½¿ç”¨ä¼˜å…ˆè°ƒåº¦çš„**æŠ¢å å¼**ç­–ç•¥

### çº¿ç¨‹ä¼˜å…ˆçº§

- çº¿ç¨‹çš„ä¼˜å…ˆçº§ç­‰çº§ï¼ˆé€šè¿‡ Thread çš„é™æ€å¸¸é‡ï¼‰
  - `Thread.MAX_PRIORITY`ï¼š10
  - `Thread.MIN _PRIORITY`ï¼š1
  - `Thread.NORM_PRIORITY`ï¼š5ï¼Œé»˜è®¤
- æ–¹æ³•
  - `getPriority()`ï¼šè¿”å›çº¿ç¨‹ä¼˜å…ˆçº§
  - `setPriority(int newPriority)`ï¼šæ”¹å˜çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œéœ€åœ¨ start å‰è®¾ç½®
- è¯´æ˜
  - **çº¿ç¨‹åˆ›å»ºæ—¶ç»§æ‰¿çˆ¶çº¿ç¨‹çš„ä¼˜å…ˆçº§**
  - **ä½ä¼˜å…ˆçº§åªæ˜¯è·å¾—è°ƒåº¦çš„æ¦‚ç‡ä½**ï¼Œå¹¶éä¸€å®šæ˜¯åœ¨é«˜ä¼˜å…ˆçº§çº¿ç¨‹ä¹‹åæ‰è¢«è°ƒç”¨



## çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ

å½“çº¿ç¨‹è¢«åˆ›å»ºå¹¶å¯åŠ¨ä»¥åï¼Œå®ƒæ—¢ä¸æ˜¯ä¸€å¯åŠ¨å°±è¿›å…¥äº†æ‰§è¡ŒçŠ¶æ€ï¼Œä¹Ÿä¸æ˜¯ä¸€ç›´å¤„äºæ‰§è¡ŒçŠ¶æ€ã€‚åœ¨çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œ æœ‰å‡ ç§çŠ¶æ€å‘¢ï¼Ÿåœ¨ API ä¸­ **`java.lang.Thread`** **ä¸­çš„`State`å†…éƒ¨æšä¸¾ç±»ä¸­ç»™å‡ºäº†å…­ç§çº¿ç¨‹çŠ¶æ€**ï¼š

- **æ–°å»º**ï¼šå½“ä¸€ä¸ª Thread ç±»æˆ–å…¶å­ç±»çš„å¯¹è±¡è¢«å£°æ˜å¹¶åˆ›å»ºæ—¶ï¼Œä½†æ˜¯å¹¶æœªå¯åŠ¨å³è°ƒç”¨ `start()`ï¼Œæ–°ç”Ÿçš„çº¿ç¨‹å¯¹è±¡å¤„äºæ–°å»ºçŠ¶æ€

  > **NEW**ï¼šThread state for a thread which has not yet started.

- **å¯è¿è¡Œ**ï¼šå¤„äºæ–°å»ºçŠ¶æ€çš„çº¿ç¨‹è¢«`start()`åï¼Œå¯èƒ½æ­£åœ¨ JVM ä¸­æ‰§è¡Œï¼Œä¹Ÿå¯èƒ½æ­£åœ¨ç­‰å¾…æ¥è‡ªæ“ä½œç³»ç»Ÿçš„å…¶ä»–èµ„æºå¦‚å¤„ç†å™¨

  > **RUNNABLE**ï¼šstate for a runnable thread. A thread in the runnable state is executing in the Java virtual machine but it may be waiting for other resources from the operating system such as processor.

- **é˜»å¡**ï¼šå½“ä¸€ä¸ªçº¿ç¨‹è¯•å›¾è·å–ä¸€ä¸ªå¯¹è±¡é”ï¼Œè€Œè¯¥å¯¹è±¡é”è¢«å…¶ä»–çš„çº¿ç¨‹æŒæœ‰ï¼Œåˆ™è¯¥çº¿ç¨‹è¿›å…¥ Blocked çŠ¶æ€ï¼›å½“è¯¥çº¿ç¨‹æŒæœ‰é”æ—¶ï¼Œè¯¥çº¿ç¨‹å°†å˜æˆ Runnable çŠ¶æ€ã€‚

  > **BLOCKED**ï¼šThread state for a thread blocked waiting for a monitor lock.A thread in the blocked state is waiting for a monitor lock to enter a synchronized block/method or reenter a synchronized block/method after calling `Object.wait`.

- **æ— é™ç­‰å¾…**ï¼šä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ä¸ªï¼ˆå”¤é†’ï¼‰åŠ¨ä½œæ—¶ï¼Œè¯¥çº¿ç¨‹è¿›å…¥ Waiting çŠ¶æ€ã€‚è¿™ä¸ªçŠ¶æ€åæ˜¯ä¸èƒ½è‡ªåŠ¨å”¤é†’çš„

  > **WAITING**ï¼šstate for a waiting thread.A thread is in the waiting state due to calling one of the following methods:
  >
  > - `Object.wait` with no timeout
  >
  > - `th.join` with no timeout
  >
  > - `LockSupport.park`
  >
  >   A thread in the waiting state is waiting for another thread to perform a particular action.
  >
  > For example, a thread that has called `Object.wait()` on an object is waiting for another thread to call `Object.notify()` or `Object.notifyAll()` on that object. A thread that has called `th.join()` is waiting for a specified thread to terminate.

- **è®¡æ—¶ç­‰å¾…**ï¼šåŒ waiting çŠ¶æ€ï¼Œæœ‰å‡ ä¸ªæ–¹æ³•æœ‰è¶…æ—¶å‚æ•°ï¼Œè°ƒç”¨ä»–ä»¬å°†è¿›å…¥ Timed Waiting çŠ¶æ€ã€‚è¿™ä¸€çŠ¶æ€å°†ä¸€ç›´ä¿æŒåˆ°è¶…æ—¶æœŸæ»¡æˆ–è€…æ¥æ”¶åˆ°å”¤é†’é€šçŸ¥ã€‚

  > **TIMED_WAITING**ï¼šThread state for a waiting thread with a specified waiting time. A thread is in the timed waiting state due to calling one of the following methods with a specified positive waiting time:
  >
  > - `Thread.sleep`must with timeout
  > - `Object.wait` with timeout
  > - `th.join` with timeout
  > - `LockSupport.parkNanos`
  > - `LockSupport.parkUntil`

- **è¢«ç»ˆæ­¢**ï¼šå› ä¸º`run`æ–¹æ³•æ­£å¸¸é€€å‡ºè€Œç»ˆæ­¢ï¼ˆå®Œæˆå…¨éƒ¨å·¥ä½œï¼‰ï¼Œæˆ–è€…å› ä¸ºæ²¡æœ‰æ•è·çš„å¼‚å¸¸ç»ˆæ­¢äº†`run`æ–¹æ³•è€Œæ­»äº¡ï¼Œæˆ–è€…æˆ–çº¿ç¨‹è¢«æå‰å¼ºåˆ¶æ€§åœ°ä¸­æ­¢ã€‚

  > TERMINATEDï¼šThread state for a terminated thread. The thread has completed execution.

![çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ-2.0](../images/Thread-Life.jpeg)

é‡Šæ”¾é”å’Œä¸é‡Šæ”¾é”çš„æ“ä½œï¼ˆæœªå®Œï¼‰

é‡Šæ”¾é”çš„æ“ä½œ

- å½“å‰çº¿ç¨‹çš„åŒæ­¥æ–¹æ³•ã€åŒæ­¥ä»£ç å—**æ‰§è¡Œç»“æŸ**ã€‚
- å½“å‰çº¿ç¨‹åœ¨åŒæ­¥ä»£ç å—ã€åŒæ­¥æ–¹æ³•ä¸­é‡åˆ°**breakã€return ç»ˆæ­¢**äº†è¯¥ä»£ç å—ã€è¯¥æ–¹æ³•çš„ç»§ç»­æ‰§è¡Œã€‚
- å½“å‰çº¿ç¨‹åœ¨åŒæ­¥ä»£ç å—ã€åŒæ­¥æ–¹æ³•ä¸­å‡ºç°äº†**æœªå¤„ç†çš„ Error æˆ– Exceptionï¼Œå¯¼è‡´å¼‚å¸¸ç»“æŸ**ã€‚
- å½“å‰çº¿ç¨‹åœ¨åŒæ­¥ä»£ç å—ã€åŒæ­¥æ–¹æ³•ä¸­æ‰§è¡Œäº†çº¿ç¨‹å¯¹è±¡çš„**`wait()`æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹æš‚åœï¼Œå¹¶é‡Šæ”¾é”**ã€‚

ä¸é‡Šæ”¾é”çš„æ“ä½œ

- çº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•æ—¶ï¼Œç¨‹åºè°ƒç”¨`Thread.sleep()`ã€`Thread.yield()`æ–¹æ³•æš‚åœå½“å‰çº¿ç¨‹çš„æ‰§è¡Œ

- çº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç å—æ—¶ï¼Œå…¶ä»–çº¿ç¨‹è°ƒç”¨äº†è¯¥çº¿ç¨‹çš„`suspend()`æ–¹æ³•å°†è¯¥çº¿ç¨‹ æŒ‚èµ·ï¼Œè¯¥çº¿ç¨‹ä¸ä¼šé‡Šæ”¾é”(åŒæ­¥ç›‘è§†å™¨)

  åº”å°½é‡é¿å…ä½¿ç”¨`suspend()`å’Œ`resume()`æ¥æ§åˆ¶çº¿ç¨‹

## 7.4 çº¿ç¨‹å®‰å…¨å’ŒåŒæ­¥

### çº¿ç¨‹å®‰å…¨é—®é¢˜

- **å–ç¥¨é—®é¢˜**

  - ç›¸åŒçš„ç¥¨å‡ºç°å¤šæ¬¡ï¼šCPU çš„ä¸€æ¬¡æ“ä½œå¿…é¡»æ˜¯åŸå­æ€§çš„ï¼ˆä½†æ˜¯è¾“å‡ºè¯­å¥ä¸æ˜¯åŸå­çš„ï¼‰
  - å‡ºç°è´Ÿæ•°çš„ç¥¨ï¼šéšæœºæ€§å’Œå»¶è¿Ÿå¯¼è‡´

- **çº¿ç¨‹å®‰å…¨é—®é¢˜äº§ç”ŸåŸå› **

  - å¤šä¸ªçº¿ç¨‹åœ¨æ“ä½œå…±äº«æ•°æ®

  - æ“ä½œå…±äº«æ•°æ®çš„ä»£ç æœ‰å¤šæ¡

    **å½“ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œæ“ä½œå…±äº«æ•°æ®çš„å¤šæ¡ä»£ç ï¼ˆéåŸå­æ“ä½œï¼‰è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–çº¿ç¨‹å‚ä¸äº†è¿ç®—ï¼Œå°±ä¼šå¯¼è‡´**

### çº¿ç¨‹åŒæ­¥

è¦è§£å†³ä¸Šè¿°å¤šçº¿ç¨‹å¹¶å‘è®¿é—®ä¸€ä¸ªèµ„æºçš„å®‰å…¨æ€§é—®é¢˜ï¼šä¹Ÿå°±æ˜¯è§£å†³é‡å¤ç¥¨ä¸ä¸å­˜åœ¨ç¥¨é—®é¢˜ï¼ŒJava ä¸­æä¾›äº†**åŒæ­¥æœºåˆ¶ (synchronized)**æ¥è§£å†³ã€‚æœ‰ä¸‰ç§æ–¹å¼å®ŒæˆåŒæ­¥æ“ä½œï¼š**åŒæ­¥ä»£ç å—**ã€**åŒæ­¥æ–¹æ³•**ã€**Lock é”æœºåˆ¶**ã€‚

- **åŒæ­¥çš„ä¼˜ç¼ºç‚¹ï¼š**
  - **å¥½å¤„**ï¼šè§£å†³çº¿ç¨‹çš„å®‰å…¨é—®é¢˜
  - **å¼Šç«¯**ï¼šç›¸å¯¹**é™ä½æ•ˆç‡**ï¼Œå› ä¸ºåŒæ­¥å¤–çš„çº¿ç¨‹éƒ½ä¼šåˆ¤æ–­åŒæ­¥é”ï¼›è‹¥æœ‰**åŒæ­¥åµŒå¥—å®¹æ˜“äº§ç”Ÿæ­»é”**

#### åŒæ­¥ä»£ç å—

- `synchronized`å…³é”®å­—å¯ä»¥ç”¨äº**æ–¹æ³•ä¸­çš„æŸä¸ªåŒºå—ä¸­**ï¼Œè¡¨ç¤ºåªå¯¹è¿™ä¸ªåŒºå—çš„**èµ„æºå®è¡Œäº’æ–¥è®¿é—®**

  - **åŒæ­¥é”**ï¼šä¹Ÿç§°**å¯¹è±¡é”**æˆ–å¯¹è±¡**ç›‘è§†å™¨**
    - é”å¯¹è±¡å¯ä»¥æ˜¯**ä»»æ„ç±»å‹**
    - å¤šä¸ªçº¿ç¨‹å¯¹è±¡è¦ä½¿ç”¨**åŒä¸€æŠŠé”**

  ```java
  public class Ticket implements Runnable {

      private int ticketCount = 100;
  	private static final Object monitorLock = new Object();

      @Override
      public void run() {
          // å–ç¥¨çª—å£ä¸€ç›´å¼€ç€ï¼Œä¸èƒ½åœ¨åŒæ­¥ä¸­ï¼Œå¦åˆ™å°±ä¼šè¢«ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œ
          while (true) {
              // synchronized éœ€åœ¨å†…éƒ¨å†™ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹ä¼šè¿›ä¸å»ã€‚ç±»ä¼¼è¿›å…¥å•æ‰€ç„¶åé”é—¨ã€‚éœ€è¦åŒ…è£¹æ“ä½œå…±äº«èµ„æºçš„ä»£ç ã€‚
              // è¿˜å¯ä»¥å†™ thisï¼ˆæ³¨æ„å”¯ä¸€æ€§ï¼‰ã€Ticket.class
              synchronized (monitorLock) {
                  if (ticketCount > 0) {
                      try {
                          // è¿›å…¥time waitingï¼Œæé«˜é”™ç¥¨å‡ ç‡
                          Thread.sleep(10);
                      } catch (Exception e) {
                          e.printStackTrace();
                      }
                      System.out.println(Thread.currentThread().getName() + "å–ç¥¨ï¼Œç¥¨å·ï¼š" + ticketCount);
                      ticketCount--;
                  } else {
                      break;
                  }
              }
          }
      }
  }
  ```

#### åŒæ­¥æ–¹æ³•

- ä½¿ç”¨`synchronized`ä¿®é¥°çš„æ–¹æ³•å°±å«åšåŒæ­¥æ–¹æ³•ï¼Œä¿è¯ A çº¿ç¨‹æ‰§è¡Œè¯¥æ–¹æ³•çš„æ—¶å€™å…¶ä»–çº¿ç¨‹åªèƒ½åœ¨æ–¹æ³•å¤–ç­‰ç€ã€‚

  - **åŒæ­¥é”æ˜¯è°**?

    - å¯¹äº**é static æ–¹æ³•**ï¼ŒåŒæ­¥é”å°±æ˜¯**this**ï¼Œæ­¤æ—¶ä»£è¡¨è°ƒç”¨ run æ–¹æ³•çš„å¯¹è±¡

    - å¯¹äº**static æ–¹æ³•**ï¼Œæˆ‘ä»¬ä½¿ç”¨å½“å‰æ–¹æ³•æ‰€åœ¨ç±»çš„å­—èŠ‚ç å¯¹è±¡(**ç±»å.class**)

      ä½¿ç”¨ç»§æ‰¿ Thread ç±»å’ŒåŒæ­¥æ–¹æ³•å®ç°æ—¶ï¼Œéœ€è¦å†™ `static synchronized`

  ```java
  public /*static*/ synchronized void sellTicket(){
       // TODO
  }
  ```

#### Lock é”

- ä» JDK 5.0 å¼€å§‹ï¼ŒJava æä¾›äº†æ›´å¼ºå¤§çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶â€”â€”é€šè¿‡**æ˜¾å¼å®šä¹‰åŒæ­¥é”å¯¹è±¡**æ¥å®ç°åŒæ­¥ã€‚`java.util.concurrent.locks.Lock` **æ¥å£**æœºåˆ¶æä¾›äº†æ¯”`synchronized`ä»£ç å—å’Œ`synchronized`æ–¹æ³•æ›´å¹¿æ³›çš„é”å®šæ“ä½œï¼ŒåŒæ­¥ä»£ç å—/åŒæ­¥æ–¹æ³•å…·æœ‰çš„åŠŸèƒ½ Lock éƒ½æœ‰ï¼Œé™¤æ­¤ä¹‹å¤–æ›´å¼ºå¤§ï¼Œæ›´ä½“ç°é¢å‘å¯¹è±¡ã€‚

- **Lock æ¥å£çš„å®ç°ç±»`ReentrantLock`**ã€‚å¯åœ¨æ„é€ æ–¹æ³•ä¸­è®¾ç½®æ˜¯å¦ä¸º**å…¬å¹³é”**ï¼ˆæŒ‰ FIFO é˜Ÿåˆ—ï¼‰ï¼Œä½†æ˜¯æ•ˆç‡å¯èƒ½ä¼šå˜ä½ã€‚

- **Lock é”ä¹Ÿç§°åŒæ­¥é”**ï¼ŒåŠ é”ä¸é‡Šæ”¾é”æ–¹æ³•åŒ–äº†ï¼Œå¦‚ä¸‹ï¼š

  - `void lock()`ï¼š**åŠ åŒæ­¥é”**

  - `void unlock()`ï¼š**é‡Šæ”¾åŒæ­¥é”**

    ```java
    public class Ticket implements Runnable {

        private int count = 100;
        private Lock lock = new ReentrantLock();

        @Override
        public void run() {
            while (true) {
                try {
                    // åŠ åŒæ­¥é”
                    lock.lock();
                    if (count > 0) {
                        try {
                            Thread.sleep(10);
                            System.out.println(Thread.currentThread().getName() + "-->æ­£åœ¨å–ç¬¬" + count + "å¼ ç¥¨");
                            count--;
                        } catch (InterruptedException e) {
                            e.printStackTrace();
                        }
                    } else {
                        break;
                    }
                } finally {
                    // é‡Šæ”¾åŒæ­¥é”
                    lock.unlock();
                }
            }
        }

        public static void main(String[] args) {
            Ticket ticket = new Ticket();
            new Thread(ticket, "çª—å£1").start();
            new Thread(ticket, "çª—å£2").start();
            new Thread(ticket, "çª—å£3").start();
        }
    }
    ```

### æ­»é”é—®é¢˜(å“²å­¦å®¶å°±é¤)

- æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„çº¿ç¨‹åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå› **äº‰å¤ºèµ„æº**äº§ç”Ÿçš„ä¸€ç§**äº’ç›¸ç­‰å¾…**ç°è±¡

  ä¸è¦ä½¿ç”¨ String æ¥åšé”ã€‚å¦‚ï¼šString s1 = "Hello" å’Œ String s2 = "Hello" å…¶å®æ˜¯åŒä¸€æŠŠé”ï¼›è¿˜ä¼šå¯èƒ½ä¸å…¶ä»–ç±»åº“å‘ç”Ÿæ­»é”ã€‚

  ```java
  public class DeadLock {
      private static Object lock1 = new Object();
      private static Object lock2 = new Object();

      public static void main(String[] args) {
          new Thread(() -> {
              synchronized (lock1) {
                  System.out.println("t1 get lock1");
                  // å¯åœ¨æ­¤å¤„sleepæé«˜æ­»é”æ¦‚ç‡
                  synchronized (lock2) {
                      System.out.println("t1 get lock2");
                  }
              }
          }, "t1").start();

          new Thread(() -> {
              synchronized (lock2) {
                  System.out.println("t2 get lock2");
                  // å¯åœ¨æ­¤å¤„sleepæé«˜æ­»é”æ¦‚ç‡
                  synchronized (lock1) {
                      System.out.println("t2 get lock1");
                  }
              }
          }, "t2").start();
      }
  }
  // å¯èƒ½å‡ºç°çš„ç»“æœæœ‰ï¼š
  // 1
  t1 get lock1
  t1 get lock2
  t2 get lock2
  t2 get lock1
  // 2
  t2 get lock2
  t2 get lock1
  t1 get lock1
  t1 get lock2
  // 3
  t1 get lock1
  t2 get lock2
  // 4
  t2 get lock2
  t1 get lock1
  ```

## 7.5 çº¿ç¨‹é—´é€šä¿¡

**å¤šä¸ªçº¿ç¨‹åœ¨å¤„ç†åŒä¸€ä¸ªèµ„æºï¼Œä½†æ˜¯å¤„ç†çš„åŠ¨ä½œï¼ˆçº¿ç¨‹çš„ä»»åŠ¡ï¼‰å´ä¸ç›¸åŒ**ã€‚

å¤šä¸ªçº¿ç¨‹åœ¨å¤„ç†åŒä¸€ä¸ªèµ„æºï¼Œå¹¶ä¸”ä»»åŠ¡ä¸åŒæ—¶ï¼Œéœ€è¦çº¿ç¨‹é€šä¿¡æ¥å¸®åŠ©è§£å†³çº¿ç¨‹ä¹‹é—´å¯¹åŒä¸€ä¸ªå˜é‡çš„ä½¿ç”¨æˆ–æ“ä½œã€‚ å°±æ˜¯å¤šä¸ªçº¿ç¨‹åœ¨æ“ä½œåŒä¸€ä»½æ•°æ®æ—¶ï¼Œ é¿å…å¯¹åŒä¸€å…±äº«å˜é‡çš„äº‰å¤ºã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€å®šçš„æ‰‹æ®µä½¿å„ä¸ªçº¿ç¨‹èƒ½æœ‰æ•ˆçš„åˆ©ç”¨èµ„æºã€‚è€Œè¿™ç§æ‰‹æ®µå³â€”â€” ç­‰å¾…å”¤é†’æœºåˆ¶ã€‚

### ç­‰å¾…å”¤é†’æœºåˆ¶

å°±æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œäº†è§„å®šæ“ä½œåï¼Œå°±è¿›å…¥ç­‰å¾…çŠ¶æ€`wait()`ï¼Œ ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œä»–ä»¬çš„æŒ‡å®šä»£ç è¿‡å å†å°†å…¶å”¤é†’`notify()`ï¼›åœ¨æœ‰å¤šä¸ªçº¿ç¨‹è¿›è¡Œç­‰å¾…æ—¶ï¼Œ å¦‚æœéœ€è¦ï¼Œå¯ä»¥ä½¿ç”¨ `notifyAll()`æ¥å”¤é†’æ‰€æœ‰çš„ç­‰å¾…çº¿ç¨‹ã€‚ wait/notify å°±æ˜¯çº¿ç¨‹é—´çš„ä¸€ç§åä½œæœºåˆ¶ã€‚

- **`Object`ç±»**ï¼ˆä»»æ„é”ï¼‰ä¸­æä¾›äº†ä¸‰ä¸ªæ–¹æ³•ã€‚è¿™äº›æ–¹æ³•å¿…é¡»é€šè¿‡**åŒä¸€ä¸ªé”å¯¹è±¡ï¼ˆthis è°ƒç”¨æˆ–å…¶ä»–åŒä¸€å¯¹è±¡è°ƒç”¨ï¼‰åœ¨åŒæ­¥ä¸­ï¼ˆåŒæ­¥ä»£ç å—ã€åŒæ­¥æ–¹æ³•ï¼‰è°ƒç”¨ï¼Œå¦åˆ™æŠ¥`IllegalMonitorStateException`é”™ã€‚**Lock æœ‰å…¶è‡ªå·±çš„æ–¹æ³•ã€‚
  - `wait([long timeout])`ï¼š**ç­‰å¾…**å¹¶ç«‹å³**é‡Šæ”¾é”**ï¼Œçº¿ç¨‹è¿›å…¥ WAITINGã€‚**è¢«å”¤é†’è‹¥è·å¾—é”åä»æ–­ç‚¹å¤„æ‰§è¡Œåç»­ä»£ç **
  - `notify()`ï¼šå”¤é†’æ­£åœ¨æ’é˜Ÿç­‰å¾…åŒæ­¥èµ„æºçš„çº¿ç¨‹ä¸­ä¼˜å…ˆçº§æœ€é«˜è€…ç»“æŸç­‰å¾…ï¼Œä½†**ä¸é‡Šæ”¾é”**ï¼Œè¢«é€šçŸ¥çº¿ç¨‹ä¸èƒ½ç«‹å³æ¢å¤æ‰§è¡Œçº¿ç¨‹ï¼Œ**éœ€é‡æ–°è¯·æ±‚åŒæ­¥é”**
  - `notifyAll()`ï¼šå”¤é†’æ­£åœ¨æ’é˜Ÿç­‰å¾…èµ„æºçš„æ‰€æœ‰çº¿ç¨‹ç»“æŸç­‰å¾…

> å“ªæ€•åªé€šçŸ¥äº†ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹ï¼Œè¢«é€šçŸ¥çº¿ç¨‹ä¹Ÿä¸èƒ½ç«‹å³æ¢å¤æ‰§è¡Œï¼Œå› ä¸ºå®ƒå½“åˆä¸­æ–­çš„åœ°æ–¹æ˜¯åœ¨åŒæ­¥å—å†…ï¼Œè€Œæ­¤åˆ»å®ƒå·²ç»ä¸æŒæœ‰é”ï¼Œæ‰€ä»¥å¥¹éœ€è¦å†æ¬¡å°è¯•å»è·å–é”ï¼ˆå¾ˆå¯èƒ½é¢ä¸´å…¶å®ƒçº¿ç¨‹çš„ç«äº‰ï¼‰ï¼ŒæˆåŠŸåæ‰èƒ½åœ¨å½“åˆè°ƒ ç”¨ wait æ–¹æ³•ä¹‹åçš„åœ°æ–¹æ¢å¤æ‰§è¡Œã€‚
> æ€»ç»“å¦‚ä¸‹ï¼š
> å¦‚æœèƒ½è·å–é”ï¼Œçº¿ç¨‹å°±ä» WAITING çŠ¶æ€å˜æˆ RUNNABLE çŠ¶æ€ï¼› å¦åˆ™ï¼Œä» wait set å‡ºæ¥ï¼Œåˆè¿›å…¥ entry setï¼Œçº¿ç¨‹å°±ä» WAITING çŠ¶æ€åˆå˜æˆ BLOCKED çŠ¶æ€ã€‚

### ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜

> ç”Ÿäº§è€…ï¼ˆProductorï¼‰å°†äº§å“äº¤ç»™åº—å‘˜ï¼ˆClerkï¼‰ï¼Œè€Œæ¶ˆè´¹è€…ï¼ˆï¼‰ä»åº—å‘˜å¤„å–èµ°äº§å“ï¼Œåº—å‘˜ä¸€æ¬¡åªèƒ½æŒæœ‰å›ºå®šæ•°é‡çš„äº§å“ï¼ˆæ¯”å¦‚ 20ï¼‰ï¼Œå¦‚æœç”Ÿäº§è€…è¯•å›¾ç”Ÿäº§æ›´å¤šçš„äº§å“ï¼Œåº—å‘˜ä¼šå«ç”Ÿäº§è€…åœä¸€ä¸‹ï¼Œå¦‚æœåº—ä¸­æœ‰ç©ºä½æ”¾äº§å“äº†å†é€šçŸ¥ç”Ÿäº§è€…ç»§ç»­ç”Ÿäº§ï¼›å¦‚æœåº—ä¸­æ²¡æœ‰äº§å“äº†ï¼Œåº—å‘˜ä¼šå‘Šè¯‰æ¶ˆè´¹è€…ç­‰ä¸€ä¸‹ï¼Œå¦‚æœåº—ä¸­æœ‰äº§å“äº†å†é€šçŸ¥æ¶ˆè´¹è€…æ¥å–èµ°äº§å“ã€‚
>
> åˆ†æï¼š
>
> 1.  æ˜¯å¦æ˜¯å¤šçº¿ç¨‹é—®é¢˜ï¼Ÿæ˜¯ï¼Œç”Ÿäº§è€…çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹
>
> 2.  æ˜¯å¦æœ‰å…±äº«æ•°æ®ï¼Ÿæ˜¯ï¼Œåº—å‘˜ï¼ˆæˆ–äº§å“ï¼‰
>
> 3.  æ˜¯å¦æ¶‰åŠçº¿ç¨‹çš„é€šä¿¡ï¼Ÿæ˜¯

#### åŒæ­¥ä»£ç å—ç‰ˆæœ¬

```java
class Productor implements Runnable {

    private final Product product;

    public Productor(Product product) {
        this.product = product;
    }

    @Override
    public void run() {
        while (true) {
            synchronized (product) {
                // while å’Œ wait ä¸€èµ·ä½¿ç”¨ï¼›ä¸èƒ½å•ç‹¬ä½¿ç”¨ ifï¼Œå¯èƒ½ä¼šç¼ºå°‘ä¸€æ¬¡åˆ¤æ–­
                // ä¸èƒ½ä½¿ç”¨ if...elseï¼Œä¼šå¯¼è‡´ wait å”¤é†’åå³ä½¿æ»¡è¶³æ¡ä»¶ä¹Ÿä¸èƒ½ç”Ÿäº§æˆ–æ¶ˆè´¹ï¼Œæµªè´¹äº† OS èµ„æº
                while (product.productNum >= 20) {
                    try {
                        product.wait();
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }

                product.productNum++;
                System.out.println(Thread.currentThread().getName() + "ï¼šç”Ÿäº§ç¬¬" + product.productNum + "ä¸ªäº§å“");

                product.notifyAll();
            }
            try {
                // æ”¾åœ¨åŒæ­¥å¤–æ›´åˆç†ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥æ­¤æ—¶æŠ¢å èµ„æº
                Thread.sleep(100);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
}


class Consumer implements Runnable {

    private final Product product;

    public Consumer(Product product) {
        this.product = product;
    }

    @Override
    public void run() {
        while (true) {
            synchronized (product) {
                // while å’Œ wait ä¸€èµ·ä½¿ç”¨ï¼›ä¸èƒ½å•ç‹¬ä½¿ç”¨ ifï¼Œå¯èƒ½ä¼šç¼ºå°‘ä¸€æ¬¡åˆ¤æ–­
                // ä¸èƒ½ä½¿ç”¨ if...elseï¼Œä¼šå¯¼è‡´ wait å”¤é†’åå³ä½¿æ»¡è¶³æ¡ä»¶ä¹Ÿä¸èƒ½ç”Ÿäº§æˆ–æ¶ˆè´¹ï¼Œæµªè´¹äº† OS èµ„æº
                while (product.productNum <= 0) {
                    try {
                        product.wait();
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }

                System.out.println(Thread.currentThread().getName() + "ï¼šæ¶ˆè´¹ç¬¬" + product.productNum + "ä¸ªäº§å“");
                product.productNum--;

                product.notifyAll();
            }
            // æ”¾åœ¨åŒæ­¥å¤–æ›´åˆç†ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥æ­¤æ—¶æŠ¢å èµ„æº
            try {
                Thread.sleep(200);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
}

class Product {
    // äº§å“æ•°é‡
    int productNum = 0;
}


public class PCTest {
    public static void main(String[] args) {
        Product product = new Product();
        new Thread(new Productor(product), "ç”Ÿäº§è€…1").start();
        new Thread(new Productor(product), "ç”Ÿäº§è€…2").start();
        new Thread(new Consumer(product), "æ¶ˆè´¹è€…1").start();
        new Thread(new Consumer(product), "æ¶ˆè´¹è€…2").start();
        new Thread(new Consumer(product), "æ¶ˆè´¹è€…3").start();
        new Thread(new Consumer(product), "æ¶ˆè´¹è€…4").start();
        new Thread(new Consumer(product), "æ¶ˆè´¹è€…5").start();
    }
}
```

#### Lock ç‰ˆæœ¬

```java
class Productor implements Runnable {

    private final Product product;

    public Productor(Product product) {
        this.product = product;
    }

    @Override
    public void run() {
        while (true) {

            try {
                product.lock.lock();
                // while å’Œ wait ä¸€èµ·ä½¿ç”¨ï¼›ä¸èƒ½å•ç‹¬ä½¿ç”¨ ifï¼Œå¯èƒ½ä¼šç¼ºå°‘ä¸€æ¬¡åˆ¤æ–­
                // ä¸èƒ½ä½¿ç”¨ if...elseï¼Œä¼šå¯¼è‡´ wait å”¤é†’åå³ä½¿æ»¡è¶³æ¡ä»¶ä¹Ÿä¸èƒ½ç”Ÿäº§æˆ–æ¶ˆè´¹ï¼Œæµªè´¹äº† OS èµ„æº
                while (product.productNum >= 20) {
                    try {
                        product.productor.await();
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }

                product.productNum++;
                System.out.println(Thread.currentThread().getName() + "ï¼šç”Ÿäº§ç¬¬" + product.productNum + "ä¸ªäº§å“");

                product.consumer.signalAll();
            } finally {
                product.lock.unlock();
            }


            try {
                // æ”¾åœ¨åŒæ­¥å¤–æ›´åˆç†ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥æ­¤æ—¶æŠ¢å èµ„æº
                Thread.sleep(100);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
}


class Consumer implements Runnable {

    private final Product product;

    public Consumer(Product product) {
        this.product = product;
    }

    @Override
    public void run() {
        while (true) {

            try {
                product.lock.lock();
                // while å’Œ wait ä¸€èµ·ä½¿ç”¨ï¼›ä¸èƒ½å•ç‹¬ä½¿ç”¨ ifï¼Œå¯èƒ½ä¼šç¼ºå°‘ä¸€æ¬¡åˆ¤æ–­
                // ä¸èƒ½ä½¿ç”¨ if...elseï¼Œä¼šå¯¼è‡´ wait å”¤é†’åå³ä½¿æ»¡è¶³æ¡ä»¶ä¹Ÿä¸èƒ½ç”Ÿäº§æˆ–æ¶ˆè´¹ï¼Œæµªè´¹äº† OS èµ„æº
                while (product.productNum <= 0) {
                    try {
                        product.consumer.await();
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }

                System.out.println(Thread.currentThread().getName() + "ï¼šæ¶ˆè´¹ç¬¬" + product.productNum + "ä¸ªäº§å“");
                product.productNum--;

                product.productor.signalAll();
            } finally {
                product.lock.unlock();
            }

            // æ”¾åœ¨åŒæ­¥å¤–æ›´åˆç†ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥æ­¤æ—¶æŠ¢å èµ„æº
            try {
                Thread.sleep(200);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
}

class Product {
    // äº§å“æ•°é‡
    int productNum = 0;

    Lock lock = new ReentrantLock();
    Condition productor = lock.newCondition();
    Condition consumer = lock.newCondition();
}


public class PCTest {
    public static void main(String[] args) {
        Product product = new Product();
        new Thread(new Productor(product), "ç”Ÿäº§è€…1").start();
        new Thread(new Productor(product), "ç”Ÿäº§è€…2").start();
        new Thread(new Consumer(product), "æ¶ˆè´¹è€…1").start();
        new Thread(new Consumer(product), "æ¶ˆè´¹è€…2").start();
        new Thread(new Consumer(product), "æ¶ˆè´¹è€…3").start();
        new Thread(new Consumer(product), "æ¶ˆè´¹è€…4").start();
        new Thread(new Consumer(product), "æ¶ˆè´¹è€…5").start();
    }
}
```

#### JUC ç‰ˆæœ¬

## ä¹ é¢˜

### synchronized å’Œ Lock åŒºåˆ«

- syn æ˜¯å…³é”®å­—å±äº **JVM å±‚é¢**çš„ï¼ˆåœ¨åŒæ­¥ä¸­å—ä¸­æ‰èƒ½è°ƒç”¨ wait/notifyï¼‰ï¼›Lock æ˜¯æ¥å£ï¼Œæ˜¯ **Api å±‚é¢**çš„ï¼ŒJVM å°†èŠ±è´¹è¾ƒå°‘çš„æ—¶é—´æ¥è°ƒåº¦çº¿ç¨‹ï¼Œæ€§èƒ½æ›´å¥½ã€‚å¹¶ä¸”å…·æœ‰æ›´å¥½çš„æ‰©å±•æ€§ï¼ˆæä¾›æ›´å¤šçš„å­ç±»ï¼‰
- syn æ˜¯**éšå¼é”**ï¼Œ**å‡ºäº†ä½œç”¨åŸŸ æˆ– æŠ›å¼‚å¸¸ä¼šè‡ªåŠ¨é‡Šæ”¾**ï¼›Lock æ˜¯**æ˜¾å¼é”**ï¼ˆ**æ‰‹åŠ¨å¼€å¯å’Œå…³é—­é”**ï¼Œåˆ«å¿˜è®°å…³é—­é”ï¼‰
- syn æœ‰ä»£ç å—é”å’Œæ–¹æ³•é”ï¼›Lock åªæœ‰ä»£ç å—é”
- **syn ä¸å¯ä¸­æ–­**ï¼›**Lock å¯ä¸­æ–­**ï¼ˆtryLock è®¾ç½®è¶…æ—¶æ–¹æ³•ï¼ŒlockInterruptibly()æ–¹ä»£ç å—ä¸­ï¼Œç”¨ interrupt()æ–¹æ³•ä¸­æ–­ï¼‰
- ä½¿ç”¨ Lock çš„ Condition å¯ä»¥**ç²¾ç¡®å”¤é†’**

ä¼˜å…ˆä½¿ç”¨é¡ºåºï¼šLock â€”> åŒæ­¥ä»£ç å—(å·²ç»è¿›å…¥äº†æ–¹æ³•ä½“ï¼Œåˆ†é…äº†ç›¸åº”èµ„æº) â€”> åŒæ­¥æ–¹æ³• (åœ¨æ–¹æ³•ä½“ä¹‹å¤–)

### sleep å’Œ wait å¼‚åŒ

- sleep æ˜¯ Thread çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä»»ä½•åœºæ™¯ä¸‹è°ƒç”¨ï¼›wait æ˜¯ Object çš„æ–¹æ³•ï¼Œå¿…é¡»åœ¨åŒæ­¥ä¸­è°ƒç”¨ï¼ˆåŒæ­¥ä»£ç å—ã€åŒæ­¥æ–¹æ³•ï¼‰
- è‹¥ä¿©æ–¹æ³•éƒ½åœ¨åŒæ­¥ä¸­è°ƒç”¨ï¼Œéƒ½ä¼šä½¿çº¿ç¨‹è¿›å…¥ TIME/ WAITING çŠ¶æ€ã€‚ä½† sleep **ä¸ä¼šé‡Šæ”¾é”**ï¼Œä¼‘çœ ç»“æŸå›åˆ°å°±ç»ªçŠ¶æ€ï¼›wait **ç­‰å¾…**å¹¶ç«‹å³**é‡Šæ”¾é”**ï¼Œ**è¢«å”¤é†’åè‹¥è·å¾—é”åˆ™ä»è¿™é‡Œæ‰§è¡Œåç»­ä»£ç **

### 2 ä¸ªçº¿ç¨‹å‘è´¦æˆ·å­˜é’±å¹¶æ‰“å°

é“¶è¡Œæœ‰ä¸€ä¸ªè´¦æˆ·ï¼Œæœ‰ä¸¤ä¸ªå‚¨æˆ·åˆ†åˆ«å‘åŒä¸€ä¸ªè´¦æˆ·å­˜ 3000 å…ƒï¼Œæ¯æ¬¡å­˜ 1000ï¼Œå­˜ 3 æ¬¡ã€‚æ¯æ¬¡å­˜å®Œæ‰“å°è´¦æˆ·ä½™é¢ã€‚

é—®é¢˜:è¯¥ç¨‹åºæ˜¯å¦æœ‰å®‰å…¨é—®é¢˜ï¼Œå¦‚æœæœ‰ï¼Œå¦‚ä½•è§£å†³ï¼Ÿæ­¤å¤„é‡‡ç”¨ç»§æ‰¿ Thread ç±»æ¥å®ç°ï¼ˆå®ç° Runnable æ¥å£ç¨ç®€å•ï¼‰

```java
class Account {
    private double balance;

    public Account(double balance) {
        this.balance = balance;
    }

    //å­˜é’±
    public synchronized void deposit(double amt) {
        if (amt > 0) {
            balance += amt;
            System.out.println(Thread.currentThread().getName() + ":å­˜é’±æˆåŠŸã€‚ä½™é¢ä¸ºï¼š" + balance);
        }
    }
}

class Customer extends Thread {

    private Account acct;

    public Customer(Account acct, String name) {
        super(name);
        this.acct = acct;
    }

    @Override
    public void run() {

        for (int i = 0; i < 3; i++) {
            acct.deposit(1000);

            try {
                Thread.sleep(100);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
}

public class AccountTest {

    public static void main(String[] args) {
        Account acct = new Account(0);
        new Customer(acct, "ç”²").start();
        new Customer(acct, "ä¹™").start();
    }
}
```

### 2 ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å° 1-100

åŒæ­¥ä»£ç å—ã€åŒæ­¥æ–¹æ³•

```java
class PrintThread implements Runnable{

    private int count = 1;

    @Override
    public void run() {
        while (true) {
            // waitã€notify å¿…é¡»åœ¨åŒæ­¥ä¸­ã€‚ä¸”è°ƒç”¨çš„å¯¹è±¡ä¸é”å¯¹è±¡å¿…é¡»ç›¸åŒ
            synchronized (this) {
                // å”¤é†’
                this.notifyAll();
                if (count <= 100) {
                    /*try {
                        // ä¸åŠ é”æ—¶ï¼Œå¢åŠ çº¿ç¨‹å®‰å…¨é—®é¢˜å‘ç”Ÿçš„æ¦‚ç‡
                        Thread.sleep(100);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }*/
                    System.out.println(Thread.currentThread().getName()+":"+count++);

                    try {
                        // ç­‰å¾…å¹¶ç«‹å³é‡Šæ”¾é”ï¼Œå”¤é†’åè¿˜æ˜¯ä»è¿™é‡Œç»§ç»­ï¼Œä½†æ˜¯éœ€è¦è·å–åˆ°é”ï¼Œæ‰€ä»¥å¤–å±‚éœ€è¦ä½¿ç”¨ while
                        this.wait();
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                } else {
                    break;
                }
            }
        }
    }
}

public class PrintTest {

    public static void main(String[] args) {
        PrintThread printThread = new PrintThread();
        // ä¹Ÿå¯ä»¥å°† run æ–¹æ³•å†…å®¹å†™å…¥æ™®é€šæ–¹æ³•ä¸­ï¼Œé‡‡ç”¨æ–¹æ³•å¼•ç”¨æ¥æ“ä½œ
        new Thread(printThread,"A").start();
        new Thread(printThread,"B").start();
    }
}
```

Lock æ–¹å¼æš‚æ—¶æ²¡æƒ³åˆ°å¥½ç‚¹çš„æ–¹æ³•

### ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜

è§ç¬”è®°

### åˆ›å»ºå¤šçº¿ç¨‹çš„ 4 ç§æ–¹å¼

è§ç¬”è®°
