<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>åŸºç¡€æ“ä½œ | conanan&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="webå‰ç«¯æŠ€æœ¯åšå®¢,ç®€æ´è‡³ä¸Š,ä¸“æ³¨webå‰ç«¯å­¦ä¹ ä¸æ€»ç»“ã€‚JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,githubç­‰æŠ€æœ¯æ–‡ç« ã€‚">
    <meta name="keywords" content="å‰ç«¯åšå®¢,ä¸ªäººæŠ€æœ¯åšå®¢,å‰ç«¯,å‰ç«¯å¼€å‘,å‰ç«¯æ¡†æ¶,webå‰ç«¯,å‰ç«¯é¢è¯•é¢˜,æŠ€æœ¯æ–‡æ¡£,å­¦ä¹ ,é¢è¯•,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.03260d1f.css" as="style"><link rel="preload" href="/assets/js/app.ac5e3ef4.js" as="script"><link rel="preload" href="/assets/js/2.d960b235.js" as="script"><link rel="preload" href="/assets/js/4.0e4cf147.js" as="script"><link rel="prefetch" href="/assets/js/10.949143aa.js"><link rel="prefetch" href="/assets/js/100.122fb3a2.js"><link rel="prefetch" href="/assets/js/101.88060c8d.js"><link rel="prefetch" href="/assets/js/102.06832b28.js"><link rel="prefetch" href="/assets/js/103.a0c17aef.js"><link rel="prefetch" href="/assets/js/104.b38ef641.js"><link rel="prefetch" href="/assets/js/105.603033e4.js"><link rel="prefetch" href="/assets/js/106.6b288074.js"><link rel="prefetch" href="/assets/js/107.1ffec4c0.js"><link rel="prefetch" href="/assets/js/108.c7b79afa.js"><link rel="prefetch" href="/assets/js/109.dda9fbee.js"><link rel="prefetch" href="/assets/js/11.326a1f58.js"><link rel="prefetch" href="/assets/js/110.920cbe6e.js"><link rel="prefetch" href="/assets/js/111.45bfe7f2.js"><link rel="prefetch" href="/assets/js/112.1f11c570.js"><link rel="prefetch" href="/assets/js/113.fab1cc04.js"><link rel="prefetch" href="/assets/js/114.21ea4ed6.js"><link rel="prefetch" href="/assets/js/115.96f65264.js"><link rel="prefetch" href="/assets/js/116.b324c49b.js"><link rel="prefetch" href="/assets/js/117.dc4d308c.js"><link rel="prefetch" href="/assets/js/118.8f152d6d.js"><link rel="prefetch" href="/assets/js/119.ede5fffc.js"><link rel="prefetch" href="/assets/js/12.23122444.js"><link rel="prefetch" href="/assets/js/120.044161d7.js"><link rel="prefetch" href="/assets/js/121.453c745a.js"><link rel="prefetch" href="/assets/js/122.e3b088eb.js"><link rel="prefetch" href="/assets/js/123.d5a90d16.js"><link rel="prefetch" href="/assets/js/124.7731d89c.js"><link rel="prefetch" href="/assets/js/125.e64126c4.js"><link rel="prefetch" href="/assets/js/126.e46361b1.js"><link rel="prefetch" href="/assets/js/127.067ae046.js"><link rel="prefetch" href="/assets/js/128.59df2a2f.js"><link rel="prefetch" href="/assets/js/129.a2b82230.js"><link rel="prefetch" href="/assets/js/13.6780e0cd.js"><link rel="prefetch" href="/assets/js/130.c20833b9.js"><link rel="prefetch" href="/assets/js/131.da020742.js"><link rel="prefetch" href="/assets/js/132.e20ac455.js"><link rel="prefetch" href="/assets/js/133.f114b097.js"><link rel="prefetch" href="/assets/js/134.49de9e80.js"><link rel="prefetch" href="/assets/js/135.1a24633f.js"><link rel="prefetch" href="/assets/js/136.d5853212.js"><link rel="prefetch" href="/assets/js/137.3a1020dd.js"><link rel="prefetch" href="/assets/js/138.f194f86d.js"><link rel="prefetch" href="/assets/js/139.bf8c1ca0.js"><link rel="prefetch" href="/assets/js/14.08edf279.js"><link rel="prefetch" href="/assets/js/140.c800f5e0.js"><link rel="prefetch" href="/assets/js/141.47afa8e4.js"><link rel="prefetch" href="/assets/js/142.fda2db61.js"><link rel="prefetch" href="/assets/js/143.0224a2e5.js"><link rel="prefetch" href="/assets/js/144.4126fe8d.js"><link rel="prefetch" href="/assets/js/145.9fe0839a.js"><link rel="prefetch" href="/assets/js/146.89a9e1b2.js"><link rel="prefetch" href="/assets/js/147.56419b8e.js"><link rel="prefetch" href="/assets/js/148.03d2b50f.js"><link rel="prefetch" href="/assets/js/149.c1331b6d.js"><link rel="prefetch" href="/assets/js/15.f198e5b9.js"><link rel="prefetch" href="/assets/js/16.00e51c93.js"><link rel="prefetch" href="/assets/js/17.291d3ebc.js"><link rel="prefetch" href="/assets/js/18.017a098e.js"><link rel="prefetch" href="/assets/js/19.61ae84a4.js"><link rel="prefetch" href="/assets/js/20.2fed9841.js"><link rel="prefetch" href="/assets/js/21.0540e3f5.js"><link rel="prefetch" href="/assets/js/22.65f1eb05.js"><link rel="prefetch" href="/assets/js/23.fd9e2f2e.js"><link rel="prefetch" href="/assets/js/24.199ad75b.js"><link rel="prefetch" href="/assets/js/25.005a23bb.js"><link rel="prefetch" href="/assets/js/26.46587fdd.js"><link rel="prefetch" href="/assets/js/27.eaf61373.js"><link rel="prefetch" href="/assets/js/28.12bcc1aa.js"><link rel="prefetch" href="/assets/js/29.2ee78c15.js"><link rel="prefetch" href="/assets/js/3.aae4de15.js"><link rel="prefetch" href="/assets/js/30.5a13fad2.js"><link rel="prefetch" href="/assets/js/31.d559ae93.js"><link rel="prefetch" href="/assets/js/32.d5a38545.js"><link rel="prefetch" href="/assets/js/33.484dfc49.js"><link rel="prefetch" href="/assets/js/34.1a006a06.js"><link rel="prefetch" href="/assets/js/35.12b84d1e.js"><link rel="prefetch" href="/assets/js/36.b2cd4408.js"><link rel="prefetch" href="/assets/js/37.a5859cb8.js"><link rel="prefetch" href="/assets/js/38.96209f1d.js"><link rel="prefetch" href="/assets/js/39.71d70a82.js"><link rel="prefetch" href="/assets/js/40.a59b859c.js"><link rel="prefetch" href="/assets/js/41.ebb72a6a.js"><link rel="prefetch" href="/assets/js/42.71f99aa2.js"><link rel="prefetch" href="/assets/js/43.092ff2c9.js"><link rel="prefetch" href="/assets/js/44.d70e216f.js"><link rel="prefetch" href="/assets/js/45.afb733d1.js"><link rel="prefetch" href="/assets/js/46.86c421f9.js"><link rel="prefetch" href="/assets/js/47.6d337ef6.js"><link rel="prefetch" href="/assets/js/48.157e1f1c.js"><link rel="prefetch" href="/assets/js/49.1aed4add.js"><link rel="prefetch" href="/assets/js/5.831f36ca.js"><link rel="prefetch" href="/assets/js/50.b495cbac.js"><link rel="prefetch" href="/assets/js/51.f4a8b763.js"><link rel="prefetch" href="/assets/js/52.beec293d.js"><link rel="prefetch" href="/assets/js/53.2ac4d785.js"><link rel="prefetch" href="/assets/js/54.342112cf.js"><link rel="prefetch" href="/assets/js/55.61e2bfb6.js"><link rel="prefetch" href="/assets/js/56.fa782548.js"><link rel="prefetch" href="/assets/js/57.41bc249e.js"><link rel="prefetch" href="/assets/js/58.c1d5fafb.js"><link rel="prefetch" href="/assets/js/59.4297a34f.js"><link rel="prefetch" href="/assets/js/6.54e4e793.js"><link rel="prefetch" href="/assets/js/60.634948c3.js"><link rel="prefetch" href="/assets/js/61.de4327e7.js"><link rel="prefetch" href="/assets/js/62.c6902476.js"><link rel="prefetch" href="/assets/js/63.737a0e11.js"><link rel="prefetch" href="/assets/js/64.cbe1b041.js"><link rel="prefetch" href="/assets/js/65.2df8f108.js"><link rel="prefetch" href="/assets/js/66.ee7de747.js"><link rel="prefetch" href="/assets/js/67.88edee59.js"><link rel="prefetch" href="/assets/js/68.c29f5efe.js"><link rel="prefetch" href="/assets/js/69.2fedc1f9.js"><link rel="prefetch" href="/assets/js/7.1c00f39e.js"><link rel="prefetch" href="/assets/js/70.0fe4782b.js"><link rel="prefetch" href="/assets/js/71.6c22c273.js"><link rel="prefetch" href="/assets/js/72.1fc7ddbd.js"><link rel="prefetch" href="/assets/js/73.25cb42eb.js"><link rel="prefetch" href="/assets/js/74.e922e1cc.js"><link rel="prefetch" href="/assets/js/75.f48393b6.js"><link rel="prefetch" href="/assets/js/76.72e96818.js"><link rel="prefetch" href="/assets/js/77.3df4edcb.js"><link rel="prefetch" href="/assets/js/78.73c6a652.js"><link rel="prefetch" href="/assets/js/79.22ba589c.js"><link rel="prefetch" href="/assets/js/8.b5f907d4.js"><link rel="prefetch" href="/assets/js/80.2d070db4.js"><link rel="prefetch" href="/assets/js/81.c0bc2539.js"><link rel="prefetch" href="/assets/js/82.4c6a47fa.js"><link rel="prefetch" href="/assets/js/83.a43f597f.js"><link rel="prefetch" href="/assets/js/84.8ce525d0.js"><link rel="prefetch" href="/assets/js/85.6b21aae0.js"><link rel="prefetch" href="/assets/js/86.f6ebabd9.js"><link rel="prefetch" href="/assets/js/87.9acaeb0d.js"><link rel="prefetch" href="/assets/js/88.99cdf592.js"><link rel="prefetch" href="/assets/js/89.58f63450.js"><link rel="prefetch" href="/assets/js/9.053d267f.js"><link rel="prefetch" href="/assets/js/90.1d59f40c.js"><link rel="prefetch" href="/assets/js/91.e8b2a5cd.js"><link rel="prefetch" href="/assets/js/92.b92bba74.js"><link rel="prefetch" href="/assets/js/93.688cad95.js"><link rel="prefetch" href="/assets/js/94.2c11a588.js"><link rel="prefetch" href="/assets/js/95.aa37d1df.js"><link rel="prefetch" href="/assets/js/96.fffa0e6e.js"><link rel="prefetch" href="/assets/js/97.04e9be9f.js"><link rel="prefetch" href="/assets/js/98.2672abca.js"><link rel="prefetch" href="/assets/js/99.c8de1c63.js">
    <link rel="stylesheet" href="/assets/css/0.styles.03260d1f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/EB-logo.png" alt="conanan's blog" class="logo"> <span class="site-name can-hide">conanan's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><a href="/about/" class="nav-link">å…³äº</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/pages/4b56bd/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/4b56bd/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/pages/724936/" class="nav-link">Java Web</a></li><li class="dropdown-item"><h4>å·¥å…·</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b18d09/" class="nav-link">Maven</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DataBase" class="dropdown-title"><a href="/pages/74cdda/" class="link-title">DataBase</a> <span class="title" style="display:none;">DataBase</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/74cdda/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/pages/4e9f47/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool" class="dropdown-title"><a href="/pages/89d1e7/" class="link-title">Tool</a> <span class="title" style="display:none;">Tool</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/89d1e7/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Vim</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d5fb/" class="nav-link">Docker</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/xugaoyi/image_store/blog/20200103123203.jpg"> <div class="blogger-info"><h3>Evan Xu</h3> <span>å‰ç«¯ç•Œçš„å°å­¦ç”Ÿ</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><a href="/about/" class="nav-link">å…³äº</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/pages/4b56bd/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/4b56bd/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/pages/724936/" class="nav-link">Java Web</a></li><li class="dropdown-item"><h4>å·¥å…·</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b18d09/" class="nav-link">Maven</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DataBase" class="dropdown-title"><a href="/pages/74cdda/" class="link-title">DataBase</a> <span class="title" style="display:none;">DataBase</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/74cdda/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/pages/4e9f47/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool" class="dropdown-title"><a href="/pages/89d1e7/" class="link-title">Tool</a> <span class="title" style="display:none;">Tool</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/89d1e7/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Vim</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d5fb/" class="nav-link">Docker</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Jakarta EE</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tomcat</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringMVC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SpringDataJPA</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/9e29b0/" class="sidebar-link">JPAåŸºç¡€</a></li><li><a href="/pages/5427c0/" class="sidebar-link">æ€»è§ˆå…¥é—¨</a></li><li><a href="/pages/a40e65/" aria-current="page" class="active sidebar-link">åŸºç¡€æ“ä½œ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/a40e65/#ç¯å¢ƒå‡†å¤‡" class="sidebar-link">ç¯å¢ƒå‡†å¤‡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/a40e65/#maven-æˆ–-gradle-é¡¹ç›®" class="sidebar-link">Maven æˆ– Gradle é¡¹ç›®</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#application-yml" class="sidebar-link">application.yml</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#entity" class="sidebar-link">Entity</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#repository" class="sidebar-link">Repository</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#jpa-æ¥å£é»˜è®¤å¢åˆ æ”¹æŸ¥-ğŸ”¥" class="sidebar-link">JPA æ¥å£é»˜è®¤å¢åˆ æ”¹æŸ¥ ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#dqm-æ–¹æ³•å-å•è¡¨æŸ¥è¯¢ã€åˆ é™¤-ğŸ”¥" class="sidebar-link">DQMâ€”æ–¹æ³•å å•è¡¨æŸ¥è¯¢ã€åˆ é™¤ ğŸ”¥</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/a40e65/#ç®€ä»‹ã€äº†è§£ã€‘" class="sidebar-link">ç®€ä»‹ã€äº†è§£ã€‘</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#é€‰æ‹©æ€§æš´éœ²æ–¹æ³•ã€æŒæ¡ã€‘ğŸ”¥" class="sidebar-link">é€‰æ‹©æ€§æš´éœ²æ–¹æ³•ã€æŒæ¡ã€‘ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#æ–¹æ³•çš„æŸ¥è¯¢ç­–ç•¥è®¾ç½®-ã€â˜ ï¸ã€‘" class="sidebar-link">æ–¹æ³•çš„æŸ¥è¯¢ç­–ç•¥è®¾ç½® ã€â˜ ï¸ã€‘</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#dqm-è¯­æ³•ã€æŒæ¡ã€‘ğŸ”¥" class="sidebar-link">DQM è¯­æ³•ã€æŒæ¡ã€‘ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#ç‰¹å®šç±»å‹çš„å‚æ•°ï¼šsort-pageableã€æŒæ¡ã€‘ğŸ”¥" class="sidebar-link">ç‰¹å®šç±»å‹çš„å‚æ•°ï¼šSort Pageableã€æŒæ¡ã€‘ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#é™åˆ¶æŸ¥è¯¢ç»“æœ-first-å’Œ-topã€æŒæ¡ã€‘ğŸ”¥" class="sidebar-link">é™åˆ¶æŸ¥è¯¢ç»“æœ First å’Œ Topã€æŒæ¡ã€‘ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#nonnullã€-nonnullapiã€-nullableã€äº†è§£ã€‘" class="sidebar-link">@NonNullã€@NonNullApiã€@Nullableã€äº†è§£ã€‘</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#æ€è€ƒï¼šservice-å±‚å°è£…ã€äº†è§£ã€‘" class="sidebar-link">æ€è€ƒï¼šService å±‚å°è£…ã€äº†è§£ã€‘</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#åˆ©ç”¨-repository-ä¸­çš„æ–¹æ³•è¿”å›å€¼-ğŸ”¥" class="sidebar-link">åˆ©ç”¨ Repository ä¸­çš„æ–¹æ³•è¿”å›å€¼ ğŸ”¥</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/a40e65/#è¿”å›ç±»å‹æ€»è§ˆã€äº†è§£ã€‘" class="sidebar-link">è¿”å›ç±»å‹æ€»è§ˆã€äº†è§£ã€‘</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#streamableã€äº†è§£ã€‘" class="sidebar-link">Streamableã€äº†è§£ã€‘</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#list-stream-page-sliceã€æŒæ¡ã€‘ğŸ”¥" class="sidebar-link">List/Stream/Page/Sliceã€æŒæ¡ã€‘ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#å¯¹-feature-completablefuture-å¼‚æ­¥è¿”å›ç»“æœçš„æ”¯æŒ" class="sidebar-link">å¯¹ Feature/CompletableFuture å¼‚æ­¥è¿”å›ç»“æœçš„æ”¯æŒ</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#å¯¹-reactive-æ”¯æŒ-flux-ä¸-mono" class="sidebar-link">å¯¹ Reactive æ”¯æŒ flux ä¸ Mono</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#è¿”å›ç»“æœæ”¯æŒæ€»ç»“" class="sidebar-link">è¿”å›ç»“æœæ”¯æŒæ€»ç»“</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#æœ€å¸¸è§çš„-dto-è¿”å›ç»“æœçš„æ”¯æŒæ–¹æ³•æœ‰å“ªäº›ã€æŒæ¡ã€‘" class="sidebar-link">æœ€å¸¸è§çš„ DTO è¿”å›ç»“æœçš„æ”¯æŒæ–¹æ³•æœ‰å“ªäº›ã€æŒæ¡ã€‘</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#dqm-jpql-query-å•ã€å¤šè¡¨å¢åˆ æ”¹æŸ¥-ğŸ”¥" class="sidebar-link">DQMâ€”JPQL @Query å•ã€å¤šè¡¨å¢åˆ æ”¹æŸ¥ ğŸ”¥</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/a40e65/#å¿«é€Ÿä½“éªŒ-query-çš„æ–¹æ³•" class="sidebar-link">å¿«é€Ÿä½“éªŒ @Query çš„æ–¹æ³•</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#jpaquerylookupstrategy-å…³é”®æºç å‰–æ" class="sidebar-link">JpaQueryLookupStrategy å…³é”®æºç å‰–æ</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#query-çš„åŸºæœ¬ä»‹ç»ã€äº†è§£ã€‘" class="sidebar-link">@Query çš„åŸºæœ¬ä»‹ç»ã€äº†è§£ã€‘</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#jpql-çš„è¯­æ³•" class="sidebar-link">JPQL çš„è¯­æ³•</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#query-ç”¨æ³•æ¡ˆä¾‹ã€æŒæ¡ã€‘ğŸ”¥" class="sidebar-link">@Query ç”¨æ³•æ¡ˆä¾‹ã€æŒæ¡ã€‘ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#query-çš„æ’åº-ğŸ”¥" class="sidebar-link">@Query çš„æ’åº ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#query-çš„åˆ†é¡µ-ğŸ”¥" class="sidebar-link">@Query çš„åˆ†é¡µ ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#param-ç”¨æ³•-ğŸ”¥" class="sidebar-link">@Param ç”¨æ³• ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#query-ä¹‹-projections-åº”ç”¨è¿”å›æŒ‡å®š-dtoã€æŒæ¡ã€‘ğŸ”¥" class="sidebar-link">@Query ä¹‹ Projections åº”ç”¨è¿”å›æŒ‡å®š DTOã€æŒæ¡ã€‘ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#query-åŠ¨æ€æŸ¥è¯¢è§£å†³æ–¹æ³•ã€æŒæ¡ã€‘ğŸ”¥" class="sidebar-link">@Query åŠ¨æ€æŸ¥è¯¢è§£å†³æ–¹æ³•ã€æŒæ¡ã€‘ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#query-æ€»ç»“-ğŸ”¥" class="sidebar-link">@Query æ€»ç»“ ğŸ”¥</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/a40e65/#specification-åŠ¨æ€æŸ¥è¯¢-ğŸ”¥" class="sidebar-link">Specification åŠ¨æ€æŸ¥è¯¢ ğŸ”¥</a></li></ul></li><li><a href="/pages/26ad8c/" class="sidebar-link">å¤šè¡¨æ“ä½œ</a></li><li><a href="/pages/544a0d/" class="sidebar-link">å®¡è®¡åŠŸèƒ½</a></li><li><a href="/pages/044c3c/" class="sidebar-link">JPAç¤ºä¾‹ï¼ˆæ—§ï¼‰</a></li></ul></section></li><li><a href="/pages/927e76/" class="sidebar-link">Test</a></li><li><a href="/pages/2ffe27/" class="sidebar-link">Shiro</a></li><li><a href="/pages/16f81e/" class="sidebar-link">Thymeleaf</a></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- æ­£æ–¹å½¢ -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/categories/?category=Java%20Web" title="åˆ†ç±»" data-v-1cd794fe>Java Web</a></li> <li data-v-1cd794fe><a href="/categories/?category=SpringDataJPA" title="åˆ†ç±»" data-v-1cd794fe>SpringDataJPA</a></li> <!----></ul> <div class="info" data-v-1cd794fe><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/apple54whn" target="_blank" title="ä½œè€…" class="beLink" data-v-1cd794fe>conanan</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2021-06-21</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          åŸºç¡€æ“ä½œ
        </h1> <div class="page-slot page-slot-top"><!-- å›ºå®š100% * 90pxå¯æ˜¾ç¤ºï¼Œmax-height:90pxæœªè§æ˜¾ç¤º-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h1 id="å•è¡¨æ“ä½œ"><a href="#å•è¡¨æ“ä½œ" class="header-anchor">#</a> å•è¡¨æ“ä½œ</h1> <h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="header-anchor">#</a> ç¯å¢ƒå‡†å¤‡</h2> <h3 id="maven-æˆ–-gradle-é¡¹ç›®"><a href="#maven-æˆ–-gradle-é¡¹ç›®" class="header-anchor">#</a> Maven æˆ– Gradle é¡¹ç›®</h3> <p>ä¸å¤šé€¼é€¼äº†ï¼ŒIDEA ç›´æ¥åˆ›å»ºå³å¯ã€‚é€‰æ‹© spring-boot-starter-data-jpaã€mysql-connector-javaï¼Œå…¶ä½™æ ¹æ®éœ€è¦é€‰æ‹©</p> <div class="language-gradle line-numbers-mode"><pre class="language-text"><code>plugins {
	id 'org.springframework.boot' version '2.4.1'
	id 'io.spring.dependency-management' version '1.0.10.RELEASE'
	id 'java'
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="application-yml"><a href="#application-yml" class="header-anchor">#</a> application.yml</h3> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10000</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>///demo<span class="token punctuation">?</span>characterEncoding=utf<span class="token punctuation">-</span>8<span class="token important">&amp;serverTimezone=GMT%2B8</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> w111111
  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
    <span class="token key atrule">show-sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># æ˜¾ç¤ºsql</span>
    <span class="token comment">#generate-ddl: true # è‡ªåŠ¨ç”Ÿæˆè¡¨ï¼Œæœ‰åˆ™ä¸ç”Ÿæˆï¼ˆç”Ÿäº§ä¸­ä¸æ¨èï¼Œæµ‹è¯•hibernateä¸­å¯ä»¥ç”¨spring.jpa.hibernateå®ƒçš„é…ç½®ï¼‰</span>
    <span class="token key atrule">properties</span><span class="token punctuation">:</span> <span class="token comment"># jpa å®ç°æ¡†æ¶ç‰¹æœ‰çš„å±æ€§é…ç½®</span>
      <span class="token key atrule">hibernate</span><span class="token punctuation">:</span> <span class="token comment"># å¦‚ hibernate</span>
        <span class="token key atrule">format_sql</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>
      <span class="token comment">#è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“è¡¨ï¼Œæ³¨æ„ï¼Œå­—æ®µçš„å¢åˆ ä¸ä¼šè§¦å‘ï¼</span>
      <span class="token comment">#create: ç¨‹åºè¿è¡Œæ—¶åˆ›å»ºæ•°æ®åº“è¡¨ï¼ˆå¦‚æœæœ‰è¡¨ï¼Œå…ˆåˆ é™¤è¡¨å†åˆ›å»ºï¼‰</span>
      <span class="token comment">#update: ç¨‹åºè¿è¡Œæ—¶åˆ›å»ºè¡¨ï¼ˆå¦‚æœæœ‰è¡¨ï¼Œä¸ä¼šåˆ›å»ºè¡¨ï¼Œæ³¨æ„ä¿®æ”¹å­—æ®µä¹Ÿä¸ä¼šé‡æ–°ç”Ÿæˆè¡¨ï¼‰</span>
      <span class="token comment">#create-drop: ä¸€èˆ¬ç”¨åœ¨æµ‹è¯•, ä¼šè¯å®Œæˆåæ¸…ç©ºè¡¨</span>
      <span class="token comment">#none: é»˜è®¤å€¼ï¼Œä¸ä¼šåˆ›å»ºè¡¨ï¼Œåç»­ä¼šç½®ä¸º none</span>
      <span class="token key atrule">ddl-auto</span><span class="token punctuation">:</span> create
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="entity"><a href="#entity" class="header-anchor">#</a> Entity</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@Setter</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@Entity</span> <span class="token comment">// å‘Šè¯‰ JPA è¿™æ˜¯ä¸€ä¸ªå®ä½“ç±»</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;article&quot;</span><span class="token punctuation">)</span><span class="token comment">//@Tableå»ºç«‹äº†å®ä½“ç±»å’Œæ•°æ®è¡¨çš„å…³ç³»ï¼ŒnameæŒ‡å‘è¡¨åã€‚å½“ç±»åå’Œæ•°æ®è¡¨çš„åä¸€è‡´æ—¶ï¼Œæ­¤æ³¨è§£å¯çœç•¥</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token punctuation">{</span>

    <span class="token comment">//æ ‡è¯†è¿™æ˜¯ä¸»é”®å­—æ®µ</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token comment">//æŒ‡å®šä¸»é”®ç”Ÿæˆç­–ç•¥ï¼ŒGenerationType.IDENTITYå°±æ˜¯å¯¹åº”åˆ°mysqlä¸­çš„æ•°æ®è‡ªå¢ç­–ç•¥</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> aid<span class="token punctuation">;</span>

    <span class="token comment">//ä½¿ç”¨@Columnæ˜ å°„ç±»çš„å±æ€§å’Œæ•°æ®è¡¨çš„å­—æ®µå…³ç³»ï¼ŒnameæŒ‡å®šè¡¨ä¸­çš„å­—æ®µåã€‚å½“ç±»çš„å±æ€§åå’Œæ•°æ®è¡¨çš„å­—æ®µåä¸€è‡´æ—¶ï¼Œæ­¤æ³¨è§£å¯çœç•¥</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;author&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> author<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> createTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="repository"><a href="#repository" class="header-anchor">#</a> Repository</h3> <p>æ³¨æ„ï¼šJpaSpecificationExecutor åœ¨åŠ¨æ€æŸ¥è¯¢ä¸­ä¼šç”¨åˆ°</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">JpaSpecificationExecutor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="jpa-æ¥å£é»˜è®¤å¢åˆ æ”¹æŸ¥-ğŸ”¥"><a href="#jpa-æ¥å£é»˜è®¤å¢åˆ æ”¹æŸ¥-ğŸ”¥" class="header-anchor">#</a> JPA æ¥å£é»˜è®¤å¢åˆ æ”¹æŸ¥ ğŸ”¥</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DataJpaTest</span>
<span class="token comment">// DataJpaTestã€MybatisTest ä¼šé»˜è®¤ä½¿ç”¨å…¶æµ‹è¯•æ•°æ®æºæ›¿ä»£ï¼Œè‹¥è¦ä½¿ç”¨è‡ªå·±é…ç½®çš„ï¼Œéœ€è¦æ·»åŠ å¦‚ä¸‹æ³¨è§£</span>
<span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace <span class="token operator">=</span> <span class="token class-name">AutoConfigureTestDatabase<span class="token punctuation">.</span>Replace</span><span class="token punctuation">.</span>NONE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArticleRepositoryTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ArticleRepository</span> articleRepository<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Test</span>
    <span class="token comment">// @Test å•å…ƒæµ‹è¯•é»˜è®¤æµ‹è¯•å®Œä¼šå›æ»šï¼Œå¯ä»¥é…ç½®å¦‚ä¸‹æ³¨è§£æ¥é˜²æ­¢å›æ»š</span>
    <span class="token annotation punctuation">@Rollback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">testSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Article</span> article <span class="token operator">=</span> <span class="token class-name">Article</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">&quot;ç‰›é€¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token string">&quot;ç”·å“¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// save çš„ entity ä¸­è‹¥ id ä¸º nullï¼Œåˆ™persistï¼Œå¦åˆ™æ‰§è¡Œmergeï¼ˆæºç ä¸­ä¼šè¿›è¡Œidæ˜¯å¦ä¸ºnullç­‰åˆ¤æ–­ï¼‰</span>
        <span class="token class-name">Article</span> save <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>save<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Test</span>
    <span class="token comment">// @Test å•å…ƒæµ‹è¯•é»˜è®¤æµ‹è¯•å®Œä¼šå›æ»šï¼Œå¯ä»¥é…ç½®å¦‚ä¸‹æ³¨è§£æ¥é˜²æ­¢å›æ»š</span>
    <span class="token annotation punctuation">@Rollback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">testUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Article</span> article <span class="token operator">=</span> <span class="token class-name">Article</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">aid</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token string">&quot;ç”·ç¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// save çš„ entity ä¸­è‹¥ id ä¸º nullï¼Œåˆ™persistï¼Œå¦åˆ™æ‰§è¡Œmergeï¼ˆæºç ä¸­ä¼šè¿›è¡Œidæ˜¯å¦ä¸ºnullç­‰åˆ¤æ–­ï¼‰</span>
        <span class="token comment">// æ³¨æ„ï¼Œå®ä½“ç±»ä¸­å½“å‰ä¸ºnullçš„å­—æ®µä¹Ÿä¼šè¢«æ›´æ–°ä¸ºnullï¼Œå¯ä»¥é…ç½®æ›´æ”¹è¯¥ç­–ç•¥ï¼ŒDynamicUpdateç­–ç•¥</span>
        <span class="token class-name">Article</span> save <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>save<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Test</span>
    <span class="token comment">// @Test å•å…ƒæµ‹è¯•é»˜è®¤æµ‹è¯•å®Œä¼šå›æ»šï¼Œå¯ä»¥é…ç½®å¦‚ä¸‹æ³¨è§£æ¥é˜²æ­¢å›æ»š</span>
    <span class="token annotation punctuation">@Rollback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">testDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Article</span> article <span class="token operator">=</span> <span class="token class-name">Article</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">aid</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token string">&quot;ç”·ç¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        articleRepository<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ ¹æ®idæŸ¥è¯¢ååˆ é™¤</span>

        articleRepository<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ ¹æ®entityä¸­idæŸ¥è¯¢ååˆ é™¤</span>

        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> articles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        articles<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Article</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">aid</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token string">&quot;ç”·ç¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        articleRepository<span class="token punctuation">.</span><span class="token function">deleteAll</span><span class="token punctuation">(</span>articles<span class="token punctuation">)</span><span class="token punctuation">;</span>

        articleRepository<span class="token punctuation">.</span><span class="token function">deleteInBatch</span><span class="token punctuation">(</span>articles<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä¼˜åŒ–åçš„ï¼Œç»§æ‰¿ JpaRepository</span>

        articleRepository<span class="token punctuation">.</span><span class="token function">deleteAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        articleRepository<span class="token punctuation">.</span><span class="token function">deleteAllInBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä¼˜åŒ–åçš„ï¼Œç»§æ‰¿ JpaRepository</span>
    <span class="token punctuation">}</span>



    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ ¹æ®id/idsæŸ¥è¯¢</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> articleOptional <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">5L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>articleOptional<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> articleIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        articleIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        articleRepository<span class="token punctuation">.</span><span class="token function">findAllById</span><span class="token punctuation">(</span>articleIds<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ˜¯å¦å­˜åœ¨</span>
        <span class="token keyword">boolean</span> b1 <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">existsById</span><span class="token punctuation">(</span><span class="token number">5L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åº•å±‚æ ¹æ®æ•°é‡æ˜¯å¦ == 1</span>
        <span class="token keyword">boolean</span> b2 <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token class-name">Example</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">Article</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token string">&quot;ç”·ç¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">// å•ä¸ªæ¡ä»¶æŸ¥è¯¢</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> one <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token class-name">Example</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">Article</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token string">&quot;ç”·ç¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å¤šä¸ªæ¡ä»¶æŸ¥è¯¢ï¼Œå¯åˆ†é¡µã€æ’åº</span>
        articleRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Example</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">Article</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token string">&quot;ç”·å“¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">// ç»Ÿè®¡</span>
        <span class="token keyword">long</span> count1 <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> count2 <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token class-name">Example</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">Article</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token string">&quot;ç”·ç¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * ç«‹å³åŠ è½½
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testFindOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> articleOptional <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token class-name">Example</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">Article</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">aid</span><span class="token punctuation">(</span><span class="token number">6L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>articleOptional<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * å»¶è¿ŸåŠ è½½ï¼ˆæ‡’åŠ è½½ï¼‰ï¼Œåº•å±‚è°ƒç”¨getReferenceï¼Œä½¿ç”¨çš„æ—¶å€™æ‰æŸ¥è¯¢æ•°æ®åº“ã€‚ä¸€èˆ¬ä½¿ç”¨è¿™ä¸ªï¼ˆåºåˆ—åŒ–æ—¶å¯èƒ½æŠ¥é”™ï¼Ÿï¼‰
     * IDEAéœ€è¦å»æ‰Debugä¸­å‡ ä¸ªé€‰é¡¹æ‰å¯ä»¥çœ‹åˆ°
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testGetOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Article</span> article <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span><span class="token number">6L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br></div></div><h2 id="dqm-æ–¹æ³•å-å•è¡¨æŸ¥è¯¢ã€åˆ é™¤-ğŸ”¥"><a href="#dqm-æ–¹æ³•å-å•è¡¨æŸ¥è¯¢ã€åˆ é™¤-ğŸ”¥" class="header-anchor">#</a> DQMâ€”æ–¹æ³•å å•è¡¨æŸ¥è¯¢ã€åˆ é™¤ ğŸ”¥</h2> <h3 id="ç®€ä»‹ã€äº†è§£ã€‘"><a href="#ç®€ä»‹ã€äº†è§£ã€‘" class="header-anchor">#</a> ç®€ä»‹ã€äº†è§£ã€‘</h3> <p>Spring Data JPA çš„æœ€å¤§ç‰¹è‰²æ˜¯åˆ©ç”¨<strong>æ–¹æ³•åå®šä¹‰æŸ¥è¯¢æ–¹æ³•</strong>ï¼ˆDefining Query Methodsï¼‰æ¥åš CRUD æ“ä½œã€‚è¿˜èƒ½ç»Ÿä¸€æ–¹æ³•åçš„è¯­ä¹‰ã€å‘½åè§„èŒƒã€‚DQM æ˜¯<strong>å¯¹ JPQL æ›´æ·±å±‚æ¬¡å°è£…ï¼Ÿ</strong>ã€‚DQM è¯­æ³•å…±æœ‰ 2 ç§ï¼š</p> <ul><li><p>@Query æ‰‹åŠ¨åœ¨æ–¹æ³•ä¸Šå®šä¹‰</p></li> <li><p>ç›´æ¥é€šè¿‡æ–¹æ³•åå°±å¯ä»¥å®ç°ï¼ˆæœ¬èŠ‚é‡ç‚¹ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼‰ğŸ”¥</p> <p>ä¼šæ ¹æ®<strong>å…ˆåé¡ºåº</strong>ä¼ å‚ï¼ï¼åç§°æ— æ‰€è°“å…·ä½“çš„å…³é”®å­—</p></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ArticleRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token class-name">Article</span> <span class="token function">findByAuthorAndTitle</span><span class="token punctuation">(</span><span class="token class-name">String</span> author<span class="token punctuation">,</span> <span class="token class-name">String</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è¿”å› stream</span>
    <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> <span class="token function">streamByAuthorAndTitleLike</span><span class="token punctuation">(</span><span class="token class-name">String</span> author<span class="token punctuation">,</span> <span class="token class-name">String</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// find ä¹Ÿå¯ä»¥ç›´æ¥è¿”å› stream</span>
    <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByAuthorAndTitleLike</span><span class="token punctuation">(</span><span class="token class-name">String</span> author<span class="token punctuation">,</span> <span class="token class-name">String</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DataJpaTest</span>
<span class="token comment">// DataJpaTestã€MybatisTest ä¼šé»˜è®¤ä½¿ç”¨å…¶æµ‹è¯•æ•°æ®æºæ›¿ä»£ï¼Œè‹¥è¦ä½¿ç”¨è‡ªå·±é…ç½®çš„ï¼Œéœ€è¦æ·»åŠ å¦‚ä¸‹æ³¨è§£</span>
<span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace <span class="token operator">=</span> <span class="token class-name">AutoConfigureTestDatabase<span class="token punctuation">.</span>Replace</span><span class="token punctuation">.</span>NONE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArticleMethodRepositoryTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ArticleRepository</span> articleRepository<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testFindByAuthorAndTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Article</span> article <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">findByAuthorAndTitle</span><span class="token punctuation">(</span><span class="token string">&quot;ç”·å“¥&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ç‰›é€¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testFindByAuthorAndTitleLike</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è¿”å› stream</span>
        <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> articleStream1 <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">streamByAuthorAndTitleLike</span><span class="token punctuation">(</span><span class="token string">&quot;ç”·å“¥&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ç‰›%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        articleStream1<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> articleStream2 <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">streamByAuthorAndTitleLike</span><span class="token punctuation">(</span><span class="token string">&quot;ç”·å“¥&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ç‰›_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        articleStream2<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> articleStream3 <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">findByAuthorAndTitleLike</span><span class="token punctuation">(</span><span class="token string">&quot;ç”·å“¥&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ç‰›%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        articleStream3<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="é€‰æ‹©æ€§æš´éœ²æ–¹æ³•ã€æŒæ¡ã€‘ğŸ”¥"><a href="#é€‰æ‹©æ€§æš´éœ²æ–¹æ³•ã€æŒæ¡ã€‘ğŸ”¥" class="header-anchor">#</a> é€‰æ‹©æ€§æš´éœ²æ–¹æ³•ã€æŒæ¡ã€‘ğŸ”¥</h3> <p>æ–¹æ³•ååªéœ€ç»§æ‰¿ Repository æ¥å£æˆ–å…¶å­ç±»æ¥å£å³å¯ä½¿ç”¨ï¼Œå› ä¸ºæœ€ç»ˆçš„å®ç°ç±»éƒ½æ˜¯ SimpleJpaRepositoryã€‚ä¹Ÿå¯ä»¥æ ¹æ®æ­¤åŸç†æ¥<strong>é€‰æ‹©æ€§æš´éœ²æ–¹æ³•</strong>ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@NoRepositoryBean</span>
<span class="token keyword">interface</span> <span class="token class-name">MyBaseRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID <span class="token keyword">extends</span> <span class="token class-name">Serializable</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">T</span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token class-name">ID</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token class-name">T</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">MyBaseRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
     <span class="token class-name">User</span> <span class="token function">findByEmailAddress</span><span class="token punctuation">(</span><span class="token class-name">String</span> emailAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>è¿™æ ·åœ¨ Service å±‚å°±åªæœ‰ findOneã€saveã€findByEmailAddress è¿™ 3 ä¸ªæ–¹æ³•å¯ä»¥è°ƒç”¨ï¼Œä¸ä¼šæœ‰æ›´å¤šæ–¹æ³•äº†ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ SimpleJpaRepository é‡Œé¢ä»»æ„å·²ç»å®ç°çš„æ–¹æ³•åšé€‰æ‹©æ€§æš´éœ²ã€‚</p> <h3 id="æ–¹æ³•çš„æŸ¥è¯¢ç­–ç•¥è®¾ç½®-ã€â˜ ï¸ã€‘"><a href="#æ–¹æ³•çš„æŸ¥è¯¢ç­–ç•¥è®¾ç½®-ã€â˜ ï¸ã€‘" class="header-anchor">#</a> æ–¹æ³•çš„æŸ¥è¯¢ç­–ç•¥è®¾ç½® ã€â˜ ï¸ã€‘</h3> <p>ç›®å‰åœ¨å®é™…ç”Ÿäº§ä¸­è¿˜æ²¡æœ‰é‡åˆ°è¦ä¿®æ”¹é»˜è®¤ç­–ç•¥çš„æƒ…å†µã€‚è¿™ä¸¤ç§æ–¹å¼åˆ‡æ¢è§„åˆ™å³<strong>æ–¹æ³•çš„æŸ¥è¯¢ç­–ç•¥è®¾ç½®</strong>å¯ä»¥é€šè¿‡ @EnableJpaRepositories æ³¨è§£æ¥é…ç½®æ–¹æ³•çš„æŸ¥è¯¢ç­–ç•¥</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@EnableJpaRepositories</span><span class="token punctuation">(</span>queryLookupStrategy<span class="token operator">=</span> <span class="token class-name">QueryLookupStrategy<span class="token punctuation">.</span>Key</span><span class="token punctuation">.</span>CREATE_IF_NOT_FOUND<span class="token punctuation">)</span>
<span class="token comment">// æ”¾åœ¨é…ç½®ç±»ä¸Šå³å¯ï¼Œå¦‚@SpringBootApplication</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å…¶ä¸­ï¼ŒQueryLookupStrategy.Key çš„å€¼å…± 3 ä¸ªï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p> <ul><li><strong>Create</strong>ï¼šç›´æ¥æ ¹æ®æ–¹æ³•åè¿›è¡Œåˆ›å»ºï¼Œè§„åˆ™æ˜¯æ ¹æ®æ–¹æ³•åç§°çš„æ„é€ è¿›è¡Œå°è¯•ï¼Œä¸€èˆ¬çš„æ–¹æ³•æ˜¯ä»æ–¹æ³•åä¸­åˆ é™¤ç»™å®šçš„ä¸€ç»„å·²çŸ¥å‰ç¼€ï¼Œå¹¶è§£æè¯¥æ–¹æ³•çš„å…¶ä½™éƒ¨åˆ†ã€‚å¦‚æœæ–¹æ³•åä¸ç¬¦åˆè§„åˆ™ï¼Œå¯åŠ¨çš„æ—¶å€™ä¼šæŠ¥å¼‚å¸¸ï¼Œè¿™ç§æƒ…å†µå¯ä»¥ç†è§£ä¸ºï¼Œå³ä½¿é…ç½®äº† @Query ä¹Ÿæ˜¯æ²¡æœ‰ç”¨çš„ã€‚</li> <li><strong>USE_DECLARED_QUERY</strong>ï¼šå£°æ˜æ–¹å¼åˆ›å»ºï¼Œå¯åŠ¨çš„æ—¶å€™ä¼šå°è¯•æ‰¾åˆ°ä¸€ä¸ªå£°æ˜çš„æŸ¥è¯¢ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å°†æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œå¯ä»¥ç†è§£ä¸ºå¿…é¡»é…ç½® @Queryã€‚</li> <li><strong>CREATE_IF_NOT_FOUND</strong>ï¼šè¿™ä¸ªæ˜¯<strong>é»˜è®¤</strong>çš„ï¼Œé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œå¯ä»¥ç†è§£ä¸ºè¿™æ˜¯ä»¥ä¸Š 2 ç§æ–¹å¼çš„å…¼å®¹ç‰ˆã€‚å…ˆç”¨å£°æ˜æ–¹å¼ï¼ˆ@Queryï¼‰è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ä¸æ–¹æ³•ç›¸åŒ¹é…çš„æŸ¥è¯¢ï¼Œé‚£ç”¨ Create çš„æ–¹æ³•ååˆ›å»ºè§„åˆ™åˆ›å»ºä¸€ä¸ªæŸ¥è¯¢ï¼›è¿™ä¸¤è€…éƒ½ä¸æ»¡è¶³çš„æƒ…å†µä¸‹ï¼Œå¯åŠ¨å°±ä¼šæŠ¥é”™ã€‚</li></ul> <h3 id="dqm-è¯­æ³•ã€æŒæ¡ã€‘ğŸ”¥"><a href="#dqm-è¯­æ³•ã€æŒæ¡ã€‘ğŸ”¥" class="header-anchor">#</a> DQM è¯­æ³•ã€æŒæ¡ã€‘ğŸ”¥</h3> <p>è¯­æ³•ï¼šå¸¦æŸ¥è¯¢åŠŸèƒ½çš„æ–¹æ³•åç”±<strong>æŸ¥è¯¢ç­–ç•¥ï¼ˆå…³é”®å­—ï¼‰</strong>+ <strong>æŸ¥è¯¢å­—æ®µ</strong> + ä¸€äº›<strong>é™åˆ¶æ€§æ¡ä»¶</strong>ç»„æˆã€‚å¦‚ä¸‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">interface</span> <span class="token class-name">PersonRepository</span> <span class="token keyword">extends</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token comment">// and çš„æŸ¥è¯¢å…³ç³»</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByEmailAddressAndLastname</span><span class="token punctuation">(</span><span class="token class-name">EmailAddress</span> emailAddress<span class="token punctuation">,</span> <span class="token class-name">String</span> lastname<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// åŒ…å« distinct å»é‡ï¼Œor çš„ sql è¯­æ³•</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findDistinctPeopleByLastnameOrFirstname</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">,</span> <span class="token class-name">String</span> firstname<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ ¹æ® lastname å­—æ®µæŸ¥è¯¢å¿½ç•¥å¤§å°å†™</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByLastnameIgnoreCase</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ ¹æ® lastname å’Œ firstname æŸ¥è¯¢ equal å¹¶ä¸”å¿½ç•¥å¤§å°å†™</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByLastnameAndFirstnameAllIgnoreCase</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">,</span> <span class="token class-name">String</span> firstname<span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token comment">// å¯¹æŸ¥è¯¢ç»“æœæ ¹æ® lastname æ’åºï¼Œæ­£åº</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByLastnameOrderByFirstnameAsc</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// å¯¹æŸ¥è¯¢ç»“æœæ ¹æ® lastname æ’åºï¼Œå€’åº</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByLastnameOrderByFirstnameDesc</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>ä¸‹é¢è¡¨æ ¼æ˜¯ä¸€ä¸ªæˆ‘ä»¬åœ¨ä¸Šé¢ DQM æ–¹æ³•è¯­æ³•é‡Œå¸¸ç”¨çš„å…³é”®å­—åˆ—è¡¨</p> <table><thead><tr><th><strong>Keyword</strong></th> <th><strong>Sample</strong></th> <th><strong>JPQL</strong></th></tr></thead> <tbody><tr><td>And</td> <td>findByLastnameAndFirstname</td> <td>â€¦ where x.lastname = ?1 and x.firstname = ?2</td></tr> <tr><td>Or</td> <td>findByLastnameOrFirstname</td> <td>â€¦ where x.lastname = ?1 or x.firstname = ?2</td></tr> <tr><td>Is,Equals</td> <td>findByFirstnameIs, findByFirstnameEquals</td> <td>â€¦ where x.firstname = ?1</td></tr> <tr><td>Between</td> <td>findByStartDateBetween</td> <td>â€¦ where x.startDate between ?1 and ?2</td></tr> <tr><td>LessThan</td> <td>findByAgeLessThan</td> <td>â€¦ where x.age &lt; ?1</td></tr> <tr><td>LessThanEqual</td> <td>findByAgeLessThanEqual</td> <td>â€¦ where x.age â‡ ?1</td></tr> <tr><td>GreaterThan</td> <td>findByAgeGreaterThan</td> <td>â€¦ where x.age &gt; ?1</td></tr> <tr><td>GreaterThanEqual</td> <td>findByAgeGreaterThanEqual</td> <td>â€¦ where x.age &gt;= ?1</td></tr> <tr><td>After</td> <td>findByStartDateAfter</td> <td>â€¦ where x.startDate &gt; ?1</td></tr> <tr><td>Before</td> <td>findByStartDateBefore</td> <td>â€¦ where x.startDate &lt; ?1</td></tr> <tr><td>IsNull</td> <td>findByAgeIsNull</td> <td>â€¦ where x.age is null</td></tr> <tr><td>IsNotNull,NotNull</td> <td>findByAge(Is)NotNull</td> <td>â€¦ where x.age not null</td></tr> <tr><td>Like</td> <td>findByFirstnameLike</td> <td>â€¦ where x.firstname like ?1</td></tr> <tr><td>NotLike</td> <td>findByFirstnameNotLike</td> <td>â€¦ where x.firstname not like ?1</td></tr> <tr><td>StartingWith</td> <td>findByFirstnameStartingWith</td> <td>â€¦ where x.firstname like ?1 (parameter bound with appended %)</td></tr> <tr><td>EndingWith</td> <td>findByFirstnameEndingWith</td> <td>â€¦ where x.firstname like ?1 (parameter bound with prepended %)</td></tr> <tr><td>Containing</td> <td>findByFirstnameContaining</td> <td>â€¦ where x.firstname like ?1 (parameter bound wrapped in %)</td></tr> <tr><td>OrderBy</td> <td>findByAgeOrderByLastnameDesc</td> <td>â€¦ where x.age = ?1 order by x.lastname desc</td></tr> <tr><td>Not</td> <td>findByLastnameNot</td> <td>â€¦ where x.lastname &lt;&gt; ?1</td></tr> <tr><td>In</td> <td>findByAgeIn(Collection ages)</td> <td>â€¦ where x.age in ?1</td></tr> <tr><td>NotIn</td> <td>findByAgeNotIn(Collection age)</td> <td>â€¦ where x.age not in ?1</td></tr> <tr><td>TRUE</td> <td>findByActiveTrue()</td> <td>â€¦ where x.active = true</td></tr> <tr><td>FALSE</td> <td>findByActiveFalse()</td> <td>â€¦ where x.active = false</td></tr> <tr><td>IgnoreCase</td> <td>findByFirstnameIgnoreCase</td> <td>â€¦ where UPPER(x.firstame) = UPPER(?1)</td></tr></tbody></table> <p>ç»¼ä¸Šï¼Œæ€»ç»“ 3 ç‚¹ç»éªŒï¼š</p> <ul><li>æ–¹æ³•åçš„è¡¨è¾¾å¼é€šå¸¸æ˜¯å®ä½“å±æ€§è¿æ¥è¿ç®—ç¬¦çš„ç»„åˆï¼Œå¦‚ Andã€orã€Betweenã€LessThanã€GreaterThanã€Like ç­‰å±æ€§è¿æ¥è¿ç®—è¡¨è¾¾å¼ï¼Œä¸åŒçš„æ•°æ®åº“ï¼ˆNoSQLã€MySQLï¼‰å¯èƒ½äº§ç”Ÿçš„æ•ˆæœä¸ä¸€æ ·ï¼Œå¦‚æœé‡åˆ°é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€ SQL æ—¥å¿—è§‚å¯Ÿã€‚</li> <li><strong>IgnoreCase å¯ä»¥é’ˆå¯¹å•ä¸ªå±æ€§</strong>ï¼ˆå¦‚ findByLastnameIgnoreCase(â€¦)ï¼‰ï¼Œ<strong>ä¹Ÿå¯ä»¥é’ˆå¯¹æŸ¥è¯¢æ¡ä»¶é‡Œé¢æ‰€æœ‰çš„å®ä½“</strong>å±æ€§å¿½ç•¥å¤§å°å†™ï¼ˆæ‰€æœ‰å±æ€§å¿…é¡»åœ¨ String æƒ…å†µä¸‹ï¼Œå¦‚ findByLastnameAndFirstnameAllIgnoreCase(â€¦)ï¼‰ã€‚</li> <li>OrderBy å¯ä»¥åœ¨æŸäº›å±æ€§çš„æ’åºä¸Šæä¾›æ–¹å‘ï¼ˆAsc æˆ– Descï¼‰ï¼Œç§°ä¸º<strong>é™æ€æ’åº</strong>ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸ªæ–¹ä¾¿çš„<strong>å‚æ•° Sort å®ç°æŒ‡å®šå­—æ®µçš„åŠ¨æ€æ’åº</strong>çš„æŸ¥è¯¢æ–¹æ³•ï¼ˆå¦‚ repository.findAll(Sort.by(Sort.Direction.ASC, &quot;myField&quot;))ï¼‰ã€‚</li></ul> <p>ä¸Šé¢çš„è¡¨æ ¼è™½ç„¶å¤§å¤šæ˜¯ find å¼€å¤´çš„æ–¹æ³•ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒJPA è¿˜æ”¯æŒreadã€getã€queryã€<strong>stream</strong>ã€<strong>count</strong>ã€<strong>exists</strong>ã€<strong>delete</strong>ã€<strong>remove</strong>ç­‰å‰ç¼€ï¼Œå¦‚å­—é¢æ„æ€ä¸€æ ·ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ countã€deleteã€remove çš„ä¾‹å­ï¼Œå…¶ä»–å‰ç¼€å¯ä»¥ä¸¾ä¸€åä¸‰</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">CrudRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">long</span> <span class="token function">countByLastname</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æŸ¥è¯¢æ€»æ•°</span>

    <span class="token keyword">long</span> <span class="token function">deleteByLastname</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ ¹æ®ä¸€ä¸ªå­—æ®µè¿›è¡Œåˆ é™¤æ“ä½œï¼Œå¹¶è¿”å›åˆ é™¤è¡Œæ•°</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">removeByLastname</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ ¹æ®Lastnameåˆ é™¤ä¸€å †User,å¹¶è¿”å›åˆ é™¤çš„User</span>

<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>æœ‰çš„æ—¶å€™éšç€ç‰ˆæœ¬çš„æ›´æ–°ï¼Œä¹Ÿä¼šæœ‰æ›´å¤šçš„è¯­æ³•æ”¯æŒï¼Œæˆ–è€…ä¸åŒçš„ç‰ˆæœ¬è¯­æ³•å¯èƒ½ä¹Ÿä¸ä¸€æ ·ï¼Œæˆ‘ä»¬é€šè¿‡æºç æ¥çœ‹ä¸€ä¸‹ä¸Šé¢è¯´çš„å‡ ç§è¯­æ³•</p> <p>org.springframework.data.repository.query.parser.PartTree æŸ¥çœ‹ç›¸å…³æºç çš„é€»è¾‘å’Œå¤„ç†æ–¹æ³•ã€‚å…³é”®æºç å¦‚ä¸‹ï¼š</p> <p><img src="/assets/img/image-20201221231903631.4290176e.png" alt="image-20201221231903631"></p> <p><img src="/assets/img/image-20201221231925371.06d840e5.png" alt="image-20201221231925371"></p> <p>æ ¹æ®æºç æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ†æå‡ºæ¥ï¼Œquery method åŒ…å«å…¶ä»–çš„è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ findã€countã€deleteã€exist ç­‰å…³é”®å­—åœ¨ by ä¹‹å‰é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</p> <p><img src="/assets/img/image-20201221231937909.60d10770.png" alt="image-20201221231937909"></p> <p><img src="/assets/img/image-20201221231947226.99e73a85.png" alt="image-20201221231947226"></p> <p>ç”±æ­¤å¯çŸ¥ï¼Œæˆ‘ä»¬æ–¹æ³•ä¸­çš„å…³é”®å­—ä¸æ˜¯ä¹±å¡«çš„ï¼Œæ˜¯æšä¸¾å¸®æˆ‘ä»¬å®šä¹‰å¥½çš„ã€‚æšä¸¾ç±» Type æºç æ ¼å¼åŒ–åå¦‚ä¸‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">enum</span> <span class="token class-name">Type</span> <span class="token punctuation">{</span>

    <span class="token function">BETWEEN</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsBetween&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Between&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">IS_NOT_NULL</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsNotNull&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NotNull&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">IS_NULL</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsNull&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Null&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">LESS_THAN</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsLessThan&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;LessThan&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">LESS_THAN_EQUAL</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsLessThanEqual&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;LessThanEqual&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">GREATER_THAN</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsGreaterThan&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GreaterThan&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">GREATER_THAN_EQUAL</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsGreaterThanEqual&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GreaterThanEqual&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">BEFORE</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsBefore&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Before&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">AFTER</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsAfter&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;After&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">NOT_LIKE</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsNotLike&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NotLike&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">LIKE</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsLike&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Like&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">STARTING_WITH</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsStartingWith&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;StartingWith&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;StartsWith&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">ENDING_WITH</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsEndingWith&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;EndingWith&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;EndsWith&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">IS_NOT_EMPTY</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsNotEmpty&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NotEmpty&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">IS_EMPTY</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsEmpty&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Empty&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">NOT_CONTAINING</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsNotContaining&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NotContaining&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NotContains&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">CONTAINING</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsContaining&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Containing&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Contains&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">NOT_IN</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsNotIn&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NotIn&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">IN</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsIn&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;In&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">NEAR</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsNear&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Near&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">WITHIN</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsWithin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Within&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">REGEX</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;MatchesRegex&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Matches&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Regex&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">EXISTS</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;Exists&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">TRUE</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsTrue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;True&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">FALSE</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsFalse&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;False&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">NEGATING_SIMPLE_PROPERTY</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;IsNot&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Not&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">SIMPLE_PROPERTY</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;Is&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Equals&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//....</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p>çœ‹æºç å°±å¯ä»¥çŸ¥é“æ¡†æ¶æ”¯æŒäº†å“ªäº›é€»è¾‘å…³é”®å­—ï¼Œæ¯”å¦‚ NotInã€Likeã€Inã€Exists ç­‰ï¼Œæœ‰çš„æ—¶å€™æ¯”æŸ¥æ–‡æ¡£å’Œåšå®¢éƒ½å‡†ç¡®ã€è¿˜å¿«</p> <h3 id="ç‰¹å®šç±»å‹çš„å‚æ•°ï¼šsort-pageableã€æŒæ¡ã€‘ğŸ”¥"><a href="#ç‰¹å®šç±»å‹çš„å‚æ•°ï¼šsort-pageableã€æŒæ¡ã€‘ğŸ”¥" class="header-anchor">#</a> ç‰¹å®šç±»å‹çš„å‚æ•°ï¼šSort Pageableã€æŒæ¡ã€‘ğŸ”¥</h3> <p>Sort æºç ï¼ˆSpring Boot 2.4.1 ç‰ˆæœ¬æ¨èç”¨å¦‚ä¸‹æ–¹å¼ï¼Œæ„é€ æ–¹æ³•éƒ½å·²ç»ç§æœ‰äº†ï¼‰</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
	 * Creates a new {@link Sort} for the given {@link Order}s.
	 *
	 * @param orders must not be {@literal null}.
	 * @return
	 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Sort</span> <span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Order</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> orders<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>orders<span class="token punctuation">,</span> <span class="token string">&quot;Orders must not be null!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Sort</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>orders<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Pageable åœ¨æŸ¥è¯¢çš„æ—¶å€™å¯ä»¥å®ç°<strong>åˆ†é¡µ</strong>æ•ˆæœå’Œ<strong>åŠ¨æ€æ’åº</strong>åŒé‡æ•ˆæœ</p> <p>ä¸‹é¢ä»£ç å®šä¹‰äº†æ ¹æ® Lastname æŸ¥è¯¢ User çš„åˆ†é¡µå’Œæ’åºçš„å®ä¾‹ï¼Œæ­¤æ®µä»£ç æ˜¯åœ¨ UserRepository æ¥å£é‡Œé¢å®šä¹‰çš„æ–¹æ³•</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">//æ ¹æ®åˆ†é¡µå‚æ•°æŸ¥è¯¢Userï¼Œè¿”å›ä¸€ä¸ªå¸¦åˆ†é¡µç»“æœçš„Page(ä¸‹ä¸€è¯¾æ—¶è¯¦è§£)å¯¹è±¡ï¼ˆæ–¹æ³•ä¸€ï¼‰</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByLastname</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//æˆ‘ä»¬æ ¹æ®åˆ†é¡µå‚æ•°è¿”å›ä¸€ä¸ªSliceçš„userç»“æœï¼ˆæ–¹æ³•äºŒï¼‰</span>
    <span class="token class-name">Slice</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByLastname</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//æ ¹æ®æ’åºç»“æœè¿”å›ä¸€ä¸ªListï¼ˆæ–¹æ³•ä¸‰ï¼‰</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByLastname</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">,</span> <span class="token class-name">Sort</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//æ ¹æ®åˆ†é¡µå‚æ•°è¿”å›ä¸€ä¸ªListå¯¹è±¡ï¼ˆæ–¹æ³•å››ï¼‰</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByLastname</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>ã€æŒæ¡ã€‘<strong>æ–¹æ³•ä¸€</strong>ï¼šå…è®¸å°† org.springframework.data.domain.Pageable å®ä¾‹ä¼ é€’ç»™æŸ¥è¯¢æ–¹æ³•ï¼Œå°†åˆ†é¡µå‚æ•°æ·»åŠ åˆ°é™æ€å®šä¹‰çš„æŸ¥è¯¢ä¸­ï¼Œé€šè¿‡ Page è¿”å›çš„ç»“æœå¾—çŸ¥å¯ç”¨çš„å…ƒç´ å’Œé¡µé¢çš„æ€»æ•°ã€‚è¿™ç§åˆ†é¡µæŸ¥è¯¢æ–¹æ³•å¯èƒ½æ˜¯<strong>æ˜‚è´µ</strong>çš„ï¼ˆä¼šé»˜è®¤æ‰§è¡Œä¸€æ¡ <strong>count</strong> çš„ SQL è¯­å¥ï¼‰ï¼Œæ‰€ä»¥ç”¨çš„æ—¶å€™è¦è€ƒè™‘ä¸€ä¸‹ä½¿ç”¨åœºæ™¯ï¼ˆ<strong>æ•°æ®é‡å°çš„é¡¹ç›®å¯ä»¥å°è¯•</strong>ï¼‰ã€‚</p> <p>ã€<strong>æŒæ¡</strong>ã€‘<strong>æ–¹æ³•äºŒ</strong>ï¼šè¿”å›ç»“æœæ˜¯ Sliceï¼Œå› ä¸ºåªçŸ¥é“æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ª Slice å¯ç”¨ï¼Œè€Œä¸çŸ¥é“ countï¼Œæ‰€ä»¥å½“æŸ¥è¯¢è¾ƒå¤§çš„ç»“æœé›†æ—¶ï¼ŒåªçŸ¥é“æ•°æ®æ˜¯è¶³å¤Ÿçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç”¨åœ¨ä¸šåŠ¡åœºæ™¯ä¸­æ—¶<strong>ä¸ç”¨å…³å¿ƒä¸€å…±æœ‰å¤šå°‘é¡µ</strong>ã€‚</p> <p>ã€æŒæ¡ã€‘<strong>æ–¹æ³•ä¸‰</strong>ï¼šå¦‚æœ<strong>åªéœ€è¦æ’åº</strong>ï¼Œéœ€åœ¨ org.springframework.data.domain.Sort å‚æ•°ä¸­æ·»åŠ ä¸€ä¸ªå‚æ•°ï¼Œæ­£å¦‚ä¸Šé¢çœ‹åˆ°çš„ï¼Œåªéœ€è¿”å›ä¸€ä¸ª List ä¹Ÿæ˜¯æœ‰å¯èƒ½çš„ã€‚</p> <p>ã€æŒæ¡ã€‘<strong>æ–¹æ³•å››</strong>ï¼š<strong>æ’åºé€‰é¡¹ä¹Ÿé€šè¿‡ Pageable å®ä¾‹å¤„ç†</strong>ï¼Œ<strong>è¿”å› List</strong> ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒPage å°†ä¸ä¼šåˆ›å»ºæ„å»ºå®é™…å®ä¾‹æ‰€éœ€çš„é™„åŠ å…ƒæ•°æ®ï¼ˆå³ä¸éœ€è¦è®¡ç®—å’ŒæŸ¥è¯¢åˆ†é¡µç›¸å…³æ•°æ®ï¼‰ï¼Œè€Œä»…ä»…ç”¨æ¥åšé™åˆ¶æŸ¥è¯¢ç»™å®šèŒƒå›´çš„å®ä½“ã€‚</p> <p>é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹æºç ï¼Œä¹Ÿå°±æ˜¯ Pageable çš„å®ç°ç±»</p> <p><img src="/assets/img/image-20201221232003048.577368b4.png" alt="image-20201221232003048"></p> <p>ç”±æ­¤å¯çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ PageRequest é‡Œé¢æä¾›çš„å‡ ä¸ª of é™æ€æ–¹æ³•ï¼ˆå¤šæ€ï¼‰ï¼Œåˆ†åˆ«æ„å»ºé¡µç ã€é¡µé¢å¤§å°ã€æ’åºç­‰ã€‚ç¤ºä¾‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token comment">//æŸ¥è¯¢useré‡Œé¢çš„lastname=jkçš„ç¬¬ä¸€é¡µï¼Œæ¯é¡µå¤§å°æ˜¯20æ¡ï¼›å¹¶ä¼šè¿”å›ä¸€å…±æœ‰å¤šå°‘é¡µçš„ä¿¡æ¯</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findByLastname</span><span class="token punctuation">(</span><span class="token string">&quot;jk&quot;</span><span class="token punctuation">,</span><span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//æŸ¥è¯¢useré‡Œé¢çš„lastname=jkçš„ç¬¬ä¸€é¡µçš„20æ¡æ•°æ®ï¼Œä¸çŸ¥é“ä¸€å…±å¤šå°‘æ¡</span>
    <span class="token class-name">Slice</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findByLastname</span><span class="token punctuation">(</span><span class="token string">&quot;jk&quot;</span><span class="token punctuation">,</span><span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//æŸ¥è¯¢å‡ºæ¥æ‰€æœ‰çš„useré‡Œé¢çš„lastname=jkçš„Useræ•°æ®ï¼Œå¹¶æŒ‰ç…§nameæ­£åºè¿”å›List</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findByLastname</span><span class="token punctuation">(</span><span class="token string">&quot;jk&quot;</span><span class="token punctuation">,</span><span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Order</span><span class="token punctuation">.</span><span class="token function">asc</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment">//æŒ‰ç…§createdAtå€’åºï¼ŒæŸ¥è¯¢å‰ä¸€ç™¾æ¡Useræ•°æ®</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userRepository
        <span class="token punctuation">.</span><span class="token function">findByLastname</span><span class="token punctuation">(</span><span class="token string">&quot;jk&quot;</span><span class="token punctuation">,</span><span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span>DESC<span class="token punctuation">,</span> <span class="token string">&quot;createdAt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="é™åˆ¶æŸ¥è¯¢ç»“æœ-first-å’Œ-topã€æŒæ¡ã€‘ğŸ”¥"><a href="#é™åˆ¶æŸ¥è¯¢ç»“æœ-first-å’Œ-topã€æŒæ¡ã€‘ğŸ”¥" class="header-anchor">#</a> é™åˆ¶æŸ¥è¯¢ç»“æœ First å’Œ Topã€æŒæ¡ã€‘ğŸ”¥</h3> <p>æœ‰çš„æ—¶å€™æˆ‘ä»¬æƒ³ç›´æ¥æŸ¥è¯¢å‰å‡ æ¡æ•°æ®ï¼Œä¹Ÿä¸éœ€è¦åŠ¨æ€æ’åºï¼Œé‚£ä¹ˆå°±å¯ä»¥ç®€å•åœ°åœ¨æ–¹æ³•åå­—ä¸­ä½¿ç”¨ First å’Œ Top å…³é”®å­—ï¼Œæ¥é™åˆ¶è¿”å›æ¡æ•°</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token class-name">User</span> <span class="token function">findFirstByOrderByLastnameAsc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">User</span> <span class="token function">findTopByOrderByAgeDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findDistinctUserTop3ByLastname</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findFirst10ByLastname</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">,</span> <span class="token class-name">Sort</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findTop10ByLastname</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>å…¶ä¸­ï¼š</p> <ul><li>æŸ¥è¯¢æ–¹æ³•åœ¨ä½¿ç”¨ First æˆ– Top æ—¶ï¼Œæ•°å€¼å¯ä»¥è¿½åŠ åˆ° First æˆ– Top åé¢ï¼ŒæŒ‡å®šè¿”å›æœ€å¤§ç»“æœçš„å¤§å°ï¼›</li> <li>å¦‚æœæ•°å­—è¢«çœç•¥ï¼Œåˆ™å‡è®¾ç»“æœå¤§å°ä¸º 1ï¼›</li> <li>é™åˆ¶è¡¨è¾¾å¼ä¹Ÿæ”¯æŒ Distinct å…³é”®å­—ï¼›</li> <li>æ”¯æŒå°†ç»“æœåŒ…è£…åˆ° Optional ä¸­ï¼ˆä¸‹ä¸€è¯¾æ—¶è¯¦è§£ï¼‰ã€‚</li> <li>å¦‚æœå°† Pageable ä½œä¸ºå‚æ•°ï¼Œä»¥ Top å’Œ First åé¢çš„æ•°å­—ä¸ºå‡†ï¼Œå³åˆ†é¡µå°†åœ¨é™åˆ¶ç»“æœä¸­åº”ç”¨ã€‚</li></ul> <h3 id="nonnullã€-nonnullapiã€-nullableã€äº†è§£ã€‘"><a href="#nonnullã€-nonnullapiã€-nullableã€äº†è§£ã€‘" class="header-anchor">#</a> @NonNullã€@NonNullApiã€@Nullableã€äº†è§£ã€‘</h3> <p>ä» Spring Data 2.0 å¼€å§‹ï¼ŒJPA æ–°å¢äº†<a href="https://docs.spring.io/spring/docs/5.2.8.RELEASE/javadoc-api/org/springframework/lang/NonNull.html" target="_blank" rel="noopener noreferrer">@NonNull<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://docs.spring.io/spring/docs/5.2.8.RELEASE/javadoc-api/org/springframework/lang/NonNullApi.html" target="_blank" rel="noopener noreferrer">@NonNullApi<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://docs.spring.io/spring/docs/5.2.8.RELEASE/javadoc-api/org/springframework/lang/Nullable.html" target="_blank" rel="noopener noreferrer">@Nullable<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œæ˜¯å¯¹ null çš„å‚æ•°å’Œè¿”å›ç»“æœåšçš„æ”¯æŒã€‚</p> <ul><li><strong>@NonNullApi</strong>ï¼šåœ¨åŒ…çº§åˆ«ç”¨äºå£°æ˜å‚æ•°ï¼Œä»¥åŠè¿”å›å€¼çš„é»˜è®¤è¡Œä¸ºæ˜¯ä¸æ¥å—æˆ–äº§ç”Ÿç©ºå€¼çš„ã€‚</li> <li><strong>@NonNull</strong>ï¼šç”¨äºä¸èƒ½ä¸ºç©ºçš„å‚æ•°æˆ–è¿”å›å€¼ï¼ˆåœ¨ @NonNullApi é€‚ç”¨çš„å‚æ•°å’Œè¿”å›å€¼ä¸Šä¸éœ€è¦ï¼‰ã€‚</li> <li><strong>@Nullable</strong>ï¼šç”¨äºå¯ä»¥ä¸ºç©ºçš„å‚æ•°æˆ–è¿”å›å€¼ã€‚</li></ul> <p>æˆ‘åœ¨è‡ªå·±çš„ Repository æ‰€åœ¨ package çš„ package-info.java ç±»é‡Œé¢åšå¦‚ä¸‹å£°æ˜ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@org.springframework.lang.NonNullApi</span>

<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>myrespository</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>myrespository ä¸‹é¢çš„ UserRepository å®ç°å¦‚ä¸‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>myrespository</span><span class="token punctuation">;</span>                                               

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">Nullable</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

  <span class="token class-name">User</span> <span class="token function">getByEmailAddress</span><span class="token punctuation">(</span><span class="token class-name">EmailAddress</span> emailAddress<span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>è¿™ä¸ªæ—¶å€™å½“ emailAddress å‚æ•°ä¸º null çš„æ—¶å€™å°±ä¼šæŠ›å¼‚å¸¸ï¼Œå½“è¿”å›ç»“æœä¸º null çš„æ—¶å€™ä¹Ÿä¼šæŠ›å¼‚å¸¸ã€‚å› ä¸ºæˆ‘ä»¬åœ¨package çš„ package-info.javaé‡Œé¢æŒ‡å®šäº†NonNullApiï¼Œæ‰€æœ‰è¿”å›ç»“æœå’Œå‚æ•°ä¸èƒ½ä¸º Nullã€‚</p> <p>ä¸‹é¢æ”¹ä¸ºç‰¹ä¾‹æƒ…å†µï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Nullable</span>
<span class="token class-name">User</span> <span class="token function">findByEmailAddress</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">EmailAddress</span> emailAdress<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å½“æˆ‘ä»¬æ·»åŠ @Nullable æ³¨è§£ä¹‹åï¼Œå‚æ•°å’Œè¿”å›ç»“æœè¿™ä¸ªæ—¶å€™å°±éƒ½ä¼šå…è®¸ä¸º null äº†ï¼›          </span>

<span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findOptionalByEmailAddress</span><span class="token punctuation">(</span><span class="token class-name">EmailAddress</span> emailAddress<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è¿”å›ç»“æœå…è®¸ä¸º null,å‚æ•°ä¸å…è®¸ä¸º null çš„æƒ…å†µ</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="æ€è€ƒï¼šservice-å±‚å°è£…ã€äº†è§£ã€‘"><a href="#æ€è€ƒï¼šservice-å±‚å°è£…ã€äº†è§£ã€‘" class="header-anchor">#</a> æ€è€ƒï¼šService å±‚å°è£…ã€äº†è§£ã€‘</h3> <p>Spring Data Common é‡Œé¢çš„ repository åŸºç±»ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥åº”ç”¨æ¨å¹¿åˆ° service å±‚ï¼Ÿç±»ä¼¼ Mybatis Plusã€‚çœ‹ä¸‹é¢çš„å®æˆ˜ä¾‹å­ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BaseService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getDomainClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">S</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">S</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">saveAll</span><span class="token punctuation">(</span><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> entities<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token class-name">ID</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">deleteAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">deleteAll</span><span class="token punctuation">(</span><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> entities<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">deleteInBatch</span><span class="token punctuation">(</span><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> entities<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">deleteAllInBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">T</span> <span class="token function">getOne</span><span class="token punctuation">(</span><span class="token class-name">ID</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> example<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">ID</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Sort</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> example<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> example<span class="token punctuation">,</span> <span class="token class-name">Sort</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> example<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllById</span><span class="token punctuation">(</span><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span>ID<span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">long</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">long</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> example<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">boolean</span> <span class="token function">exists</span><span class="token punctuation">(</span><span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> example<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">existsById</span><span class="token punctuation">(</span><span class="token class-name">ID</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">S</span> <span class="token function">saveAndFlush</span><span class="token punctuation">(</span><span class="token class-name">S</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p>æ¨¡ä»¿JpaRepositoryæ¥å£ä¹Ÿè‡ªå®šä¹‰äº†ä¸€ä¸ªè‡ªå·±çš„BaseServiceï¼Œå£°æ˜äº†å¸¸ç”¨çš„CRUDæ“ä½œï¼Œä¸Šé¢çš„ä»£ç æ˜¯<strong>ç”Ÿäº§ä»£ç </strong>ï¼Œå¯ä»¥ä½œä¸ºå‚è€ƒã€‚å½“ç„¶äº†æˆ‘ä»¬ä¹Ÿå¯ä»¥å»ºç«‹è‡ªå·±çš„ PagingAndSortingServiceã€ComplexityServiceã€SampleService ç­‰æ¥åˆ’åˆ†ä¸åŒçš„ serviceæ¥å£ï¼Œä¾›ä¸åŒç›®çš„ Service å­ç±»ç»§æ‰¿</p> <p>å†æ¥æ¨¡ä»¿ä¸€ä¸ª SimpleJpaRepositoryï¼Œæ¥å®ç°è‡ªå·±çš„ BaseService çš„å®ç°ç±»ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaseServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID<span class="token punctuation">,</span> <span class="token class-name">R</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">BaseService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">&gt;</span></span> DOMAIN_CLASS_CACHE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">R</span> repository<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">BaseServiceImpl</span><span class="token punctuation">(</span><span class="token class-name">R</span> repository<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>repository <span class="token operator">=</span> repository<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getDomainClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span> thisClass <span class="token operator">=</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> domainClass <span class="token operator">=</span> DOMAIN_CLASS_CACHE<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>thisClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>domainClass<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            domainClass <span class="token operator">=</span> <span class="token class-name">GenericsUtils</span><span class="token punctuation">.</span><span class="token function">getGenericClass</span><span class="token punctuation">(</span>thisClass<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            DOMAIN_CLASS_CACHE<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>thisClass<span class="token punctuation">,</span> domainClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> domainClass<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">protected</span> <span class="token class-name">R</span> <span class="token function">getRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">S</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">S</span> entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">saveAll</span><span class="token punctuation">(</span><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> entities<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">.</span><span class="token function">saveAll</span><span class="token punctuation">(</span>entities<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        repository<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token class-name">ID</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        repository<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        repository<span class="token punctuation">.</span><span class="token function">deleteAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteAll</span><span class="token punctuation">(</span><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> entities<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        repository<span class="token punctuation">.</span><span class="token function">deleteAll</span><span class="token punctuation">(</span>entities<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteInBatch</span><span class="token punctuation">(</span><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> entities<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        repository<span class="token punctuation">.</span><span class="token function">deleteInBatch</span><span class="token punctuation">(</span>entities<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteAllInBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        repository<span class="token punctuation">.</span><span class="token function">deleteAllInBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">getOne</span><span class="token punctuation">(</span><span class="token class-name">ID</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> example<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">ID</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Sort</span> sort<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> example<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> example<span class="token punctuation">,</span> <span class="token class-name">Sort</span> sort<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>example<span class="token punctuation">,</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> example<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>example<span class="token punctuation">,</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllById</span><span class="token punctuation">(</span><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span>ID<span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">.</span><span class="token function">findAllById</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">long</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> example<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">boolean</span> <span class="token function">exists</span><span class="token punctuation">(</span><span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> example<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">existsById</span><span class="token punctuation">(</span><span class="token class-name">ID</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">.</span><span class="token function">existsById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        repository<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">S</span> <span class="token function">saveAndFlush</span><span class="token punctuation">(</span><span class="token class-name">S</span> entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">.</span><span class="token function">saveAndFlush</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br></div></div><p>ä»¥ä¸Šä»£ç å°±æ˜¯ BaseService å¸¸ç”¨çš„ CURL å®ç°ä»£ç ï¼Œæˆ‘ä»¬è¿™é‡Œé¢å¤§éƒ¨åˆ†ä¹Ÿæ˜¯ç›´æ¥è°ƒç”¨ Repository æä¾›çš„æ–¹æ³•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ç»§æ‰¿ BaseServiceImpl çš„æ—¶å€™éœ€è¦ä¼ é€’è‡ªå·±çš„ Repositoryï¼Œå¦‚ä¸‹é¢å®ä¾‹ä»£ç ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">BaseServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">UserRepository</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token class-name">UserRepository</span> repository<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>repository<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// .....</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="åˆ©ç”¨-repository-ä¸­çš„æ–¹æ³•è¿”å›å€¼-ğŸ”¥"><a href="#åˆ©ç”¨-repository-ä¸­çš„æ–¹æ³•è¿”å›å€¼-ğŸ”¥" class="header-anchor">#</a> åˆ©ç”¨ Repository ä¸­çš„æ–¹æ³•è¿”å›å€¼ ğŸ”¥</h2> <h3 id="è¿”å›ç±»å‹æ€»è§ˆã€äº†è§£ã€‘"><a href="#è¿”å›ç±»å‹æ€»è§ˆã€äº†è§£ã€‘" class="header-anchor">#</a> è¿”å›ç±»å‹æ€»è§ˆã€äº†è§£ã€‘</h3> <p>è¿™ä¸€è¯¾æ—¶æˆ‘ä»¬æ¥çœ‹ä¸‹Repository æ”¯æŒçš„è¿”å›ç»“æœæœ‰å“ªäº›ï¼Œä»¥åŠ DTO ç±»å‹çš„è¿”å›ç»“æœå¦‚ä½•è‡ªå®šä¹‰ï¼Œåœ¨å®é™…å·¥ä½œåœºæ™¯ä¸­æˆ‘ä»¬å¦‚ä½•åšã€‚</p> <p>ä¹‹å‰å·²ç»ä»‹ç»è¿‡äº† Repository çš„æ¥å£ï¼Œé‚£ä¹ˆç°åœ¨æ¥çœ‹ä¸€ä¸‹è¿™äº›æ¥å£æ”¯æŒçš„è¿”å›ç»“æœæœ‰å“ªäº›ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p> <p><img src="/assets/img/image-20201221232021715.33017f84.png" alt="image-20201221232021715"></p> <p>æ‰“å¼€ SimpleJpaRepository ç›´æ¥çœ‹å®ƒçš„ Structure å°±å¯ä»¥çŸ¥é“ï¼Œå®ƒå®ç°çš„æ–¹æ³•ï¼Œä»¥åŠçˆ¶ç±»æ¥å£çš„æ–¹æ³•å’Œè¿”å›ç±»å‹åŒ…æ‹¬ï¼šOptionalã€Iterableã€Listã€Pageã€Longã€Booleanã€Entity å¯¹è±¡ç­‰ï¼Œè€Œå®é™…ä¸Šæ”¯æŒçš„è¿”å›ç±»å‹è¿˜è¦å¤šä¸€äº›ã€‚</p> <h3 id="streamableã€äº†è§£ã€‘"><a href="#streamableã€äº†è§£ã€‘" class="header-anchor">#</a> Streamableã€äº†è§£ã€‘</h3> <p>ç”±äº Repository é‡Œé¢æ”¯æŒ Iterableï¼Œæ‰€ä»¥å…¶å® java æ ‡å‡†çš„ Listã€Set éƒ½å¯ä»¥ä½œä¸ºè¿”å›ç»“æœï¼Œå¹¶ä¸”ä¹Ÿä¼šæ”¯æŒå…¶å­ç±»ï¼ŒSpring Data é‡Œé¢å®šä¹‰äº†ä¸€ä¸ªç‰¹æ®Šçš„å­ç±» Streamableï¼ŒStreamable å¯ä»¥æ›¿ä»£ Iterable æˆ–ä»»ä½•é›†åˆç±»å‹ã€‚å®ƒè¿˜æä¾›äº†æ–¹ä¾¿çš„æ–¹æ³•æ¥è®¿é—® Streamï¼Œå¯ä»¥ç›´æ¥åœ¨å…ƒç´ ä¸Šè¿›è¡Œ â€¦.filter(â€¦) å’Œ â€¦.map(â€¦) æ“ä½œï¼Œå¹¶å°† Streamable è¿æ¥åˆ°å…¶ä»–å…ƒç´ ã€‚æˆ‘ä»¬çœ‹ä¸ªå…³äº UserRepository ç›´æ¥ç»§æ‰¿ JpaRepository çš„ä¾‹å­ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DataJpaTest</span>
<span class="token comment">// DataJpaTestã€MybatisTest ä¼šé»˜è®¤ä½¿ç”¨å…¶æµ‹è¯•æ•°æ®æºæ›¿ä»£ï¼Œè‹¥è¦ä½¿ç”¨è‡ªå·±é…ç½®çš„ï¼Œéœ€è¦æ·»åŠ å¦‚ä¸‹æ³¨è§£</span>
<span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace <span class="token operator">=</span> <span class="token class-name">AutoConfigureTestDatabase<span class="token punctuation">.</span>Replace</span><span class="token punctuation">.</span>NONE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RepositoryTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jackxx&quot;</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">sex</span><span class="token punctuation">(</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token string">&quot;shanghai&quot;</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Streamable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userStreamable <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token class-name">User</span>
                 <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jack222&quot;</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        userStreamable<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>ç„¶åæˆ‘ä»¬å°±ä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>User(id=1, name=jackxx, email=123456@126.com, sex=man, address=shanghai)
User(id=null, name=jack222, email=null, sex=null, address=null)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¿™ä¸ªä¾‹å­ Streamable<code>&lt;User&gt;</code> userStreamableï¼Œå®ç°äº† Streamable çš„è¿”å›ç»“æœï¼Œå¦‚æœæƒ³è‡ªå®šä¹‰æ–¹æ³•ï¼Œå¯ä»¥è¿›è¡Œå¦‚ä¸‹æ“ä½œã€‚</p> <p>å®˜æ–¹ç»™æˆ‘ä»¬æä¾›äº†è‡ªå®šä¹‰ Streamable çš„æ–¹æ³•ï¼Œä¸è¿‡åœ¨å®é™…å·¥ä½œä¸­å¾ˆå°‘å‡ºç°è¦è‡ªå®šä¹‰ä¿è¯ç»“æœç±»çš„æƒ…å†µï¼Œåœ¨è¿™é‡Œæˆ‘ç®€å•ä»‹ç»ä¸€ä¸‹æ–¹æ³•ï¼Œçœ‹å¦‚ä¸‹ä¾‹å­ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span> <span class="token comment">// (1)</span>
    <span class="token class-name">MonetaryAmount</span> <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//..</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@RequiredArgConstructor</span><span class="token punctuation">(</span>staticName <span class="token operator">=</span> <span class="token string">&quot;of&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Products</span> <span class="token keyword">implements</span> <span class="token class-name">Streamable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span> <span class="token comment">//(2)</span>
    <span class="token keyword">private</span> <span class="token class-name">Streamable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> streamable<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">MonetaryAmount</span> <span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//(3)</span>
        <span class="token keyword">return</span> streamable<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Priced</span><span class="token operator">::</span><span class="token function">getPrice</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Money</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">MonetaryAmount</span><span class="token operator">::</span><span class="token function">add</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">ProductRepository</span> <span class="token keyword">implements</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">Products</span> <span class="token function">findAllByDescriptionContaining</span><span class="token punctuation">(</span><span class="token class-name">String</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//(4)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>ä»¥ä¸Šå››ä¸ªæ­¥éª¤ä»‹ç»äº†è‡ªå®šä¹‰ Streamable çš„æ–¹æ³•ï¼Œåˆ†åˆ«ä¸ºï¼š</p> <p>ï¼ˆ1ï¼‰Product å®ä½“ï¼Œå…¬å¼€ API ä»¥è®¿é—®äº§å“ä»·æ ¼ã€‚</p> <p>ï¼ˆ2ï¼‰Streamable<code>&lt;Product&gt;</code> çš„åŒ…è£…ç±»å‹å¯ä»¥é€šè¿‡ Products.of(â€¦) æ„é€ ï¼ˆé€šè¿‡ Lombok æ³¨è§£åˆ›å»ºçš„å·¥å‚æ–¹æ³•ï¼‰ã€‚</p> <p>ï¼ˆ3ï¼‰åŒ…è£…å™¨ç±»å‹åœ¨ Streamable<code>&lt;Product&gt;</code> ä¸Šå…¬å¼€äº†è®¡ç®—æ–°å€¼çš„å…¶ä»– APIã€‚</p> <p>ï¼ˆ4ï¼‰å¯ä»¥å°†åŒ…è£…å™¨ç±»å‹ç›´æ¥ç”¨ä½œæŸ¥è¯¢æ–¹æ³•è¿”å›ç±»å‹ã€‚æ— é¡»è¿”å› Stremable<code>&lt;Product&gt;</code> å¹¶å°†å…¶æ‰‹åŠ¨åŒ…è£…åœ¨å­˜å‚¨åº“ Client ç«¯ä¸­ã€‚</p> <p>é€šè¿‡ä»¥ä¸Šä¾‹å­ä½ å°±å¯ä»¥åšåˆ°è‡ªå®šä¹‰ Streamableï¼Œå…¶åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯å®ç°Streamableæ¥å£ï¼Œè‡ªå·±å®šä¹‰è‡ªå·±çš„å®ç°ç±»å³å¯ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹ä¸‹æºç  QueryExecutionResultHandler é‡Œé¢æ˜¯å¦æœ‰ Streamable å­ç±»çš„åˆ¤æ–­ï¼Œæ¥æ”¯æŒè‡ªå®šä¹‰ Streamableï¼Œå…³é”®æºç å¦‚ä¸‹ï¼š</p> <p><img src="/assets/img/image-20201221232035672.7b6b6e26.png" alt="image-20201221232035672"></p> <p>é€šè¿‡æºç ä½ ä¼šå‘ç° Streamable ä¸ºä»€ä¹ˆç”Ÿæ•ˆï¼Œä¸‹é¢æ¥çœ‹çœ‹å¸¸è§çš„é›†åˆç±»çš„è¿”å›å®ç°ã€‚</p> <h3 id="list-stream-page-sliceã€æŒæ¡ã€‘ğŸ”¥"><a href="#list-stream-page-sliceã€æŒæ¡ã€‘ğŸ”¥" class="header-anchor">#</a> List/Stream/Page/Sliceã€æŒæ¡ã€‘ğŸ”¥</h3> <p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¦‚ä½•è¿”å› List/Stream/Page/Slice å‘¢ï¼Ÿ</p> <p>æ–°å»ºæˆ‘ä»¬çš„ UserRepositoryï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
   <span class="token comment">//è‡ªå®šä¹‰ä¸€ä¸ªæŸ¥è¯¢æ–¹æ³•ï¼Œè¿”å›Streamå¯¹è±¡ï¼Œå¹¶ä¸”æœ‰åˆ†é¡µå±æ€§</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u from User u&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllByCustomQueryAndStream</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æµ‹è¯•Sliceçš„è¿”å›ç»“æœ</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u from User u&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">Slice</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllByCustomQueryAndSlice</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>æµ‹è¯•ç”¨ä¾‹ç±»</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DataJpaTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserRepositoryTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSaveUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">{</span>
        <span class="token comment">//æˆ‘ä»¬æ–°å¢7æ¡æ•°æ®æ–¹ä¾¿æµ‹è¯•åˆ†é¡µç»“æœ</span>
        userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jack1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&quot;12356@126.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sex</span><span class="token punctuation">(</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token string">&quot;shanghai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jack2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&quot;12456@126.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sex</span><span class="token punctuation">(</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token string">&quot;shanghai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jack3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&quot;12456@126.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sex</span><span class="token punctuation">(</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token string">&quot;shanghai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jack4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&quot;12356@126.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sex</span><span class="token punctuation">(</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token string">&quot;shanghai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jack5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&quot;12356@126.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sex</span><span class="token punctuation">(</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token string">&quot;shanghai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jack6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&quot;12346@126.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sex</span><span class="token punctuation">(</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token string">&quot;shanghai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jack7&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&quot;12346@126.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sex</span><span class="token punctuation">(</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token string">&quot;shanghai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
        <span class="token comment">//æˆ‘ä»¬åˆ©ç”¨ObjectMapperå°†æˆ‘ä»¬çš„è¿”å›ç»“æœJson to String</span>
        <span class="token class-name">ObjectMapper</span> objectMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è¿”å›Streamç±»å‹ç»“æœï¼ˆ1ï¼‰</span>
        <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userStream <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findAllByCustomQueryAndStream</span><span class="token punctuation">(</span><span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userStream<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è¿”å›åˆ†é¡µæ•°æ®ï¼ˆ2ï¼‰</span>
        <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userPage <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>userPage<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è¿”å›Sliceç»“æœï¼ˆ3ï¼‰</span>
        <span class="token class-name">Slice</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userSlice <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findAllByCustomQueryAndSlice</span><span class="token punctuation">(</span><span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>userSlice<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è¿”å›Listç»“æœï¼ˆ4ï¼‰</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userList <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findAllById</span><span class="token punctuation">(</span><span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span><span class="token number">2L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>userList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åˆ†åˆ«çœ‹ä¸‹å››ç§æµ‹è¯•ç»“æœï¼š</p> <p><strong>ç¬¬ä¸€ç§ï¼šé€šè¿‡</strong>Stream<code>&lt;User&gt;</code><strong>å–ç¬¬äºŒé¡µçš„æ•°æ®ï¼Œå¾—åˆ°ç»“æœå¦‚ä¸‹ï¼š</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>User(id=4, name=jack4, email=123456@126.com, sex=man, address=shanghai)
User(id=5, name=jack5, email=123456@126.com, sex=man, address=shanghai)
User(id=6, name=jack6, email=123456@126.com, sex=man, address=shanghai)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Spring Data çš„æ”¯æŒå¯ä»¥é€šè¿‡ä½¿ç”¨ Java 8 Stream ä½œä¸ºè¿”å›ç±»å‹æ¥é€æ­¥å¤„ç†æŸ¥è¯¢æ–¹æ³•çš„ç»“æœã€‚<strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šæµçš„å…³é—­é—®é¢˜</strong>ï¼Œtry catch æ˜¯ä¸€ç§å¸¸ç”¨çš„å…³é—­æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> stream<span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
   stream <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findAllByCustomQueryAndStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   stream<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>â€¦<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>stream<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      stream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>ç¬¬äºŒç§ï¼šè¿”å› Page<code>&lt;User&gt;</code> çš„åˆ†é¡µæ•°æ®ç»“æœï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
   <span class="token property">&quot;content&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
         <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;jack1&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;email&quot;</span><span class="token operator">:</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;sex&quot;</span><span class="token operator">:</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;address&quot;</span><span class="token operator">:</span><span class="token string">&quot;shanghai&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
         <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;jack2&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;email&quot;</span><span class="token operator">:</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;sex&quot;</span><span class="token operator">:</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;address&quot;</span><span class="token operator">:</span><span class="token string">&quot;shanghai&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
         <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;jack3&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;email&quot;</span><span class="token operator">:</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;sex&quot;</span><span class="token operator">:</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;address&quot;</span><span class="token operator">:</span><span class="token string">&quot;shanghai&quot;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token property">&quot;pageable&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
         <span class="token property">&quot;sorted&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
         <span class="token property">&quot;unsorted&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
         <span class="token property">&quot;empty&quot;</span><span class="token operator">:</span><span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;pageNumber&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//å½“å‰é¡µç </span>
      <span class="token property">&quot;pageSize&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token comment">//é¡µç å¤§å°</span>
      <span class="token property">&quot;offset&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//åç§»é‡</span>
      <span class="token property">&quot;paged&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//æ˜¯å¦åˆ†é¡µäº†</span>
      <span class="token property">&quot;unpaged&quot;</span><span class="token operator">:</span><span class="token boolean">false</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token property">&quot;totalPages&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token comment">//ä¸€å…±æœ‰å¤šå°‘é¡µ</span>
   <span class="token property">&quot;last&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">//æ˜¯å¦æ˜¯åˆ°æœ€å</span>
   <span class="token property">&quot;totalElements&quot;</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token comment">//ä¸€å…±å¤šå°‘è°ƒæ•°</span>
   <span class="token property">&quot;numberOfElements&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token comment">//å½“å‰æ•°æ®ä¸‹æ ‡</span>
   <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token property">&quot;sorted&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token property">&quot;unsorted&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">&quot;empty&quot;</span><span class="token operator">:</span><span class="token boolean">true</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token property">&quot;size&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// å½“å‰contentå¤§å°</span>
   <span class="token property">&quot;number&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">// å½“å‰é¡µé¢ç çš„ç´¢å¼•</span>
   <span class="token property">&quot;first&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">// æ˜¯å¦æ˜¯ç¬¬ä¸€é¡µ</span>
   <span class="token property">&quot;empty&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token comment">//æ˜¯å¦æœ‰æ•°æ®</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Page<code>&lt;User&gt;</code> è¿”å›äº†ç¬¬ä¸€ä¸ªé¡µçš„æ•°æ®ï¼Œå¹¶ä¸”å‘Šè¯‰æˆ‘ä»¬ä¸€å…±æœ‰ä¸‰ä¸ªéƒ¨åˆ†çš„æ•°æ®ï¼š</p> <ul><li><strong>content</strong>ï¼šæ•°æ®çš„å†…å®¹ï¼Œç°åœ¨æŒ‡ User çš„ List 3 æ¡ã€‚</li> <li><strong>pageable</strong>ï¼šåˆ†é¡µæ•°æ®ï¼ŒåŒ…æ‹¬æ’åºå­—æ®µæ˜¯ä»€ä¹ˆåŠå…¶æ–¹å‘ã€å½“å‰æ˜¯ç¬¬å‡ é¡µã€ä¸€å…±å¤šå°‘é¡µã€æ˜¯å¦æ˜¯æœ€åä¸€æ¡ç­‰ã€‚</li> <li><strong>å½“å‰æ•°æ®çš„æè¿°</strong>ï¼šâ€œsizeâ€ï¼š3ï¼Œå½“å‰ content å¤§å°ï¼›â€œnumberâ€ï¼š0ï¼Œå½“å‰é¡µé¢ç çš„ç´¢å¼•ï¼› â€œfirstâ€ï¼štrueï¼Œæ˜¯å¦æ˜¯ç¬¬ä¸€é¡µï¼›â€œemptyâ€ï¼šfalseï¼Œæ˜¯å¦æ²¡æœ‰æ•°æ®ã€‚</li></ul> <p>é€šè¿‡è¿™ä¸‰éƒ¨åˆ†æ•°æ®æˆ‘ä»¬å¯ä»¥çŸ¥é“è¦æŸ¥æ•°çš„åˆ†é¡µä¿¡æ¯ã€‚</p> <p><strong>ç¬¬ä¸‰ç§ï¼šè¿”å› Slice<code>&lt;User&gt;</code> ç»“æœï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
   <span class="token property">&quot;content&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
         <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">,</span>
         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;jack4&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;email&quot;</span><span class="token operator">:</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;sex&quot;</span><span class="token operator">:</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;address&quot;</span><span class="token operator">:</span><span class="token string">&quot;shanghai&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
         <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span>
         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;jack5&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;email&quot;</span><span class="token operator">:</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;sex&quot;</span><span class="token operator">:</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;address&quot;</span><span class="token operator">:</span><span class="token string">&quot;shanghai&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
         <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span>
         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;jack6&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;email&quot;</span><span class="token operator">:</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;sex&quot;</span><span class="token operator">:</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;address&quot;</span><span class="token operator">:</span><span class="token string">&quot;shanghai&quot;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token property">&quot;pageable&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
         <span class="token property">&quot;sorted&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
         <span class="token property">&quot;unsorted&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
         <span class="token property">&quot;empty&quot;</span><span class="token operator">:</span><span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;pageNumber&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;pageSize&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token property">&quot;offset&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token property">&quot;paged&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">&quot;unpaged&quot;</span><span class="token operator">:</span><span class="token boolean">false</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token property">&quot;numberOfElements&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
   <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token property">&quot;sorted&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token property">&quot;unsorted&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">&quot;empty&quot;</span><span class="token operator">:</span><span class="token boolean">true</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token property">&quot;size&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
   <span class="token property">&quot;number&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
   <span class="token property">&quot;first&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
   <span class="token property">&quot;last&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
   <span class="token property">&quot;empty&quot;</span><span class="token operator">:</span><span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>è¿™æ—¶æˆ‘ä»¬å‘ç°ä¸Šé¢çš„ Page è¿”å›ç»“æœå°‘äº†ï¼Œé‚£ä¹ˆä¸€å…±æœ‰å¤šå°‘æ¡ç»“æœã€å¤šå°‘é¡µçš„æ•°æ®å‘¢ï¼Ÿæˆ‘ä»¬å†æ¯”è¾ƒä¸€ä¸‹ç¬¬äºŒç§å’Œç¬¬ä¸‰ç§æµ‹è¯•ç»“æœçš„æ‰§è¡Œ SQLï¼š</p> <p>ç¬¬äºŒç§æ‰§è¡Œçš„æ˜¯æ™®é€šçš„åˆ†é¡µæŸ¥è¯¢ SQLï¼š</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- æŸ¥è¯¢åˆ†é¡µæ•°æ®</span>
<span class="token keyword">select</span> user0_<span class="token punctuation">.</span>id <span class="token keyword">as</span> id1_0_<span class="token punctuation">,</span> user0_<span class="token punctuation">.</span>address <span class="token keyword">as</span> address2_0_<span class="token punctuation">,</span> user0_<span class="token punctuation">.</span>email <span class="token keyword">as</span> email3_0_<span class="token punctuation">,</span> user0_<span class="token punctuation">.</span>name <span class="token keyword">as</span> name4_0_<span class="token punctuation">,</span> user0_<span class="token punctuation">.</span>sex <span class="token keyword">as</span> sex5_0_ <span class="token keyword">from</span> <span class="token keyword">user</span> user0_ <span class="token keyword">limit</span> ?
<span class="token comment">-- è®¡ç®—åˆ†é¡µæ•°æ®</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>user0_<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token keyword">as</span> col_0_0_ <span class="token keyword">from</span> <span class="token keyword">user</span> user0_
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ç¬¬ä¸‰ç§æ‰§è¡Œçš„ SQL å¦‚ä¸‹ï¼š</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> user0_<span class="token punctuation">.</span>id <span class="token keyword">as</span> id1_0_<span class="token punctuation">,</span> user0_<span class="token punctuation">.</span>address <span class="token keyword">as</span> address2_0_<span class="token punctuation">,</span> user0_<span class="token punctuation">.</span>email <span class="token keyword">as</span> email3_0_<span class="token punctuation">,</span> user0_<span class="token punctuation">.</span>name <span class="token keyword">as</span> name4_0_<span class="token punctuation">,</span> user0_<span class="token punctuation">.</span>sex <span class="token keyword">as</span> sex5_0_ <span class="token keyword">from</span> <span class="token keyword">user</span> user0_ <span class="token keyword">limit</span> ? <span class="token keyword">offset</span> ?
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>é€šè¿‡å¯¹æ¯”å¯ä»¥çœ‹å‡ºï¼ŒåªæŸ¥è¯¢åç§»é‡ï¼Œä¸è®¡ç®—åˆ†é¡µæ•°æ®ï¼Œè¿™å°±æ˜¯ Page å’Œ Slice çš„ä¸»è¦åŒºåˆ«</p> <p><strong>ç¬¬å››ç§ï¼šè¿”å› List<code>&lt;User&gt;</code> ç»“æœå¦‚ä¸‹ï¼š</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;jack1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;email&quot;</span><span class="token operator">:</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sex&quot;</span><span class="token operator">:</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;address&quot;</span><span class="token operator">:</span><span class="token string">&quot;shanghai&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
     <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;jack2&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;email&quot;</span><span class="token operator">:</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;sex&quot;</span><span class="token operator">:</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;address&quot;</span><span class="token operator">:</span><span class="token string">&quot;shanghai&quot;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆç®€å•åœ°æŸ¥è¯¢å‡ºæ¥ ID=1 å’Œ ID=2 çš„æ•°æ®ï¼Œæ²¡æœ‰åˆ†é¡µä¿¡æ¯ã€‚</p> <p>ä¸Šé¢å››ç§æ–¹æ³•ä»‹ç»äº†å¸¸è§çš„å¤šæ¡æ•°æ®è¿”å›ç»“æœçš„å½¢å¼ï¼Œå•æ¡çš„æˆ‘å°±ä¸å¤šä»‹ç»äº†ï¼Œç›¸ä¿¡ä½ ä¸€çœ‹å°±æ‡‚ï¼Œæ— éå°±æ˜¯å¯¹ JDK8 çš„ Optional çš„æ”¯æŒã€‚æ¯”å¦‚æ”¯æŒäº† Null çš„ä¼˜é›…åˆ¤æ–­ï¼Œå†ä¸€ä¸ªå°±æ˜¯æ”¯æŒç›´æ¥è¿”å› Entityï¼Œæˆ–è€…ä¸€äº›å­˜åœ¨ / ä¸å­˜åœ¨çš„ Boolean çš„ç»“æœå’Œä¸€äº› count æ¡æ•°çš„è¿”å›ç»“æœè€Œå·²ã€‚</p> <h3 id="å¯¹-feature-completablefuture-å¼‚æ­¥è¿”å›ç»“æœçš„æ”¯æŒ"><a href="#å¯¹-feature-completablefuture-å¼‚æ­¥è¿”å›ç»“æœçš„æ”¯æŒ" class="header-anchor">#</a> å¯¹ Feature/CompletableFuture å¼‚æ­¥è¿”å›ç»“æœçš„æ”¯æŒ</h3> <p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Spring çš„å¼‚æ­¥æ–¹æ³•æ‰§è¡ŒRepositoryæŸ¥è¯¢ï¼Œè¿™æ„å‘³ç€æ–¹æ³•å°†åœ¨è°ƒç”¨æ—¶ç«‹å³è¿”å›ï¼Œå¹¶ä¸”å®é™…çš„æŸ¥è¯¢æ‰§è¡Œå°†å‘ç”Ÿåœ¨å·²æäº¤ç»™ Spring TaskExecutor çš„ä»»åŠ¡ä¸­ï¼Œæ¯”è¾ƒé€‚åˆå®šæ—¶ä»»åŠ¡çš„å®é™…åœºæ™¯ã€‚å¼‚æ­¥ä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œç›´æ¥åŠ @Async æ³¨è§£å³å¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Async</span>
<span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByFirstname</span><span class="token punctuation">(</span><span class="token class-name">String</span> firstname<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Async</span>
<span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findOneByFirstname</span><span class="token punctuation">(</span><span class="token class-name">String</span> firstname<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Async</span>
<span class="token class-name">ListenableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findOneByLastname</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ä¸Šè¿°ä¸‰ä¸ªå¼‚æ­¥æ–¹æ³•çš„è¿”å›ç»“æœï¼Œåˆ†åˆ«åšå¦‚ä¸‹è§£é‡Šï¼š</p> <ul><li>ç¬¬ä¸€å¤„ï¼šä½¿ç”¨ java.util.concurrent.Future çš„è¿”å›ç±»å‹ï¼›</li> <li>ç¬¬äºŒå¤„ï¼šä½¿ç”¨ java.util.concurrent.CompletableFuture ä½œä¸ºè¿”å›ç±»å‹ï¼›</li> <li>ç¬¬ä¸‰å¤„ï¼šä½¿ç”¨ org.springframework.util.concurrent.ListenableFuture ä½œä¸ºè¿”å›ç±»å‹ã€‚</li></ul> <p>ä»¥ä¸Šæ˜¯å¯¹ @Async çš„æ”¯æŒï¼Œå…³äºå®é™…ä½¿ç”¨éœ€è¦æ³¨æ„ä»¥ä¸‹ä¸‰ç‚¹å†…å®¹ï¼š</p> <ul><li>åœ¨å®é™…å·¥ä½œä¸­ï¼Œç›´æ¥åœ¨ Repository è¿™ä¸€å±‚ä½¿ç”¨å¼‚æ­¥æ–¹æ³•çš„åœºæ™¯ä¸å¤šï¼Œä¸€èˆ¬éƒ½æ˜¯æŠŠå¼‚æ­¥æ³¨è§£æ”¾åœ¨ Service çš„æ–¹æ³•ä¸Šé¢ï¼Œè¿™æ ·çš„è¯ï¼Œå¯ä»¥æœ‰ä¸€äº›é¢å¤–é€»è¾‘ï¼Œå¦‚å‘çŸ­ä¿¡ã€å‘é‚®ä»¶ã€å‘æ¶ˆæ¯ç­‰é…åˆä½¿ç”¨ï¼›</li> <li>ä½¿ç”¨å¼‚æ­¥çš„æ—¶å€™ä¸€å®šè¦é…ç½®çº¿ç¨‹æ± ï¼Œè¿™ç‚¹åˆ‡è®°ï¼Œå¦åˆ™â€œæ­»â€å¾—ä¼šå¾ˆéš¾çœ‹ï¼›</li> <li>ä¸‡ä¸€å¤±è´¥æˆ‘ä»¬ä¼šæ€ä¹ˆå¤„ç†ï¼Ÿå…³äºäº‹åŠ¡æ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿè¿™ç§éœ€è¦é‡ç‚¹è€ƒè™‘çš„ï¼Œæˆ‘å°†ä¼šåœ¨ 14 è¯¾æ—¶ï¼ˆä¹è§‚é”æœºåˆ¶å’Œé‡è¯•æœºåˆ¶åœ¨å®æˆ˜ä¸­åº”è¯¥æ€ä¹ˆç”¨?ï¼‰ä¸­è¯¦ç»†ä»‹ç»ã€‚</li></ul> <p>æ¥ä¸‹æ¥çœ‹çœ‹ Repository å¯¹Reactive æ˜¯å¦‚ä½•æ”¯æŒçš„ã€‚</p> <h3 id="å¯¹-reactive-æ”¯æŒ-flux-ä¸-mono"><a href="#å¯¹-reactive-æ”¯æŒ-flux-ä¸-mono" class="header-anchor">#</a> å¯¹ Reactive æ”¯æŒ flux ä¸ Mono</h3> <p>å¯èƒ½æœ‰åŒå­¦ä¼šé—®ï¼Œçœ‹åˆ°Spring Data Commoné‡Œé¢å¯¹Reactè¿˜æ˜¯æœ‰æ”¯æŒçš„ï¼Œé‚£ä¸ºä»€ä¹ˆåœ¨JpaRespositoryé‡Œé¢æ²¡çœ‹åˆ°æœ‰å“åº”çš„è¿”å›ç»“æœæ”¯æŒå‘¢ï¼Ÿå…¶å®Commoné‡Œé¢æä¾›çš„åªæ˜¯æ¥å£ï¼Œè€ŒJPAé‡Œé¢æ²¡æœ‰åšç›¸å…³çš„Reactive çš„å®ç°ï¼Œä½†æ˜¯æœ¬èº«Spring Data Commoné‡Œé¢å¯¹ Reactive æ˜¯æ”¯æŒçš„ã€‚</p> <p>ä¸‹é¢æˆ‘ä»¬åœ¨ gradle é‡Œé¢å¼•ç”¨ä¸€ä¸ªSpring Data Commonçš„å­æ¨¡å—implementation 'org.springframework.boot:spring-boot-starter-data-mongodb' æ¥åŠ è½½ä¾èµ–ï¼Œè¿™æ—¶å€™æˆ‘ä»¬æ‰“å¼€ Repository çœ‹ Hierarchy å°±å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå¤šäº†ä¸€ä¸ª Mongo çš„ Repsitory çš„å®ç°ï¼Œå¤©ç„¶åœ°æ”¯æŒç€ Reactive è¿™æ¡çº¿ã€‚</p> <p><img src="/assets/img/Ciqc1F9rC-uAWLY5AASQJuG5If0280.b1b00539.png" alt="img"></p> <p>ç›¸ä¿¡åˆ°è¿™é‡Œä½ èƒ½æ„Ÿå—åˆ° Spring Data Common çš„å¼ºå¤§æ”¯æŒï¼Œå¯¹ Repository æ¥å£çš„ä¸åŒå®ç°ä¹Ÿæœ‰äº†ä¸€å®šçš„è®¤è¯†ã€‚å¯¹äºä»¥ä¸Šè®²è¿°çš„è¿”å›ç»“æœï¼Œä½ å¯ä»¥è‡ªå·±æµ‹è¯•ä¸€ä¸‹åŠ ä»¥ç†è§£å¹¶è¿ç”¨ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬è¿›è¡Œä¸€ä¸ªæ€»ç»“ã€‚</p> <h3 id="è¿”å›ç»“æœæ”¯æŒæ€»ç»“"><a href="#è¿”å›ç»“æœæ”¯æŒæ€»ç»“" class="header-anchor">#</a> è¿”å›ç»“æœæ”¯æŒæ€»ç»“</h3> <p>ä¸‹é¢æ‰“å¼€ ResultProcessor ç±»çš„æºç çœ‹ä¸€ä¸‹æ”¯æŒçš„ç±»å‹æœ‰å“ªäº›ã€‚</p> <p><img src="/assets/img/CgqCHl9rC7uAOiNSAAGT0qXVLyY891.63b1385d.png" alt="img"></p> <p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡º processResult çš„æ—¶å€™åˆ†åˆ«å¯¹ PageQueryã€Streamã€Reactiv æœ‰äº†å„è‡ªçš„åˆ¤æ–­ï¼Œæˆ‘ä»¬ debug åˆ°è¿™é‡Œçš„æ—¶å€™æ¥çœ‹ä¸€ä¸‹ convertï¼Œè¿›å…¥åˆ°ç±»é‡Œé¢ã€‚</p> <p><img src="/assets/img/Ciqc1F9rC_-AOhtnAALvuoaT4mw230.5e983fc7.png" alt="img"></p> <p>å¯ä»¥çœ‹åˆ° QueryExecutorConverters é‡Œé¢å¯¹ JDK8ã€Guavaã€vavr ä¹Ÿåšäº†å„ç§æ”¯æŒï¼Œå¦‚æœä½ æœ‰å…´è¶£å¯ä»¥è¯¾åå»ä»”ç»†çœ‹çœ‹æºç ã€‚</p> <p>è¿™é‡Œæˆ‘ä»¬å…ˆç”¨è¡¨æ ¼æ€»ç»“ä¸€ä¸‹è¿”å›å€¼ï¼Œä¸‹è¡¨åˆ—å‡ºäº† Spring Data JPA Query Method æœºåˆ¶æ”¯æŒçš„æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ï¼š</p> <p><img src="/assets/img/Ciqc1F9rDAiARh9tAAQVFWlht1s532.c5b5810b.png" alt="img"></p> <h3 id="æœ€å¸¸è§çš„-dto-è¿”å›ç»“æœçš„æ”¯æŒæ–¹æ³•æœ‰å“ªäº›ã€æŒæ¡ã€‘"><a href="#æœ€å¸¸è§çš„-dto-è¿”å›ç»“æœçš„æ”¯æŒæ–¹æ³•æœ‰å“ªäº›ã€æŒæ¡ã€‘" class="header-anchor">#</a> æœ€å¸¸è§çš„ DTO è¿”å›ç»“æœçš„æ”¯æŒæ–¹æ³•æœ‰å“ªäº›ã€æŒæ¡ã€‘</h3> <p>ä¸Šé¢æˆ‘ä»¬è®²è§£äº† Repository ä¸åŒçš„è¿”å›ç±»å‹ï¼Œä¸‹é¢æˆ‘ä»¬ç€é‡è¯´ä¸€ä¸‹é™¤äº† Entityï¼Œè¿˜èƒ½è¿”å›å“ªäº› POJO å‘¢ï¼Ÿæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸ªæ¦‚å¿µï¼š<strong>Projections</strong>ã€‚</p> <h4 id="projections-çš„æ¦‚å¿µ-ã€æŒæ¡ã€‘"><a href="#projections-çš„æ¦‚å¿µ-ã€æŒæ¡ã€‘" class="header-anchor">#</a> Projections çš„æ¦‚å¿µ ã€æŒæ¡ã€‘</h4> <p>Spring JPA å¯¹ Projections æ‰©å±•çš„æ”¯æŒï¼Œæˆ‘ä¸ªäººè§‰å¾—è¿™æ˜¯ä¸ªéå¸¸å¥½çš„ä¸œè¥¿ï¼Œä»å­—é¢æ„æ€ä¸Šç†è§£å°±æ˜¯æ˜ å°„ï¼ŒæŒ‡çš„æ˜¯å’Œ DB çš„æŸ¥è¯¢ç»“æœçš„å­—æ®µæ˜ å°„å…³ç³»ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿”å›çš„å­—æ®µå’Œ DB çš„æŸ¥è¯¢ç»“æœçš„å­—æ®µæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼›ä½†æœ‰çš„æ—¶å€™ï¼Œéœ€è¦è¿”å›ä¸€äº›æŒ‡å®šçš„å­—æ®µï¼Œæˆ–è€…è¿”å›ä¸€äº›å¤åˆå‹çš„å­—æ®µï¼Œè€Œä¸éœ€è¦å…¨éƒ¨è¿”å›ã€‚</p> <p>åŸæ¥æˆ‘ä»¬çš„åšæ³•æ˜¯è‡ªå·±å†™å„ç§ entity åˆ° view çš„å„ç§ convert çš„è½¬åŒ–é€»è¾‘ï¼Œè€Œ Spring Data æ­£æ˜¯è€ƒè™‘åˆ°äº†è¿™ä¸€ç‚¹ï¼Œå…è®¸å¯¹ä¸“ç”¨è¿”å›ç±»å‹è¿›è¡Œå»ºæ¨¡ï¼Œæœ‰é€‰æ‹©åœ°è¿”å›åŒä¸€ä¸ªå®ä½“çš„ä¸åŒè§†å›¾å¯¹è±¡ã€‚</p> <p>ä¸‹é¢è¿˜ä»¥æˆ‘ä»¬çš„ User æŸ¥è¯¢å¯¹è±¡ä¸ºä¾‹ï¼Œçœ‹çœ‹æ€ä¹ˆè‡ªå®šä¹‰è¿”å› DTOï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Id</span>
   <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy<span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>çœ‹ä¸Šé¢çš„åŸå§‹ User å®ä½“ä»£ç ï¼Œå¦‚æœæˆ‘ä»¬åªæƒ³è¿”å› User å¯¹è±¡é‡Œé¢çš„ name å’Œ emailï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿä¸‹é¢æˆ‘ä»¬ä»‹ç»ä¸‰ç§æ–¹æ³•ã€‚</p> <h4 id="æ–¹æ³•ä¸€ï¼šæ–°å»ºä¸€å¼ è¡¨çš„ä¸åŒ-entity"><a href="#æ–¹æ³•ä¸€ï¼šæ–°å»ºä¸€å¼ è¡¨çš„ä¸åŒ-entity" class="header-anchor">#</a> æ–¹æ³•ä¸€ï¼šæ–°å»ºä¸€å¼ è¡¨çš„ä¸åŒ Entity</h4> <p>é¦–å…ˆï¼Œæˆ‘ä»¬æ–°å¢ä¸€ä¸ªEntityç±»ï¼šé€šè¿‡ @Table æŒ‡å‘åŒä¸€å¼ è¡¨ï¼Œè¿™å¼ è¡¨å’Œ User å®ä¾‹é‡Œé¢çš„è¡¨ä¸€æ ·éƒ½æ˜¯ userï¼Œå®Œæ•´å†…å®¹å¦‚ä¸‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserOnlyNameEmailEntity</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Id</span>
   <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy<span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>ç„¶åï¼Œæ–°å¢ä¸€ä¸ª UserOnlyNameEmailEntityRepositoryï¼Œåšå•ç‹¬çš„æŸ¥è¯¢ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserOnlyNameEmailEntityRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserOnlyNameEmailEntity</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æœ€åï¼Œæˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹é‡Œé¢çš„å†™æ³•å¦‚ä¸‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testProjections</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jack12&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sex</span><span class="token punctuation">(</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token string">&quot;shanghai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users<span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">UserOnlyNameEmailEntity</span> uName <span class="token operator">=</span> userOnlyNameEmailEntityRepository<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>uName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Hibernate: insert into user (address, email, name, sex, id) values (?, ?, ?, ?, ?)
Hibernate: select user0_.id as id1_0_, user0_.address as address2_0_, user0_.email as email3_0_, user0_.name as name4_0_, user0_.sex as sex5_0_ from user user0_
[User(id=1, name=jack12, email=123456@126.com, sex=man, address=shanghai)]
Hibernate: select useronlyna0_.id as id1_0_0_, useronlyna0_.email as email3_0_0_, useronlyna0_.name as name4_0_0_ from user useronlyna0_ where useronlyna0_.id=?
UserOnlyNameEmailEntity(id=1, name=jack12, email=123456@126.com)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ä¸Šè¿°ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œå½“åœ¨ user è¡¨é‡Œé¢æ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œè€Œ userRepository å’Œ userOnlyNameEmailEntityRepository æŸ¥è¯¢çš„éƒ½æ˜¯åŒä¸€å¼ è¡¨ userï¼Œè¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯ç®€å•ã€æ–¹ä¾¿ï¼Œå¾ˆå®¹æ˜“å¯ä»¥æƒ³åˆ°ï¼›ç¼ºç‚¹å°±æ˜¯é€šè¿‡ä¸¤ä¸ªå®ä½“éƒ½å¯ä»¥è¿›è¡Œ update æ“ä½œï¼Œå¦‚æœåŒä¸€ä¸ªé¡¹ç›®é‡Œé¢è¿™ç§å®ä½“æ¯”è¾ƒå¤šï¼Œåˆ°æ—¶å€™å°±å®¹æ˜“ä¸çŸ¥é“æ˜¯è°æ›´æ–°çš„ï¼Œä»è€Œå¯¼è‡´å‡º bug ä¸å¥½æŸ¥è¯¢ï¼Œå®ä½“èŒè´£åˆ’åˆ†ä¸æ˜ç¡®ã€‚æˆ‘ä»¬æ¥çœ‹ç¬¬äºŒç§è¿”å› DTO çš„åšæ³•ã€‚</p> <h4 id="æ–¹æ³•äºŒï¼šå®šä¹‰ä¸€ä¸ª-useronlynameemaildto"><a href="#æ–¹æ³•äºŒï¼šå®šä¹‰ä¸€ä¸ª-useronlynameemaildto" class="header-anchor">#</a> æ–¹æ³•äºŒï¼šå®šä¹‰ä¸€ä¸ª UserOnlyNameEmailDto</h4> <p>é¦–å…ˆï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª DTO ç±»æ¥è¿”å›æˆ‘ä»¬æƒ³è¦çš„å­—æ®µï¼Œå®ƒæ˜¯ UserOnlyNameEmailDtoï¼Œç”¨æ¥æ¥æ”¶ nameã€email ä¸¤ä¸ªå­—æ®µçš„å€¼ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserOnlyNameEmailDto</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span>email<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>å…¶æ¬¡ï¼Œåœ¨ UserRepository é‡Œé¢åšå¦‚ä¸‹ç”¨æ³•ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">//æµ‹è¯•åªè¿”å›nameå’Œemailçš„DTO</span>
    <span class="token class-name">UserOnlyNameEmailDto</span> <span class="token function">findByEmail</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ç„¶åï¼Œæµ‹è¯•ç”¨ä¾‹é‡Œé¢å†™æ³•å¦‚ä¸‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testProjections</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jack12&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sex</span><span class="token punctuation">(</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token string">&quot;shanghai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">UserOnlyNameEmailDto</span> userOnlyNameEmailDto <span class="token operator">=</span>  userRepository<span class="token punctuation">.</span><span class="token function">findByEmail</span><span class="token punctuation">(</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userOnlyNameEmailDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>æœ€åï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Hibernate: select user0_.name as col_0_0_, user0_.email as col_1_0_ from user user0_ where user0_.email=?
UserOnlyNameEmailDto(name=jack12, email=123456@126.com)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å»çœ‹æºç çš„è¯ï¼Œçœ‹å…³é”®çš„ PreferredConstructorDiscoverer ç±»æ—¶ä¼šå‘ç°ï¼ŒUserDTO é‡Œé¢åªèƒ½æœ‰ä¸€ä¸ªå…¨å‚æ•°æ„é€ æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <p><img src="/assets/img/CgqCHl9rDDKAPKAIAASfIaP3unE060.4364504a.png" alt="img"></p> <p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒConstructor é€‰æ‹©çš„æ—¶å€™ä¼šå¸®æˆ‘ä»¬åšæ„é€ å‚æ•°çš„é€‰æ‹©ï¼Œå¦‚æœ DTO é‡Œé¢æœ‰å¤šä¸ªæ„é€ æ–¹æ³•ï¼Œå°±ä¼šæŠ¥è½¬åŒ–é”™è¯¯çš„å¼‚å¸¸ï¼Œè¿™ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œå¼‚å¸¸æ˜¯è¿™æ ·çš„ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>No converter found capable of converting from type [com.example.jpa.example1.User] to type [com.example.jpa.example1.UserOnlyNameEmailDto
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>æ‰€ä»¥è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹å°±æ˜¯è¿”å›çš„ç»“æœä¸éœ€è¦æ˜¯ä¸ªå®ä½“å¯¹è±¡ï¼Œå¯¹ DB ä¸èƒ½è¿›è¡Œé™¤äº†æŸ¥è¯¢ä¹‹å¤–çš„ä»»ä½•æ“ä½œï¼›ç¼ºç‚¹å°±æ˜¯æœ‰ set æ–¹æ³•è¿˜å¯ä»¥æ”¹å˜é‡Œé¢çš„å€¼ï¼Œæ„é€ æ–¹æ³•ä¸èƒ½æ›´æ”¹ï¼Œå¿…é¡»å…¨å‚æ•°ï¼Œè¿™æ ·å¦‚æœæ˜¯ä¸ç†Ÿæ‚‰ JPA çš„æ–°äººæ“ä½œçš„æ—¶å€™å¾ˆå®¹æ˜“å¼•å‘ Bugã€‚</p> <h4 id="æ–¹æ³•ä¸‰ï¼šè¿”å›ç»“æœä¸º-pojo-çš„æ¥å£ã€æŒæ¡ã€‘ğŸ”¥"><a href="#æ–¹æ³•ä¸‰ï¼šè¿”å›ç»“æœä¸º-pojo-çš„æ¥å£ã€æŒæ¡ã€‘ğŸ”¥" class="header-anchor">#</a> æ–¹æ³•ä¸‰ï¼šè¿”å›ç»“æœä¸º POJO çš„æ¥å£ã€æŒæ¡ã€‘ğŸ”¥</h4> <p>æˆ‘ä»¬å†æ¥å­¦ä¹ ä¸€ç§è¿”å›ä¸åŒå­—æ®µçš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼ä¸ä¸Šé¢ä¸¤ç§çš„åŒºåˆ«æ˜¯åªéœ€è¦å®šä¹‰æ¥å£ï¼Œå®ƒçš„å¥½å¤„æ˜¯åªè¯»ï¼Œä¸éœ€è¦æ·»åŠ æ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬ä½¿ç”¨èµ·æ¥éå¸¸çµæ´»ï¼Œä¸€èˆ¬å¾ˆéš¾äº§ç”Ÿ Bugï¼Œé‚£ä¹ˆå®ƒæ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p> <p>é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ª UserOnlyName çš„æ¥å£ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserOnlyName</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> <span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>å…¶æ¬¡ï¼Œæˆ‘ä»¬çš„ UserRepository å†™æ³•å¦‚ä¸‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * æ¥å£çš„æ–¹å¼è¿”å›DTO
     * @param address
     * @return
     */</span>
    <span class="token class-name">UserOnlyName</span> <span class="token function">findByAddress</span><span class="token punctuation">(</span><span class="token class-name">String</span> address<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ç„¶åï¼Œæµ‹è¯•ç”¨ä¾‹çš„å†™æ³•å¦‚ä¸‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testProjections</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jack12&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sex</span><span class="token punctuation">(</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token string">&quot;shanghai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">UserOnlyName</span> userOnlyName <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findByAddress</span><span class="token punctuation">(</span><span class="token string">&quot;shanghai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userOnlyName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>æœ€åï¼Œæˆ‘ä»¬çš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Hibernate: select user0_.name as col_0_0_, user0_.email as col_1_0_ from user user0_ where user0_.address=?
org.springframework.data.jpa.repository.query.AbstractJpaQuery$TupleConverter$TupleBackedMap@1d369521
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¿™ä¸ªæ—¶å€™ä¼šå‘ç°æˆ‘ä»¬çš„ userOnlyName æ¥å£æˆäº†ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œé‡Œé¢é€šè¿‡ Map çš„æ ¼å¼åŒ…å«äº†æˆ‘ä»¬çš„è¦è¿”å›å­—æ®µçš„å€¼ï¼ˆå¦‚ï¼šnameã€emailï¼‰ï¼Œæˆ‘ä»¬ç”¨çš„æ—¶å€™ç›´æ¥è°ƒç”¨æ¥å£é‡Œé¢çš„æ–¹æ³•å³å¯ï¼Œå¦‚ userOnlyName.getName() å³å¯ï¼›è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯æ¥å£ä¸ºåªè¯»ï¼Œå¹¶ä¸”è¯­ä¹‰æ›´æ¸…æ™°ï¼Œæ‰€ä»¥è¿™ç§æ˜¯æˆ‘æ¯”è¾ƒæ¨èçš„åšæ³•ã€‚</p> <p>å…¶ä¸­æºç æ˜¯å¦‚ä½•å®ç°çš„ï¼Œæˆ‘æ¥è¯´ä¸€ä¸ªç±»ï¼Œä½ å¯ä»¥é€šè¿‡ debugï¼Œçœ‹ä¸€ä¸‹æœ€ç»ˆ DTO å’Œæ¥å£è½¬åŒ–æ‰§è¡Œçš„ query æœ‰ä»€ä¹ˆä¸åŒï¼Œçœ‹ä¸‹å›¾ä¸­è€å¸ˆ debug æ˜¾ç¤ºçš„ Query è¯­å¥çš„ä½ç½®ï¼š</p> <p><img src="/assets/img/CgqCHl9rDD6AWKs9AAE8kGFOxmo130.612e3f6f.png" alt="img"></p> <p>å›¾ä¸€ï¼šæ˜¯è¿”å› DTO æ¥å£å½¢å¼çš„ query ç”Ÿæˆçš„ JPQLã€‚</p> <p><img src="/assets/img/CgqCHl9rDEWAdoxmAARwd1XSUzo704.c68789d7.png" alt="img"></p> <p>å›¾äºŒï¼šæ˜¯è¿”å› DTO ç±»çš„æ—¶å€™ QueryStructure ç”Ÿæˆçš„ JPQL è¯­å¥ã€‚</p> <p>ä¸¤ç§æœ€å¤§çš„åŒºåˆ«æ˜¯ DTO ç±»éœ€è¦æ„é€ æ–¹æ³• new ä¸€ä¸ªå¯¹è±¡å‡ºæ¥ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ç¬¬äºŒç§æ–¹æ³•é‡Œé¢éœ€è¦æ³¨æ„çš„ DTO æ„é€ å‡½æ•°çš„é—®é¢˜ï¼›è€Œé€šè¿‡å›¾ä¸€æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¥å£ç›´æ¥é€šè¿‡ as åˆ«åï¼Œæ˜ å°„æˆ hashmap å³å¯ï¼Œéå¸¸çµæ´»ã€‚</p> <h4 id="æ–¹æ³•å››ï¼š-query"><a href="#æ–¹æ³•å››ï¼š-query" class="header-anchor">#</a> æ–¹æ³•å››ï¼š@Query</h4> <p>ä»¥ä¸Šå°±æ˜¯è¿”å› DTO çš„å‡ ç§å¸¸è§çš„æ–¹æ³•äº†ï¼Œä½ åœ¨å®é™…åº”ç”¨æ—¶ï¼Œè¦ä¸æ–­ debug å’Œä»”ç»†ä½“ä¼šã€‚å½“ç„¶é™¤äº†è¿™äº›å¤–ï¼Œè¿˜æœ‰ @Query æ³¨è§£ä¹Ÿæ˜¯å¯ä»¥åšåˆ°</p> <h2 id="dqm-jpql-query-å•ã€å¤šè¡¨å¢åˆ æ”¹æŸ¥-ğŸ”¥"><a href="#dqm-jpql-query-å•ã€å¤šè¡¨å¢åˆ æ”¹æŸ¥-ğŸ”¥" class="header-anchor">#</a> DQMâ€”JPQL @Query å•ã€å¤šè¡¨å¢åˆ æ”¹æŸ¥ ğŸ”¥</h2> <p>JPQLï¼ˆJava Persistence Query Languageï¼‰ã€‚åŸºäºé¦–æ¬¡åœ¨EJB2.0ä¸­å¼•å…¥çš„EJBæŸ¥è¯¢è¯­è¨€(EJB QL)ï¼ŒJavaæŒä¹…åŒ–æŸ¥è¯¢è¯­è¨€(JPQL)æ˜¯ä¸€ç§å¯ç§»æ¤çš„æŸ¥è¯¢è¯­è¨€ï¼Œæ—¨åœ¨ä»¥é¢å‘å¯¹è±¡è¡¨è¾¾å¼è¯­è¨€çš„è¡¨è¾¾å¼ï¼Œå°†SQLè¯­æ³•å’Œç®€å•æŸ¥è¯¢è¯­ä¹‰ç»‘å®šåœ¨ä¸€èµ·ï¼Œä½¿ç”¨è¿™ç§è¯­è¨€ç¼–å†™çš„æŸ¥è¯¢æ˜¯å¯ç§»æ¤çš„ï¼Œå¯ä»¥è¢«ç¼–è¯‘æˆæ‰€æœ‰ä¸»æµæ•°æ®åº“æœåŠ¡å™¨ä¸Šçš„SQLã€‚é¿å…äº†ç¨‹åºä¸æ•°æ®åº“ SQL è¯­å¥è€¦åˆä¸¥é‡ï¼Œæ¯”è¾ƒé€‚åˆè·¨æ•°æ®æºçš„åœºæ™¯ï¼ˆä¸€ä¼šå„¿ MySQLï¼Œä¸€ä¼šå„¿ Oracle ç­‰ï¼‰</p> <p>å…¶ç‰¹å¾ä¸åŸç”ŸSQLè¯­å¥ç±»ä¼¼ï¼Œå¹¶ä¸”å®Œå…¨<strong>é¢å‘å¯¹è±¡</strong>ï¼Œé€šè¿‡<strong>ç±»å</strong>å’Œ<strong>å±æ€§</strong>è®¿é—®ï¼Œè€Œ<strong>ä¸æ˜¯è¡¨åå’Œè¡¨ä¸­å­—æ®µ</strong>ã€‚ä¸æ”¯æŒ<code>SELECT *</code>ï¼Œä½†æ˜¯æ”¯æŒ<code>COUNT(*)</code>ã€‚<strong>å•è¡¨å¤šè¡¨éƒ½æ”¯æŒ</strong>ï¼</p> <p>ä½¿ç”¨å¦‚ä¸‹ï¼š</p> <ul><li>ç‰¹æœ‰çš„æŸ¥è¯¢ï¼šéœ€è¦åœ¨ Repository æ¥å£ä¸Šé…ç½®æ–¹æ³•</li> <li>åœ¨é…ç½®çš„æ–¹æ³•ä¸Šï¼Œä½¿ç”¨<code>@Query</code>æ³¨è§£çš„å½¢å¼é…ç½®JPQLè¯­å¥</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ArticleRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  
    <span class="token comment">/**
     * ?1 ä»£è¡¨å‚æ•°çš„å ä½ç¬¦ï¼Œå…¶ä¸­1ä»£è¡¨å¯¹åº”æ–¹æ³•ä¸­çš„å‚æ•°ç´¢å¼•ï¼ˆå‚æ•°ç´¢å¼•ä»1å¼€å§‹ï¼‰
     */</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;from Article where author = ?1 and title = ?2&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">Article</span> <span class="token function">jpqlFindByAuthorAndTitle</span><span class="token punctuation">(</span><span class="token class-name">String</span> author<span class="token punctuation">,</span> <span class="token class-name">String</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span>

  
  
    <span class="token comment">/**
     * ?1 ä»£è¡¨å‚æ•°çš„å ä½ç¬¦ï¼Œå…¶ä¸­1ä»£è¡¨å¯¹åº”æ–¹æ³•ä¸­çš„å‚æ•°ç´¢å¼•ï¼ˆå‚æ•°ç´¢å¼•ä»1å¼€å§‹ï¼‰
     */</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;update Article set author = ?1 where aid = ?2&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Modifying</span><span class="token comment">// ä»£è¡¨ä¿®æ”¹æ“ä½œï¼ˆupdateã€deleteã€insert éƒ½å¯ä»¥ï¼‰</span>
    <span class="token keyword">void</span> <span class="token function">updateAuthorById</span><span class="token punctuation">(</span><span class="token class-name">String</span> author<span class="token punctuation">,</span> <span class="token class-name">Long</span> aid<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * ä¸æŒ‡å®šåˆ™æŒ‰ç…§æ–¹æ³•ä¸­å‚æ•°ä½ç½®å¯¹åº”ã€‚â€œ:å‚æ•°åç§°â€œ ä¹Ÿå¯ä»¥å½“åšå ä½ç¬¦
     */</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;update Article set author = :author where aid = :aid&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Modifying</span><span class="token comment">// ä»£è¡¨ä¿®æ”¹æ“ä½œï¼ˆupdateã€deleteã€insert éƒ½å¯ä»¥ï¼‰</span>
    <span class="token keyword">void</span> <span class="token function">updateAuthorById2</span><span class="token punctuation">(</span><span class="token class-name">String</span> author<span class="token punctuation">,</span> <span class="token class-name">Long</span> aid<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DataJpaTest</span>
<span class="token comment">// DataJpaTestã€MybatisTest ä¼šé»˜è®¤ä½¿ç”¨å…¶æµ‹è¯•æ•°æ®æºæ›¿ä»£ï¼Œè‹¥è¦ä½¿ç”¨è‡ªå·±é…ç½®çš„ï¼Œéœ€è¦æ·»åŠ å¦‚ä¸‹æ³¨è§£</span>
<span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace <span class="token operator">=</span> <span class="token class-name">AutoConfigureTestDatabase<span class="token punctuation">.</span>Replace</span><span class="token punctuation">.</span>NONE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArticleJpqlRepositoryTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ArticleRepository</span> articleRepository<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testJpqlFindByAuthorAndTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Article</span> article <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">jpqlFindByAuthorAndTitle</span><span class="token punctuation">(</span><span class="token string">&quot;ç”·ç¥&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ç‰›é€¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// @Test å•å…ƒæµ‹è¯•é»˜è®¤æµ‹è¯•å®Œä¼šå›æ»šï¼Œå¯ä»¥é…ç½®å¦‚ä¸‹æ³¨è§£æ¥é˜²æ­¢å›æ»š</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token annotation punctuation">@Rollback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">testUpdateAuthorById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        articleRepository<span class="token punctuation">.</span><span class="token function">updateAuthorById</span><span class="token punctuation">(</span><span class="token string">&quot;ç”·ç¥1&quot;</span><span class="token punctuation">,</span> <span class="token number">5L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// @Test å•å…ƒæµ‹è¯•é»˜è®¤æµ‹è¯•å®Œä¼šå›æ»šï¼Œå¯ä»¥é…ç½®å¦‚ä¸‹æ³¨è§£æ¥é˜²æ­¢å›æ»š</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token annotation punctuation">@Rollback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">testUpdateAuthorById2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        articleRepository<span class="token punctuation">.</span><span class="token function">updateAuthorById2</span><span class="token punctuation">(</span><span class="token string">&quot;ç”·ç¥2&quot;</span><span class="token punctuation">,</span> <span class="token number">6L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="å¿«é€Ÿä½“éªŒ-query-çš„æ–¹æ³•"><a href="#å¿«é€Ÿä½“éªŒ-query-çš„æ–¹æ³•" class="header-anchor">#</a> å¿«é€Ÿä½“éªŒ @Query çš„æ–¹æ³•</h3> <p>å¼€å§‹ä¹‹å‰ï¼Œé¦–å…ˆæ¥çœ‹ä¸€ä¸ª Demoï¼Œæ²¿ç”¨æˆ‘ä»¬ä¹‹å‰çš„ä¾‹å­ï¼Œæ–°å¢ä¸€ä¸ª @Query çš„æ–¹æ³•ï¼Œå¿«é€Ÿä½“éªŒä¸€ä¸‹ @Query çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDtoRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
   <span class="token comment">//é€šè¿‡queryæ³¨è§£æ ¹æ®nameæŸ¥è¯¢userä¿¡æ¯</span>
   <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;From User where name=:name&quot;</span><span class="token punctuation">)</span>
   <span class="token class-name">User</span> <span class="token function">findByQuery</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> nameParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ç„¶åï¼Œæˆ‘ä»¬æ–°å¢ä¸€ä¸ªæµ‹è¯•ç±»ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DataJpaTest</span>
<span class="token comment">// DataJpaTestã€MybatisTest ä¼šé»˜è®¤ä½¿ç”¨å…¶æµ‹è¯•æ•°æ®æºæ›¿ä»£ï¼Œè‹¥è¦ä½¿ç”¨è‡ªå·±é…ç½®çš„ï¼Œéœ€è¦æ·»åŠ å¦‚ä¸‹æ³¨è§£</span>
<span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace <span class="token operator">=</span> <span class="token class-name">AutoConfigureTestDatabase<span class="token punctuation">.</span>Replace</span><span class="token punctuation">.</span>NONE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserRepositoryQueryTest</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Autowired</span>
   <span class="token keyword">private</span> <span class="token class-name">UserDtoRepository</span> userDtoRepository<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Test</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testQueryAnnotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//æ–°å¢ä¸€æ¡æ•°æ®æ–¹ä¾¿æµ‹è¯•      userDtoRepository.save(User.builder().name(&quot;jackxx&quot;).email(&quot;123456@126.com&quot;).sex(&quot;man&quot;).address(&quot;shanghai&quot;).build());</span>
      <span class="token comment">//è°ƒç”¨ä¸Šé¢çš„æ–¹æ³•æŸ¥çœ‹ç»“æœ</span>
      <span class="token class-name">User</span> user2 <span class="token operator">=</span> userDtoRepository<span class="token punctuation">.</span><span class="token function">findByQuery</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user2<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>æœ€åï¼Œçœ‹åˆ°è¿è¡Œçš„ç»“æœå¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Hibernate: insert into user (address, email, name, sex, version, id) values (?, ?, ?, ?, ?, ?)
Hibernate: select user0_.id as id1_0_, user0_.address as address2_0_, user0_.email as email3_0_, user0_.name as name4_0_, user0_.sex as sex5_0_, user0_.version as version6_0_ from user user0_ where user0_.name=?
User(id=1, name=jack, email=123456@126.com, version=0, sex=man, address=shanghai)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å‘ç°ï¼Œè¿™æ¬¡ä¸æ˜¯é€šè¿‡æ–¹æ³•åæ¥ç”ŸæˆæŸ¥è¯¢è¯­æ³•ï¼Œè€Œæ˜¯ @Query æ³¨è§£åœ¨å…¶ä¸­èµ·äº†ä½œç”¨ï¼Œä½¿ &quot;From User where name=:name&quot;JPQL ç”Ÿæ•ˆäº†ã€‚é‚£ä¹ˆå®ƒçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬é€šè¿‡æºç æ¥çœ‹ä¸€ä¸‹ã€‚</p> <h3 id="jpaquerylookupstrategy-å…³é”®æºç å‰–æ"><a href="#jpaquerylookupstrategy-å…³é”®æºç å‰–æ" class="header-anchor">#</a> JpaQueryLookupStrategy å…³é”®æºç å‰–æ</h3> <p>æˆ‘ä»¬åœ¨ 03 è¯¾æ—¶å·²ç»ä»‹ç»è¿‡ QueryLookupStrategy çš„ç­–ç•¥å€¼æœ‰å“ªäº›ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸‹æºç æ˜¯å¦‚ä½•èµ·ä½œç”¨çš„ã€‚</p> <p>æˆ‘ä»¬å…ˆæ‰“å¼€ QueryExecutorMethodInterceptor ç±»ï¼Œæ‰¾åˆ°å¦‚ä¸‹ä»£ç ï¼š</p> <p><img src="/assets/img/CgqCHl9rKUmAaHv0AAHfhSZLnCM314.38832f3f.png" alt="img"></p> <p>å†è¿è¡Œä¸Šé¢çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¿™æ—¶å€™åœ¨è¿™é‡Œè®¾ç½®ä¸€ä¸ªæ–­ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°é»˜è®¤çš„ç­–ç•¥æ˜¯CreateIfNotFoundï¼Œä¹Ÿå°±æ˜¯å¦‚æœæœ‰@Queryæ³¨è§£ï¼Œé‚£ä¹ˆä»¥@Queryçš„æ³¨è§£å†…å®¹ä¸ºå‡†ï¼Œå¯ä»¥å¿½ç•¥æ–¹æ³•åã€‚</p> <p>æˆ‘ä»¬ç»§ç»­å¾€åé¢çœ‹ï¼Œè¿›å…¥åˆ° lookupStrategy.resolveQuery é‡Œé¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <p><img src="/assets/img/Ciqc1F9rKU-AKQ5bAAWmeacWTAQ768.2ff34db2.png" alt="img"></p> <p>é€šè¿‡ä¸Šå›¾çš„æ–­ç‚¹å’Œçº¢æ¡†ä¹‹å¤„ï¼Œæˆ‘ä»¬ä¹Ÿå‘ç°äº†ï¼ŒSpring Data JPA è¿™ä¸ªåœ°æ–¹ä½¿ç”¨äº†ç­–ç•¥ã€æ¨¡å¼ï¼Œå½“æˆ‘ä»¬è‡ªå·±å†™ç­–ç•¥æ¨¡å¼çš„æ—¶å€™ä¹Ÿå¯ä»¥è¿›è¡Œå‚è€ƒã€‚</p> <p>é‚£ä¹ˆæ¥ç€å¾€ä¸‹ debugï¼Œè¿›å…¥åˆ° resolveQuery æ–¹æ³•é‡Œé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p> <p><img src="/assets/img/Ciqc1F9rKVaARZk-AAYrhMro5y4100.a10e5f05.png" alt="img"></p> <p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å›¾ä¸­ â‘ å¤„ï¼Œå¦‚æœ Query æ³¨è§£æ‰¾åˆ°äº†ï¼Œå°±ä¸ä¼šèµ°åˆ° â‘¡ å¤„äº†ï¼ˆå³æˆ‘ä»¬ç¬¬ 03 è¯¾æ—¶ä¸­è®²çš„ Defined Query Method è¯­æ³•ï¼‰ã€‚</p> <p>è¿™æ—¶æˆ‘ä»¬ç‚¹å¼€ Query é‡Œé¢çš„ Query å±æ€§çš„å€¼çœ‹ä¸€ä¸‹ï¼Œä½ ä¼šå‘ç°è¿™é‡ŒåŒæ—¶ç”Ÿæˆäº†ä¸¤ä¸ª SQLï¼šä¸€ä¸ªæ˜¯æŸ¥è¯¢æ€»æ•°çš„ Query å®šä¹‰ï¼Œå¦ä¸€ä¸ªæ˜¯æŸ¥è¯¢ç»“æœ Query å®šä¹‰ã€‚</p> <p>åˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»åŸºæœ¬æ˜ç™½äº†ï¼Œå¦‚æœæƒ³çœ‹çœ‹ Query å…·ä½“æ˜¯æ€ä¹ˆç”Ÿæˆçš„ã€ä¸Šé¢çš„ @Param æ³¨è§£æ˜¯æ€ä¹ˆç”Ÿæ•ˆçš„ï¼Œå¯ä»¥åœ¨ä¸Šé¢çš„å›¾ â‘  å¤„ debug ç»§ç»­å¾€é‡Œé¢çœ‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <p><img src="/assets/img/Ciqc1F9rKV2AMpasAAE0Zjc3fRw672.961464b5.png" alt="img"></p> <p>æˆ‘ä»¬ç»§ç»­ä¸€è·¯ debug å°±å¯ä»¥çœ‹åˆ°æ€ä¹ˆé€šè¿‡ @Query å»ç”Ÿæˆ SQL äº†ï¼Œè¿™ä¸ªä¸æ˜¯æœ¬èŠ‚çš„é‡ç‚¹ï¼Œæˆ‘åœ¨è¿™é‡Œå°±ç®€å•å¸¦è¿‡äº†ï¼Œä½ æœ‰å…´è¶£å¯ä»¥è‡ªå·±å» debug çœ‹ä¸€ä¸‹ã€‚</p> <p>é‚£ä¹ˆåŸç†æˆ‘ä»¬æŒæ¡äº†ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹ @Query ç»™æˆ‘ä»¬æä¾›äº†å“ªäº›è¯­æ³•å§ï¼Œå…ˆçœ‹ä¸‹åŸºæœ¬ç”¨æ³•ã€‚</p> <h3 id="query-çš„åŸºæœ¬ä»‹ç»ã€äº†è§£ã€‘"><a href="#query-çš„åŸºæœ¬ä»‹ç»ã€äº†è§£ã€‘" class="header-anchor">#</a> @Query çš„åŸºæœ¬ä»‹ç»ã€äº†è§£ã€‘</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span>
   <span class="token comment">/**
    * æŒ‡å®šJPQLçš„æŸ¥è¯¢è¯­å¥ã€‚ï¼ˆnativeQuery=trueçš„æ—¶å€™ï¼Œæ˜¯åŸç”Ÿçš„Sqlè¯­å¥ï¼‰
	*/</span>
   <span class="token class-name">String</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
   <span class="token comment">/**
	* æŒ‡å®šcountçš„JPQLè¯­å¥ï¼Œå¦‚æœä¸æŒ‡å®šå°†æ ¹æ®queryè‡ªåŠ¨ç”Ÿæˆã€‚
    * ï¼ˆå¦‚æœå½“nativeQuery=trueçš„æ—¶å€™ï¼ŒæŒ‡çš„æ˜¯åŸç”Ÿçš„Sqlè¯­å¥ï¼‰
    */</span>
   <span class="token class-name">String</span> <span class="token function">countQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
   <span class="token comment">/**
    * æ ¹æ®å“ªä¸ªå­—æ®µæ¥countï¼Œä¸€èˆ¬é»˜è®¤å³å¯ã€‚
	*/</span>
   <span class="token class-name">String</span> <span class="token function">countProjection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
   <span class="token comment">/**
    * é»˜è®¤æ˜¯falseï¼Œè¡¨ç¤ºvalueé‡Œé¢æ˜¯ä¸æ˜¯åŸç”Ÿçš„sqlè¯­å¥
	*/</span>
   <span class="token keyword">boolean</span> <span class="token function">nativeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token comment">/**
    * å¯ä»¥æŒ‡å®šä¸€ä¸ªqueryçš„åå­—ï¼Œå¿…é¡»å”¯ä¸€çš„ã€‚
	* å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤çš„ç”Ÿæˆè§„åˆ™æ˜¯ï¼š
    * {$domainClass}.${queryMethodName}
    */</span>
   <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
   <span class="token comment">/*
    * å¯ä»¥æŒ‡å®šä¸€ä¸ªcountçš„queryçš„åå­—ï¼Œå¿…é¡»å”¯ä¸€çš„ã€‚
	* å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤çš„ç”Ÿæˆè§„åˆ™æ˜¯ï¼š
    * {$domainClass}.${queryMethodName}.count
    */</span>
   <span class="token class-name">String</span> <span class="token function">countName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>æ‰€ä»¥åˆ°è¿™é‡Œä½ ä¼šå‘ç°ï¼Œ @Query ç”¨æ³•æ˜¯ä½¿ç”¨ JPQL ä¸ºå®ä½“åˆ›å»ºå£°æ˜å¼æŸ¥è¯¢æ–¹æ³•ã€‚æˆ‘ä»¬ä¸€èˆ¬åªéœ€è¦å…³å¿ƒ @Query é‡Œé¢çš„ value å’Œ nativeQueryã€countQuery çš„å€¼å³å¯ï¼Œå› ä¸ºå…¶ä»–çš„ä¸å¸¸ç”¨ã€‚</p> <p>ä½¿ç”¨å£°æ˜å¼ JPQL æŸ¥è¯¢æœ‰ä¸ªå¥½å¤„ï¼Œå°±æ˜¯å¯åŠ¨çš„æ—¶å€™å°±çŸ¥é“ä½ çš„è¯­æ³•æ­£ç¡®ä¸æ­£ç¡®ã€‚é‚£ä¹ˆæˆ‘ä»¬ç®€å•ä»‹ç»ä¸€ä¸‹ JPQL è¯­æ³•ã€‚</p> <h3 id="jpql-çš„è¯­æ³•"><a href="#jpql-çš„è¯­æ³•" class="header-anchor">#</a> JPQL çš„è¯­æ³•</h3> <p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æŸ¥è¯¢çš„è¯­æ³•ç»“æ„ï¼Œä»£ç å¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SELECT ... FROM ...
[WHERE ...]
[GROUP BY ... [HAVING ...]]
[ORDER BY ...]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä½ ä¼šå‘ç°å®ƒçš„è¯­æ³•ç»“æ„æœ‰ç‚¹ç±»ä¼¼æˆ‘ä»¬ SQLï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ JPQL FROM åé¢è·Ÿçš„æ˜¯å¯¹è±¡ï¼Œè€Œ SQL é‡Œé¢çš„å­—æ®µå¯¹åº”çš„æ˜¯å¯¹è±¡é‡Œé¢çš„å±æ€§å­—æ®µã€‚</p> <p>åŒç†æˆ‘ä»¬çœ‹ä¸€ä¸‹ update å’Œ delete çš„è¯­æ³•ç»“æ„ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>DELETE FROM ... [WHERE ...]
UPDATE ... SET ... [WHERE ...]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å…¶ä¸­â€œ...â€çœç•¥çš„éƒ¨åˆ†æ˜¯å®ä½“å¯¹è±¡åå­—å’Œå®ä½“å¯¹è±¡é‡Œé¢çš„å­—æ®µåå­—ï¼Œè€Œå…¶ä¸­ç±»ä¼¼ SQL ä¸€æ ·åŒ…å«çš„è¯­æ³•å…³é”®å­—æœ‰ï¼šSELECT FROM WHERE UPDATE DELETE JOIN OUTER INNER LEFT GROUP BY HAVING FETCH DISTINCT OBJECT NULL TRUE FALSE NOT AND OR BETWEEN LIKE IN AS UNKNOWN EMPTY MEMBER OF IS AVG MAX MIN SUM COUNT ORDER BY ASC DESC MOD UPPER LOWER TRIM POSITION CHARACTER_LENGTH CHAR_LENGTH BIT_LENGTH CURRENT_TIME CURRENT_DATE CURRENT_TIMESTAMP NEW EXISTS ALL ANY SOME è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬å°±ä¸ä¸€ä¸€ä»‹ç»äº†ã€‚</p> <p>è¿™ä¸ªè¯­æ³•ç”¨èµ·æ¥ä¸å¤æ‚ï¼Œé‡åˆ°é—®é¢˜æ—¶ï¼Œç®€å•æƒ³ä¸€ä¸‹ SQL å°±å¯ä»¥çŸ¥é“äº†ï¼Œæˆ‘æ¨èä¸€ä¸ª Oracle çš„æ–‡æ¡£åœ°å€ï¼šhttps://docs.oracle.com/html/E13946_04/ejb3_langref.htmlï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥çœ‹è¿™ä¸ªæ–‡æ¡£ï¼Œæ‰¾åˆ°è§£å†³é—®é¢˜çš„åŠæ³•ã€‚</p> <p>é‚£ä¹ˆ JPQL çš„è¯­æ³•ä½ å·²ç»å¤§æ¦‚äº†è§£äº†ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹ @Query æ€ä¹ˆä½¿ç”¨ã€‚</p> <h3 id="query-ç”¨æ³•æ¡ˆä¾‹ã€æŒæ¡ã€‘ğŸ”¥"><a href="#query-ç”¨æ³•æ¡ˆä¾‹ã€æŒæ¡ã€‘ğŸ”¥" class="header-anchor">#</a> @Query ç”¨æ³•æ¡ˆä¾‹ã€æŒæ¡ã€‘ğŸ”¥</h3> <p>æˆ‘ä»¬é€šè¿‡å‡ ä¸ªæ¡ˆä¾‹æ¥äº†è§£ä¸€ä¸‹ @Query çš„ç”¨æ³•ï¼Œä½ å°±å¯ä»¥çŸ¥é“ @Query æ€ä¹ˆä½¿ç”¨ã€æ€ä¹ˆä¼ é€’å‚æ•°ã€æ€ä¹ˆåˆ†é¡µç­‰ã€‚</p> <p><strong>æ¡ˆä¾‹ 1ï¼š</strong> è¦åœ¨ Repository çš„æŸ¥è¯¢æ–¹æ³•ä¸Šå£°æ˜ä¸€ä¸ªæ³¨è§£ï¼Œè¿™é‡Œå°±æ˜¯ @Query æ³¨è§£æ ‡æ³¨çš„åœ°æ–¹ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u from User u where u.emailAddress = ?1&quot;</span><span class="token punctuation">)</span>
  <span class="token class-name">User</span> <span class="token function">findByEmailAddress</span><span class="token punctuation">(</span><span class="token class-name">String</span> emailAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>æ¡ˆä¾‹ 2ï¼š</strong> LIKE æŸ¥è¯¢ï¼Œæ³¨æ„ firstname ä¸ä¼šè‡ªåŠ¨åŠ ä¸Šâ€œ%â€å…³é”®å­—ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u from User u where u.firstname like %?1&quot;</span><span class="token punctuation">)</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByFirstnameEndsWith</span><span class="token punctuation">(</span><span class="token class-name">String</span> firstname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>æ¡ˆä¾‹ 3ï¼š</strong> ç›´æ¥ç”¨åŸå§‹ SQLï¼ŒnativeQuery = true å³å¯ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;SELECT * FROM USERS WHERE EMAIL_ADDRESS = ?1&quot;</span><span class="token punctuation">,</span> nativeQuery <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token class-name">User</span> <span class="token function">findByEmailAddress</span><span class="token punctuation">(</span><span class="token class-name">String</span> emailAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>æ³¨æ„ï¼š<strong>nativeQuery ä¸æ”¯æŒç›´æ¥ Sort çš„</strong>å‚æ•°æŸ¥è¯¢ï¼Œéœ€è¦æ‰‹åŠ¨åŠ ä¸Š Sort æ¡ä»¶</p> <p><strong>æ¡ˆä¾‹ 4ï¼š</strong> ä¸‹é¢æ˜¯ nativeQuery çš„æ’åºé”™è¯¯çš„å†™æ³•ï¼Œä¼šå¯¼è‡´æ— æ³•å¯åŠ¨ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;select * from user_info where first_name=?1&quot;</span><span class="token punctuation">,</span>nativeQuery <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfoEntity</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByFirstName</span><span class="token punctuation">(</span><span class="token class-name">String</span> firstName<span class="token punctuation">,</span><span class="token class-name">Sort</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>æ¡ˆä¾‹ 5ï¼š</strong> nativeQuery æ’åºçš„æ­£ç¡®å†™æ³•ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;select * from user_info where first_name=?1 order by ?2&quot;</span><span class="token punctuation">,</span>nativeQuery <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfoEntity</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByFirstName</span><span class="token punctuation">(</span><span class="token class-name">String</span> firstName<span class="token punctuation">,</span><span class="token class-name">String</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//è°ƒç”¨çš„åœ°æ–¹å†™æ³•last_nameæ˜¯æ•°æ®é‡Œé¢çš„å­—æ®µåï¼Œä¸æ˜¯å¯¹è±¡çš„å­—æ®µå</span>
repository<span class="token punctuation">.</span><span class="token function">findByFirstName</span><span class="token punctuation">(</span><span class="token string">&quot;jackzhang&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;last_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>é€šè¿‡ä¸Šé¢å‡ ä¸ªæ¡ˆä¾‹ï¼Œæˆ‘ä»¬çœ‹åˆ°äº† @Query çš„å‡ ç§ç”¨æ³•ï¼Œä½ å°±ä¼šæ˜ç™½æ’åºã€å‚æ•°ã€ä½¿ç”¨æ–¹æ³•ã€LIKEã€åŸå§‹ SQL æ€ä¹ˆå†™ã€‚ä¸‹é¢ç»§ç»­é€šè¿‡æ¡ˆä¾‹æ¥çœ‹ä¸‹ @Query çš„æ’åºã€‚</p> <h3 id="query-çš„æ’åº-ğŸ”¥"><a href="#query-çš„æ’åº-ğŸ”¥" class="header-anchor">#</a> @Query çš„æ’åº ğŸ”¥</h3> <p>@Queryä¸­åœ¨ç”¨JPQLçš„æ—¶å€™ï¼Œæƒ³è¦å®ç°æ’åºï¼Œæ–¹æ³•ä¸Šç›´æ¥ç”¨ PageRequest æˆ–è€… Sort å‚æ•°éƒ½å¯ä»¥åšåˆ°ã€‚</p> <p>æ³¨æ„ <strong>nativeQuery ä¸æ”¯æŒç›´æ¥ Sort çš„</strong>å‚æ•°æŸ¥è¯¢ï¼Œéœ€è¦æ‰‹åŠ¨åŠ ä¸Š Sort æ¡ä»¶ã€‚</p> <p>åœ¨æ’åºå®ä¾‹ä¸­ï¼Œå®é™…ä½¿ç”¨çš„å±æ€§éœ€è¦ä¸å®ä½“æ¨¡å‹é‡Œé¢çš„å­—æ®µç›¸åŒ¹é…ï¼Œè¿™æ„å‘³ç€å®ƒä»¬éœ€è¦è§£æä¸ºæŸ¥è¯¢ä¸­ä½¿ç”¨çš„å±æ€§æˆ–åˆ«åã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¾‹å­ï¼Œè¿™æ˜¯ä¸€ä¸ª<code>state_field_path_expression JPQL</code>çš„å®šä¹‰ï¼Œå¹¶ä¸” Sort çš„å¯¹è±¡æ”¯æŒä¸€äº›ç‰¹å®šçš„å‡½æ•°ã€‚</p> <p><strong>æ¡ˆä¾‹ 6ï¼š</strong> Sort and JpaSort çš„ä½¿ç”¨ï¼Œå®ƒå¯ä»¥è¿›è¡Œæ’åºã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u from User u where u.lastname like ?1%&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByAndSort</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">,</span> <span class="token class-name">Sort</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u.id, LENGTH(u.firstname) as fn_len from User u where u.lastname like ?1%&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token function">findByAsArrayAndSort</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">,</span> <span class="token class-name">Sort</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//è°ƒç”¨æ–¹çš„å†™æ³•ï¼Œå¦‚ä¸‹ï¼š</span>
repo<span class="token punctuation">.</span><span class="token function">findByAndSort</span><span class="token punctuation">(</span><span class="token string">&quot;lannister&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Sort</span><span class="token punctuation">(</span><span class="token string">&quot;firstname&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
repo<span class="token punctuation">.</span><span class="token function">findByAndSort</span><span class="token punctuation">(</span><span class="token string">&quot;stark&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Sort</span><span class="token punctuation">(</span><span class="token string">&quot;LENGTH(firstname)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
repo<span class="token punctuation">.</span><span class="token function">findByAndSort</span><span class="token punctuation">(</span><span class="token string">&quot;targaryen&quot;</span><span class="token punctuation">,</span> <span class="token class-name">JpaSort</span><span class="token punctuation">.</span><span class="token function">unsafe</span><span class="token punctuation">(</span><span class="token string">&quot;LENGTH(firstname)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
repo<span class="token punctuation">.</span><span class="token function">findByAsArrayAndSort</span><span class="token punctuation">(</span><span class="token string">&quot;bolton&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Sort</span><span class="token punctuation">(</span><span class="token string">&quot;fn_len&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="query-çš„åˆ†é¡µ-ğŸ”¥"><a href="#query-çš„åˆ†é¡µ-ğŸ”¥" class="header-anchor">#</a> @Query çš„åˆ†é¡µ ğŸ”¥</h3> <p>@Query çš„åˆ†é¡µåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«ä¸º JPQL çš„æ’åºå’Œ nativeQuery çš„æ’åºã€‚çœ‹ä¸‹é¢çš„æ¡ˆä¾‹ã€‚</p> <p><strong>æ¡ˆä¾‹ 7</strong>ï¼šç›´æ¥ç”¨ Page å¯¹è±¡æ¥å—æ¥å£ï¼Œå‚æ•°ç›´æ¥ç”¨ Pageable çš„å®ç°ç±»å³å¯ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;select u from User u where u.lastname = ?1&quot;</span><span class="token punctuation">)</span>
  <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByLastname</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//è°ƒç”¨è€…çš„å†™æ³•</span>
repository<span class="token punctuation">.</span><span class="token function">findByFirstName</span><span class="token punctuation">(</span><span class="token string">&quot;jackzhang&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">PageRequest</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>æ¡ˆä¾‹ 8ï¼š</strong>@Query å¯¹åŸç”Ÿ SQL çš„åˆ†é¡µæ”¯æŒï¼Œå¹¶ä¸æ˜¯ç‰¹åˆ«å‹å¥½ï¼Œå› ä¸ºè¿™ç§å†™æ³•æ¯”è¾ƒâ€œéª‡å®¢â€ï¼Œå¯èƒ½éšç€ç‰ˆæœ¬çš„ä¸åŒä¼šæœ‰æ‰€å˜åŒ–ã€‚æˆ‘ä»¬ä»¥ MySQL ä¸ºä¾‹ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfoEntity</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">JpaSpecificationExecutor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfoEntity</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;select * from user_info where first_name=?1 /* #pageable# */&quot;</span><span class="token punctuation">,</span>
         countQuery <span class="token operator">=</span> <span class="token string">&quot;select count(*) from user_info where first_name=?1&quot;</span><span class="token punctuation">,</span>
         nativeQuery <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
   <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfoEntity</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByFirstName</span><span class="token punctuation">(</span><span class="token class-name">String</span> firstName<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//è°ƒç”¨è€…çš„å†™æ³•</span>
<span class="token keyword">return</span> userRepository<span class="token punctuation">.</span><span class="token function">findByFirstName</span><span class="token punctuation">(</span><span class="token string">&quot;jackzhang&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">PageRequest</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span>DESC<span class="token punctuation">,</span><span class="token string">&quot;last_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//æ‰“å°å‡ºæ¥çš„sql</span>
select  <span class="token operator">*</span>   from  user_info  where  first_name<span class="token operator">=</span><span class="token operator">?</span> <span class="token comment">/* #pageable# */</span>  order by  last_name desc limit <span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>è¿™é‡Œéœ€è¦æ³¨æ„ï¼šè¿™ä¸ªæ³¨é‡Š <code>/* #pageable# */</code> å¿…é¡»æœ‰ã€‚</strong>
å¦å¤–ï¼Œéšç€ç‰ˆæœ¬çš„å˜åŒ–ï¼Œè¿™ä¸ªæ–¹æ³•æœ‰å¯èƒ½ä¼šè¿›è¡Œä¼˜åŒ–ã€‚æ­¤å¤–è¿˜æœ‰ä¸€ç§å®ç°æ–¹æ³•ï¼Œå°±æ˜¯è‡ªå·±å†™ä¸¤ä¸ªæŸ¥è¯¢æ–¹æ³•ï¼Œè‡ªå·±æ‰‹åŠ¨åˆ†é¡µã€‚</p> <p>å…³äº @Query çš„ç”¨æ³•ï¼Œè¿˜æœ‰ä¸€ä¸ªéœ€è¦äº†è§£çš„å†…å®¹ï¼Œå°±æ˜¯ @ Param ç”¨æ³•ã€‚</p> <h3 id="param-ç”¨æ³•-ğŸ”¥"><a href="#param-ç”¨æ³•-ğŸ”¥" class="header-anchor">#</a> @Param ç”¨æ³• ğŸ”¥</h3> <p>@Param æ³¨è§£æŒ‡å®šæ–¹æ³•å‚æ•°çš„å…·ä½“åç§°ï¼Œé€šè¿‡ç»‘å®šçš„å‚æ•°åå­—æŒ‡å®šæŸ¥è¯¢æ¡ä»¶ï¼Œè¿™æ ·ä¸éœ€è¦å…³å¿ƒå‚æ•°çš„é¡ºåºã€‚<strong>æˆ‘æ¯”è¾ƒæ¨èè¿™ç§åšæ³•ï¼Œå› ä¸ºå®ƒæ¯”è¾ƒåˆ©äºä»£ç é‡æ„</strong>ã€‚å¦‚æœä¸ç”¨ @Param ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå‚æ•°æ˜¯æœ‰åºçš„ï¼Œè¿™ä½¿å¾—æŸ¥è¯¢æ–¹æ³•å¯¹å‚æ•°ä½ç½®çš„é‡æ„å®¹æ˜“å‡ºé”™ã€‚æˆ‘ä»¬çœ‹ä¸ªæ¡ˆä¾‹ã€‚</p> <p><strong>æ¡ˆä¾‹ 9</strong>ï¼šæ ¹æ® firstname å’Œ lastname å‚æ•°æŸ¥è¯¢ user å¯¹è±¡ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u from User u where u.firstname = :firstname or u.lastname = :lastname&quot;</span><span class="token punctuation">)</span>
  <span class="token class-name">User</span> <span class="token function">findByLastnameOrFirstname</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;lastname&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> lastname<span class="token punctuation">,</span>
                                 <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;firstname&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> firstname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>æ¡ˆä¾‹ 10ï¼š</strong> æ ¹æ®å‚æ•°è¿›è¡ŒæŸ¥è¯¢ï¼Œ<strong>top 10 å‰é¢è¯´çš„â€œquery methodâ€å…³é”®å­—ç…§æ ·æœ‰ç”¨</strong>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u from User u where u.firstname = :firstname or u.lastname = :lastname&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">User</span> <span class="token function">findTop10ByLastnameOrFirstname</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;lastname&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> lastname<span class="token punctuation">,</span>
                                        <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;firstname&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> firstname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>è¿™é‡Œè¯´ä¸‹æˆ‘çš„ç»éªŒä¹‹è°ˆï¼šä½ åœ¨é€šè¿‡ @Query å®šä¹‰è‡ªå·±çš„æŸ¥è¯¢æ–¹æ³•æ—¶ï¼Œæˆ‘å»ºè®®ä¹Ÿç”¨ Spring Data JPA çš„ name query çš„å‘½åæ–¹æ³•ï¼Œè¿™æ ·ä¸‹æ¥é£æ ¼å°±æ¯”è¾ƒç»Ÿä¸€äº†ã€‚</strong>
ä¸Šé¢æˆ‘ä»‹ç»äº† @Query çš„åŸºæœ¬ç”¨æ³•ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹ @Query åœ¨æˆ‘ä»¬çš„å®é™…åº”ç”¨ä¸­æœ€å—æ¬¢è¿çš„ä¸¤å¤„åœºæ™¯ã€‚</p> <h3 id="query-ä¹‹-projections-åº”ç”¨è¿”å›æŒ‡å®š-dtoã€æŒæ¡ã€‘ğŸ”¥"><a href="#query-ä¹‹-projections-åº”ç”¨è¿”å›æŒ‡å®š-dtoã€æŒæ¡ã€‘ğŸ”¥" class="header-anchor">#</a> @Query ä¹‹ Projections åº”ç”¨è¿”å›æŒ‡å®š DTOã€æŒæ¡ã€‘ğŸ”¥</h3> <p>æˆ‘ä»¬åœ¨ä¹‹å‰çš„ä¾‹å­çš„åŸºç¡€ä¸Šæ–°å¢ä¸€å¼ è¡¨ UserExtendï¼Œé‡Œé¢åŒ…å«èº«ä»½è¯ã€å­¦å·ã€å¹´é¾„ç­‰ä¿¡æ¯ï¼Œæœ€ç»ˆæˆ‘ä»¬çš„å®ä½“å˜æˆå¦‚ä¸‹æ¨¡æ ·ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserExtend</span> <span class="token punctuation">{</span> <span class="token comment">//ç”¨æˆ·æ‰©å±•ä¿¡æ¯è¡¨</span>
   <span class="token annotation punctuation">@Id</span>
   <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy<span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> idCard<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">Integer</span> ages<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> studentNumber<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span> <span class="token comment">//ç”¨æˆ·åŸºæœ¬ä¿¡æ¯è¡¨</span>
   <span class="token annotation punctuation">@Id</span>
   <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy<span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Version</span>
   <span class="token keyword">private</span> <span class="token class-name">Long</span> version<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>å¦‚æœæˆ‘ä»¬æƒ³å®šä¹‰ä¸€ä¸ª DTO å¯¹è±¡ï¼Œé‡Œé¢åªè¦ nameã€emailã€idCardï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™ç§åœºæ™¯éå¸¸å¸¸è§ï¼Œä½†å¥½å¤šäººä½¿ç”¨çš„éƒ½ä¸æ˜¯æœ€ä½³å®è·µï¼Œæˆ‘åœ¨è¿™é‡Œä»‹ç»å‡ ç§æ–¹å¼åšä¸€ä¸‹å¯¹æ¯”ã€‚</p> <h4 id="åˆšå­¦-jpa-çš„æ—¶å€™åˆ«æ‰‹åˆ«è„šçš„å†™æ³•"><a href="#åˆšå­¦-jpa-çš„æ—¶å€™åˆ«æ‰‹åˆ«è„šçš„å†™æ³•" class="header-anchor">#</a> åˆšå­¦ JPA çš„æ—¶å€™åˆ«æ‰‹åˆ«è„šçš„å†™æ³•</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDtoRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
   <span class="token comment">/**
    * æŸ¥è¯¢ç”¨æˆ·è¡¨é‡Œé¢çš„nameã€emailå’ŒUserExtendè¡¨é‡Œé¢çš„idCard
    * @param id
    * @return
    */</span>
   <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u.name,u.email,e.idCard from User u,UserExtend e where u.id= e.userId and u.id=:id&quot;</span><span class="token punctuation">)</span>
   <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token function">findByUserId</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>æˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„æµ‹è¯•ç”¨ä¾‹æ¥å–ä¸Šé¢ findByUserId æ–¹æ³•è¿”å›çš„æ•°æ®ç»„ç»“æœå€¼ï¼Œå†å¡åˆ° DTO é‡Œé¢ï¼Œä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testQueryAnnotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ–°å¢ä¸€æ¡ç”¨æˆ·æ•°æ®  userDtoRepository.save(User.builder().name(&quot;jack&quot;).email(&quot;123456@126.com&quot;).sex(&quot;man&quot;).address(&quot;shanghai&quot;).build());</span>
    <span class="token comment">//å†æ–°å¢ä¸€æ¡å’Œç”¨æˆ·ä¸€å¯¹ä¸€çš„UserExtendæ•°æ®  userExtendRepository.save(UserExtend.builder().userId(1L).idCard(&quot;shengfengzhenghao&quot;).ages(18).studentNumber(&quot;xuehao001&quot;).build());</span>
    <span class="token comment">//æŸ¥è¯¢æˆ‘ä»¬æƒ³è¦çš„ç»“æœ</span>
    <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> userArray <span class="token operator">=</span> userDtoRepository<span class="token punctuation">.</span><span class="token function">findByUserId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>userArray<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>userArray<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">UserDto</span> userDto <span class="token operator">=</span> <span class="token class-name">UserDto</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>userArray<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>å…¶å®ç»éªŒçš„ä¸°å¯Œçš„â€œè€å¸æœºâ€ä¸€çœ‹å°±çŸ¥é“è¿™è‚¯å®šä¸æ˜¯æœ€ä½³å®è·µï¼Œè¿™å¤šéº»çƒ¦å‘€ï¼Œè‚¯å®šä¼šæœ‰æ›´ä¼˜è§£ã€‚é‚£ä¹ˆæˆ‘ä»¬å†å¯¹æ­¤ç¨åŠ æ”¹é€ ï¼Œç”¨ UserDto æ¥æ”¶è¿”å›ç»“æœã€‚</p> <h4 id="åˆ©ç”¨-userdto-ç±»"><a href="#åˆ©ç”¨-userdto-ç±»" class="header-anchor">#</a> åˆ©ç”¨ UserDto ç±»</h4> <p>é¦–å…ˆï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª UserDto ç±»çš„å†…å®¹ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDto</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span>email<span class="token punctuation">,</span>idCard<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>å…¶æ¬¡ï¼Œæˆ‘ä»¬çœ‹ä¸‹åˆ©ç”¨ @Query åœ¨ Repository é‡Œé¢æ€ä¹ˆå†™ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDtoRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select new com.example.jpa.example1.UserDto(CONCAT(u.name,'JK123'),u.email,e.idCard) from User u,UserExtend e where u.id= e.userId and u.id=:id&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">UserDto</span> <span class="token function">findByUserDtoId</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>æˆ‘ä»¬åˆ©ç”¨ JPQLï¼Œnew äº†ä¸€ä¸ª UserDtoï¼›å†é€šè¿‡æ„é€ æ–¹æ³•ï¼Œæ¥æ”¶æŸ¥è¯¢ç»“æœã€‚å…¶ä¸­ä½ ä¼šå‘ç°ï¼Œæˆ‘ä»¬ç”¨ CONCAT çš„å…³é”®å­—åšäº†ä¸€ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè¿™æ—¶æœ‰çš„åŒå­¦å°±ä¼šé—®äº†ï¼Œè¿™ç§æ–¹æ³•æ”¯æŒçš„å…³é”®å­—æœ‰å“ªäº›å‘¢ï¼Ÿ</p> <p>ä½ å¯ä»¥æŸ¥çœ‹JPQLçš„ Oracal æ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æºç æ¥çœ‹æ”¯æŒçš„å…³é”®å­—æœ‰å“ªäº›ã€‚</p> <p>é¦–å…ˆï¼Œæˆ‘ä»¬æ‰“å¼€ ParameterizedFunctionExpression ä¼šå‘ç° Hibernate æ”¯æŒçš„å…³é”®å­—æœ‰è¿™ä¹ˆå¤šï¼Œéƒ½æ˜¯ MySQL æ•°æ®åº“çš„æŸ¥è¯¢å…³é”®å­—ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€è§£é‡Šäº†ã€‚</p> <p><img src="/assets/img/CgqCHl9rKZeAHUEyAAGh83E9Xs4928.1ad8d2d9.png" alt="img"></p> <p>ç„¶åï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ï¼Œè°ƒç”¨ä¸Šé¢çš„æ–¹æ³•æµ‹è¯•ä¸€ä¸‹ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testQueryAnnotationDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    userDtoRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                           <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sex</span><span class="token punctuation">(</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token string">&quot;shanghai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userExtendRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">UserExtend</span>
                              <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                              <span class="token punctuation">.</span><span class="token function">userId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span>
                              <span class="token punctuation">.</span><span class="token function">idCard</span><span class="token punctuation">(</span><span class="token string">&quot;shengfengzhenghao&quot;</span><span class="token punctuation">)</span>
                              <span class="token punctuation">.</span><span class="token function">ages</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span>
                              <span class="token punctuation">.</span><span class="token function">studentNumber</span><span class="token punctuation">(</span><span class="token string">&quot;xuehao001&quot;</span><span class="token punctuation">)</span>
                              <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">UserDto</span> userDto <span class="token operator">=</span> userDtoRepository<span class="token punctuation">.</span><span class="token function">findByUserDtoId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>æœ€åï¼Œæˆ‘ä»¬è¿è¡Œä¸€ä¸‹æµ‹è¯•ç”¨ä¾‹ï¼Œç»“æœå¦‚ä¸‹ã€‚è¿™æ—¶ä½ ä¼šå‘ç°ï¼Œæˆ‘ä»¬æŒ‰ç…§é¢„æœŸæ“ä½œå¾—åˆ°äº† UserDto çš„ç»“æœã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Hibernate: insert into user (address, email, name, sex, version, id) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into user_extend (ages, id_card, student_number, user_id, id) values (?, ?, ?, ?, ?)
Hibernate: select (user0_.name||'JK123') as col_0_0_, user0_.email as col_1_0_, userextend1_.id_card as col_2_0_ from user user0_ cross join user_extend userextend1_ where user0_.id=userextend1_.user_id and user0_.id=?
UserDto(name=jackJK123, email=123456@126.com, idCard=shengfengzhenghao)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>é‚£ä¹ˆè¿˜æœ‰æ›´ç®€å•çš„æ–¹æ³•å—ï¼Ÿç­”æ¡ˆæ˜¯æœ‰ï¼Œä¸‹é¢æˆ‘ä»¬åˆ©ç”¨ UserDto æ¥å£æ¥å®ç°ä¸€ä¸‹ã€‚</p> <h4 id="åˆ©ç”¨-userdto-æ¥å£-ğŸ”¥"><a href="#åˆ©ç”¨-userdto-æ¥å£-ğŸ”¥" class="header-anchor">#</a> åˆ©ç”¨ UserDto æ¥å£ ğŸ”¥</h4> <p>é¦–å…ˆï¼Œæ–°å¢ä¸€ä¸ª UserSimpleDto æ¥å£æ¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ nameã€emailã€idCard ä¿¡æ¯ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserSimpleDto</span> <span class="token punctuation">{</span>
   <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">String</span> <span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">String</span> <span class="token function">getIdCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>å…¶æ¬¡ï¼Œåœ¨ UserDtoRepository é‡Œé¢æ–°å¢ä¸€ä¸ªæ–¹æ³•ï¼Œè¿”å›ç»“æœæ˜¯ UserSimpleDto æ¥å£ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDtoRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">//åˆ©ç”¨æ¥å£DTOè·å¾—è¿”å›ç»“æœï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ¯ä¸ªå­—æ®µéœ€è¦aså’Œæ¥å£é‡Œé¢çš„getæ–¹æ³•åå­—ä¿æŒä¸€æ ·</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select CONCAT(u.name,'JK123') as name,UPPER(u.email) as email ,e.idCard as idCard from User u,UserExtend e where u.id= e.userId and u.id=:id&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">UserSimpleDto</span> <span class="token function">findByUserSimpleDtoId</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ç„¶åï¼Œæµ‹è¯•ç”¨ä¾‹å†™æ³•å¦‚ä¸‹ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testQueryAnnotationDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    userDtoRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                           <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sex</span><span class="token punctuation">(</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token string">&quot;shanghai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userExtendRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">UserExtend</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                              <span class="token punctuation">.</span><span class="token function">userId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span>
                              <span class="token punctuation">.</span><span class="token function">idCard</span><span class="token punctuation">(</span><span class="token string">&quot;shengfengzhenghao&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ages</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">studentNumber</span><span class="token punctuation">(</span><span class="token string">&quot;xuehao001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">UserSimpleDto</span> userDto <span class="token operator">=</span> userDtoRepository<span class="token punctuation">.</span><span class="token function">findByUserSimpleDtoId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userDto<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userDto<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;:&quot;</span><span class="token operator">+</span>userDto<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;:&quot;</span><span class="token operator">+</span>userDto<span class="token punctuation">.</span><span class="token function">getIdCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>æœ€åï¼Œæˆ‘ä»¬æ‰§è¡Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æœã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>org.springframework.data.jpa.repository.query.AbstractJpaQuery$TupleConverter$TupleBackedMap@373c28e5
jackJK123:123456@126.COM:shengfengzhenghao
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æˆ‘ä»¬å‘ç°ï¼Œæ¯”èµ· DTO æˆ‘ä»¬ä¸éœ€è¦ new äº†ï¼Œå¹¶ä¸”æ¥å£åªèƒ½è¯»ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿”å›çš„ç»“æœ DTO çš„èŒè´£å°±æ›´å•ä¸€äº†ï¼Œåªç”¨æ¥æŸ¥è¯¢ã€‚</p> <p><strong>æ¥å£çš„æ–¹å¼æ˜¯æˆ‘æ¯”è¾ƒæ¨èçš„åšæ³•ï¼Œå› ä¸ºå®ƒæ˜¯åªè¯»çš„ï¼Œå¯¹æ„é€ æ–¹æ³•æ²¡æœ‰è¦æ±‚ï¼Œè¿”å›çš„å®é™…æ˜¯ HashMapã€‚å¹¶ä¸”æ”¯æŒè¿”å›åµŒå¥—çš„å¯¹è±¡</strong></p> <p>è¿”å›ç»“æœä»‹ç»å®Œäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸‹ä¸€ä¸ªæœ€å¸¸è§çš„é—®é¢˜ï¼šå¦‚ä½•ç”¨ @Query æ³¨è§£å®ç°åŠ¨æ€æŸ¥è¯¢ï¼Ÿ</p> <h3 id="query-åŠ¨æ€æŸ¥è¯¢è§£å†³æ–¹æ³•ã€æŒæ¡ã€‘ğŸ”¥"><a href="#query-åŠ¨æ€æŸ¥è¯¢è§£å†³æ–¹æ³•ã€æŒæ¡ã€‘ğŸ”¥" class="header-anchor">#</a> @Query åŠ¨æ€æŸ¥è¯¢è§£å†³æ–¹æ³•ã€æŒæ¡ã€‘ğŸ”¥</h3> <p>æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼Œæ¥äº†è§£ä¸€ä¸‹å¦‚ä½•å®ç° @Query çš„åŠ¨æ€å‚æ•°æŸ¥è¯¢ã€‚</p> <p>é¦–å…ˆï¼Œæ–°å¢ä¸€ä¸ª UserOnlyName æ¥å£ï¼ŒåªæŸ¥è¯¢ User é‡Œé¢çš„ name å’Œ email å­—æ®µã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//è·å¾—è¿”å›ç»“æœ</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserOnlyName</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> <span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>å…¶æ¬¡ï¼Œåœ¨æˆ‘ä»¬çš„ UserDtoRepository é‡Œé¢æ–°å¢ä¸¤ä¸ªæ–¹æ³•ï¼šä¸€ä¸ªæ˜¯åˆ©ç”¨ JPQL å®ç°åŠ¨æ€æŸ¥è¯¢ï¼Œä¸€ä¸ªæ˜¯åˆ©ç”¨åŸå§‹ SQL å®ç°åŠ¨æ€æŸ¥è¯¢ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDtoRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">/**
    * åˆ©ç”¨JQPlåŠ¨æ€æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
    * @param name
    * @param email
    * @return UserSimpleDtoæ¥å£
    */</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u.name as name,u.email as email from User u where (:name is null or u.name =:name) and (:email is null or u.email =:email)&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">UserOnlyName</span> <span class="token function">findByUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
    * åˆ©ç”¨åŸå§‹sqlåŠ¨æ€æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
    * @param user
    * @return
    */</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;select u.name as name,u.email as email from user u where (:#{#user.name} is null or u.name =:#{#user.name}) and (:#{#user.email} is null or u.email =:#{#user.email})&quot;</span><span class="token punctuation">,</span>nativeQuery <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token class-name">UserOnlyName</span> <span class="token function">findByUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>ç„¶åï¼Œæˆ‘ä»¬æ–°å¢ä¸€ä¸ªæµ‹è¯•ç±»ï¼Œæµ‹è¯•ä¸€ä¸‹ä¸Šé¢æ–¹æ³•çš„ç»“æœã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testQueryDinamicDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   userDtoRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sex</span><span class="token punctuation">(</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token string">&quot;shanghai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">UserOnlyName</span> userDto <span class="token operator">=</span> userDtoRepository<span class="token punctuation">.</span><span class="token function">findByUser</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userDto<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> userDto<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">UserOnlyName</span> userDto2 <span class="token operator">=</span> userDtoRepository<span class="token punctuation">.</span><span class="token function">findByUser</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userDto2<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> userDto2<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>æœ€åï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Hibernate: insert into user (address, email, name, sex, version, id) values (?, ?, ?, ?, ?, ?)
 : binding parameter [1] as [VARCHAR] - [shanghai]
 : binding parameter [2] as [VARCHAR] - [123456@126.com]
 : binding parameter [3] as [VARCHAR] - [jack]
 : binding parameter [4] as [VARCHAR] - [man]
 : binding parameter [5] as [BIGINT] - [0]
 : binding parameter [6] as [BIGINT] - [1]
Hibernate: select user0_.name as col_0_0_, user0_.email as col_1_0_ from user user0_ where (? is null or user0_.name=?) and (? is null or user0_.email=?)
 : binding parameter [1] as [VARCHAR] - [jack]
 : binding parameter [2] as [VARCHAR] - [jack]
 : binding parameter [3] as [VARCHAR] - [null]
 : binding parameter [4] as [VARCHAR] - [null]
jack:123456@126.com
Hibernate: select u.name as name,u.email as email from user u where (? is null or u.name =?) and (? is null or u.email =?)
 : binding parameter [1] as [VARBINARY] - [null]
 : binding parameter [2] as [VARBINARY] - [null]
 : binding parameter [3] as [VARCHAR] - [123456@126.com]
 : binding parameter [4] as [VARCHAR] - [123456@126.com]
jack:123456@126.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>æ³¨æ„ï¼šå…¶ä¸­æˆ‘ä»¬æ‰“å°äº†ä¸€ä¸‹ SQL ä¼ å…¥çš„å‚æ•°ï¼Œæ˜¯ä¸ºäº†è®©æˆ‘ä»¬æ›´æ¸…æ¥šå‚æ•°éƒ½ä¼ å…¥äº†ä»€ä¹ˆå€¼ã€‚
ä¸Šé¢çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬åˆ†åˆ«é‡‡ç”¨äº† JPQL çš„åŠ¨æ€å‚æ•°å’Œ SPEL çš„è¡¨è¾¾å¼æ–¹å¼è·å–å‚æ•°ï¼ˆè¿™ä¸ªæˆ‘ä»¬åœ¨ç¬¬ 26 è¯¾æ—¶â€œSpEL è§£å†³äº†å“ªäº›é—®é¢˜â€ä¸­å†è¯¦ç»†ä»‹ç»ï¼‰ã€‚</p> <p>é€šè¿‡ä¸Šé¢çš„å®ä¾‹å¯ä»¥çœ‹å¾—å‡ºæ¥ï¼Œæˆ‘ä»¬é‡‡ç”¨äº† :email is null or s.email = :email è¿™ç§æ–¹å¼æ¥å®ç°åŠ¨æ€æŸ¥è¯¢çš„æ•ˆæœï¼Œå®é™…å·¥ä½œä¸­ä¹Ÿå¯ä»¥æ¼”å˜å¾—å¾ˆå¤æ‚ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸ªå®é™…å·¥ä½œä¸­å¤æ‚ä¸€ç‚¹çš„ä¾‹å­ã€‚</p> <p><strong>é€šè¿‡åŸå§‹ sqlï¼Œæ ¹æ®åŠ¨æ€æ¡ä»¶ room å…³è” room_record æ¥è·å– room_record çš„ç»“æœã€‚</strong></p> <p><img src="/assets/img/CgqCHl9rKauAfQmmAAHMquqHBVg909.bf562865.png" alt="img"></p> <p><strong>é€šè¿‡ JPQL åŠ¨æ€å‚æ•°æŸ¥è¯¢ RoomRecordï¼Œå¦‚ä¸‹å›¾ï¼š</strong></p> <p><img src="/assets/img/Ciqc1F9rKbGAT_6FAAL_YUkV6AQ306.72c30c89.png" alt="img"></p> <p>è¿™ä¸¤ä¸ªä¾‹å­å°±æ˜¯æ¯”è¾ƒå¤æ‚çš„åŠ¨æ€æŸ¥è¯¢çš„æ¡ˆä¾‹ï¼Œå’Œä¸Šé¢çš„ç®€å•åŠ¨æ€æŸ¥è¯¢è¯­æ³•æ˜¯ä¸€æ ·çš„ï¼Œä½ ä»”ç»†çœ‹ä¸€ä¸‹å°±ä¼šæ˜ç™½ï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾åº”ç”¨åˆ°å·¥ä½œä¸­è¿›è¡ŒåŠ¨æ€æŸ¥è¯¢ã€‚</p> <h3 id="query-æ€»ç»“-ğŸ”¥"><a href="#query-æ€»ç»“-ğŸ”¥" class="header-anchor">#</a> @Query æ€»ç»“ ğŸ”¥</h3> <p>åˆ°æ­¤ï¼Œ@Query çš„å¸¸è§ç”¨æ³•ï¼Œå°±å·²ç»è®²å®Œäº†ã€‚æˆ‘ä»¬é€šè¿‡åŸºæœ¬è¯­æ³•ï¼Œåˆ†æäº†ä¸€äº›åŸç†ï¼Œè®²è§£äº†å¸¸è§çš„ DTO å’ŒåŠ¨æ€å‚æ•°çš„å®ç°æ–¹æ³•ï¼Œè¯¦ç»†æŒæ¡äº† @Query çš„ç”¨æ³•ã€‚</p> <p>é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ä½ å¯èƒ½ä¼šé—®äº†ï¼Œæˆ‘ä»¬çŸ¥é“å®šä¹‰æ–¹æ³•åå¯ä»¥è·å¾—æƒ³è¦çš„ç»“æœï¼Œ@Query æ³¨è§£äº¦å¯ä»¥è·å¾—æƒ³è¦çš„ç»“æœï¼ŒnativeQuery ä¹Ÿå¯ä»¥è·å¾—æƒ³è¦çš„ç»“æœï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•åšé€‰æ‹©å‘¢ï¼Ÿ<strong>ä¸‹é¢æˆ‘ä»ä¸ªäººç»éªŒä¸­æ€»ç»“äº†ä¸€äº›è§‚ç‚¹ï¼Œåˆ†äº«ç»™ä½ ã€‚</strong></p> <ol><li>èƒ½ç”¨æ–¹æ³•åè¡¨ç¤ºçš„ï¼Œå°½é‡ç”¨æ–¹æ³•åè¡¨ç¤ºï¼Œå› ä¸ºè¿™æ ·è¯­ä¹‰æ¸…æ™°ã€ç®€å•å¿«é€Ÿï¼ŒåŸºæœ¬ä¸Šåªè¦ç¼–è¯‘é€šè¿‡ï¼Œä¸€å®šä¸ä¼šæœ‰é—®é¢˜ï¼›</li> <li>èƒ½ç”¨ @Query é‡Œé¢çš„ JPQL è¡¨ç¤ºçš„ï¼Œå°±ç”¨ JPQLï¼Œè¿™æ ·ä¸ SQL æ— å…³ï¼Œä¸‡ä¸€å“ªå¤©æ¢æ•°æ®åº“äº†ï¼ŒåŸºæœ¬ä¸Šä»£ç ä¸ç”¨æ”¹å˜ï¼›</li> <li>æœ€åå®åœ¨æ²¡æœ‰åŠæ³•äº†ï¼Œå¯ä»¥é€‰æ‹© nativeQuery å†™åŸå§‹ SQLï¼Œç‰¹åˆ«æ˜¯ä¸€å¼€å§‹ä» MyBatis è½¬è¿‡æ¥çš„åŒå­¦ï¼Œé€‰æ‹©å†™ SQL ä¼šæ›´å®¹æ˜“ä¸€äº›ã€‚</li></ol> <p>å¥½çš„æ¶æ„å¸ˆå†™ä»£ç æ—¶æŠ¥é”™çš„é¡ºåºæ˜¯ï¼šç¼–è¯‘ â€”å¯åŠ¨ â€” è¿è¡Œï¼Œå³è¶Šæ—©å‘ç°é”™è¯¯è¶Šå¥½ã€‚</p> <h2 id="specification-åŠ¨æ€æŸ¥è¯¢-ğŸ”¥"><a href="#specification-åŠ¨æ€æŸ¥è¯¢-ğŸ”¥" class="header-anchor">#</a> Specification åŠ¨æ€æŸ¥è¯¢ ğŸ”¥</h2> <p>åº”è¯¥åœ¨<strong>å†™æ¡†æ¶æ—¶ä½¿ç”¨ï¼Œå…¶ä½™åº”è¯¥ä½¿ç”¨@Queryå†™JPQL</strong></p> <p>Spring Data JPAä¸­å¯ä»¥é€šè¿‡<code>JpaSpecificationExecutor</code>æ¥å£æŸ¥è¯¢ã€‚ç›¸æ¯”JPQLï¼Œå…¶ä¼˜åŠ¿æ˜¯ç±»å‹å®‰å…¨ï¼Œæ›´åŠ çš„é¢å‘å¯¹è±¡ã€‚</p> <p><img src="/assets/img/image-20201220132454832.81ae57b0.png" alt="image-20201220132454832"></p> <ul><li><p><code>T findOne(Specification&lt;T&gt; spec);</code> æŸ¥è¯¢å•ä¸ªå¯¹è±¡</p></li> <li><p><code>List&lt;T&gt; findAll(Specification&lt;T&gt; spec);</code> æŸ¥è¯¢åˆ—è¡¨</p></li> <li><p><code>Page&lt;T&gt; findAll(Specification&lt;T&gt; spec, Pageable pageable);</code></p> <ul><li>Pageableï¼šåˆ†é¡µå‚æ•°ï¼ŒåŒ…æ‹¬æ’åº</li> <li>è¿”å›å€¼ï¼šSpring Data JPAæä¾›çš„åˆ†é¡µ Bean</li></ul></li> <li><p><code>List&lt;T&gt; findAll(Specification&lt;T&gt; spec, Sort sort);</code>æ’åºæŸ¥è¯¢</p></li> <li><p><code>long count(Specification&lt;T&gt; spec);</code>ç»Ÿè®¡æŸ¥è¯¢</p></li></ul> <p>å¯¹äº<code>JpaSpecificationExecutor</code>ï¼Œè¿™ä¸ªæ¥å£åŸºæœ¬æ˜¯å›´ç»•ç€<code>Specification</code>æ¥å£æ¥å®šä¹‰çš„ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•çš„ç†è§£ä¸ºï¼Œ<code>Specification</code><strong>æ„é€ çš„å°±æ˜¯æŸ¥è¯¢æ¡ä»¶</strong>ã€‚</p> <p><img src="/assets/img/image-20201220132537598.085dd780.png" alt="image-20201220132537598"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
  *	root	ï¼šRootæ¥å£ï¼Œä»£è¡¨æŸ¥è¯¢çš„æ ¹å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡rootè·å–å®ä½“ä¸­çš„å±æ€§
  *	query	ï¼šä»£è¡¨ä¸€ä¸ªé¡¶å±‚æŸ¥è¯¢å¯¹è±¡ï¼Œç”¨æ¥è‡ªå®šä¹‰æŸ¥è¯¢ï¼ˆç”¨çš„å°‘ï¼Œä½†æ˜¯å¾ˆå¼ºå¤§ï¼‰
  *	cb		ï¼šç”¨æ¥æ„å»ºæŸ¥è¯¢ï¼Œæ­¤å¯¹è±¡é‡Œæœ‰å¾ˆå¤šæ¡ä»¶æ–¹æ³•
  **/</span>
<span class="token keyword">public</span> <span class="token class-name">Predicate</span> <span class="token function">toPredicate</span><span class="token punctuation">(</span><span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> root<span class="token punctuation">,</span> <span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> query<span class="token punctuation">,</span> <span class="token class-name">CriteriaBuilder</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ArticleRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">JpaSpecificationExecutor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸»è¦æ˜¯ç»§æ‰¿ JpaSpecificationExecutor æ¥å£</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 1.å®ç°Specificationæ¥å£ï¼ˆæä¾›æ³›å‹ï¼šæŸ¥è¯¢çš„å¯¹è±¡ç±»å‹ï¼‰
 * 2.å®ç°toPredicateæ–¹æ³•ï¼ˆæ„é€ æŸ¥è¯¢æ¡ä»¶ï¼‰
 * 3.éœ€è¦å€ŸåŠ©æ–¹æ³•å‚æ•°ä¸­çš„ä¸¤ä¸ªå‚æ•°ï¼ˆ
 *  rootï¼šè·å–éœ€è¦æŸ¥è¯¢çš„å¯¹è±¡å±æ€§ï¼ˆä¸æ˜¯æ•°æ®åº“ä¸­å­—æ®µåï¼ï¼ï¼‰
 *  CriteriaBuilderï¼šæ„é€ æŸ¥è¯¢æ¡ä»¶çš„ï¼Œå†…éƒ¨å°è£…äº†å¾ˆå¤šçš„æŸ¥è¯¢æ¡ä»¶ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼Œç²¾å‡†åŒ¹é…ï¼‰
 **/</span>
<span class="token annotation punctuation">@DataJpaTest</span>
<span class="token comment">// DataJpaTestã€MybatisTest ä¼šé»˜è®¤ä½¿ç”¨å…¶æµ‹è¯•æ•°æ®æºæ›¿ä»£ï¼Œè‹¥è¦ä½¿ç”¨è‡ªå·±é…ç½®çš„ï¼Œéœ€è¦æ·»åŠ å¦‚ä¸‹æ³¨è§£</span>
<span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace <span class="token operator">=</span> <span class="token class-name">AutoConfigureTestDatabase<span class="token punctuation">.</span>Replace</span><span class="token punctuation">.</span>NONE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpecificationTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ArticleRepository</span> articleRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">LinkManRepository</span> linkManRepository<span class="token punctuation">;</span>


    <span class="token comment">/**
     * å•æ¡ä»¶æŸ¥è¯¢ï¼Œæ ¹æ®ä½œè€…æŸ¥è¯¢æ–‡ç« ï¼ˆequalï¼‰
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">spec1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> spec <span class="token operator">=</span> <span class="token punctuation">(</span>root<span class="token punctuation">,</span> query<span class="token punctuation">,</span> criteriaBuilder<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//1.è·å–æ¯”è¾ƒçš„å±æ€§</span>
            <span class="token class-name">Path</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> author <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;author&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//2.æ„é€ æŸ¥è¯¢æ¡ä»¶</span>
            <span class="token comment">//ç¬¬1ä¸ªå‚æ•°ä¸ºæ¯”è¾ƒçš„å±æ€§ï¼ˆPathå¯¹è±¡ï¼‰ï¼›ç¬¬2ä¸ªå‚æ•°ä¸ºè¦æ¯”è¾ƒçš„å€¼</span>
            <span class="token keyword">return</span> criteriaBuilder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>author<span class="token punctuation">,</span> <span class="token string">&quot;ç”·å“¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> articles <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>spec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        articles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * å¤šæ¡ä»¶æŸ¥è¯¢ï¼Œæ ¹æ®authorå’ŒtitleæŸ¥è¯¢æ–‡ç« ï¼ˆequalï¼Œandï¼‰
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">spec2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> spec <span class="token operator">=</span> <span class="token punctuation">(</span>root<span class="token punctuation">,</span> query<span class="token punctuation">,</span> criteriaBuilder<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//1.è·å–æ¯”è¾ƒçš„å±æ€§</span>
            <span class="token class-name">Path</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> author <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;author&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Path</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> title <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//2.æ„é€ æŸ¥è¯¢æ¡ä»¶</span>
            <span class="token class-name">Predicate</span> predicate1 <span class="token operator">=</span> criteriaBuilder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>author<span class="token punctuation">,</span> <span class="token string">&quot;ç”·å“¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Predicate</span> predicate2 <span class="token operator">=</span> criteriaBuilder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> <span class="token string">&quot;ç‰›é€¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//3.æ¡ä»¶é—´å…³ç³»</span>
            <span class="token keyword">return</span> criteriaBuilder<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>predicate1<span class="token punctuation">,</span> predicate2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> articles <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>spec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        articles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * æ™®é€šæŸ¥è¯¢ï¼›æ’åºæŸ¥è¯¢ï¼›åˆ†é¡µæŸ¥è¯¢ï¼Œæ ¹æ®å®¢æˆ·åæ¨¡ç³ŠåŒ¹é…æŸ¥è¯¢å®¢æˆ·åˆ—è¡¨ï¼ˆlikeï¼‰ï¼›
     *  equal: ç›´æ¥çš„åˆ°pathå¯¹è±¡ï¼ˆå±æ€§ï¼‰ï¼Œç„¶åè¿›è¡Œæ¯”è¾ƒå³å¯
     *  gt,lt,ge,le,like: å¾—åˆ°Pathå¯¹è±¡ï¼Œæ ¹æ®PathæŒ‡å®šæ¯”è¾ƒçš„å‚æ•°ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ç­‰ï¼‰ï¼Œå†å»è¿›è¡Œæ¯”è¾ƒ
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">spec3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> spec <span class="token operator">=</span> <span class="token punctuation">(</span>root<span class="token punctuation">,</span> query<span class="token punctuation">,</span> criteriaBuilder<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//1.è·å–æ¯”è¾ƒçš„å±æ€§</span>
            <span class="token class-name">Expression</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> author <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;author&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//2.æ„é€ æŸ¥è¯¢æ¡ä»¶</span>
            <span class="token comment">//3.æ¡ä»¶é—´å…³ç³»</span>
            <span class="token keyword">return</span> criteriaBuilder<span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span>author<span class="token punctuation">,</span> <span class="token string">&quot;ç”·å“¥%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// æ¨¡ç³ŠæŸ¥è¯¢</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> articles1 <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>spec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        articles1<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



        <span class="token comment">// æ’åºæŸ¥è¯¢</span>
        <span class="token class-name">Sort</span> <span class="token class-name">Sorts</span> <span class="token operator">=</span> <span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Order</span><span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token string">&quot;createTime&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Sort<span class="token punctuation">.</span>Order</span><span class="token punctuation">.</span><span class="token function">asc</span><span class="token punctuation">(</span><span class="token string">&quot;aid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> articles2 <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>spec<span class="token punctuation">,</span> <span class="token class-name">Sorts</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        articles2<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">// åˆ†é¡µæŸ¥è¯¢</span>
        <span class="token class-name">Sort</span> <span class="token class-name">Sorts2</span> <span class="token operator">=</span> <span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Order</span><span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token string">&quot;createTime&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Sort<span class="token punctuation">.</span>Order</span><span class="token punctuation">.</span><span class="token function">asc</span><span class="token punctuation">(</span><span class="token string">&quot;aid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Pageable</span> pageable <span class="token operator">=</span> <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">Sorts2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// é¡µç ï¼ˆä»0å¼€å§‹ï¼‰ï¼Œæ¯é¡µæ˜¾ç¤ºæ¡æ•°</span>
        <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>spec<span class="token punctuation">,</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ€»è®°å½•æ•°:&quot;</span> <span class="token operator">+</span> page<span class="token punctuation">.</span><span class="token function">getTotalElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ€»é¡µæ•°:&quot;</span> <span class="token operator">+</span> page<span class="token punctuation">.</span><span class="token function">getTotalPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;åˆ†é¡µæŸ¥è¯¢çš„æ•°æ®:&quot;</span> <span class="token operator">+</span> page<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * Specificationçš„å¤šè¡¨æŸ¥è¯¢
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LinkMan</span><span class="token punctuation">&gt;</span></span> specification <span class="token operator">=</span> <span class="token punctuation">(</span>root<span class="token punctuation">,</span> criteriaQuery<span class="token punctuation">,</span> criteriaBuilder<span class="token punctuation">)</span> <span class="token operator">-&gt;</span>  <span class="token punctuation">{</span>
            <span class="token comment">//Joinä»£è¡¨é“¾æ¥æŸ¥è¯¢ï¼Œé€šè¿‡rootå¯¹è±¡è·å–</span>
            <span class="token comment">//åˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå…³è”å¯¹è±¡çš„å±æ€§åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¿æ¥æŸ¥è¯¢çš„æ–¹å¼ï¼ˆinnerï¼Œleftï¼Œrightï¼‰</span>
            <span class="token comment">//JoinType.LEFT : å·¦å¤–è¿æ¥,JoinType.INNERï¼šå†…è¿æ¥,JoinType.RIGHTï¼šå³å¤–è¿æ¥</span>
            <span class="token class-name">Join</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LinkMan</span><span class="token punctuation">,</span> <span class="token class-name">Customer</span><span class="token punctuation">&gt;</span></span> join <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;customer&quot;</span><span class="token punctuation">,</span><span class="token class-name">JoinType</span><span class="token punctuation">.</span>INNER<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> criteriaBuilder<span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span>join<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;custName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;ä¼ æ™ºæ’­å®¢1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LinkMan</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> linkManRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>specification<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">LinkMan</span> linkMan <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>linkMan<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br></div></div><p>æ–¹æ³•å¯¹åº”å…³ç³»</p> <table><thead><tr><th>æ–¹æ³•åç§°</th> <th>Sqlå¯¹åº”å…³ç³»</th></tr></thead> <tbody><tr><td>equle</td> <td>filed = value</td></tr> <tr><td>gtï¼ˆgreaterThan ï¼‰</td> <td>filed &gt; value</td></tr> <tr><td>ltï¼ˆlessThan ï¼‰</td> <td>filed &lt; value</td></tr> <tr><td>geï¼ˆgreaterThanOrEqualTo ï¼‰</td> <td>filed &gt;= value</td></tr> <tr><td>leï¼ˆ lessThanOrEqualToï¼‰</td> <td>filed &lt;= value</td></tr> <tr><td>notEqule</td> <td>filed != value</td></tr> <tr><td>like</td> <td>filed like value</td></tr> <tr><td>notLike</td> <td>filed not like value</td></tr></tbody></table></div></div> <div class="page-slot page-slot-bottom"><!-- æ¨ªå‘è‡ªé€‚åº” -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/master/docs/200.Java Web/600.SpringDataJPA/403.åŸºç¡€æ“ä½œ.md" target="_blank" rel="noopener noreferrer">ç¼–è¾‘</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2021/06/21, 15:45:42</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/5427c0/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">æ€»è§ˆå…¥é—¨</div></a> <a href="/pages/26ad8c/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">å¤šè¡¨æ“ä½œ</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pages/5427c0/" class="prev">æ€»è§ˆå…¥é—¨</a></span> <span class="next"><a href="/pages/26ad8c/">å¤šè¡¨æ“ä½œ</a>â†’
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/7fcc72/"><div>çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ</div></a> <span>07-06</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/a4ef99/"><div>çº¿ç¨‹å®‰å…¨ç†è®º</div></a> <span>06-24</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/890a0b/"><div>å¹¶å‘ç®€å²</div></a> <span>06-24</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">æ›´å¤šæ–‡ç« &gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:894072666@qq.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/xugaoyi" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="å¬éŸ³ä¹" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2019-2021
    <span>Evan Xu | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">Ã—</i> <div><!-- å›ºå®š160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.ac5e3ef4.js" defer></script><script src="/assets/js/2.d960b235.js" defer></script><script src="/assets/js/4.0e4cf147.js" defer></script>
  </body>
</html>