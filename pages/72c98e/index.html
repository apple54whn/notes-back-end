<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å…±äº«æ¨¡å‹â€”ç®¡ç¨‹ï¼ˆæ‚²è§‚é”ï¼Œé˜»å¡ï¼‰ | conanan&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="webå‰ç«¯æŠ€æœ¯åšå®¢,ç®€æ´è‡³ä¸Š,ä¸“æ³¨webå‰ç«¯å­¦ä¹ ä¸æ€»ç»“ã€‚JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,githubç­‰æŠ€æœ¯æ–‡ç« ã€‚">
    <meta name="keywords" content="å‰ç«¯åšå®¢,ä¸ªäººæŠ€æœ¯åšå®¢,å‰ç«¯,å‰ç«¯å¼€å‘,å‰ç«¯æ¡†æ¶,webå‰ç«¯,å‰ç«¯é¢è¯•é¢˜,æŠ€æœ¯æ–‡æ¡£,å­¦ä¹ ,é¢è¯•,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.03260d1f.css" as="style"><link rel="preload" href="/assets/js/app.ac5e3ef4.js" as="script"><link rel="preload" href="/assets/js/2.d960b235.js" as="script"><link rel="preload" href="/assets/js/7.1c00f39e.js" as="script"><link rel="prefetch" href="/assets/js/10.949143aa.js"><link rel="prefetch" href="/assets/js/100.122fb3a2.js"><link rel="prefetch" href="/assets/js/101.88060c8d.js"><link rel="prefetch" href="/assets/js/102.06832b28.js"><link rel="prefetch" href="/assets/js/103.a0c17aef.js"><link rel="prefetch" href="/assets/js/104.b38ef641.js"><link rel="prefetch" href="/assets/js/105.603033e4.js"><link rel="prefetch" href="/assets/js/106.6b288074.js"><link rel="prefetch" href="/assets/js/107.1ffec4c0.js"><link rel="prefetch" href="/assets/js/108.c7b79afa.js"><link rel="prefetch" href="/assets/js/109.dda9fbee.js"><link rel="prefetch" href="/assets/js/11.326a1f58.js"><link rel="prefetch" href="/assets/js/110.920cbe6e.js"><link rel="prefetch" href="/assets/js/111.45bfe7f2.js"><link rel="prefetch" href="/assets/js/112.1f11c570.js"><link rel="prefetch" href="/assets/js/113.fab1cc04.js"><link rel="prefetch" href="/assets/js/114.21ea4ed6.js"><link rel="prefetch" href="/assets/js/115.96f65264.js"><link rel="prefetch" href="/assets/js/116.b324c49b.js"><link rel="prefetch" href="/assets/js/117.dc4d308c.js"><link rel="prefetch" href="/assets/js/118.8f152d6d.js"><link rel="prefetch" href="/assets/js/119.ede5fffc.js"><link rel="prefetch" href="/assets/js/12.23122444.js"><link rel="prefetch" href="/assets/js/120.044161d7.js"><link rel="prefetch" href="/assets/js/121.453c745a.js"><link rel="prefetch" href="/assets/js/122.e3b088eb.js"><link rel="prefetch" href="/assets/js/123.d5a90d16.js"><link rel="prefetch" href="/assets/js/124.7731d89c.js"><link rel="prefetch" href="/assets/js/125.e64126c4.js"><link rel="prefetch" href="/assets/js/126.e46361b1.js"><link rel="prefetch" href="/assets/js/127.067ae046.js"><link rel="prefetch" href="/assets/js/128.59df2a2f.js"><link rel="prefetch" href="/assets/js/129.a2b82230.js"><link rel="prefetch" href="/assets/js/13.6780e0cd.js"><link rel="prefetch" href="/assets/js/130.c20833b9.js"><link rel="prefetch" href="/assets/js/131.da020742.js"><link rel="prefetch" href="/assets/js/132.e20ac455.js"><link rel="prefetch" href="/assets/js/133.f114b097.js"><link rel="prefetch" href="/assets/js/134.49de9e80.js"><link rel="prefetch" href="/assets/js/135.1a24633f.js"><link rel="prefetch" href="/assets/js/136.d5853212.js"><link rel="prefetch" href="/assets/js/137.3a1020dd.js"><link rel="prefetch" href="/assets/js/138.f194f86d.js"><link rel="prefetch" href="/assets/js/139.bf8c1ca0.js"><link rel="prefetch" href="/assets/js/14.08edf279.js"><link rel="prefetch" href="/assets/js/140.c800f5e0.js"><link rel="prefetch" href="/assets/js/141.47afa8e4.js"><link rel="prefetch" href="/assets/js/142.fda2db61.js"><link rel="prefetch" href="/assets/js/143.0224a2e5.js"><link rel="prefetch" href="/assets/js/144.4126fe8d.js"><link rel="prefetch" href="/assets/js/145.9fe0839a.js"><link rel="prefetch" href="/assets/js/146.89a9e1b2.js"><link rel="prefetch" href="/assets/js/147.56419b8e.js"><link rel="prefetch" href="/assets/js/148.03d2b50f.js"><link rel="prefetch" href="/assets/js/149.c1331b6d.js"><link rel="prefetch" href="/assets/js/15.f198e5b9.js"><link rel="prefetch" href="/assets/js/16.00e51c93.js"><link rel="prefetch" href="/assets/js/17.291d3ebc.js"><link rel="prefetch" href="/assets/js/18.017a098e.js"><link rel="prefetch" href="/assets/js/19.61ae84a4.js"><link rel="prefetch" href="/assets/js/20.2fed9841.js"><link rel="prefetch" href="/assets/js/21.0540e3f5.js"><link rel="prefetch" href="/assets/js/22.65f1eb05.js"><link rel="prefetch" href="/assets/js/23.fd9e2f2e.js"><link rel="prefetch" href="/assets/js/24.199ad75b.js"><link rel="prefetch" href="/assets/js/25.005a23bb.js"><link rel="prefetch" href="/assets/js/26.46587fdd.js"><link rel="prefetch" href="/assets/js/27.eaf61373.js"><link rel="prefetch" href="/assets/js/28.12bcc1aa.js"><link rel="prefetch" href="/assets/js/29.2ee78c15.js"><link rel="prefetch" href="/assets/js/3.aae4de15.js"><link rel="prefetch" href="/assets/js/30.5a13fad2.js"><link rel="prefetch" href="/assets/js/31.d559ae93.js"><link rel="prefetch" href="/assets/js/32.d5a38545.js"><link rel="prefetch" href="/assets/js/33.484dfc49.js"><link rel="prefetch" href="/assets/js/34.1a006a06.js"><link rel="prefetch" href="/assets/js/35.12b84d1e.js"><link rel="prefetch" href="/assets/js/36.b2cd4408.js"><link rel="prefetch" href="/assets/js/37.a5859cb8.js"><link rel="prefetch" href="/assets/js/38.96209f1d.js"><link rel="prefetch" href="/assets/js/39.71d70a82.js"><link rel="prefetch" href="/assets/js/4.0e4cf147.js"><link rel="prefetch" href="/assets/js/40.a59b859c.js"><link rel="prefetch" href="/assets/js/41.ebb72a6a.js"><link rel="prefetch" href="/assets/js/42.71f99aa2.js"><link rel="prefetch" href="/assets/js/43.092ff2c9.js"><link rel="prefetch" href="/assets/js/44.d70e216f.js"><link rel="prefetch" href="/assets/js/45.afb733d1.js"><link rel="prefetch" href="/assets/js/46.86c421f9.js"><link rel="prefetch" href="/assets/js/47.6d337ef6.js"><link rel="prefetch" href="/assets/js/48.157e1f1c.js"><link rel="prefetch" href="/assets/js/49.1aed4add.js"><link rel="prefetch" href="/assets/js/5.831f36ca.js"><link rel="prefetch" href="/assets/js/50.b495cbac.js"><link rel="prefetch" href="/assets/js/51.f4a8b763.js"><link rel="prefetch" href="/assets/js/52.beec293d.js"><link rel="prefetch" href="/assets/js/53.2ac4d785.js"><link rel="prefetch" href="/assets/js/54.342112cf.js"><link rel="prefetch" href="/assets/js/55.61e2bfb6.js"><link rel="prefetch" href="/assets/js/56.fa782548.js"><link rel="prefetch" href="/assets/js/57.41bc249e.js"><link rel="prefetch" href="/assets/js/58.c1d5fafb.js"><link rel="prefetch" href="/assets/js/59.4297a34f.js"><link rel="prefetch" href="/assets/js/6.54e4e793.js"><link rel="prefetch" href="/assets/js/60.634948c3.js"><link rel="prefetch" href="/assets/js/61.de4327e7.js"><link rel="prefetch" href="/assets/js/62.c6902476.js"><link rel="prefetch" href="/assets/js/63.737a0e11.js"><link rel="prefetch" href="/assets/js/64.cbe1b041.js"><link rel="prefetch" href="/assets/js/65.2df8f108.js"><link rel="prefetch" href="/assets/js/66.ee7de747.js"><link rel="prefetch" href="/assets/js/67.88edee59.js"><link rel="prefetch" href="/assets/js/68.c29f5efe.js"><link rel="prefetch" href="/assets/js/69.2fedc1f9.js"><link rel="prefetch" href="/assets/js/70.0fe4782b.js"><link rel="prefetch" href="/assets/js/71.6c22c273.js"><link rel="prefetch" href="/assets/js/72.1fc7ddbd.js"><link rel="prefetch" href="/assets/js/73.25cb42eb.js"><link rel="prefetch" href="/assets/js/74.e922e1cc.js"><link rel="prefetch" href="/assets/js/75.f48393b6.js"><link rel="prefetch" href="/assets/js/76.72e96818.js"><link rel="prefetch" href="/assets/js/77.3df4edcb.js"><link rel="prefetch" href="/assets/js/78.73c6a652.js"><link rel="prefetch" href="/assets/js/79.22ba589c.js"><link rel="prefetch" href="/assets/js/8.b5f907d4.js"><link rel="prefetch" href="/assets/js/80.2d070db4.js"><link rel="prefetch" href="/assets/js/81.c0bc2539.js"><link rel="prefetch" href="/assets/js/82.4c6a47fa.js"><link rel="prefetch" href="/assets/js/83.a43f597f.js"><link rel="prefetch" href="/assets/js/84.8ce525d0.js"><link rel="prefetch" href="/assets/js/85.6b21aae0.js"><link rel="prefetch" href="/assets/js/86.f6ebabd9.js"><link rel="prefetch" href="/assets/js/87.9acaeb0d.js"><link rel="prefetch" href="/assets/js/88.99cdf592.js"><link rel="prefetch" href="/assets/js/89.58f63450.js"><link rel="prefetch" href="/assets/js/9.053d267f.js"><link rel="prefetch" href="/assets/js/90.1d59f40c.js"><link rel="prefetch" href="/assets/js/91.e8b2a5cd.js"><link rel="prefetch" href="/assets/js/92.b92bba74.js"><link rel="prefetch" href="/assets/js/93.688cad95.js"><link rel="prefetch" href="/assets/js/94.2c11a588.js"><link rel="prefetch" href="/assets/js/95.aa37d1df.js"><link rel="prefetch" href="/assets/js/96.fffa0e6e.js"><link rel="prefetch" href="/assets/js/97.04e9be9f.js"><link rel="prefetch" href="/assets/js/98.2672abca.js"><link rel="prefetch" href="/assets/js/99.c8de1c63.js">
    <link rel="stylesheet" href="/assets/css/0.styles.03260d1f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/EB-logo.png" alt="conanan's blog" class="logo"> <span class="site-name can-hide">conanan's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><a href="/about/" class="nav-link">å…³äº</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/pages/4b56bd/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/4b56bd/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/pages/724936/" class="nav-link">Java Web</a></li><li class="dropdown-item"><h4>å·¥å…·</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b18d09/" class="nav-link">Maven</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DataBase" class="dropdown-title"><a href="/pages/74cdda/" class="link-title">DataBase</a> <span class="title" style="display:none;">DataBase</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/74cdda/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/pages/4e9f47/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool" class="dropdown-title"><a href="/pages/89d1e7/" class="link-title">Tool</a> <span class="title" style="display:none;">Tool</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/89d1e7/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Vim</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d5fb/" class="nav-link">Docker</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/xugaoyi/image_store/blog/20200103123203.jpg"> <div class="blogger-info"><h3>Evan Xu</h3> <span>å‰ç«¯ç•Œçš„å°å­¦ç”Ÿ</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><a href="/about/" class="nav-link">å…³äº</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/pages/4b56bd/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/4b56bd/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/pages/724936/" class="nav-link">Java Web</a></li><li class="dropdown-item"><h4>å·¥å…·</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b18d09/" class="nav-link">Maven</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DataBase" class="dropdown-title"><a href="/pages/74cdda/" class="link-title">DataBase</a> <span class="title" style="display:none;">DataBase</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/74cdda/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/pages/4e9f47/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool" class="dropdown-title"><a href="/pages/89d1e7/" class="link-title">Tool</a> <span class="title" style="display:none;">Tool</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/89d1e7/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Vim</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d5fb/" class="nav-link">Docker</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>åŸºç¡€</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>API</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Container</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>å¤šçº¿ç¨‹</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/9fcc8d/" class="sidebar-link">åŸºæœ¬æ¦‚å¿µ</a></li><li><a href="/pages/59919e/" class="sidebar-link">åŸºæœ¬ä½¿ç”¨</a></li><li><a href="/pages/7fcc72/" class="sidebar-link">çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ</a></li><li><a href="/pages/72c98e/" aria-current="page" class="active sidebar-link">å…±äº«æ¨¡å‹â€”ç®¡ç¨‹ï¼ˆæ‚²è§‚é”ï¼Œé˜»å¡ï¼‰</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/72c98e/#å…±äº«å¸¦æ¥çš„çº¿ç¨‹å®‰å…¨é—®é¢˜" class="sidebar-link">å…±äº«å¸¦æ¥çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/72c98e/#å–ç¥¨é—®é¢˜" class="sidebar-link">å–ç¥¨é—®é¢˜</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#è‡ªå¢è‡ªå‡é—®é¢˜" class="sidebar-link">è‡ªå¢è‡ªå‡é—®é¢˜</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#é—®é¢˜åˆ†æ" class="sidebar-link">é—®é¢˜åˆ†æ</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#çº¿ç¨‹å®‰å…¨é—®é¢˜æ€»ç»“-ğŸ”¥" class="sidebar-link">çº¿ç¨‹å®‰å…¨é—®é¢˜æ€»ç»“ ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#ä¸´ç•ŒåŒº-critical-section" class="sidebar-link">ä¸´ç•ŒåŒº Critical Section</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#ç«æ€æ¡ä»¶-race-condition" class="sidebar-link">ç«æ€æ¡ä»¶ Race Condition</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#è§£å†³æ–¹æ¡ˆæ€»è§ˆ-ğŸ”¥" class="sidebar-link">è§£å†³æ–¹æ¡ˆæ€»è§ˆ ğŸ”¥</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#synchronized-å…³é”®å­—-ğŸ”¥" class="sidebar-link">synchronized å…³é”®å­— ğŸ”¥</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/72c98e/#ä»‹ç»" class="sidebar-link">ä»‹ç»</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#è¯­æ³•1-åŒæ­¥ä»£ç å—" class="sidebar-link">è¯­æ³•1â€”åŒæ­¥ä»£ç å—</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#å–ç¥¨é—®é¢˜è§£å†³" class="sidebar-link">å–ç¥¨é—®é¢˜è§£å†³</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#è‡ªå¢è‡ªå‡é—®é¢˜è§£å†³" class="sidebar-link">è‡ªå¢è‡ªå‡é—®é¢˜è§£å†³</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#åŸç†-ğŸ”¥" class="sidebar-link">åŸç† ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#æ€è€ƒ" class="sidebar-link">æ€è€ƒ</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#è‡ªå¢è‡ªå‡é¢å‘å¯¹è±¡æ”¹è¿›" class="sidebar-link">è‡ªå¢è‡ªå‡é¢å‘å¯¹è±¡æ”¹è¿›</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#è¯­æ³•2-åŒæ­¥æ–¹æ³•-é”å¯¹è±¡-ğŸ”¥" class="sidebar-link">è¯­æ³•2â€”åŒæ­¥æ–¹æ³• &amp; é”å¯¹è±¡ ğŸ”¥</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#çº¿ç¨‹å…«é”-ğŸ”¥" class="sidebar-link">&quot;çº¿ç¨‹å…«é”&quot; ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ-ğŸ”¥" class="sidebar-link">å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ ğŸ”¥</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/72c98e/#æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ" class="sidebar-link">æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ" class="sidebar-link">å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#åˆ†æ-æˆå‘˜å˜é‡-list-add-Ã—-ğŸ”¥" class="sidebar-link">åˆ†æâ€”æˆå‘˜å˜é‡â€”List#add Ã— ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#åˆ†æ-å±€éƒ¨æ™®é€šå˜é‡-âœ“" class="sidebar-link">åˆ†æâ€”å±€éƒ¨æ™®é€šå˜é‡ âœ“</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#åˆ†æ-å±€éƒ¨å˜é‡ä¸ºå¼•ç”¨å¯¹è±¡-âœ“" class="sidebar-link">åˆ†æâ€”å±€éƒ¨å˜é‡ä¸ºå¼•ç”¨å¯¹è±¡ âœ“</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#åˆ†æ-å±€éƒ¨å˜é‡ä¸ºå¼•ç”¨å¯¹è±¡å¹¶æš´éœ²-Ã—" class="sidebar-link">åˆ†æâ€”å±€éƒ¨å˜é‡ä¸ºå¼•ç”¨å¯¹è±¡å¹¶æš´éœ² Ã—</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#å¸¸è§çº¿ç¨‹å®‰å…¨ç±»-åŒæ­¥é”" class="sidebar-link">å¸¸è§çº¿ç¨‹å®‰å…¨ç±»â€”åŒæ­¥é”</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#å¸¸è§çº¿ç¨‹å®‰å…¨ç±»-ä¸å¯å˜ç±»" class="sidebar-link">å¸¸è§çº¿ç¨‹å®‰å…¨ç±»â€”ä¸å¯å˜ç±»</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#å®ä¾‹åˆ†æ-ğŸ”¥" class="sidebar-link">å®ä¾‹åˆ†æ ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#ä¹ é¢˜1-å–ç¥¨ç»ƒä¹ -ğŸ”¥" class="sidebar-link">ä¹ é¢˜1â€”å–ç¥¨ç»ƒä¹  ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#ä¹ é¢˜2-è½¬è´¦-ğŸ”¥" class="sidebar-link">ä¹ é¢˜2â€”è½¬è´¦ ğŸ”¥</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#çº¿ç¨‹é—´é€šä¿¡-waitã€notify-ç­‰å¾…å”¤é†’æœºåˆ¶-ğŸ”¥" class="sidebar-link">çº¿ç¨‹é—´é€šä¿¡â€”waitã€notify ç­‰å¾…å”¤é†’æœºåˆ¶ ğŸ”¥</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/72c98e/#çº¿ç¨‹é—´é€šä¿¡-ğŸ”¥" class="sidebar-link">çº¿ç¨‹é—´é€šä¿¡ ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#å°æ•…äº‹" class="sidebar-link">å°æ•…äº‹</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#åŸç†å›¾è§£-ğŸ”¥" class="sidebar-link">åŸç†å›¾è§£ ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#æ–¹æ³•-ğŸ”¥" class="sidebar-link">æ–¹æ³• ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#sleep-ä¸-wait-åŒºåˆ«-ğŸ”¥" class="sidebar-link">sleep ä¸ wait åŒºåˆ« ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#æ­£ç¡®ä½¿ç”¨-waitã€notify-æ­¥éª¤-ğŸ”¥" class="sidebar-link">æ­£ç¡®ä½¿ç”¨ waitã€notify æ­¥éª¤ ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#è®¾è®¡æ¨¡å¼-ä¿æŠ¤æ€§æš‚åœ-ğŸ”¥" class="sidebar-link">è®¾è®¡æ¨¡å¼â€”ä¿æŠ¤æ€§æš‚åœ ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#join-åŸç†-æºç " class="sidebar-link">join åŸç†â€”æºç </a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#è®¾è®¡æ¨¡å¼-ç”Ÿäº§è€…æ¶ˆè´¹è€…-ğŸ”¥" class="sidebar-link">è®¾è®¡æ¨¡å¼â€”ç”Ÿäº§è€…æ¶ˆè´¹è€… ğŸ”¥</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#parkã€unpark-ğŸ”¥" class="sidebar-link">parkã€unpark ğŸ”¥</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/72c98e/#åŸºæœ¬ä½¿ç”¨" class="sidebar-link">åŸºæœ¬ä½¿ç”¨</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#ç‰¹ç‚¹-ğŸ”¥" class="sidebar-link">ç‰¹ç‚¹ ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#åº•å±‚åŸç†-ğŸ”¥" class="sidebar-link">åº•å±‚åŸç† ğŸ”¥</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#å¤šæŠŠé”-é”ç²’åº¦-ğŸ”¥" class="sidebar-link">å¤šæŠŠé”â€”é”ç²’åº¦ ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#çº¿ç¨‹æ´»è·ƒæ€§-ğŸ”¥" class="sidebar-link">çº¿ç¨‹æ´»è·ƒæ€§ ğŸ”¥</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/72c98e/#æ­»é”-ğŸ”¥" class="sidebar-link">æ­»é” ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#å®šä½æ­»é”-jps-jstack-sconsole-ğŸ”¥" class="sidebar-link">å®šä½æ­»é”â€”jps jstack sconsole ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#å“²å­¦å®¶å°±é¤é—®é¢˜-ğŸ”¥" class="sidebar-link">å“²å­¦å®¶å°±é¤é—®é¢˜ ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#æ´»é”-ğŸ”¥" class="sidebar-link">æ´»é” ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#é¥¥é¥¿-reentrantlockè§£å†³-ğŸ”¥" class="sidebar-link">é¥¥é¥¿â€”reentrantlockè§£å†³ ğŸ”¥</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#reentrantlock-ğŸ”¥" class="sidebar-link">ReentrantLock ğŸ”¥</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/72c98e/#å¯é‡å…¥" class="sidebar-link">å¯é‡å…¥</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#_7-4-çº¿ç¨‹å®‰å…¨å’ŒåŒæ­¥" class="sidebar-link">7.4 çº¿ç¨‹å®‰å…¨å’ŒåŒæ­¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#ä¹ é¢˜" class="sidebar-link">ä¹ é¢˜</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/72c98e/#å®ç°-runnable-æ¥å£çš„å¥½å¤„-ğŸ”¥" class="sidebar-link">å®ç° Runnable æ¥å£çš„å¥½å¤„ ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#run-å’Œstart-çš„åŒºåˆ«-ğŸ”¥" class="sidebar-link">run()å’Œstart()çš„åŒºåˆ« ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#synchronized-å’Œ-lock-åŒºåˆ«" class="sidebar-link">synchronized å’Œ Lock åŒºåˆ«</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#sleep-å’Œ-wait-å¼‚åŒ" class="sidebar-link">sleep å’Œ wait å¼‚åŒ</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#_2-ä¸ªçº¿ç¨‹å‘è´¦æˆ·å­˜é’±å¹¶æ‰“å°" class="sidebar-link">2 ä¸ªçº¿ç¨‹å‘è´¦æˆ·å­˜é’±å¹¶æ‰“å°</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#_2-ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°-1-100" class="sidebar-link">2 ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å° 1-100</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜" class="sidebar-link">ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜</a></li><li class="sidebar-sub-header"><a href="/pages/72c98e/#åˆ›å»ºå¤šçº¿ç¨‹çš„-4-ç§æ–¹å¼" class="sidebar-link">åˆ›å»ºå¤šçº¿ç¨‹çš„ 4 ç§æ–¹å¼</a></li></ul></li></ul></li><li><a href="/pages/55e20e/" class="sidebar-link">Monitor &amp; synchronized åŸç†</a></li><li><a href="/pages/77cbbe/" class="sidebar-link">åº”ç”¨</a></li><li><a href="/pages/89dd04/" class="sidebar-link">è®¾è®¡æ¨¡å¼</a></li><li><a href="/pages/379419/" class="sidebar-link">8 IO</a></li><li><a href="/pages/ade7aa/" class="sidebar-link">9 NIO</a></li><li><a href="/pages/8fb7c9/" class="sidebar-link">10 AIO</a></li><li><a href="/pages/8e9c4f/" class="sidebar-link">11 Network</a></li><li><a href="/pages/34ffff/" class="sidebar-link">2 Object Orientation-4 æ³¨è§£</a></li><li><a href="/pages/2a2bbe/" class="sidebar-link">12 Reflect</a></li></ul></section></li><li><a href="/pages/da9985/" class="sidebar-link">16 9,10,11æ–°ç‰¹æ€§</a></li><li><a href="/pages/0ebf0c/" class="sidebar-link">17 Test</a></li><li><a href="/pages/0608c1/" class="sidebar-link">18 è®¾è®¡åŸåˆ™&amp;è®¾è®¡æ¨¡å¼</a></li><li><a href="/pages/1a8e91/" class="sidebar-link">JDBC</a></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- æ­£æ–¹å½¢ -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/categories/?category=Java" title="åˆ†ç±»" data-v-1cd794fe>Java</a></li> <li data-v-1cd794fe><a href="/categories/?category=%E5%A4%9A%E7%BA%BF%E7%A8%8B" title="åˆ†ç±»" data-v-1cd794fe>å¤šçº¿ç¨‹</a></li> <!----></ul> <div class="info" data-v-1cd794fe><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/apple54whn" target="_blank" title="ä½œè€…" class="beLink" data-v-1cd794fe>conanan</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2021-02-16</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          å…±äº«æ¨¡å‹â€”ç®¡ç¨‹ï¼ˆæ‚²è§‚é”ï¼Œé˜»å¡ï¼‰
        </h1> <div class="page-slot page-slot-top"><!-- å›ºå®š100% * 90pxå¯æ˜¾ç¤ºï¼Œmax-height:90pxæœªè§æ˜¾ç¤º-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h1 id="å¤šçº¿ç¨‹-å…±äº«æ¨¡å‹-ç®¡ç¨‹ï¼ˆæ‚²è§‚é”ï¼Œé˜»å¡ï¼‰"><a href="#å¤šçº¿ç¨‹-å…±äº«æ¨¡å‹-ç®¡ç¨‹ï¼ˆæ‚²è§‚é”ï¼Œé˜»å¡ï¼‰" class="header-anchor">#</a> å¤šçº¿ç¨‹â€”å…±äº«æ¨¡å‹â€”ç®¡ç¨‹ï¼ˆæ‚²è§‚é”ï¼Œé˜»å¡ï¼‰</h1> <h2 id="å…±äº«å¸¦æ¥çš„çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#å…±äº«å¸¦æ¥çš„çº¿ç¨‹å®‰å…¨é—®é¢˜" class="header-anchor">#</a> å…±äº«å¸¦æ¥çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</h2> <p>åœ¨ Java ä¸­çš„ä½“ç°</p> <h3 id="å–ç¥¨é—®é¢˜"><a href="#å–ç¥¨é—®é¢˜" class="header-anchor">#</a> å–ç¥¨é—®é¢˜</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;TestSafe&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestSafe</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

        <span class="token class-name">Runnable</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ticket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token string">&quot;çª—å£1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token string">&quot;çª—å£2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token string">&quot;çª—å£3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token string">&quot;çª—å£4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t4<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;Ticket&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Ticket</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">1_000</span><span class="token punctuation">;</span><span class="token comment">// çº¿ç¨‹ç«äº‰ä¸æ˜æ˜¾å¯ä»¥å¢å¤§ç¥¨æ•°</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;{}è¯´: ç¥¨å·²ç»å–å®Œäº†&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// è¿›å…¥time waitingï¼Œæé«˜çº¿ç¨‹åˆ‡æ¢æ¦‚ç‡ï¼Œé”™ç¥¨å‡ ç‡</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;{}å–äº†ç¬¬{}å¼ ç¥¨&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> count<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>é—®é¢˜ï¼š</p> <ul><li>ç›¸åŒçš„ç¥¨å‡ºç°å¤šæ¬¡ï¼šCPU çš„ä¸€æ¬¡æ“ä½œå¿…é¡»æ˜¯åŸå­æ€§çš„ï¼ˆä½†æ˜¯è¾“å‡ºè¯­å¥ä¸æ˜¯åŸå­çš„ï¼‰</li> <li>å‡ºç°è´Ÿæ•°çš„ç¥¨ï¼šéšæœºæ€§å’Œå»¶è¿Ÿå¯¼è‡´</li></ul> <h3 id="è‡ªå¢è‡ªå‡é—®é¢˜"><a href="#è‡ªå¢è‡ªå‡é—®é¢˜" class="header-anchor">#</a> è‡ªå¢è‡ªå‡é—®é¢˜</h3> <p>ä¸¤ä¸ªçº¿ç¨‹å¯¹åˆå§‹å€¼ä¸º 0 çš„**é™æ€å˜é‡ï¼ˆå±€éƒ¨å˜é‡å°±ä¸ä¸€æ ·äº†ï¼‰**ä¸€ä¸ªåšè‡ªå¢ï¼Œä¸€ä¸ªåšè‡ªå‡ï¼Œå„åš 5000 æ¬¡ï¼Œç»“æœæ˜¯ 0 å—ï¼Ÿ</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;TestCount&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestCount</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5_000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                counter<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5_000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                counter<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="header-anchor">#</a> é—®é¢˜åˆ†æ</h3> <p>ä»¥ä¸Šçš„ç»“æœå¯èƒ½æ˜¯æ­£æ•°ã€è´Ÿæ•°ã€é›¶ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸º Java ä¸­å¯¹**é™æ€å˜é‡ï¼ˆå±€éƒ¨å˜é‡å°±ä¸ä¸€æ ·äº†ï¼‰**çš„è‡ªå¢ï¼Œè‡ªå‡å¹¶ä¸æ˜¯åŸå­æ“ä½œï¼Œè¦å½»åº•ç†è§£ï¼Œå¿…é¡»ä»å­—èŠ‚ç æ¥è¿›è¡Œåˆ†æã€‚ä¾‹å¦‚å¯¹äº i++ è€Œè¨€ï¼ˆi ä¸ºé™æ€å˜é‡ï¼‰ï¼Œå®é™…ä¼šäº§ç”Ÿå¦‚ä¸‹çš„ JVM å­—èŠ‚ç æŒ‡ä»¤ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>getstatic i // è·å–é™æ€å˜é‡içš„å€¼
iconst_1 // å‡†å¤‡å¸¸é‡1
iadd // è‡ªå¢
putstatic i // å°†ä¿®æ”¹åçš„å€¼å­˜å…¥é™æ€å˜é‡i
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>è€Œå¯¹åº” i-- ä¹Ÿæ˜¯ç±»ä¼¼ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>getstatic i // è·å–é™æ€å˜é‡içš„å€¼
iconst_1 // å‡†å¤‡å¸¸é‡1
isub // è‡ªå‡
putstatic i // å°†ä¿®æ”¹åçš„å€¼å­˜å…¥é™æ€å˜é‡i
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>è€Œ Java çš„å†…å­˜æ¨¡å‹å¦‚ä¸‹ï¼Œå®Œæˆé™æ€å˜é‡çš„è‡ªå¢ï¼Œè‡ªå‡éœ€è¦<strong>åœ¨ä¸»å­˜å’Œå·¥ä½œå†…å­˜ä¸­è¿›è¡Œæ•°æ®äº¤æ¢</strong>ï¼š</p> <p><img src="/assets/img/image-20210216174313171.9c1db3a9.png" alt="image-20210216174313171"></p> <p>å¦‚æœæ˜¯å•çº¿ç¨‹ä»¥ä¸Š 8 è¡Œä»£ç æ˜¯é¡ºåºæ‰§è¡Œï¼ˆä¸ä¼šäº¤é”™ï¼‰æ²¡æœ‰é—®é¢˜ï¼š</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>ä½†å¤šçº¿ç¨‹ä¸‹è¿™ 8 è¡Œä»£ç å¯èƒ½<strong>äº¤é”™è¿è¡Œ</strong></p> <p>ä¼šå‡ºç°è´Ÿæ•°çš„æƒ…å†µï¼š</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>å‡ºç°æ­£æ•°çš„æƒ…å†µï¼š</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><h3 id="çº¿ç¨‹å®‰å…¨é—®é¢˜æ€»ç»“-ğŸ”¥"><a href="#çº¿ç¨‹å®‰å…¨é—®é¢˜æ€»ç»“-ğŸ”¥" class="header-anchor">#</a> çº¿ç¨‹å®‰å…¨é—®é¢˜æ€»ç»“ ğŸ”¥</h3> <p>åˆ†æ—¶ç³»ç»Ÿï¼Œçº¿ç¨‹åˆ‡æ¢æ—¶ï¼Œå¯¹ä¸´ç•ŒåŒºæ•°æ®è¯»å†™çš„éåŸå­æ€§ï¼Œä»¥åŠç¼“å­˜å¯¼è‡´æœ€ç»ˆå¯èƒ½å‘ç”Ÿ<strong>çº¿ç¨‹å®‰å…¨é—®é¢˜</strong>ã€‚å‡ºç°è¯¥é—®é¢˜çš„åŸå› ï¼š</p> <ul><li><p><strong>å¤šä¸ªçº¿ç¨‹åœ¨æ“ä½œå…±äº«èµ„æº</strong></p></li> <li><p><strong>æ“ä½œå…±äº«èµ„æºçš„ä»£ç æœ‰å¤šæ¡ï¼ˆå¯èƒ½æ˜¯éåŸå­æ“ä½œï¼‰</strong></p> <p>å³å½“ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œæ“ä½œå…±äº«èµ„æºçš„å¤šæ¡ä»£ç ï¼ˆå¯èƒ½æ˜¯éåŸå­æ“ä½œï¼‰è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–çº¿ç¨‹å‚ä¸äº†è¿ç®—ï¼Œå°±ä¼šå¯¼è‡´</p> <p>OSçš„åˆ†æ—¶æ“ä½œï¼Œçº¿ç¨‹åˆ‡æ¢ï¼Œç¼“å­˜</p></li></ul> <h3 id="ä¸´ç•ŒåŒº-critical-section"><a href="#ä¸´ç•ŒåŒº-critical-section" class="header-anchor">#</a> ä¸´ç•ŒåŒº Critical Section</h3> <ul><li><p>ä¸€ä¸ªç¨‹åºè¿è¡Œå¤šä¸ªçº¿ç¨‹æœ¬èº«æ˜¯æ²¡æœ‰é—®é¢˜çš„</p></li> <li><p>é—®é¢˜å‡ºåœ¨å¤šä¸ªçº¿ç¨‹è®¿é—®<strong>å…±äº«èµ„æº</strong></p> <ul><li><p>å¤šä¸ªçº¿ç¨‹è¯»<strong>å…±äº«èµ„æº</strong>å…¶å®ä¹Ÿæ²¡æœ‰é—®é¢˜</p></li> <li><p>åœ¨å¤šä¸ªçº¿ç¨‹å¯¹<strong>å…±äº«èµ„æº</strong>è¯»å†™æ“ä½œæ—¶å‘ç”ŸæŒ‡ä»¤äº¤é”™ï¼Œå°±ä¼šå‡ºç°é—®é¢˜</p></li></ul></li></ul> <p>ä¸´ç•ŒåŒº(critical section)æ˜¯æŒ‡è®¿é—®æŸä¸€å…±äº«èµ„æºçš„<strong>ä»£ç ç‰‡æ®µ</strong>ï¼Œå¹¶ä¸”è¿™æ®µä»£ç çš„æ‰§è¡Œ<strong>åº”ä¸ºåŸå­(atomic) æ“ä½œ</strong>ï¼Œ<strong>å³ä¸´ç•ŒåŒºå†…çš„ä»£ç å¿…é¡»å¯¹å¤–æ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œä¸ä¼šè¢«çº¿ç¨‹åˆ‡æ¢æ‰€æ‰“æ–­</strong></p> <p>ä¾‹å¦‚ï¼Œä¸‹é¢ä»£ç ä¸­çš„ä¸´ç•ŒåŒºï¼ˆå¿…é¡»æœ‰synchronizedï¼Œå¦åˆ™æ— æ³•ä¿è¯ä¸´ç•ŒåŒºä»£ç çš„åŸå­æ“ä½œï¼‰</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">// ä¸´ç•ŒåŒº</span>
    counter<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
<span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">// ä¸´ç•ŒåŒº</span>
    counter<span class="token operator">--</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="ç«æ€æ¡ä»¶-race-condition"><a href="#ç«æ€æ¡ä»¶-race-condition" class="header-anchor">#</a> ç«æ€æ¡ä»¶ Race Condition</h3> <p>ç«äº‰æ¡ä»¶æ˜¯æŒ‡å¤šä¸ªä»»åŠ¡ä»¥<strong>éäº’æ–¥</strong>çš„æ–¹å¼åŒæ—¶è¿›å…¥ä¸´ç•ŒåŒºï¼Œå¤§å®¶å¯¹å…¬å…±èµ„æºçš„è®¿é—®æ˜¯ä»¥ç«äº‰çš„æ–¹å¼å¹¶è¡Œè¿›è¡Œçš„ï¼Œå› æ­¤å…¬å…±èµ„æºçš„æœ€ç»ˆçŠ¶æ€ä¾èµ–äºè¿™äº›ä»»åŠ¡çš„ä¸´ç•ŒåŒºä¸­çš„å¾®æ“ä½œ<strong>æ‰§è¡Œæ¬¡åº</strong>ã€‚</p> <p>å¤šä¸ªçº¿ç¨‹åœ¨ä¸´ç•ŒåŒºå†…æ‰§è¡Œï¼Œç”±äºä»£ç çš„<strong>æ‰§è¡Œåºåˆ—ä¸åŒ</strong>è€Œå¯¼è‡´ç»“æœæ— æ³•é¢„æµ‹ï¼Œç§°ä¹‹ä¸ºå‘ç”Ÿäº†<strong>ç«æ€æ¡ä»¶</strong></p> <h3 id="è§£å†³æ–¹æ¡ˆæ€»è§ˆ-ğŸ”¥"><a href="#è§£å†³æ–¹æ¡ˆæ€»è§ˆ-ğŸ”¥" class="header-anchor">#</a> è§£å†³æ–¹æ¡ˆæ€»è§ˆ ğŸ”¥</h3> <p>ä¸ºäº†<strong>é¿å…ä¸´ç•ŒåŒºçš„ç«æ€æ¡ä»¶å‘ç”Ÿ</strong>ï¼Œæœ‰å¤šç§æ‰‹æ®µå¯ä»¥è¾¾åˆ°ç›®çš„ã€‚</p> <ul><li><p><strong>é˜»å¡å¼</strong>çš„è§£å†³æ–¹æ¡ˆï¼š</p> <ul><li>åŒæ­¥é”æœºåˆ¶ï¼š<strong>synchronized</strong>ï¼ˆåŒæ­¥ä»£ç å—ã€åŒæ­¥æ–¹æ³•ï¼‰</li> <li>Locké”æœºåˆ¶ï¼š<strong>Lock</strong>ï¼ˆJUCä¸­ä»‹ç»ï¼‰</li></ul></li> <li><p><strong>éé˜»å¡å¼</strong>çš„è§£å†³æ–¹æ¡ˆ</p> <ul><li><strong>åŸå­å˜é‡</strong>ï¼ˆAutomicï¼‰</li></ul></li></ul> <h2 id="synchronized-å…³é”®å­—-ğŸ”¥"><a href="#synchronized-å…³é”®å­—-ğŸ”¥" class="header-anchor">#</a> synchronized å…³é”®å­— ğŸ”¥</h2> <h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="header-anchor">#</a> ä»‹ç»</h3> <p><code>synchronized</code>å…³é”®å­—å¯ä»¥ç”¨äº<strong>æ–¹æ³•ä¸­çš„æŸä¸ªåŒºå—ä¸­</strong>ï¼Œè¡¨ç¤ºåªå¯¹è¿™ä¸ªåŒºå—çš„<strong>èµ„æºå®è¡Œäº’æ–¥è®¿é—®</strong>ã€‚è®©åŒä¸€æ—¶åˆ»è‡³å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰ã€åŒæ­¥é”/å¯¹è±¡é”/å¯¹è±¡ç›‘è§†å™¨ã€‘ï¼Œå…¶å®ƒçº¿ç¨‹å†æƒ³è·å–è¿™ä¸ªã€åŒæ­¥é”/å¯¹è±¡é”/å¯¹è±¡ç›‘è§†å™¨ã€‘æ—¶å°±ä¼š<strong>é˜»å¡</strong>ä½ã€‚è¿™æ ·å°±èƒ½ä¿è¯æ‹¥æœ‰é”çš„çº¿ç¨‹å¯ä»¥å®‰å…¨çš„æ‰§è¡Œä¸´ç•ŒåŒºå†…çš„ä»£ç ï¼Œä¸ç”¨æ‹…å¿ƒçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</p> <p><strong>æ³¨æ„</strong>ï¼Œè™½ç„¶ java ä¸­äº’æ–¥å’ŒåŒæ­¥éƒ½å¯ä»¥é‡‡ç”¨ synchronized å…³é”®å­—æ¥å®Œæˆï¼Œä½†å®ƒä»¬è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼š</p> <ul><li><p><strong>äº’æ–¥</strong>æ˜¯ä¿è¯ä¸´ç•ŒåŒºçš„ç«æ€æ¡ä»¶å‘ç”Ÿï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸´ç•ŒåŒºä»£ç </p></li> <li><p><strong>åŒæ­¥</strong>æ˜¯ç”±äºçº¿ç¨‹æ‰§è¡Œçš„å…ˆåã€é¡ºåºä¸åŒã€éœ€è¦ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å…¶å®ƒçº¿ç¨‹è¿è¡Œåˆ°æŸä¸ªç‚¹</p></li></ul> <p><strong>synchronized çš„ä¼˜ç¼ºç‚¹ï¼š</strong></p> <ul><li><strong>å¥½å¤„</strong>ï¼šè§£å†³çº¿ç¨‹çš„å®‰å…¨é—®é¢˜ï¼ˆäº’æ–¥ï¼‰</li> <li><strong>å¼Šç«¯</strong>ï¼šç›¸å¯¹<strong>é™ä½æ•ˆç‡</strong>ï¼ˆåŒæ­¥ï¼‰ï¼Œå› ä¸ºåŒæ­¥å¤–çš„çº¿ç¨‹éƒ½ä¼šåˆ¤æ–­åŒæ­¥é”ï¼›è‹¥æœ‰<strong>åŒæ­¥åµŒå¥—å®¹æ˜“äº§ç”Ÿæ­»é”</strong></li></ul> <p><strong>åŒæ­¥é”/å¯¹è±¡é”/å¯¹è±¡ç›‘è§†å™¨</strong></p> <ul><li>é”å¯¹è±¡å¯ä»¥æ˜¯<strong>ä»»æ„ç±»å‹</strong></li> <li>å¤šä¸ªçº¿ç¨‹å¯¹è±¡è¦ä½¿ç”¨<strong>åŒä¸€æŠŠé”</strong></li></ul> <h3 id="è¯­æ³•1-åŒæ­¥ä»£ç å—"><a href="#è¯­æ³•1-åŒæ­¥ä»£ç å—" class="header-anchor">#</a> è¯­æ³•1â€”åŒæ­¥ä»£ç å—</h3> <p>é”çš„ç›®æ ‡æ˜¯å¯¹è±¡ï¼</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">synchronized</span><span class="token punctuation">(</span>å¯¹è±¡<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// çº¿ç¨‹1è¿›å…¥åï¼Œçº¿ç¨‹2åˆ°è¿™é‡Œå°±è¢« blocked</span>
    <span class="token comment">// ä¸´ç•ŒåŒº</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="å–ç¥¨é—®é¢˜è§£å†³"><a href="#å–ç¥¨é—®é¢˜è§£å†³" class="header-anchor">#</a> å–ç¥¨é—®é¢˜è§£å†³</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;SafeTicket&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">SafeTicket</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">1_000</span><span class="token punctuation">;</span><span class="token comment">// çº¿ç¨‹ç«äº‰ä¸æ˜æ˜¾å¯ä»¥å¢å¤§ç¥¨æ•°</span>

    <span class="token comment">// final Object lock = new Object();</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å–ç¥¨çª—å£ä¸€ç›´å¼€ç€ï¼Œä¸èƒ½åœ¨åŒæ­¥ä¸­ï¼Œå¦åˆ™å°±ä¼šè¢«ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œ</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// synchronized éœ€åœ¨å†…éƒ¨å†™ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹ä¼šè¿›ä¸å»ã€‚ç±»ä¼¼è¿›å…¥å•æ‰€ç„¶åé”é—¨ã€‚éœ€è¦åŒ…è£¹æ“ä½œå…±äº«èµ„æºçš„ä»£ç ã€‚</span>
            <span class="token comment">// è¿˜å¯ä»¥å†™ thisï¼ˆæ³¨æ„å”¯ä¸€æ€§ï¼‰ã€SafeTicket.classã€ä¸Šé¢çš„å¯¹è±¡ lock</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;{}è¯´: ç¥¨å·²ç»å–å®Œäº†&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">// è¿›å…¥time waitingï¼Œæé«˜çº¿ç¨‹åˆ‡æ¢æ¦‚ç‡ï¼Œé”™ç¥¨å‡ ç‡</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;{}å–äº†ç¬¬{}å¼ ç¥¨&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> count<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;TestSafe&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestSafe</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

        <span class="token class-name">Runnable</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ticket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token string">&quot;çª—å£1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token string">&quot;çª—å£2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token string">&quot;çª—å£3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token string">&quot;çª—å£4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t4<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h3 id="è‡ªå¢è‡ªå‡é—®é¢˜è§£å†³"><a href="#è‡ªå¢è‡ªå‡é—®é¢˜è§£å†³" class="header-anchor">#</a> è‡ªå¢è‡ªå‡é—®é¢˜è§£å†³</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;TestCount&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestCount</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> room <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// test1();</span>
        <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * åŒæ­¥ä»£ç å—
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5_000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    counter<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5_000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    counter<span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h3 id="åŸç†-ğŸ”¥"><a href="#åŸç†-ğŸ”¥" class="header-anchor">#</a> åŸç† ğŸ”¥</h3> <p>ç±»æ¯”ï¼š</p> <ul><li><p>synchronized(å¯¹è±¡) ä¸­çš„å¯¹è±¡ï¼Œå¯ä»¥æƒ³è±¡ä¸ºä¸€ä¸ªæˆ¿é—´ï¼ˆroomï¼‰ï¼Œæœ‰å”¯ä¸€å…¥å£ï¼ˆé—¨ï¼‰æˆ¿é—´åªèƒ½ä¸€æ¬¡è¿›å…¥ä¸€äººè¿›è¡Œè®¡ç®—ï¼Œçº¿ç¨‹ t1ï¼Œt2 æƒ³è±¡æˆä¸¤ä¸ªäºº</p></li> <li><p>å½“çº¿ç¨‹ t1 æ‰§è¡Œåˆ° synchronized(room) æ—¶å°±å¥½æ¯” t1 è¿›å…¥äº†è¿™ä¸ªæˆ¿é—´ï¼Œå¹¶é”ä½äº†é—¨æ‹¿èµ°äº†é’¥åŒ™ï¼Œåœ¨é—¨å†…æ‰§è¡Œcount++ ä»£ç </p></li> <li><p>è¿™æ—¶å€™å¦‚æœ t2 ä¹Ÿè¿è¡Œåˆ°äº† synchronized(room) æ—¶ï¼Œå®ƒå‘ç°é—¨è¢«é”ä½äº†ï¼Œåªèƒ½åœ¨é—¨å¤–ç­‰å¾…ï¼Œå‘ç”Ÿäº†ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œé˜»å¡ä½äº†</p></li> <li><p>è¿™ä¸­é—´<strong>å³ä½¿ t1 çš„ cpu æ—¶é—´ç‰‡ä¸å¹¸ç”¨å®Œï¼Œè¢«è¸¢å‡ºäº†é—¨å¤–</strong>ï¼ˆä¸è¦é”™è¯¯ç†è§£ä¸ºé”ä½äº†å¯¹è±¡å°±èƒ½ä¸€ç›´æ‰§è¡Œä¸‹å»å“¦ï¼‰ï¼Œè¿™æ—¶<strong>é—¨è¿˜æ˜¯é”ä½çš„ï¼Œt1 ä»æ‹¿ç€é’¥åŒ™ï¼Œt2 çº¿ç¨‹è¿˜åœ¨é˜»å¡çŠ¶æ€è¿›ä¸æ¥</strong>ï¼Œåªæœ‰<strong>ä¸‹æ¬¡è½®åˆ° t1 è‡ªå·±å†æ¬¡è·å¾—æ—¶é—´ç‰‡æ—¶æ‰èƒ½å¼€é—¨è¿›å…¥</strong></p></li> <li><p><strong>å½“ t1 æ‰§è¡Œå®Œ synchronized{} å—å†…çš„ä»£ç ï¼Œè¿™æ—¶å€™æ‰ä¼šä» obj æˆ¿é—´å‡ºæ¥å¹¶è§£å¼€é—¨ä¸Šçš„é”ï¼Œå”¤é†’ t2 çº¿ç¨‹æŠŠé’¥åŒ™ç»™ä»–</strong>ã€‚t2 çº¿ç¨‹è¿™æ—¶æ‰å¯ä»¥è¿›å…¥ obj æˆ¿é—´ï¼Œé”ä½äº†é—¨æ‹¿ä¸Šé’¥åŒ™ï¼Œæ‰§è¡Œå®ƒçš„ count-- ä»£ç </p></li></ul> <p>ç”¨å›¾è¡¨ç¤ºï¼š</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><h3 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="header-anchor">#</a> æ€è€ƒ</h3> <p>synchronized å®é™…æ˜¯ç”¨<strong>å¯¹è±¡é”</strong>ä¿è¯äº†<strong>ä¸´ç•ŒåŒºå†…ä»£ç çš„åŸå­æ€§ï¼ˆä¸´ç•ŒåŒºå†…çš„ä»£ç å¿…é¡»å¯¹å¤–æ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œä¸ä¼šè¢«çº¿ç¨‹åˆ‡æ¢æ‰€æ‰“æ–­ï¼‰</strong>ã€‚ä¸ºäº†åŠ æ·±ç†è§£ï¼Œè¯·æ€è€ƒä¸‹é¢çš„é—®é¢˜ï¼ˆè‡ªå¢è‡ªå‡é—®é¢˜ï¼‰ï¼š</p> <ul><li><p>å¦‚æœæŠŠ synchronized(obj) æ”¾åœ¨ for å¾ªç¯çš„å¤–é¢ï¼Œå¦‚ä½•ç†è§£ï¼Ÿ-- å¯¹forå¾ªç¯æ•´ä½“ä¿è¯åŸå­æ€§</p></li> <li><p>å¦‚æœ t1 synchronized(obj1) è€Œ t2 synchronized(obj2) ä¼šæ€æ ·è¿ä½œï¼Ÿ-- é”å¯¹è±¡ä¸åŒï¼Œæ— æ³•ä¿è¯åŒæ­¥äº’æ–¥</p></li> <li><p>å¦‚æœ t1 synchronized(obj) è€Œ t2 æ²¡æœ‰åŠ ä¼šæ€ä¹ˆæ ·ï¼Ÿå¦‚ä½•ç†è§£ï¼Ÿ-- é”å¯¹è±¡ä¸åŒï¼Œä¸€ä¸ªæœ‰ä¸€ä¸ªæ²¡æœ‰ï¼Œåˆ™ä¼šå‘ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜</p> <p>åŠ æ³•ä¸åŠ é”åˆ™æ˜¯æ­£æ•°å‡ ç‡å¤§ï¼Œå‡æ³•ä¸åŠ é”åˆ™æ˜¯è´Ÿæ•°å‡ ç‡å¤§ï¼Œä¸ºå•¥äº†ã€‚ã€‚</p></li></ul> <h3 id="è‡ªå¢è‡ªå‡é¢å‘å¯¹è±¡æ”¹è¿›"><a href="#è‡ªå¢è‡ªå‡é¢å‘å¯¹è±¡æ”¹è¿›" class="header-anchor">#</a> è‡ªå¢è‡ªå‡é¢å‘å¯¹è±¡æ”¹è¿›</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;TestCount2&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestCount2</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Room</span> room <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Room</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5_000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                room<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5_000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                room<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> room<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Room</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            count<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            count<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> count<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h3 id="è¯­æ³•2-åŒæ­¥æ–¹æ³•-é”å¯¹è±¡-ğŸ”¥"><a href="#è¯­æ³•2-åŒæ­¥æ–¹æ³•-é”å¯¹è±¡-ğŸ”¥" class="header-anchor">#</a> è¯­æ³•2â€”åŒæ­¥æ–¹æ³• &amp; é”å¯¹è±¡ ğŸ”¥</h3> <p><strong>æ­¤æ—¶åŒæ­¥é”æ˜¯è°ï¼Ÿé”çš„ç›®æ ‡è¿˜æ˜¯å¯¹è±¡</strong>ï¼Œä¸æ˜¯é”æ–¹æ³•ï¼</p> <ul><li><p>å¯¹äº<strong>é static æ–¹æ³•</strong>ï¼ŒåŒæ­¥é”å°±æ˜¯<strong>this</strong>ï¼Œæ­¤æ—¶ä»£è¡¨è°ƒç”¨ run æ–¹æ³•çš„å¯¹è±¡</p></li> <li><p>å¯¹äº<strong>static æ–¹æ³•</strong>ï¼ŒåŒæ­¥é”å½“å‰æ–¹æ³•æ‰€åœ¨ç±»çš„å­—èŠ‚ç å¯¹è±¡(<strong>ç±»å.class</strong>)ï¼Œ<strong>ä¸æ–¹æ³•è°ƒç”¨è€…æ— å…³</strong>ï¼ï¼ï¼</p> <p>ä½¿ç”¨ç»§æ‰¿ Thread ç±»å’ŒåŒæ­¥æ–¹æ³•å®ç°æ—¶ï¼Œéœ€è¦å†™ <code>static synchronized</code></p></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// ä¸´ç•ŒåŒº</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç­‰ä»·äºï¼ˆè‡ªåŠ¨è½¬æ¢ï¼‰</span>
<span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// ä¸´ç•ŒåŒº</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// ä¸´ç•ŒåŒº</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç­‰ä»·äºï¼ˆè‡ªåŠ¨è½¬æ¢ï¼‰</span>
<span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">Test</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// ä¸´ç•ŒåŒº</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>æ”¹è¿›ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;TestCount2&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestCount2</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Room</span> room <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Room</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5_000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                room<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5_000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                room<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> room<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Room</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        count<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h2 id="çº¿ç¨‹å…«é”-ğŸ”¥"><a href="#çº¿ç¨‹å…«é”-ğŸ”¥" class="header-anchor">#</a> &quot;çº¿ç¨‹å…«é”&quot; ğŸ”¥</h2> <p>è€ƒå¯Ÿ synchronized é”ä½çš„æ˜¯å“ªä¸ªå¯¹è±¡</p> <h4 id="æƒ…å†µ1"><a href="#æƒ…å†µ1" class="header-anchor">#</a> æƒ…å†µ1</h4> <p>ç»“æœï¼š12 æˆ– 21</p> <p>é”æ˜¯ this å¯¹è±¡ï¼ˆåº•å±‚æŸ¥çœ‹ n1 å¯¹è±¡å¤´éƒ¨ä¿¡æ¯ï¼‰</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test1</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Number</span> n1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>n1<span class="token operator">::</span><span class="token function">a</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>n1<span class="token operator">::</span><span class="token function">b</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;Number&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Number</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="æƒ…å†µ2"><a href="#æƒ…å†µ2" class="header-anchor">#</a> æƒ…å†µ2</h4> <p>ç»“æœï¼š1så12ï¼Œæˆ– 2 1så 1</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test1</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Number</span> n1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>n1<span class="token operator">::</span><span class="token function">a</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>n1<span class="token operator">::</span><span class="token function">b</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;Number&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Number</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// sleep ä¸ä¼šé‡Šæ”¾é”ï¼Œä¼šé‡Šæ”¾å¤„ç†æœº</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="æƒ…å†µ3"><a href="#æƒ…å†µ3" class="header-anchor">#</a> æƒ…å†µ3</h4> <p>ç»“æœï¼š3 1s 12 æˆ– 23 1s 1 æˆ– 32 1s 1</p> <ul><li>è‹¥aå…ˆè·å¾—é”ï¼Œåˆ™3å…ˆæ‰“å°ï¼Œ1så1æ‰“å°ï¼Œ2æ‰“å°</li> <li>è‹¥bå…ˆè·å¾—é”ï¼Œåˆ™2æˆ–3å…ˆæ‰“å°ï¼Œ1så1æ‰“å°</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test3</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Number3</span> n1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>n1<span class="token operator">::</span><span class="token function">a</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>n1<span class="token operator">::</span><span class="token function">b</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>n1<span class="token operator">::</span><span class="token function">c</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;Number&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Number3</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="æƒ…å†µ4"><a href="#æƒ…å†µ4" class="header-anchor">#</a> æƒ…å†µ4</h4> <p>ç»“æœï¼š2 1s å 1</p> <ul><li>é¦–å…ˆé”å¯¹è±¡éƒ½ä¸æ˜¯åŒä¸€ä¸ªäº†ï¼æ‰€ä»¥ä¿©çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œ</li> <li>aéœ€è¦ç­‰1sï¼Œæ‰€ä»¥æ˜¯å…ˆæ‰“å°2ï¼Œ1såæ‰“å°1</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test4</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Number4</span> n1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Number4</span> n2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>n1<span class="token operator">::</span><span class="token function">a</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>n2<span class="token operator">::</span><span class="token function">b</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;Number&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Number4</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="æƒ…å†µ5"><a href="#æƒ…å†µ5" class="header-anchor">#</a> æƒ…å†µ5</h4> <p>ç»“æœï¼š2 1s å 1</p> <ul><li><p>é¦–å…ˆé”å¯¹è±¡éƒ½ä¸æ˜¯åŒä¸€ä¸ªäº†ï¼<strong>static æ–¹æ³•ä¸æ˜¯çœ‹è°ƒç”¨è€…ï¼Œæ˜¯çœ‹è§„åˆ™</strong>ï¼</p> <p>açš„é”æ˜¯Number4.classå¯¹è±¡ï¼Œbçš„é”æ˜¯thiså¯¹è±¡ï¼Œæ‰€ä»¥ä¿©çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œ</p></li> <li><p>aéœ€è¦ç­‰1sï¼Œæ‰€ä»¥æ˜¯å…ˆæ‰“å°2ï¼Œ1såæ‰“å°1</p></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test5</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Number5</span> n1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> n1<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> n1<span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;Number&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Number5</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="æƒ…å†µ6"><a href="#æƒ…å†µ6" class="header-anchor">#</a> æƒ…å†µ6</h4> <p>ç»“æœï¼š1så12ï¼Œæˆ– 2 1så 1</p> <ul><li>é”å¯¹è±¡éƒ½æ˜¯ Number6.class ï¼Œæ‰€ä»¥åŒæ­¥äº’æ–¥è¿è¡Œ</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test6</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token class-name">Number6</span><span class="token operator">::</span><span class="token function">a</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token class-name">Number6</span><span class="token operator">::</span><span class="token function">b</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;Number&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Number6</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="æƒ…å†µ7"><a href="#æƒ…å†µ7" class="header-anchor">#</a> æƒ…å†µ7</h4> <ul><li>ç»“æœï¼š2 1s å 1
<ul><li>é¦–å…ˆé”å¯¹è±¡éƒ½ä¸æ˜¯åŒä¸€ä¸ªäº†ï¼Œæ‰€ä»¥ä¿©çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œ</li> <li>aéœ€è¦ç­‰1sï¼Œæ‰€ä»¥æ˜¯å…ˆæ‰“å°2ï¼Œ1såæ‰“å°1</li></ul></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test7</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Number7</span> n1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number7</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Number7</span> n2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number7</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> n1<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> n2<span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;Number&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Number7</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="æƒ…å†µ8"><a href="#æƒ…å†µ8" class="header-anchor">#</a> æƒ…å†µ8</h4> <p>ç»“æœï¼š1så12ï¼Œæˆ– 2 1så 1</p> <ul><li>è™½ç„¶çœ‹ç€æ˜¯newäº†ä¸åŒçš„å¯¹è±¡ï¼Œä½†æ˜¯å®é™…è°ƒç”¨ä¼šè½¬ä¸ºç±»staticè°ƒç”¨ï¼Œæ‰€ä»¥æ˜¯åŒä¸€é”å¯¹è±¡</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test8</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Number8</span> n1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Number8</span> n2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> n1<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> n2<span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;Number&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Number8</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ-ğŸ”¥"><a href="#å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ-ğŸ”¥" class="header-anchor">#</a> å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ ğŸ”¥</h2> <h3 id="æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ"><a href="#æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ" class="header-anchor">#</a> æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ</h3> <ul><li>å¦‚æœå®ƒä»¬<strong>æ²¡æœ‰å…±äº«ï¼Œåˆ™çº¿ç¨‹å®‰å…¨</strong></li> <li>å¦‚æœå®ƒä»¬è¢«<strong>å…±äº«</strong>äº†ï¼Œæ ¹æ®å®ƒä»¬çš„çŠ¶æ€æ˜¯å¦èƒ½å¤Ÿæ”¹å˜ï¼Œåˆåˆ†ä¸¤ç§æƒ…å†µ
<ul><li>å¦‚æœ<strong>åªæœ‰è¯»</strong>æ“ä½œï¼Œåˆ™<strong>çº¿ç¨‹å®‰å…¨</strong></li> <li>å¦‚æœ<strong>æœ‰è¯»å†™</strong>æ“ä½œï¼Œåˆ™è¿™æ®µä»£ç æ˜¯ä¸´ç•ŒåŒºï¼Œéœ€è¦<strong>è€ƒè™‘çº¿ç¨‹å®‰å…¨</strong></li></ul></li></ul> <h3 id="å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ"><a href="#å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ" class="header-anchor">#</a> å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ</h3> <ul><li><strong>å±€éƒ¨å˜é‡</strong>æ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„</li> <li>ä½†<strong>å±€éƒ¨å˜é‡å¼•ç”¨çš„å¯¹è±¡åˆ™æœªå¿…</strong>ğŸ”¥
<ul><li>å¦‚æœè¯¥å¯¹è±¡<strong>æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨è®¿é—®</strong>ï¼Œå®ƒæ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„</li> <li>å¦‚æœè¯¥å¯¹è±¡<strong>é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´</strong>ï¼Œéœ€è¦<strong>è€ƒè™‘çº¿ç¨‹å®‰å…¨</strong></li></ul></li></ul> <h3 id="åˆ†æ-æˆå‘˜å˜é‡-list-add-Ã—-ğŸ”¥"><a href="#åˆ†æ-æˆå‘˜å˜é‡-list-add-Ã—-ğŸ”¥" class="header-anchor">#</a> åˆ†æâ€”æˆå‘˜å˜é‡â€”List#add Ã— ğŸ”¥</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> THREAD_NUMBER <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> LOOP_NUMBER <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadUnsafe</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadUnsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> THREAD_NUMBER<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                test<span class="token punctuation">.</span><span class="token function">method1</span><span class="token punctuation">(</span>LOOP_NUMBER<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;Thread&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ThreadUnsafe</span> <span class="token punctuation">{</span>

    <span class="token comment">/* æˆå‘˜å˜é‡ */</span>
    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token keyword">int</span> loopNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> loopNumber<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ä¸´ç•ŒåŒº, ä¼šäº§ç”Ÿç«æ€æ¡ä»¶</span>
            <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">method3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ä¸´ç•ŒåŒº</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">method3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>è¿™é‡Œé¢æœ¬æ¥method2æ‰§è¡Œå®Œaddåå†æ‰§è¡Œmethod3çš„removeæ˜¯æ— è®ºå¦‚ä½•ä¸ä¼šå‡ºé”™çš„ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ä¸‹ï¼Œ<strong>addæ–¹æ³•ä¸æ˜¯åŸå­æ€§</strong>çš„ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span>size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Increments modCount!!</span>
    elementData<span class="token punctuation">[</span>size<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>æœ‰å¯èƒ½2ä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œaddæ—¶ï¼Œæ‹¿åˆ°äº†åŒä¸€ä¸ªsize</strong>ï¼Œå³<strong>åªæ·»åŠ äº†ä¸€ä¸ªå…ƒç´ </strong>ï¼æ­¤æ—¶è¦æ˜¯è°ƒç”¨ç¬¬äºŒä¸ªremoveå°±ä¼šæŠ›å¦‚ä¸‹å¼‚å¸¸ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Exception in thread &quot;Thread0&quot; java.lang.IndexOutOfBoundsException: Index: 0, Size: 0
	at java.util.ArrayList.rangeCheck(ArrayList.java:657)
	at java.util.ArrayList.remove(ArrayList.java:496)
	at _10_var_safe.ThreadUnsafe.method3(ThreadUnsafe.java:23)
	at _10_var_safe.ThreadUnsafe.method1(ThreadUnsafe.java:14)
	at _10_var_safe.ThreadUnsafe.lambda$main$0(ThreadUnsafe.java:37)
	at java.lang.Thread.run(Thread.java:748)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ä¸è‡ªå¢è‡ªå‡ä¸åŒçš„æ˜¯ï¼Œè‡ªå¢è‡ªå‡ä¸­2ä¸ªçº¿ç¨‹ï¼Œåˆ†åˆ«è¿›è¡Œå¢ã€å‡æ“ä½œï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªçº¿ç¨‹å†…è¿›è¡Œå¢å‡æ“ä½œ</p> <p>åˆ†æï¼š</p> <ul><li><p>æ— è®ºå“ªä¸ªçº¿ç¨‹ä¸­çš„ method2 å¼•ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ä¸­çš„ list æˆå‘˜å˜é‡</p></li> <li><p>method3 ä¸ method2 åˆ†æç›¸åŒ</p></li></ul> <p><img src="/assets/img/image-20210217160309358.168e2c35.png" alt="image-20210217160309358"></p> <h3 id="åˆ†æ-å±€éƒ¨æ™®é€šå˜é‡-âœ“"><a href="#åˆ†æ-å±€éƒ¨æ™®é€šå˜é‡-âœ“" class="header-anchor">#</a> åˆ†æâ€”å±€éƒ¨æ™®é€šå˜é‡ âœ“</h3> <p>å¦‚ä¸‹ä»£ç ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> 
    i<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>æ¯ä¸ªçº¿ç¨‹è°ƒç”¨ test1() æ–¹æ³•æ—¶å±€éƒ¨å˜é‡ iï¼Œä¼šåœ¨æ¯ä¸ªçº¿ç¨‹çš„æ ˆå¸§å†…å­˜ä¸­è¢«åˆ›å»ºå¤šä»½ï¼Œå› æ­¤ä¸å­˜åœ¨å…±äº«</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static void test1();

	descriptor: ()V
    flags: ACC_PUBLIC, ACC_STATIC
	Code:
		stack=1, locals=1, args_size=0 
			0: bipush 10
			2: istore_0
			3: iinc 0, 1 
			6: return
		LineNumberTable:
			line 10: 0
			line 11: 3
			line 12: 6
		LocalVariableTable:
			Start Length Slot Name Signature
			3 		4 		0 	i 		I
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>å¦‚å›¾ï¼š</p> <p><img src="/assets/img/image-20210217154731430.aae0b7b2.png" alt="image-20210217154731430"></p> <h3 id="åˆ†æ-å±€éƒ¨å˜é‡ä¸ºå¼•ç”¨å¯¹è±¡-âœ“"><a href="#åˆ†æ-å±€éƒ¨å˜é‡ä¸ºå¼•ç”¨å¯¹è±¡-âœ“" class="header-anchor">#</a> åˆ†æâ€”å±€éƒ¨å˜é‡ä¸ºå¼•ç”¨å¯¹è±¡ âœ“</h3> <p>å°† list ä¿®æ”¹ä¸ºå±€éƒ¨å˜é‡</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> THREAD_NUMBER <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> LOOP_NUMBER <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadSafe</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadSafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> THREAD_NUMBER<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                test<span class="token punctuation">.</span><span class="token function">method1</span><span class="token punctuation">(</span>LOOP_NUMBER<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;Thread&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ThreadSafe</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token keyword">int</span> loopNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> loopNumber<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ä¸´ç•ŒåŒº, ä¼šäº§ç”Ÿç«æ€æ¡ä»¶</span>
            <span class="token function">method2</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">method3</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ä¸´ç•ŒåŒº</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">method3</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>é‚£ä¹ˆå°±ä¸ä¼šæœ‰ä¸Šè¿°é—®é¢˜äº†</p> <p>åˆ†æï¼š</p> <ul><li><p>list æ˜¯å±€éƒ¨å˜é‡ï¼Œ<strong>æ¯ä¸ªçº¿ç¨‹è°ƒç”¨æ—¶ä¼šåˆ›å»ºå…¶ä¸åŒå®ä¾‹ï¼Œæ²¡æœ‰å…±äº«</strong></p></li> <li><p>è€Œ method2 çš„å‚æ•°æ˜¯ä» method1 ä¸­ä¼ é€’è¿‡æ¥çš„ï¼Œä¸ method1 ä¸­å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡</p></li> <li><p>method3 çš„å‚æ•°åˆ†æä¸ method2 ç›¸åŒ</p></li></ul> <p><img src="/assets/img/image-20210217160523996.99e92292.png" alt="image-20210217160523996"></p> <h3 id="åˆ†æ-å±€éƒ¨å˜é‡ä¸ºå¼•ç”¨å¯¹è±¡å¹¶æš´éœ²-Ã—"><a href="#åˆ†æ-å±€éƒ¨å˜é‡ä¸ºå¼•ç”¨å¯¹è±¡å¹¶æš´éœ²-Ã—" class="header-anchor">#</a> åˆ†æâ€”å±€éƒ¨å˜é‡ä¸ºå¼•ç”¨å¯¹è±¡å¹¶æš´éœ² Ã—</h3> <p>æ–¹æ³•è®¿é—®ä¿®é¥°ç¬¦å¸¦æ¥çš„æ€è€ƒï¼Œå¦‚æœæŠŠ method2 å’Œ method3 çš„æ–¹æ³•ä¿®æ”¹ä¸º public ä¼šä¸ä¼šä»£ç†çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ</p> <ul><li><p>æƒ…å†µ1ï¼šæœ‰å…¶å®ƒçº¿ç¨‹è°ƒç”¨ method2 å’Œ method3</p> <p>æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸ºæ“ä½œçš„listå¯¹è±¡è¿˜æ˜¯å„çº¿ç¨‹ç§æœ‰çš„</p></li> <li><p>æƒ…å†µ2ï¼šåœ¨ æƒ…å†µ1 çš„åŸºç¡€ä¸Šï¼Œä¸º ThreadSafe ç±»æ·»åŠ å­ç±»ï¼Œå­ç±»è¦†ç›– method2 æˆ– method3 æ–¹æ³•ï¼Œå³</p></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Test2</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> THREAD_NUMBER <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> LOOP_NUMBER <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadSafe2Sub</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadSafe2Sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> THREAD_NUMBER<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> test<span class="token punctuation">.</span><span class="token function">method1</span><span class="token punctuation">(</span>LOOP_NUMBER<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Thread&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">ThreadSafe2</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token keyword">int</span> loopNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> loopNumber<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ä¸´ç•ŒåŒº, ä¼šäº§ç”Ÿç«æ€æ¡ä»¶</span>
            <span class="token function">method2</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">method3</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ä¸´ç•ŒåŒº</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method3</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ThreadSafe2Sub</span> <span class="token keyword">extends</span> <span class="token class-name">ThreadSafe2</span><span class="token punctuation">{</span>
    <span class="token comment">// @Override</span>
    <span class="token comment">// public void method2(ArrayList&lt;String&gt; list) {</span>
    <span class="token comment">//     new Thread(()-&gt; list.add(&quot;1&quot;)).start();</span>
    <span class="token comment">// }</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method3</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span> list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>è¿™æ ·å°±å¯¼è‡´å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€èµ„æºè¿›è¡Œæ“ä½œï¼Œä¸”æ“ä½œçš„è¯­å¥æœ‰å¤šæ¡ï¼removeåº•å±‚ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">rangeCheck</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>

    modCount<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token class-name">E</span> oldValue <span class="token operator">=</span> <span class="token function">elementData</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> numMoved <span class="token operator">=</span> size <span class="token operator">-</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>numMoved <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> index<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> index<span class="token punctuation">,</span>
                         numMoved<span class="token punctuation">)</span><span class="token punctuation">;</span>
    elementData<span class="token punctuation">[</span><span class="token operator">--</span>size<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// clear to let GC do its work</span>

    <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="å¸¸è§çº¿ç¨‹å®‰å…¨ç±»-åŒæ­¥é”"><a href="#å¸¸è§çº¿ç¨‹å®‰å…¨ç±»-åŒæ­¥é”" class="header-anchor">#</a> å¸¸è§çº¿ç¨‹å®‰å…¨ç±»â€”åŒæ­¥é”</h3> <ul><li>StringBuffer</li> <li>Random</li> <li><s>Vector</s>ï¼šä¸æ¨è</li> <li><s>Hashtable</s>ï¼šä¸æ¨è</li> <li>java.util.concurrent åŒ…ä¸‹çš„ç±»</li></ul> <p>è¿™é‡Œè¯´å®ƒä»¬æ˜¯çº¿ç¨‹å®‰å…¨çš„æ˜¯æŒ‡ï¼Œ<strong>å¤šä¸ªçº¿ç¨‹è°ƒç”¨</strong>å®ƒä»¬<strong>åŒä¸€ä¸ªå®ä¾‹çš„æŸä¸ªæ–¹æ³•æ—¶</strong>ï¼Œæ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸º</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Hashtable</span> table <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hashtable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
    table<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
    table<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>å®ƒä»¬çš„<strong>æ¯ä¸ªæ–¹æ³•æ˜¯åŸå­</strong>çš„ã€‚ä½†<strong>æ³¨æ„</strong>å®ƒä»¬<strong>å¤šä¸ªæ–¹æ³•çš„ç»„åˆä¸æ˜¯åŸå­</strong>çš„ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Hashtable</span> table <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hashtable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        table<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>æ¯ä¸ªåŸå­æ“ä½œæ‰§è¡Œå®Œåéƒ½ä¼šé‡Šæ”¾é”ï¼Œå¹¶å”¤é†’å…¶ä»–é˜»å¡çº¿ç¨‹ã€‚è¿™é‡Œçš„getã€putæ–¹æ³•éƒ½æ˜¯åŒä¸€æŠŠé”</p> <h3 id="å¸¸è§çº¿ç¨‹å®‰å…¨ç±»-ä¸å¯å˜ç±»"><a href="#å¸¸è§çº¿ç¨‹å®‰å…¨ç±»-ä¸å¯å˜ç±»" class="header-anchor">#</a> å¸¸è§çº¿ç¨‹å®‰å…¨ç±»â€”ä¸å¯å˜ç±»</h3> <ul><li>String</li> <li>Integer</li></ul> <p>Stringã€Integer ç­‰éƒ½æ˜¯ä¸å¯å˜ç±»ï¼Œå› ä¸ºå…¶å†…éƒ¨çš„çŠ¶æ€ä¸å¯ä»¥æ”¹å˜ï¼Œå› æ­¤å®ƒä»¬çš„æ–¹æ³•éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„</p> <p>æœ‰åŒå­¦æˆ–è®¸æœ‰ç–‘é—®ï¼ŒString æœ‰ replaceï¼Œsubstring ç­‰æ–¹æ³•ã€å¯ä»¥ã€‘æ”¹å˜å€¼å•Šï¼Œé‚£ä¹ˆè¿™äº›æ–¹æ³•åˆæ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨çš„å‘¢ï¼Ÿ</p> <p>å› ä¸º<strong>æ²¡æœ‰æ”¹å˜åŸæœ‰çš„å€¼</strong>ï¼Œæ˜¯<strong>é‡æ–°newä¸€ä¸ªå¯¹è±¡å¹¶è¿”å›</strong>çš„ï¼</p> <h3 id="å®ä¾‹åˆ†æ-ğŸ”¥"><a href="#å®ä¾‹åˆ†æ-ğŸ”¥" class="header-anchor">#</a> å®ä¾‹åˆ†æ ğŸ”¥</h3> <p><strong>å¦‚ä¸‹å®ä¾‹ä¸­ï¼ŒServlet éƒ½æ˜¯å•ä¾‹çš„ï¼ï¼ï¼æ‰€ä»¥å…¶æ‰€æœ‰ Serviceã€Dao ä¹Ÿéƒ½æ˜¯å•ä¾‹çš„</strong></p> <p><a href="https://www.cnblogs.com/stono/p/14234241.html" target="_blank" rel="noopener noreferrer">Servletå‚è€ƒåšå®¢<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="ä¾‹1"><a href="#ä¾‹1" class="header-anchor">#</a> ä¾‹1</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ˜¯å¦å®‰å…¨ï¼Ÿå¦</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ˜¯å¦å®‰å…¨ï¼Ÿæ˜¯</span>
    <span class="token class-name">String</span> S1 <span class="token operator">=</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// æ˜¯å¦å®‰å…¨ï¼Ÿæ˜¯</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> S2 <span class="token operator">=</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// æ˜¯å¦å®‰å…¨ï¼Ÿå¦</span>
    <span class="token class-name">Date</span> d1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ˜¯å¦å®‰å…¨ï¼Ÿå¦ï¼Œåªæ˜¯ d2 è¿™ä¸ªå¼•ç”¨å€¼ä¸èƒ½å˜ï¼Œå…¶å¯¹è±¡å†…éƒ¨å±æ€§æ˜¯å¯å˜çš„</span>
    <span class="token keyword">final</span> <span class="token class-name">Date</span> d2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä½¿ç”¨ä¸Šè¿°å˜é‡</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="ä¾‹2"><a href="#ä¾‹2" class="header-anchor">#</a> ä¾‹2</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// MyServlet åªæœ‰ä¸€ä»½ï¼Œæ¯ä¸ªçº¿ç¨‹è®¿é—®éƒ½ä¼šæœ‰ä¸€ä»½</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ˜¯å¦å®‰å…¨ï¼Ÿæˆå‘˜å˜é‡ï¼Œå¯èƒ½æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚UserServiceImplä¸­æœ‰æˆå‘˜å˜é‡ï¼Œå¹¶æœ‰å¯¹è¯¥æˆå‘˜å˜é‡çš„ä¿®æ”¹æ“ä½œ</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token comment">// è®°å½•è°ƒç”¨æ¬¡æ•°</span>
    <span class="token comment">// æˆå‘˜å˜é‡ï¼Œå¯èƒ½æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...åŒæ ·</span>
        count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="ä¾‹3"><a href="#ä¾‹3" class="header-anchor">#</a> ä¾‹3</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Component</span><span class="token comment">// Springç»„ä»¶é»˜è®¤å•ä¾‹</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAspect</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ˜¯å¦å®‰å…¨ï¼Ÿæˆå‘˜å˜é‡ï¼Œå¯èƒ½æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* *(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* *(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;cost time:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>å¯ä»¥ä½¿ç”¨ç¯ç»•é€šçŸ¥ï¼Œå°†å˜é‡æ”¹ä¸ºå±€éƒ¨å˜é‡</p> <h4 id="ä¾‹4"><a href="#ä¾‹4" class="header-anchor">#</a> ä¾‹4</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ˜¯å¦å®‰å…¨ã€‚æ˜¯ã€‚æ²¡æœ‰å¯¹userServiceè¿›è¡Œä¿®æ”¹çš„æ“ä½œ</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ˜¯å¦å®‰å…¨ã€‚æ˜¯ã€‚æ²¡æœ‰å¯¹userDaoè¿›è¡Œä¿®æ”¹çš„æ“ä½œ</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDao</span> <span class="token punctuation">{</span> 
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;update user set password = ? where username = ?&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// æ˜¯å¦å®‰å…¨ã€‚æ˜¯ã€‚æ²¡æœ‰æˆå‘˜å˜é‡ï¼Œåªæœ‰å±€éƒ¨å˜é‡ä¸€èˆ¬éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="ä¾‹5"><a href="#ä¾‹5" class="header-anchor">#</a> ä¾‹5</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ˜¯å¦å®‰å…¨ã€‚æ˜¯ã€‚æ²¡æœ‰å¯¹userServiceè¿›è¡Œä¿®æ”¹çš„æ“ä½œ</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ˜¯å¦å®‰å…¨ã€‚æ˜¯ã€‚æ²¡æœ‰å¯¹userDaoè¿›è¡Œä¿®æ”¹çš„æ“ä½œ</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDao</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ˜¯å¦å®‰å…¨ã€‚å¦ã€‚æˆå‘˜å˜é‡ï¼Œä¸”æœ‰å¯¹æˆå‘˜å˜é‡çš„ä¿®æ”¹æ“ä½œï¼Œå¦‚close</span>
    <span class="token keyword">private</span> <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;update user set password = ? where username = ?&quot;</span><span class="token punctuation">;</span>
        conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
        conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="ä¾‹6"><a href="#ä¾‹6" class="header-anchor">#</a> ä¾‹6</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ˜¯å¦å®‰å…¨ã€‚æ˜¯</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span> 
    <span class="token comment">// æ˜¯å¦å®‰å…¨ã€‚æ˜¯</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserDao</span> userDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDao</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ˜¯å¦å®‰å…¨ï¼Œæ˜¯ï¼Œæ¯æ¬¡éƒ½ä¼šnew UserDaoImplï¼Œå…¶å®ä¾‹ä¸­çš„æˆå‘˜å˜é‡ä¸å­˜åœ¨å…±äº«</span>
    <span class="token keyword">private</span> <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;update user set password = ? where username = ?&quot;</span><span class="token punctuation">;</span>
        conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
        conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="ä¾‹7"><a href="#ä¾‹7" class="header-anchor">#</a> ä¾‹7</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ˜¯å¦å®‰å…¨ã€‚å¦ã€‚å±€éƒ¨å˜é‡ä¸ºå¼•ç”¨å¯¹è±¡ï¼Œå¹¶æš´éœ²äº†ï¼</span>
        <span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">foo</span><span class="token punctuation">(</span>sdf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token class-name">SimpleDateFormat</span> sdf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>å…¶ä¸­ foo çš„è¡Œä¸ºæ˜¯ä¸ç¡®å®šçš„ï¼Œå¯èƒ½å¯¼è‡´ä¸å®‰å…¨çš„å‘ç”Ÿï¼Œè¢«ç§°ä¹‹ä¸º<strong>å¤–æ˜Ÿæ–¹æ³•</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token class-name">SimpleDateFormat</span> sdf<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> dateStr <span class="token operator">=</span> <span class="token string">&quot;1999-10-11 00:00:00&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                sdf<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>dateStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ParseException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>è¯·æ¯”è¾ƒ JDK ä¸­ String ç±»çš„å®ç°</p> <h4 id="ä¾‹8"><a href="#ä¾‹8" class="header-anchor">#</a> ä¾‹8</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;Test3&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test3</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token number">5000</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        i<span class="token operator">++</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span> <span class="token operator">+</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token operator">::</span><span class="token function">start</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>t <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä¸å¤Ÿ10000</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>é”å¯¹è±¡ç”¨çš„æ˜¯æˆè¯­å˜é‡ Integer i ï¼Œä¸€ç›´åœ¨å˜åŒ–ï¼Œæ‰€ä»¥æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜</p> <h3 id="ä¹ é¢˜1-å–ç¥¨ç»ƒä¹ -ğŸ”¥"><a href="#ä¹ é¢˜1-å–ç¥¨ç»ƒä¹ -ğŸ”¥" class="header-anchor">#</a> ä¹ é¢˜1â€”å–ç¥¨ç»ƒä¹  ğŸ”¥</h3> <p>æµ‹è¯•ä¸‹é¢ä»£ç æ˜¯å¦å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¹¶å°è¯•æ”¹æ­£ã€‚ç›®å‰å·²æ˜¯æ­£ç¡®çš„äº†ï¼</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;TestSell&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestSell</span> <span class="token punctuation">{</span>

    <span class="token comment">// Random ä¸ºçº¿ç¨‹å®‰å…¨</span>
    <span class="token keyword">static</span> <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// éšæœº 1~5</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">randomAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@RepeatedTest</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆå§‹åŒ–ç¥¨æ•°</span>
        <span class="token class-name">TicketWindow</span> ticketWindow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TicketWindow</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ–¹ä¾¿ join åŒæ­¥ï¼Œç­‰å¾…éƒ½å®Œæˆå main çº¿ç¨‹æ‰§è¡Œç»Ÿè®¡ã€‚ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œä¸æ¶‰åŠå¤šçº¿ç¨‹</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ç”¨æ¥å­˜å‚¨å–å‡ºå»å¤šå°‘å¼ ç¥¨ã€‚å…±äº«èµ„æºï¼Œè‹¥ä½¿ç”¨ List#add å…¶æ–¹æ³•ä¸æ˜¯åŒæ­¥çš„ï¼Œæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> sellCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2_000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">// å¢åŠ æ—¶é—´ï¼Œä»¥ä¾¿çº¿ç¨‹åˆ‡æ¢å‡ ç‡ï¼Œå¦åˆ™ä»£ç å¤ªå°‘ï¼Œå¾ˆå¿«å°±æ‰§è¡Œå®Œäº†</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token function">randomAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// åˆ†æè¿™é‡Œçš„ç«æ€æ¡ä»¶</span>
                <span class="token comment">// è¯¥æ–¹æ³•ä¸æ˜¯åŸå­çš„ï¼Œéœ€è¦åŒæ­¥çº¦æŸ</span>
                <span class="token keyword">int</span> count <span class="token operator">=</span> ticketWindow<span class="token punctuation">.</span><span class="token function">sell</span><span class="token punctuation">(</span><span class="token function">randomAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// è¯¥æ–¹æ³•å·²ç»æ˜¯åŒæ­¥çš„äº†ï¼Œä¸”å’Œä¸Šé¢çš„ä¸æ˜¯åŒä¸€å…±äº«èµ„æºï¼Œæ‰€ä»¥æ— éœ€ç»„åˆåŒæ­¥</span>
                sellCount<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>t <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å–å‡ºçš„ç¥¨ :{} \tä½™ç¥¨: {}&quot;</span><span class="token punctuation">,</span>
                sellCount<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span>c <span class="token operator">-&gt;</span> c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                ticketWindow<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å–å‡ºçš„ç¥¨ + ä½™ç¥¨ åº”è¯¥ç­‰äºåˆå§‹ç¥¨æ•°</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>


<span class="token comment">// å”®ç¥¨çª—å£</span>
<span class="token keyword">class</span> <span class="token class-name">TicketWindow</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> count<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">TicketWindow</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è·å–ä½™ç¥¨</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å”®ç¥¨ã€‚å¿…é¡»åŠ ä¸Šsynchronizedï¼Œä¿è¯åŸå­æ€§</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">sell</span><span class="token punctuation">(</span><span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">&gt;=</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">-=</span> amount<span class="token punctuation">;</span>
            <span class="token keyword">return</span> amount<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><p>ä¸åŠ sleepï¼Œä½¿ç”¨è„šæœ¬æµ‹è¯•å¤šæ¬¡ï¼ˆæœ‰å¯èƒ½ç”µè„‘å¤ªå¿«äº†ï¼Œè¿˜å¿…é¡»åŠ sleepï¼‰ã€‚å¦‚ä¸‹ä¸ºcmd</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>for /L %n in (1,1,10) do java -cp &quot;.;C:\Users\manyh\.m2\repository\ch\qos\logback\logback-classic\1.2.3\logback-classic-1.2.3.jar;C:\Users\manyh\.m2\repository\ch\qos\logback\logback-core\1.2.3\logback-core-1.2.3.jar;C:\Users\manyh\.m2\repository\org\slf4j\slf4j-api\1.7.25\slf4j-api-1.7.25.jar&quot; cn.itcast.n4.exercise.ExerciseSell
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>-cpï¼šclasspathï¼Œå› ä¸ºåˆ©ç”¨äº†ç¬¬ä¸‰æ–¹åº“</li></ul> <h3 id="ä¹ é¢˜2-è½¬è´¦-ğŸ”¥"><a href="#ä¹ é¢˜2-è½¬è´¦-ğŸ”¥" class="header-anchor">#</a> ä¹ é¢˜2â€”è½¬è´¦ ğŸ”¥</h3> <p>æµ‹è¯•ä¸‹é¢ä»£ç æ˜¯å¦å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¹¶å°è¯•æ”¹æ­£ã€‚ç›®å‰å·²æ˜¯æ­£ç¡®çš„äº†ï¼ä½†æ˜¯<strong>æœ‰å¾ˆå¤§ç¼ºé™·</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;TestTransfer&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestTransfer</span> <span class="token punctuation">{</span>

    <span class="token comment">// Random ä¸ºçº¿ç¨‹å®‰å…¨</span>
    <span class="token keyword">static</span> <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// éšæœº 1~100</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">randomAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@RepeatedTest</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Account</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Account</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                a<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token function">randomAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                b<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token function">randomAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;total:{}&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> b<span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> money<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token keyword">int</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>money <span class="token operator">=</span> money<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> money<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMoney</span><span class="token punctuation">(</span><span class="token keyword">int</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>money <span class="token operator">=</span> money<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è¿™é‡Œ money å…±äº«èµ„æºå…¶å®æ˜¯æœ‰ 2ä¸ªè´¦æˆ·çš„ï¼Œéœ€è¦éƒ½ä¿æŠ¤èµ·æ¥ã€‚</span>
    <span class="token comment">// è€Œ synchronized åŒæ­¥æ–¹æ³•é”å¯¹è±¡æ˜¯ thisï¼Œä¸èƒ½éƒ½ä¿æŠ¤ã€‚å³ aè½¬bæ—¶å…¶ä»–aè½¬bçº¿ç¨‹ä¸èƒ½è¿›å…¥ï¼Œä½†æ˜¯bè½¬açº¿ç¨‹å¯ä»¥è¿›å…¥ï¼</span>
    <span class="token comment">// æ­¤æ—¶éœ€è¦å°†éƒ½ä¿æŠ¤èµ·æ¥ã€‚ä½†æ˜¯ä¸èƒ½ä½¿ç”¨åµŒå¥—åŒæ­¥ä»£ç å—ï¼Œå®¹æ˜“æ­»é”ã€‚æ­¤æ—¶å¯ä»¥é‡‡ç”¨Account.classé”å¯¹è±¡</span>
    <span class="token comment">// ä½†æ˜¯è¿™æ˜¯åœ¨åŒä¸€æ—¶åˆ»åªèƒ½ä¸€ä¸ªè´¦æˆ·è¿›è¡Œè½¬è´¦äº†ï¼Œæ€§èƒ½ä½ä¸‹ï¼ï¼ï¼</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">Account</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Account</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>money <span class="token operator">&gt;</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setMoney</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>money <span class="token operator">-</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
                target<span class="token punctuation">.</span><span class="token function">setMoney</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><h2 id="çº¿ç¨‹é—´é€šä¿¡-waitã€notify-ç­‰å¾…å”¤é†’æœºåˆ¶-ğŸ”¥"><a href="#çº¿ç¨‹é—´é€šä¿¡-waitã€notify-ç­‰å¾…å”¤é†’æœºåˆ¶-ğŸ”¥" class="header-anchor">#</a> çº¿ç¨‹é—´é€šä¿¡â€”waitã€notify ç­‰å¾…å”¤é†’æœºåˆ¶ ğŸ”¥</h2> <h3 id="çº¿ç¨‹é—´é€šä¿¡-ğŸ”¥"><a href="#çº¿ç¨‹é—´é€šä¿¡-ğŸ”¥" class="header-anchor">#</a> çº¿ç¨‹é—´é€šä¿¡ ğŸ”¥</h3> <p><strong>å¤šä¸ªçº¿ç¨‹åœ¨å¤„ç†åŒä¸€ä¸ªèµ„æºï¼Œä½†æ˜¯å¤„ç†çš„åŠ¨ä½œï¼ˆçº¿ç¨‹çš„ä»»åŠ¡ï¼‰å´ä¸ç›¸åŒ</strong>ï¼Œéœ€è¦çº¿ç¨‹é€šä¿¡æ¥å¸®åŠ©è§£å†³çº¿ç¨‹ä¹‹é—´å¯¹åŒä¸€ä¸ªå˜é‡çš„ä½¿ç”¨æˆ–æ“ä½œã€‚ å°±æ˜¯å¤šä¸ªçº¿ç¨‹åœ¨æ“ä½œåŒä¸€ä»½æ•°æ®æ—¶ï¼Œ é¿å…å¯¹åŒä¸€å…±äº«å˜é‡çš„äº‰å¤ºã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€å®šçš„æ‰‹æ®µä½¿å„ä¸ªçº¿ç¨‹èƒ½æœ‰æ•ˆçš„åˆ©ç”¨èµ„æºã€‚è€Œè¿™ç§æ‰‹æ®µå³â€”â€” <strong>ç­‰å¾…å”¤é†’æœºåˆ¶</strong>ã€‚</p> <h3 id="å°æ•…äº‹"><a href="#å°æ•…äº‹" class="header-anchor">#</a> å°æ•…äº‹</h3> <ul><li><p>ç”±äºæ¡ä»¶ä¸æ»¡è¶³ï¼Œå°å—ä¸èƒ½ç»§ç»­è¿›è¡Œè®¡ç®—</p></li> <li><p>ä½†å°å—å¦‚æœä¸€ç›´å ç”¨ç€é”ï¼Œå…¶å®ƒäººå°±å¾—ä¸€ç›´é˜»å¡ï¼Œæ•ˆç‡å¤ªä½</p> <p><img src="/assets/img/image-20210219233020753.5893eff9.png" alt="image-20210219233020753"></p></li> <li><p>äºæ˜¯è€ç‹å•å¼€äº†ä¸€é—´ä¼‘æ¯å®¤ï¼ˆè°ƒç”¨ wait æ–¹æ³•ï¼‰ï¼Œè®©å°å—åˆ°ä¼‘æ¯å®¤ï¼ˆWaitSetï¼‰ç­‰ç€å»äº†ï¼Œä½†è¿™æ—¶é”é‡Šæ”¾å¼€ï¼Œå…¶å®ƒäººå¯ä»¥ç”±è€ç‹éšæœºå®‰æ’è¿›å±‹</p></li> <li><p>ç›´åˆ°å°Må°†çƒŸé€æ¥ï¼Œå¤§å«ä¸€å£° [ ä½ çš„çƒŸåˆ°äº† ] ï¼ˆè°ƒç”¨ notify æ–¹æ³•ï¼‰</p> <p><img src="/assets/img/image-20210219233050871.a62fa052.png" alt="image-20210219233050871"></p></li> <li><p>å°å—äºæ˜¯å¯ä»¥ç¦»å¼€ä¼‘æ¯å®¤ï¼Œé‡æ–°è¿›å…¥ç«äº‰é”çš„é˜Ÿåˆ—</p> <p><img src="/assets/img/image-20210219233119428.f79dc7dd.png" alt="image-20210219233119428"></p></li></ul> <h3 id="åŸç†å›¾è§£-ğŸ”¥"><a href="#åŸç†å›¾è§£-ğŸ”¥" class="header-anchor">#</a> åŸç†å›¾è§£ ğŸ”¥</h3> <iframe id="embed_dom" name="embed_dom" frameborder="0" src="https://www.processon.com/embed/602e422c07912934224cfe8d" style="display:block;width:100%;height:645px;"></iframe> <ul><li><p>Owner çº¿ç¨‹å‘ç°æ¡ä»¶ä¸æ»¡è¶³ï¼Œè°ƒç”¨ wait æ–¹æ³•ï¼Œå³å¯è¿›å…¥ WaitSet å˜ä¸º WAITING çŠ¶æ€</p></li> <li><p>BLOCKED å’Œ WAITING çš„çº¿ç¨‹<strong>éƒ½å¤„äºé˜»å¡çŠ¶æ€</strong>ï¼Œ<strong>ä¸å ç”¨ CPU æ—¶é—´ç‰‡</strong></p></li> <li><p><strong>BLOCKED çº¿ç¨‹ä¼šåœ¨ Owner çº¿ç¨‹é‡Šæ”¾é”æ—¶å”¤é†’</strong></p> <p><strong>WAITING çº¿ç¨‹ä¼šåœ¨ Owner æ‰€å± Monitor è°ƒç”¨ notify æˆ– notifyAll æ—¶å”¤é†’</strong>ï¼Œä½†å”¤é†’å<strong>å¹¶ä¸æ„å‘³è€…ç«‹åˆ»è·å¾—é”</strong>ï¼Œä»éœ€<strong>è¿›å…¥EntryList é‡æ–°ç«äº‰</strong></p></li></ul> <h3 id="æ–¹æ³•-ğŸ”¥"><a href="#æ–¹æ³•-ğŸ”¥" class="header-anchor">#</a> æ–¹æ³• ğŸ”¥</h3> <p><code>Object</code>ç±»ï¼ˆä»»æ„é”ï¼‰ä¸­æä¾›äº†ä¸‰ä¸ªæ–¹æ³•ï¼Œæ˜¯çº¿ç¨‹ä¹‹é—´è¿›è¡Œåä½œçš„æ‰‹æ®µã€‚è¿™äº›æ–¹æ³•å¿…é¡»é€šè¿‡<strong>åŒä¸€ä¸ªé”å¯¹è±¡ï¼ˆthis è°ƒç”¨æˆ–å…¶ä»–åŒä¸€å¯¹è±¡è°ƒç”¨ï¼‰åœ¨åŒæ­¥ä¸­ï¼ˆåŒæ­¥ä»£ç å—ã€åŒæ­¥æ–¹æ³•ï¼Œå³å¿…é¡»è·å¾—é”ã€æˆä¸º Monitor çš„ Ownerï¼‰è°ƒç”¨</strong>ï¼Œå¦åˆ™æŠ¥<code>IllegalMonitorStateException</code>é”™ã€‚Lock æœ‰å…¶è‡ªå·±çš„æ–¹æ³•ã€‚</p> <ul><li><p><code>wait([long timeout])</code>ï¼šè®©è¿›å…¥ obj ç›‘è§†å™¨çš„çº¿ç¨‹åˆ° WaitSet ç­‰å¾…ã€‚</p> <p><strong>ç­‰å¾…</strong>å¹¶ç«‹å³<strong>é‡Šæ”¾é”</strong>ï¼Œçº¿ç¨‹è¿›å…¥ WAITINGï¼Œ<strong>è¢«å”¤é†’è‹¥è·å¾—é”åä»æ–­ç‚¹å¤„æ‰§è¡Œåç»­ä»£ç </strong>ã€‚</p> <p>æœ‰æ—¶é™çš„ç­‰å¾…, åˆ° n æ¯«ç§’åç»“æŸç­‰å¾…ç›´æ¥è¿è¡Œåç»­ä»£ç ï¼Œæˆ–æ˜¯è¢« notify</p></li> <li><p><code>wait(long timeout, int nanos)</code>ä¸ä¼šç²¾ç¡®åˆ°nanosï¼Œåªè¦nanosæœ‰æ­£ç¡®çš„å€¼ï¼Œåˆ™ç»™timeout++</p></li> <li><p><code>notify()</code>ï¼šåœ¨ obj ä¸Šæ­£åœ¨ WaitSet ç­‰å¾…çš„çº¿ç¨‹ä¸­æŒ‘ä¸€ä¸ªå”¤é†’ã€‚</p> <p>å”¤é†’æ­£åœ¨æ’é˜Ÿç­‰å¾…åŒæ­¥èµ„æºçš„çº¿ç¨‹ä¸­ä¼˜å…ˆçº§æœ€é«˜è€…ç»“æŸç­‰å¾…ï¼Œä½†<strong>å®ƒè‡ªå·±ä¸é‡Šæ”¾é”</strong>ï¼Œè¢«é€šçŸ¥çº¿ç¨‹ä¸èƒ½ç«‹å³æ¢å¤æ‰§è¡Œçº¿ç¨‹ï¼Œ<strong>éœ€é‡æ–°è¯·æ±‚åŒæ­¥é”</strong></p></li> <li><p><code>notifyAll()</code>ï¼šè®© obj ä¸Šæ­£åœ¨ WaitSet ç­‰å¾…çš„çº¿ç¨‹å…¨éƒ¨å”¤é†’</p> <p>å”¤é†’æ­£åœ¨æ’é˜Ÿç­‰å¾…èµ„æºçš„æ‰€æœ‰çº¿ç¨‹ç»“æŸç­‰å¾…</p></li></ul> <div class="custom-block tip"><p class="custom-block-title">æç¤º</p> <p>å“ªæ€•åªé€šçŸ¥äº†ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹ï¼Œè¢«é€šçŸ¥çº¿ç¨‹ä¹Ÿä¸èƒ½ç«‹å³æ¢å¤æ‰§è¡Œï¼Œå› ä¸ºå®ƒå½“åˆä¸­æ–­çš„åœ°æ–¹æ˜¯åœ¨åŒæ­¥å—å†…ï¼Œè€Œæ­¤åˆ»å®ƒå·²ç»ä¸æŒæœ‰é”ï¼Œæ‰€ä»¥å¥¹éœ€è¦å†æ¬¡å°è¯•å»è·å–é”ï¼ˆå¾ˆå¯èƒ½é¢ä¸´å…¶å®ƒçº¿ç¨‹çš„ç«äº‰ï¼‰ï¼ŒæˆåŠŸåæ‰èƒ½åœ¨å½“åˆè°ƒç”¨ wait æ–¹æ³•ä¹‹åçš„åœ°æ–¹æ¢å¤æ‰§è¡Œã€‚
æ€»ç»“å¦‚ä¸‹ï¼š
å¦‚æœèƒ½è·å–é”ï¼Œçº¿ç¨‹å°±ä» WAITING çŠ¶æ€å˜æˆ RUNNABLE çŠ¶æ€ï¼› å¦åˆ™ï¼Œä» WaitSet å‡ºæ¥ï¼Œåˆè¿›å…¥ EntryListï¼Œçº¿ç¨‹å°±ä» WAITING çŠ¶æ€åˆå˜æˆ BLOCKED çŠ¶æ€ã€‚</p></div> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;Test1&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test1</span> <span class="token punctuation">{</span>

    <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œ....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    obj<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è®©çº¿ç¨‹åœ¨objä¸Šä¸€ç›´ç­‰å¾…ä¸‹å»</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œåç»­ä»£ç ....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œ....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    obj<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è®©çº¿ç¨‹åœ¨objä¸Šä¸€ç›´ç­‰å¾…ä¸‹å»</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œåç»­ä»£ç ....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ä¸»çº¿ç¨‹ä¸¤ç§’åæ‰§è¡Œ</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å”¤é†’ obj ä¸Šå…¶å®ƒçº¿ç¨‹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            obj<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å”¤é†’objä¸Šä¸€ä¸ªçº¿ç¨‹</span>
            <span class="token comment">// obj.notifyAll(); // å”¤é†’objä¸Šæ‰€æœ‰ç­‰å¾…çº¿ç¨‹</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h3 id="sleep-ä¸-wait-åŒºåˆ«-ğŸ”¥"><a href="#sleep-ä¸-wait-åŒºåˆ«-ğŸ”¥" class="header-anchor">#</a> sleep ä¸ wait åŒºåˆ« ğŸ”¥</h3> <ul><li>sleep æ˜¯ Thread æ–¹æ³•ï¼Œè€Œ wait æ˜¯ Object çš„æ–¹æ³•</li> <li>sleep ä¸éœ€è¦å¼ºåˆ¶å’Œ synchronized é…åˆä½¿ç”¨ï¼Œä½† wait éœ€è¦å’Œ synchronized ä¸€èµ·ç”¨</li> <li>sleep åœ¨ç¡çœ çš„åŒæ—¶ï¼Œä¸ä¼šé‡Šæ”¾å¯¹è±¡é”çš„ï¼Œä½† wait åœ¨ç­‰å¾…çš„æ—¶å€™ä¼šé‡Šæ”¾å¯¹è±¡é”</li> <li>çŠ¶æ€éƒ½æ˜¯ TIMED_WAITING</li></ul> <h3 id="æ­£ç¡®ä½¿ç”¨-waitã€notify-æ­¥éª¤-ğŸ”¥"><a href="#æ­£ç¡®ä½¿ç”¨-waitã€notify-æ­¥éª¤-ğŸ”¥" class="header-anchor">#</a> æ­£ç¡®ä½¿ç”¨ waitã€notify æ­¥éª¤ ğŸ”¥</h3> <p>å…ˆæ¥ä¸ª<strong>æ ¼å¼</strong>å§ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">synchronized</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>æ¡ä»¶ä¸æˆç«‹<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¹²æ´»</span>
<span class="token punctuation">}</span>

<span class="token keyword">synchronized</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	lock<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>è¢«å”¤é†’åè‹¥è·å¾—é”åˆ™ä»waitåç»§ç»­æ‰§è¡Œï¼Œè¿™é‡Œç”±äºæ˜¯whileï¼Œåº”è¯¥ç»§ç»­æ‰§è¡Œwhileæ¡ä»¶åˆ¤æ–­</p> <p>å…·ä½“æ€è·¯å¦‚ä¸‹</p> <h4 id="sleep-æ–¹å¼"><a href="#sleep-æ–¹å¼" class="header-anchor">#</a> sleep æ–¹å¼</h4> <p>æ€è€ƒä¸‹é¢çš„è§£å†³æ–¹æ¡ˆå¥½ä¸å¥½ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;TestWaitNotify&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestWaitNotify</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> room <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">boolean</span> hasCigarette <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">// æœ‰çƒŸå—</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token function">step1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">step1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æœ‰çƒŸæ²¡ï¼Ÿ[{}]&quot;</span><span class="token punctuation">,</span> hasCigarette<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasCigarette<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æœ‰çƒŸæ²¡ï¼Ÿ[{}]&quot;</span><span class="token punctuation">,</span> hasCigarette<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>hasCigarette<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;å°å—&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;å…¶å®ƒäºº&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// è¿™é‡Œèƒ½ä¸èƒ½åŠ  synchronized (room)ï¼Ÿä¸èƒ½ï¼ŒåŠ äº†ååœ¨å°å—çº¿ç¨‹sleepæ—¶ï¼ˆä¸é‡Šæ”¾é”ï¼‰ä¸»çº¿ç¨‹è¿™é‡Œæ— æ³•è·å–é”</span>
            hasCigarette <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;çƒŸåˆ°äº†å™¢ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;é€çƒŸçš„&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><p>ç»“æœå¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>15:42:08.224 [å°å—] DEBUG TestWaitNotify - æœ‰çƒŸæ²¡ï¼Ÿ[false]
15:42:08.227 [å°å—] DEBUG TestWaitNotify - æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼
15:42:09.226 [é€çƒŸçš„] DEBUG TestWaitNotify - çƒŸåˆ°äº†å™¢ï¼
15:42:10.231 [å°å—] DEBUG TestWaitNotify - æœ‰çƒŸæ²¡ï¼Ÿ[true]
15:42:10.232 [å°å—] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
15:42:10.232 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
15:42:10.232 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
15:42:10.233 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
15:42:10.233 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
15:42:10.233 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>é—®é¢˜å¦‚ä¸‹ï¼š</p> <ul><li>å°å—çº¿ç¨‹æœªæ‰§è¡Œå®Œæ¯•æ—¶ï¼ˆåŒ…æ‹¬sleepä¸­ï¼‰å…¶å®ƒå¹²æ´»çš„çº¿ç¨‹ï¼Œéƒ½è¦ä¸€ç›´é˜»å¡ï¼Œæ•ˆç‡å¤ªä½</li> <li>å°å—çº¿ç¨‹å¿…é¡»ç¡è¶³ 2s åæ‰èƒ½é†’æ¥ï¼Œå°±ç®—çƒŸæå‰é€åˆ°ï¼Œä¹Ÿæ— æ³•ç«‹åˆ»é†’æ¥</li> <li>åŠ äº† synchronized (room) åï¼Œå°±å¥½æ¯”å°å—åœ¨é‡Œé¢åé”äº†é—¨ç¡è§‰ï¼ŒçƒŸæ ¹æœ¬æ²¡æ³•é€è¿›é—¨ï¼Œmain æ²¡åŠ  synchronized å°±å¥½åƒ main çº¿ç¨‹æ˜¯ç¿»çª—æˆ·è¿›æ¥çš„</li> <li>è§£å†³æ–¹æ³•ï¼Œä½¿ç”¨ wait - notify æœºåˆ¶</li></ul> <h4 id="wait-notify-æ”¹è¿›"><a href="#wait-notify-æ”¹è¿›" class="header-anchor">#</a> wait + notify æ”¹è¿›</h4> <p>æ€è€ƒä¸‹é¢çš„å®ç°è¡Œå—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;TestWaitNotify&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestWaitNotify</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> room <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">boolean</span> hasCigarette <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">// æœ‰çƒŸå—</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token function">step2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * waitã€notify æ–¹å¼
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">step2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æœ‰çƒŸæ²¡ï¼Ÿ[{}]&quot;</span><span class="token punctuation">,</span> hasCigarette<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasCigarette<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        room<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æœ‰çƒŸæ²¡ï¼Ÿ[{}]&quot;</span><span class="token punctuation">,</span> hasCigarette<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>hasCigarette<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;å°å—&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;å…¶å®ƒäºº&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// è¿™é‡Œèƒ½ä¸èƒ½åŠ  synchronized (room)ï¼Ÿä¸èƒ½ï¼ŒåŠ äº†ååœ¨å°å—çº¿ç¨‹sleepæ—¶ï¼ˆä¸é‡Šæ”¾é”ï¼‰ä¸»çº¿ç¨‹è¿™é‡Œæ— æ³•è·å–é”</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                hasCigarette <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;çƒŸåˆ°äº†å™¢ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                room<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;é€çƒŸçš„&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>ç»“æœå¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>15:46:57.337 [å°å—] DEBUG TestWaitNotify - æœ‰çƒŸæ²¡ï¼Ÿ[false]
15:46:57.344 [å°å—] DEBUG TestWaitNotify - æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼
15:46:57.344 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
15:46:57.344 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
15:46:57.344 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
15:46:57.344 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
15:46:57.344 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
15:46:58.344 [é€çƒŸçš„] DEBUG TestWaitNotify - çƒŸåˆ°äº†å™¢ï¼
15:46:58.344 [å°å—] DEBUG TestWaitNotify - æœ‰çƒŸæ²¡ï¼Ÿ[true]
15:46:58.344 [å°å—] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>é—®é¢˜å¦‚ä¸‹ï¼š</p> <ul><li>è§£å†³äº†å…¶å®ƒå¹²æ´»çš„çº¿ç¨‹é˜»å¡çš„é—®é¢˜ï¼Œä½†å¦‚æœæœ‰å…¶å®ƒçº¿ç¨‹ä¹Ÿåœ¨ç­‰å¾…æ¡ä»¶å‘¢ï¼Ÿä¼šä¸ä¼šå«é†’äº†å…¶ä»–çº¿ç¨‹ï¼Ÿ</li></ul> <h4 id="notify-è™šå‡å”¤é†’-notifyall"><a href="#notify-è™šå‡å”¤é†’-notifyall" class="header-anchor">#</a> notify è™šå‡å”¤é†’ + notifyAll</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;TestWaitNotify&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestWaitNotify</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> room <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">boolean</span> hasCigarette <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">// æœ‰çƒŸå—</span>
    <span class="token keyword">static</span> <span class="token keyword">boolean</span> hasTakeout <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">// æœ‰å¤–å–å—</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// step1();</span>
        <span class="token comment">// step2();</span>
        <span class="token function">step3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">step3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æœ‰çƒŸæ²¡ï¼Ÿ[{}]&quot;</span><span class="token punctuation">,</span> hasCigarette<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasCigarette<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        room<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æœ‰çƒŸæ²¡ï¼Ÿ[{}]&quot;</span><span class="token punctuation">,</span> hasCigarette<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>hasCigarette<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;å°å—&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¤–å–é€åˆ°æ²¡ï¼Ÿ[{}]&quot;</span><span class="token punctuation">,</span> hasTakeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasTakeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ²¡å¤–å–ï¼Œå…ˆæ­‡ä¼šï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        room<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¤–å–é€åˆ°æ²¡ï¼Ÿ[{}]&quot;</span><span class="token punctuation">,</span> hasTakeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>hasTakeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ²¡å¹²æˆæ´»...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;å°å¥³&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;å…¶å®ƒäºº&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é€å¤–å–çš„æŠŠå°å—çº¿ç¨‹å”¤é†’äº†ï¼ï¼ï¼æ²¡å”¤é†’å°å¥³çº¿ç¨‹</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                hasTakeout <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¤–å–åˆ°äº†å™¢ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                room<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;é€å¤–å–çš„&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><p>ç»“æœå¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>15:55:04.411 [å°å—] DEBUG TestWaitNotify - æœ‰çƒŸæ²¡ï¼Ÿ[false]
15:55:04.414 [å°å—] DEBUG TestWaitNotify - æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼
15:55:04.414 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
15:55:04.414 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
15:55:04.414 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
15:55:04.414 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
15:55:04.415 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
15:55:04.415 [å°å¥³] DEBUG TestWaitNotify - å¤–å–é€åˆ°æ²¡ï¼Ÿ[false]
15:55:04.415 [å°å¥³] DEBUG TestWaitNotify - æ²¡å¤–å–ï¼Œå…ˆæ­‡ä¼šï¼
15:55:05.411 [é€å¤–å–çš„] DEBUG TestWaitNotify - å¤–å–åˆ°äº†å™¢ï¼
15:55:05.411 [å°å—] DEBUG TestWaitNotify - æœ‰çƒŸæ²¡ï¼Ÿ[false]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>é—®é¢˜å¦‚ä¸‹ï¼š</p> <ul><li>notify åªèƒ½éšæœºå”¤é†’ä¸€ä¸ª WaitSet ä¸­çš„çº¿ç¨‹ï¼Œè¿™æ—¶å¦‚æœæœ‰å…¶å®ƒçº¿ç¨‹ä¹Ÿåœ¨ç­‰å¾…ï¼Œé‚£ä¹ˆå°±å¯èƒ½å”¤é†’ä¸äº†æ­£ç¡®çš„çº¿ç¨‹ï¼Œç§°ä¹‹ä¸ºã€è™šå‡å”¤é†’ã€‘</li> <li>è§£å†³æ–¹æ³•ï¼Œæ”¹ä¸º notifyAllã€‚ç»“æœå¦‚ä¸‹ï¼š</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>16:04:01.018 [å°å—] DEBUG TestWaitNotify - æœ‰çƒŸæ²¡ï¼Ÿ[false]
16:04:01.022 [å°å—] DEBUG TestWaitNotify - æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼
16:04:01.022 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
16:04:01.022 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
16:04:01.023 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
16:04:01.023 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
16:04:01.023 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
16:04:01.023 [å°å¥³] DEBUG TestWaitNotify - å¤–å–é€åˆ°æ²¡ï¼Ÿ[false]
16:04:01.023 [å°å¥³] DEBUG TestWaitNotify - æ²¡å¤–å–ï¼Œå…ˆæ­‡ä¼šï¼
16:04:02.019 [é€å¤–å–çš„] DEBUG TestWaitNotify - å¤–å–åˆ°äº†å™¢ï¼
16:04:02.020 [å°å¥³] DEBUG TestWaitNotify - å¤–å–é€åˆ°æ²¡ï¼Ÿ[true]
16:04:02.020 [å°å¥³] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
16:04:02.020 [å°å—] DEBUG TestWaitNotify - æœ‰çƒŸæ²¡ï¼Ÿ[false]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>é—®é¢˜å¦‚ä¸‹ï¼š</p> <ul><li>ç”¨ notifyAll ä»…è§£å†³æŸä¸ªçº¿ç¨‹çš„å”¤é†’é—®é¢˜ï¼Œä½†ä½¿ç”¨ if + wait åˆ¤æ–­ä»…æœ‰ä¸€æ¬¡æœºä¼šï¼Œä¸€æ—¦æ¡ä»¶ä¸æˆç«‹ï¼Œå°±æ²¡æœ‰é‡æ–°åˆ¤æ–­çš„æœºä¼šäº†</li> <li>è§£å†³æ–¹æ³•ï¼Œ<strong>ç”¨ while + waitï¼Œå½“æ¡ä»¶ä¸æˆç«‹ï¼Œå†æ¬¡ wait</strong></li></ul> <h4 id="while-wait-notifyall-ğŸ”¥"><a href="#while-wait-notifyall-ğŸ”¥" class="header-anchor">#</a> while + wait + notifyAll ğŸ”¥</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;TestWaitNotify&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestWaitNotify</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> room <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">boolean</span> hasCigarette <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">// æœ‰çƒŸå—</span>
    <span class="token keyword">static</span> <span class="token keyword">boolean</span> hasTakeout <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">// æœ‰å¤–å–å—</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token function">step4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * whileã€waitã€notifyAll æ–¹å¼
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">step4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æœ‰çƒŸæ²¡ï¼Ÿ[{}]&quot;</span><span class="token punctuation">,</span> hasCigarette<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasCigarette<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        room<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æœ‰çƒŸäº†ï¼Œå¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;å°å—&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¤–å–é€åˆ°æ²¡ï¼Ÿ[{}]&quot;</span><span class="token punctuation">,</span> hasTakeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasTakeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ²¡å¤–å–ï¼Œå…ˆæ­‡ä¼šï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        room<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æœ‰å¤–å–äº†ï¼Œå¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;å°å¥³&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;å…¶å®ƒäºº&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é€å¤–å–çš„æŠŠå°å—çº¿ç¨‹å”¤é†’äº†ï¼ï¼ï¼æ²¡å”¤é†’å°å¥³çº¿ç¨‹</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                hasTakeout <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¤–å–åˆ°äº†å™¢ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                room<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;é€å¤–å–çš„&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><p>ç»“æœå¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>16:12:11.012 [å°å—] DEBUG TestWaitNotify - æœ‰çƒŸæ²¡ï¼Ÿ[false]
16:12:11.015 [å°å—] DEBUG TestWaitNotify - æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼
16:12:11.015 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
16:12:11.015 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
16:12:11.015 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
16:12:11.015 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
16:12:11.016 [å…¶å®ƒäºº] DEBUG TestWaitNotify - å¯ä»¥å¼€å§‹å¹²æ´»äº†
16:12:11.016 [å°å¥³] DEBUG TestWaitNotify - å¤–å–é€åˆ°æ²¡ï¼Ÿ[false]
16:12:11.016 [å°å¥³] DEBUG TestWaitNotify - æ²¡å¤–å–ï¼Œå…ˆæ­‡ä¼šï¼
16:12:12.012 [é€å¤–å–çš„] DEBUG TestWaitNotify - å¤–å–åˆ°äº†å™¢ï¼
16:12:12.013 [å°å¥³] DEBUG TestWaitNotify - æœ‰å¤–å–äº†ï¼Œå¯ä»¥å¼€å§‹å¹²æ´»äº†
16:12:12.013 [å°å—] DEBUG TestWaitNotify - æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="è®¾è®¡æ¨¡å¼-ä¿æŠ¤æ€§æš‚åœ-ğŸ”¥"><a href="#è®¾è®¡æ¨¡å¼-ä¿æŠ¤æ€§æš‚åœ-ğŸ”¥" class="header-anchor">#</a> è®¾è®¡æ¨¡å¼â€”ä¿æŠ¤æ€§æš‚åœ ğŸ”¥</h3> <p>è§è®¾è®¡æ¨¡å¼</p> <h3 id="join-åŸç†-æºç "><a href="#join-åŸç†-æºç " class="header-anchor">#</a> join åŸç†â€”æºç </h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token function">join</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">long</span> millis<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> base <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> now <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>millis <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;timeout value is negative&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>millis <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> delay <span class="token operator">=</span> millis <span class="token operator">-</span> now<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>delay <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">wait</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
            now <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> base<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>join ä½“ç°çš„æ˜¯ã€ä¿æŠ¤æ€§æš‚åœã€‘æ¨¡å¼ï¼Œè¯·å‚è€ƒä¹‹</p> <h3 id="è®¾è®¡æ¨¡å¼-ç”Ÿäº§è€…æ¶ˆè´¹è€…-ğŸ”¥"><a href="#è®¾è®¡æ¨¡å¼-ç”Ÿäº§è€…æ¶ˆè´¹è€…-ğŸ”¥" class="header-anchor">#</a> è®¾è®¡æ¨¡å¼â€”ç”Ÿäº§è€…æ¶ˆè´¹è€… ğŸ”¥</h3> <p>è§è®¾è®¡æ¨¡å¼</p> <h2 id="parkã€unpark-ğŸ”¥"><a href="#parkã€unpark-ğŸ”¥" class="header-anchor">#</a> parkã€unpark ğŸ”¥</h2> <h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="header-anchor">#</a> åŸºæœ¬ä½¿ç”¨</h3> <p>å®ƒä»¬æ˜¯ LockSupport ç±»ä¸­çš„æ–¹æ³•</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// æš‚åœå½“å‰çº¿ç¨‹</span>
<span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// æ¢å¤æŸä¸ªçº¿ç¨‹çš„è¿è¡Œ</span>
<span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span>æš‚åœçº¿ç¨‹å¯¹è±¡<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>å…ˆ park å† unpark</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;start...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;park...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;resume...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;unpark...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>è¾“å‡º</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>18:42:52.585 c.TestParkUnpark [t1] - start... 
18:42:53.589 c.TestParkUnpark [t1] - park... 
18:42:54.583 c.TestParkUnpark [main] - unpark... 
18:42:54.583 c.TestParkUnpark [t1] - resume...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>å…ˆ unpark å† park</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;start...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;park...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;resume...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;unpark...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>è¾“å‡º</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>18:43:50.765 c.TestParkUnpark [t1] - start... 
18:43:51.764 c.TestParkUnpark [main] - unpark... 
18:43:52.769 c.TestParkUnpark [t1] - park... 
18:43:52.769 c.TestParkUnpark [t1] - resume...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="ç‰¹ç‚¹-ğŸ”¥"><a href="#ç‰¹ç‚¹-ğŸ”¥" class="header-anchor">#</a> ç‰¹ç‚¹ ğŸ”¥</h3> <p>ä¸ Object çš„ wait &amp; notify ç›¸æ¯”</p> <ul><li><strong>waitï¼Œnotify å’Œ notifyAll å¿…é¡»é…åˆ Object Monitor</strong> ï¼ˆsyncï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œ<strong>è€Œ parkï¼Œunpark ä¸å¿…</strong></li> <li><strong>park &amp; unpark æ˜¯ä»¥çº¿ç¨‹ä¸ºå•ä½æ¥ã€é˜»å¡ã€‘å’Œã€å”¤é†’ã€‘çº¿ç¨‹</strong>ï¼Œè€Œ notify åªèƒ½éšæœºå”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼ŒnotifyAll æ˜¯å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼Œå°±ä¸é‚£ä¹ˆã€<strong>ç²¾ç¡®</strong>ã€‘</li> <li><strong>park &amp; unpark å¯ä»¥å…ˆ unparkï¼Œè€Œ wait &amp; notify ä¸èƒ½å…ˆ notify</strong></li> <li>parkåçº¿ç¨‹çŠ¶æ€æ˜¯ WAITING</li></ul> <h3 id="åº•å±‚åŸç†-ğŸ”¥"><a href="#åº•å±‚åŸç†-ğŸ”¥" class="header-anchor">#</a> åº•å±‚åŸç† ğŸ”¥</h3> <p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸€ä¸ª Parker å¯¹è±¡ï¼ˆåº•å±‚Cå®ç°ï¼‰ï¼Œç”±ä¸‰éƒ¨åˆ†ç»„æˆ <code>_counter</code> ï¼Œ <code>_cond</code> å’Œ <code>_mutex</code> æ‰“ä¸ªæ¯”å–»</p> <ul><li>çº¿ç¨‹å°±åƒä¸€ä¸ªæ—…äººï¼ŒParker å°±åƒä»–éšèº«æºå¸¦çš„èƒŒåŒ…ï¼Œ<code>_cond</code> æ¡ä»¶å˜é‡å°±å¥½æ¯”èƒŒåŒ…ä¸­çš„å¸ç¯·ã€‚<code>_counter</code> å°±å¥½æ¯”èƒŒåŒ…ä¸­çš„å¤‡ç”¨å¹²ç²®ï¼ˆ0 ä¸ºè€—å°½ï¼Œ1 ä¸ºå……è¶³ï¼‰</li> <li><strong>è°ƒç”¨ park å°±æ˜¯è¦çœ‹éœ€ä¸éœ€è¦åœä¸‹æ¥æ­‡æ¯</strong> <ul><li>å¦‚æœå¤‡ç”¨å¹²ç²®è€—å°½ï¼Œé‚£ä¹ˆé’»è¿›å¸ç¯·æ­‡æ¯</li> <li>å¦‚æœå¤‡ç”¨å¹²ç²®å……è¶³ï¼Œé‚£ä¹ˆä¸éœ€åœç•™ï¼Œç»§ç»­å‰è¿›</li></ul></li> <li><strong>è°ƒç”¨ unparkï¼Œå°±å¥½æ¯”ä»¤å¹²ç²®å……è¶³</strong> <ul><li>å¦‚æœè¿™æ—¶çº¿ç¨‹è¿˜åœ¨å¸ç¯·ï¼Œå°±å”¤é†’è®©ä»–ç»§ç»­å‰è¿›</li> <li>å¦‚æœè¿™æ—¶çº¿ç¨‹è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆä¸‹æ¬¡ä»–è°ƒç”¨ park æ—¶ï¼Œä»…æ˜¯æ¶ˆè€—æ‰å¤‡ç”¨å¹²ç²®ï¼Œä¸éœ€åœç•™ç»§ç»­å‰è¿›
<ul><li>å› ä¸ºèƒŒåŒ…ç©ºé—´æœ‰é™ï¼Œå¤šæ¬¡è°ƒç”¨ unpark ä»…ä¼šè¡¥å……ä¸€ä»½å¤‡ç”¨å¹²ç²®</li></ul></li></ul></li></ul> <p>æµç¨‹å¦‚ä¸‹ï¼š</p> <p><img src="/assets/img/image-20210222003332613.26cf9e87.png" alt="image-20210222003332613"></p> <ol><li><p>å½“å‰çº¿ç¨‹è°ƒç”¨ Unsafe.park() æ–¹æ³•</p></li> <li><p>æ£€æŸ¥ _counter ï¼Œæœ¬æƒ…å†µä¸º 0ï¼Œè¿™æ—¶ï¼Œè·å¾— _mutex äº’æ–¥é”</p></li> <li><p>çº¿ç¨‹è¿›å…¥ _cond æ¡ä»¶å˜é‡é˜»å¡</p></li> <li><p>è®¾ç½® _counter = 0ï¼ï¼ï¼æœ¬æ¥å°±æ˜¯0</p></li></ol> <p><img src="/assets/img/image-20210222003428179.8e236746.png" alt="image-20210222003428179"></p> <ol><li>è°ƒç”¨ Unsafe.unpark(Thread_0) æ–¹æ³•ï¼Œè®¾ç½® _counter ä¸º 1</li> <li>å”¤é†’ _cond æ¡ä»¶å˜é‡ä¸­çš„ Thread_0</li> <li>Thread_0 æ¢å¤è¿è¡Œ</li> <li>è®¾ç½® _counter ä¸º 0ï¼ï¼ï¼å› ä¸ºè¿è¡Œäº†æ¶ˆè€—æ‰€ä»¥åˆæ”¹ä¸º0</li></ol> <p><img src="/assets/img/image-20210222003456287.1c2851fa.png" alt="image-20210222003456287"></p> <ol><li>è°ƒç”¨ Unsafe.unpark(Thread_0) æ–¹æ³•ï¼Œè®¾ç½® _counter ä¸º 1</li> <li>å½“å‰çº¿ç¨‹è°ƒç”¨ Unsafe.park() æ–¹æ³•</li> <li>æ£€æŸ¥ _counter ï¼Œæœ¬æƒ…å†µä¸º 1ï¼Œè¿™æ—¶çº¿ç¨‹<strong>æ— éœ€é˜»å¡ï¼Œç»§ç»­è¿è¡Œ</strong></li> <li>è®¾ç½® _counter ä¸º 0ï¼ï¼ï¼å› ä¸ºè¿è¡Œäº†æ¶ˆè€—æ‰€ä»¥åˆæ”¹ä¸º0</li></ol> <h2 id="å¤šæŠŠé”-é”ç²’åº¦-ğŸ”¥"><a href="#å¤šæŠŠé”-é”ç²’åº¦-ğŸ”¥" class="header-anchor">#</a> å¤šæŠŠé”â€”é”ç²’åº¦ ğŸ”¥</h2> <p>ä¸€é—´å¤§å±‹å­æœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼šç¡è§‰ã€å­¦ä¹ ï¼Œäº’ä¸ç›¸å¹²ã€‚ç°åœ¨å°å—è¦å­¦ä¹ ï¼Œå°å¥³è¦ç¡è§‰ï¼Œä½†å¦‚æœåªç”¨ä¸€é—´å±‹å­ï¼ˆä¸€ä¸ªå¯¹è±¡é”ï¼‰çš„è¯ï¼Œé‚£ä¹ˆå¹¶å‘åº¦å¾ˆä½ã€‚è§£å†³æ–¹æ³•æ˜¯å‡†å¤‡å¤šä¸ªæˆ¿é—´ï¼ˆå¤šä¸ªå¯¹è±¡é”ï¼‰</p> <p>ä¾‹å¦‚ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">BigRoom</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;sleeping 2 å°æ—¶&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">study</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;study 1 å°æ—¶&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BigRoom</span> bigRoom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigRoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            bigRoom<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;å°å—&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            bigRoom<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;å°å¥³&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>æŸæ¬¡ç»“æœ</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>12:13:54.471 [å°å—] c.BigRoom - study 1 å°æ—¶
12:13:55.476 [å°å¥³] c.BigRoom - sleeping 2 å°æ—¶
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æ”¹è¿›</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">BigRoom</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> studyRoom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> bedRoom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>bedRoom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;sleeping 2 å°æ—¶&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">study</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>studyRoom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;study 1 å°æ—¶&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BigRoom</span> bigRoom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigRoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            bigRoom<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;å°å—&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            bigRoom<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;å°å¥³&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>æŸæ¬¡æ‰§è¡Œç»“æœ</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>12:15:35.069 [å°å—] c.BigRoom - study 1 å°æ—¶
12:15:35.069 [å°å¥³] c.BigRoom - sleeping 2 å°æ—¶
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å°†<strong>é”çš„ç²’åº¦ç»†åˆ†</strong>ï¼ˆä¸šåŠ¡èµ„æºæ˜¯æ²¡æœ‰å…³è”çš„ï¼Œå¦åˆ™æ— æ³•ç»†åˆ†ï¼‰</p> <ul><li><p>å¥½å¤„ï¼Œæ˜¯å¯ä»¥<strong>å¢å¼ºå¹¶å‘åº¦</strong></p></li> <li><p>åå¤„ï¼Œ<strong>å¦‚æœä¸€ä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶è·å¾—å¤šæŠŠé”ï¼Œå°±å®¹æ˜“å‘ç”Ÿæ­»é”</strong></p></li></ul> <h2 id="çº¿ç¨‹æ´»è·ƒæ€§-ğŸ”¥"><a href="#çº¿ç¨‹æ´»è·ƒæ€§-ğŸ”¥" class="header-anchor">#</a> çº¿ç¨‹æ´»è·ƒæ€§ ğŸ”¥</h2> <h3 id="æ­»é”-ğŸ”¥"><a href="#æ­»é”-ğŸ”¥" class="header-anchor">#</a> æ­»é” ğŸ”¥</h3> <p>æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„çº¿ç¨‹åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå› <strong>äº‰å¤ºèµ„æº</strong>äº§ç”Ÿçš„ä¸€ç§<strong>äº’ç›¸ç­‰å¾…</strong>ç°è±¡ã€‚ä¸€ä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶è·å–å¤šæŠŠé”ï¼Œè¿™æ—¶å°±å®¹æ˜“å‘ç”Ÿæ­»é”</p> <p>ä¸è¦ä½¿ç”¨ String æ¥åšé”ã€‚å¦‚ï¼šString s1 = &quot;Hello&quot; å’Œ String s2 = &quot;Hello&quot; å…¶å®æ˜¯åŒä¸€æŠŠé”ï¼›è¿˜ä¼šå¯èƒ½ä¸å…¶ä»–ç±»åº“å‘ç”Ÿæ­»é”ã€‚</p> <p>t1 çº¿ç¨‹ è·å¾— Aå¯¹è±¡ é”ï¼Œæ¥ä¸‹æ¥æƒ³è·å– Bå¯¹è±¡ çš„é” t2 çº¿ç¨‹ è·å¾— Bå¯¹è±¡ é”ï¼Œæ¥ä¸‹æ¥æƒ³è·å– Aå¯¹è±¡çš„é”ã€‚ä¾‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeadLock</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> lock1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> lock2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;t1 get lock1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// å¯åœ¨æ­¤å¤„sleepæé«˜æ­»é”æ¦‚ç‡</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;t1 get lock2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;t2 get lock2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// å¯åœ¨æ­¤å¤„sleepæé«˜æ­»é”æ¦‚ç‡</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;t2 get lock1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>å¯èƒ½å‡ºç°çš„ç»“æœæœ‰ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 1 æ­£å¸¸
t1 get lock1
t1 get lock2
t2 get lock2
t2 get lock1

// 2 æ­£å¸¸
t2 get lock2
t2 get lock1
t1 get lock1
t1 get lock2

// 3 æ­»é”
t1 get lock1
t2 get lock2

// 4 æ­»é”
t2 get lock2
t1 get lock1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="å®šä½æ­»é”-jps-jstack-sconsole-ğŸ”¥"><a href="#å®šä½æ­»é”-jps-jstack-sconsole-ğŸ”¥" class="header-anchor">#</a> å®šä½æ­»é”â€”jps jstack sconsole ğŸ”¥</h3> <p><code>jps</code> æ‰§è¡Œå</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>51203 RemoteMavenServer36
51204 RemoteMavenServer36
26357
51205 RemoteMavenServer36
95943 DeadLock
95942 Launcher
96462 Jps
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>jstack 95943</code>æŸ¥çœ‹ 95943 DeadLock</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>2021-02-23 21:51:28
Full thread dump OpenJDK 64-Bit Server VM (25.232-b09 mixed mode):

&quot;Attach Listener&quot; #14 daemon prio=9 os_prio=31 tid=0x00007fba44086800 nid=0xa203 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;DestroyJavaVM&quot; #13 prio=5 os_prio=31 tid=0x00007fba4604e800 nid=0xe03 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;t2&quot; #12 prio=5 os_prio=31 tid=0x00007fba4604d800 nid=0x5b03 waiting for monitor entry [0x00007000111df000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at _12_deadlock.DeadLock.lambda$main$1(DeadLock.java:30)
	- waiting to lock &lt;0x000000076ac2dc88&gt; (a java.lang.Object)
	- locked &lt;0x000000076ac2dc98&gt; (a java.lang.Object)
	at _12_deadlock.DeadLock$$Lambda$2/764977973.run(Unknown Source)
	at java.lang.Thread.run(Thread.java:748)

&quot;t1&quot; #11 prio=5 os_prio=31 tid=0x00007fba4604d000 nid=0x5903 waiting for monitor entry [0x00007000110dc000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at _12_deadlock.DeadLock.lambda$main$0(DeadLock.java:20)
	- waiting to lock &lt;0x000000076ac2dc98&gt; (a java.lang.Object)
	- locked &lt;0x000000076ac2dc88&gt; (a java.lang.Object)
	at _12_deadlock.DeadLock$$Lambda$1/1452126962.run(Unknown Source)
	at java.lang.Thread.run(Thread.java:748)

&quot;Service Thread&quot; #10 daemon prio=9 os_prio=31 tid=0x00007fba44828800 nid=0xa603 runnable [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;C1 CompilerThread3&quot; #9 daemon prio=9 os_prio=31 tid=0x00007fba45032800 nid=0x5703 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;C2 CompilerThread2&quot; #8 daemon prio=9 os_prio=31 tid=0x00007fba45032000 nid=0xa703 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;C2 CompilerThread1&quot; #7 daemon prio=9 os_prio=31 tid=0x00007fba45031000 nid=0xa903 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;C2 CompilerThread0&quot; #6 daemon prio=9 os_prio=31 tid=0x00007fba49821800 nid=0x4203 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;Monitor Ctrl-Break&quot; #5 daemon prio=5 os_prio=31 tid=0x00007fba4981f800 nid=0x4103 runnable [0x00007000109c7000]
   java.lang.Thread.State: RUNNABLE
	at java.net.SocketInputStream.socketRead0(Native Method)
	at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)
	at java.net.SocketInputStream.read(SocketInputStream.java:171)
	at java.net.SocketInputStream.read(SocketInputStream.java:141)
	at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:284)
	at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:326)
	at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:178)
	- locked &lt;0x000000076ac7af78&gt; (a java.io.InputStreamReader)
	at java.io.InputStreamReader.read(InputStreamReader.java:184)
	at java.io.BufferedReader.fill(BufferedReader.java:161)
	at java.io.BufferedReader.readLine(BufferedReader.java:324)
	- locked &lt;0x000000076ac7af78&gt; (a java.io.InputStreamReader)
	at java.io.BufferedReader.readLine(BufferedReader.java:389)
	at com.intellij.rt.execution.application.AppMainV2$1.run(AppMainV2.java:61)

&quot;Signal Dispatcher&quot; #4 daemon prio=9 os_prio=31 tid=0x00007fba4a00b000 nid=0x3f07 runnable [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;Finalizer&quot; #3 daemon prio=8 os_prio=31 tid=0x00007fba4a008800 nid=0x3403 in Object.wait() [0x0000700010638000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on &lt;0x000000076ab08ed8&gt; (a java.lang.ref.ReferenceQueue$Lock)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:144)
	- locked &lt;0x000000076ab08ed8&gt; (a java.lang.ref.ReferenceQueue$Lock)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:165)
	at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:216)

&quot;Reference Handler&quot; #2 daemon prio=10 os_prio=31 tid=0x00007fba4481d800 nid=0x4d03 in Object.wait() [0x0000700010535000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on &lt;0x000000076ab06c00&gt; (a java.lang.ref.Reference$Lock)
	at java.lang.Object.wait(Object.java:502)
	at java.lang.ref.Reference.tryHandlePending(Reference.java:191)
	- locked &lt;0x000000076ab06c00&gt; (a java.lang.ref.Reference$Lock)
	at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:153)

&quot;VM Thread&quot; os_prio=31 tid=0x00007fba44016800 nid=0x4f03 runnable

&quot;GC task thread#0 (ParallelGC)&quot; os_prio=31 tid=0x00007fba4480e800 nid=0x1c07 runnable

&quot;GC task thread#1 (ParallelGC)&quot; os_prio=31 tid=0x00007fba4480f000 nid=0x2003 runnable

&quot;GC task thread#2 (ParallelGC)&quot; os_prio=31 tid=0x00007fba4400c000 nid=0x1e03 runnable

&quot;GC task thread#3 (ParallelGC)&quot; os_prio=31 tid=0x00007fba4400c800 nid=0x2a03 runnable

&quot;GC task thread#4 (ParallelGC)&quot; os_prio=31 tid=0x00007fba4481a800 nid=0x5303 runnable

&quot;GC task thread#5 (ParallelGC)&quot; os_prio=31 tid=0x00007fba4400d000 nid=0x5103 runnable

&quot;GC task thread#6 (ParallelGC)&quot; os_prio=31 tid=0x00007fba4400d800 nid=0x2c03 runnable

&quot;GC task thread#7 (ParallelGC)&quot; os_prio=31 tid=0x00007fba4400e800 nid=0x2e03 runnable

&quot;GC task thread#8 (ParallelGC)&quot; os_prio=31 tid=0x00007fba46008800 nid=0x2f03 runnable

&quot;GC task thread#9 (ParallelGC)&quot; os_prio=31 tid=0x00007fba46009000 nid=0x3103 runnable

&quot;VM Periodic Task Thread&quot; os_prio=31 tid=0x00007fba4604c000 nid=0xa403 waiting on condition

JNI global references: 320


Found one Java-level deadlock:
=============================
&quot;t2&quot;:
  waiting to lock monitor 0x00007fba4603deb8 (object 0x000000076ac2dc88, a java.lang.Object),
  which is held by &quot;t1&quot;
&quot;t1&quot;:
  waiting to lock monitor 0x00007fba4603f2a8 (object 0x000000076ac2dc98, a java.lang.Object),
  which is held by &quot;t2&quot;

Java stack information for the threads listed above:
===================================================
&quot;t2&quot;:
	at _12_deadlock.DeadLock.lambda$main$1(DeadLock.java:30)
	- waiting to lock &lt;0x000000076ac2dc88&gt; (a java.lang.Object)
	- locked &lt;0x000000076ac2dc98&gt; (a java.lang.Object)
	at _12_deadlock.DeadLock$$Lambda$2/764977973.run(Unknown Source)
	at java.lang.Thread.run(Thread.java:748)
&quot;t1&quot;:
	at _12_deadlock.DeadLock.lambda$main$0(DeadLock.java:20)
	- waiting to lock &lt;0x000000076ac2dc98&gt; (a java.lang.Object)
	- locked &lt;0x000000076ac2dc88&gt; (a java.lang.Object)
	at _12_deadlock.DeadLock$$Lambda$1/1452126962.run(Unknown Source)
	at java.lang.Thread.run(Thread.java:748)

Found 1 deadlock.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br></div></div><p>çœ‹ Found one Java-level deadlock: å³å¯çŸ¥é“ï¼št2çº¿ç¨‹æ‹¥æœ‰98çš„é”ï¼Œç­‰å¾…88çš„é”ï¼Œt1çº¿ç¨‹ç›¸å</p> <p><code>jconsole</code>ä¸“é—¨æœ‰æ£€æµ‹æ­»é”æŒ‰é’®</p> <h3 id="å“²å­¦å®¶å°±é¤é—®é¢˜-ğŸ”¥"><a href="#å“²å­¦å®¶å°±é¤é—®é¢˜-ğŸ”¥" class="header-anchor">#</a> å“²å­¦å®¶å°±é¤é—®é¢˜ ğŸ”¥</h3> <p><img src="/assets/img/image-20210223220035029.959a6077.png" alt="image-20210223220035029"></p> <p>æœ‰äº”ä½å“²å­¦å®¶ï¼Œå›´ååœ¨åœ†æ¡Œæ—ã€‚</p> <ul><li><p>ä»–ä»¬åªåšä¸¤ä»¶äº‹ï¼Œæ€è€ƒå’Œåƒé¥­ï¼Œæ€è€ƒä¸€ä¼šåƒå£é¥­ï¼Œåƒå®Œé¥­åæ¥ç€æ€è€ƒã€‚</p></li> <li><p>åƒé¥­æ—¶è¦ç”¨ä¸¤æ ¹ç­·å­åƒï¼Œæ¡Œä¸Šå…±æœ‰ 5 æ ¹ç­·å­ï¼Œæ¯ä½å“²å­¦å®¶å·¦å³æ‰‹è¾¹å„æœ‰ä¸€æ ¹ç­·å­ã€‚</p></li> <li><p>å¦‚æœç­·å­è¢«èº«è¾¹çš„äººæ‹¿ç€ï¼Œè‡ªå·±å°±å¾—ç­‰å¾…</p></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * ç­·å­
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Chopstick</span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;ç­·å­{&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'}'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
 * å“²å­¦å®¶
 */</span>
<span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;Philosopher&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Philosopher</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>

    <span class="token comment">// ç­·å­å……å½“é”</span>
    <span class="token keyword">final</span> <span class="token class-name">Chopstick</span> left<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">Chopstick</span> right<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Chopstick</span> left<span class="token punctuation">,</span> <span class="token class-name">Chopstick</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">=</span> left<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">=</span> right<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è·å¾—å·¦æ‰‹ç­·å­</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>left<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è·å¾—å³æ‰‹ç­·å­</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token comment">// åƒé¥­</span>
                        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;eating...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// æ”¾ä¸‹å³æ‰‹ç­·å­</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// æ”¾ä¸‹å·¦æ‰‹ç­·å­</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestPhilosopher</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Chopstick</span> c1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;ç­·å­1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;ç­·å­2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;ç­·å­3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;ç­·å­4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;ç­·å­5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;è‹æ ¼æ‹‰åº•&quot;</span><span class="token punctuation">,</span> c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;æŸæ‹‰å›¾&quot;</span><span class="token punctuation">,</span> c2<span class="token punctuation">,</span> c3<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;äºšé‡Œå£«å¤šå¾·&quot;</span><span class="token punctuation">,</span> c3<span class="token punctuation">,</span> c4<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;èµ«æ‹‰å…‹åˆ©ç‰¹&quot;</span><span class="token punctuation">,</span> c4<span class="token punctuation">,</span> c5<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;é˜¿åŸºç±³å¾·&quot;</span><span class="token punctuation">,</span> c5<span class="token punctuation">,</span> c1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><p>æ‰§è¡Œä¸å¤šä¼šï¼Œå°±æ‰§è¡Œä¸ä¸‹å»äº†</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>22:07:22.593 [äºšé‡Œå£«å¤šå¾·] DEBUG Philosopher - eating...
22:07:23.594 [äºšé‡Œå£«å¤šå¾·] DEBUG Philosopher - eating...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä½¿ç”¨<code>jstack</code>æ£€æŸ¥æ­»é”</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>2021-02-23 22:08:26
Full thread dump OpenJDK 64-Bit Server VM (25.232-b09 mixed mode):

&quot;Attach Listener&quot; #17 daemon prio=9 os_prio=31 tid=0x00007fc28d117800 nid=0x9c03 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;DestroyJavaVM&quot; #16 prio=5 os_prio=31 tid=0x00007fc28c85a000 nid=0x1203 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;é˜¿åŸºç±³å¾·&quot; #15 prio=5 os_prio=31 tid=0x00007fc28d81d800 nid=0x9d03 waiting for monitor entry [0x0000700004070000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at _12_deadlock.Philosopher.run(TestPhilosopher.java:51)
	- waiting to lock &lt;0x000000076ac2fd40&gt; (a _12_deadlock.Chopstick)
	- locked &lt;0x000000076ac2fe40&gt; (a _12_deadlock.Chopstick)

&quot;èµ«æ‹‰å…‹ï¿½ï¿½ç‰¹&quot; #14 prio=5 os_prio=31 tid=0x00007fc293808800 nid=0x5b03 waiting for monitor entry [0x0000700003f6d000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at _12_deadlock.Philosopher.run(TestPhilosopher.java:51)
	- waiting to lock &lt;0x000000076ac2fe40&gt; (a _12_deadlock.Chopstick)
	- locked &lt;0x000000076ac2fe00&gt; (a _12_deadlock.Chopstick)

&quot;äºšé‡Œå£«å¤šå¾·&quot; #13 prio=5 os_prio=31 tid=0x00007fc292018800 nid=0xa003 waiting for monitor entry [0x0000700003e6a000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at _12_deadlock.Philosopher.run(TestPhilosopher.java:51)
	- waiting to lock &lt;0x000000076ac2fe00&gt; (a _12_deadlock.Chopstick)
	- locked &lt;0x000000076ac2fdc0&gt; (a _12_deadlock.Chopstick)

&quot;æŸæ‹‰å›¾&quot; #12 prio=5 os_prio=31 tid=0x00007fc28d113000 nid=0x5a03 waiting for monitor entry [0x0000700003d67000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at _12_deadlock.Philosopher.run(TestPhilosopher.java:51)
	- waiting to lock &lt;0x000000076ac2fdc0&gt; (a _12_deadlock.Chopstick)
	- locked &lt;0x000000076ac2fd80&gt; (a _12_deadlock.Chopstick)

&quot;è‹æ ¼æ‹‰åº•&quot; #11 prio=5 os_prio=31 tid=0x00007fc28b86c000 nid=0xa303 waiting for monitor entry [0x0000700003c64000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at _12_deadlock.Philosopher.run(TestPhilosopher.java:51)
	- waiting to lock &lt;0x000000076ac2fd80&gt; (a _12_deadlock.Chopstick)
	- locked &lt;0x000000076ac2fd40&gt; (a _12_deadlock.Chopstick)

&quot;Service Thread&quot; #10 daemon prio=9 os_prio=31 tid=0x00007fc29282d800 nid=0x5803 runnable [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;C1 CompilerThread3&quot; #9 daemon prio=9 os_prio=31 tid=0x00007fc29281d000 nid=0x5703 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;C2 CompilerThread2&quot; #8 daemon prio=9 os_prio=31 tid=0x00007fc292814000 nid=0x5603 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;C2 CompilerThread1&quot; #7 daemon prio=9 os_prio=31 tid=0x00007fc292813800 nid=0xa903 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;C2 CompilerThread0&quot; #6 daemon prio=9 os_prio=31 tid=0x00007fc28d089800 nid=0x3f03 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;Monitor Ctrl-Break&quot; #5 daemon prio=5 os_prio=31 tid=0x00007fc28d05a000 nid=0x4003 runnable [0x000070000354f000]
   java.lang.Thread.State: RUNNABLE
	at java.net.SocketInputStream.socketRead0(Native Method)
	at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)
	at java.net.SocketInputStream.read(SocketInputStream.java:171)
	at java.net.SocketInputStream.read(SocketInputStream.java:141)
	at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:284)
	at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:326)
	at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:178)
	- locked &lt;0x000000076ac7ac70&gt; (a java.io.InputStreamReader)
	at java.io.InputStreamReader.read(InputStreamReader.java:184)
	at java.io.BufferedReader.fill(BufferedReader.java:161)
	at java.io.BufferedReader.readLine(BufferedReader.java:324)
	- locked &lt;0x000000076ac7ac70&gt; (a java.io.InputStreamReader)
	at java.io.BufferedReader.readLine(BufferedReader.java:389)
	at com.intellij.rt.execution.application.AppMainV2$1.run(AppMainV2.java:61)

&quot;Signal Dispatcher&quot; #4 daemon prio=9 os_prio=31 tid=0x00007fc28c80e000 nid=0x4207 runnable [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;Finalizer&quot; #3 daemon prio=8 os_prio=31 tid=0x00007fc291808800 nid=0x3303 in Object.wait() [0x00007000031c0000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on &lt;0x000000076ab08ed8&gt; (a java.lang.ref.ReferenceQueue$Lock)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:144)
	- locked &lt;0x000000076ab08ed8&gt; (a java.lang.ref.ReferenceQueue$Lock)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:165)
	at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:216)

&quot;Reference Handler&quot; #2 daemon prio=10 os_prio=31 tid=0x00007fc28b818800 nid=0x4d03 in Object.wait() [0x00007000030bd000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on &lt;0x000000076ab06c00&gt; (a java.lang.ref.Reference$Lock)
	at java.lang.Object.wait(Object.java:502)
	at java.lang.ref.Reference.tryHandlePending(Reference.java:191)
	- locked &lt;0x000000076ab06c00&gt; (a java.lang.ref.Reference$Lock)
	at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:153)

&quot;VM Thread&quot; os_prio=31 tid=0x00007fc28d04f000 nid=0x4f03 runnable

&quot;GC task thread#0 (ParallelGC)&quot; os_prio=31 tid=0x00007fc28b816000 nid=0x2007 runnable

&quot;GC task thread#1 (ParallelGC)&quot; os_prio=31 tid=0x00007fc28d808800 nid=0x1b03 runnable

&quot;GC task thread#2 (ParallelGC)&quot; os_prio=31 tid=0x00007fc28e008800 nid=0x1c03 runnable

&quot;GC task thread#3 (ParallelGC)&quot; os_prio=31 tid=0x00007fc28d809000 nid=0x2a03 runnable

&quot;GC task thread#4 (ParallelGC)&quot; os_prio=31 tid=0x00007fc28e009000 nid=0x2b03 runnable

&quot;GC task thread#5 (ParallelGC)&quot; os_prio=31 tid=0x00007fc28e808800 nid=0x2c03 runnable

&quot;GC task thread#6 (ParallelGC)&quot; os_prio=31 tid=0x00007fc28e009800 nid=0x2e03 runnable

&quot;GC task thread#7 (ParallelGC)&quot; os_prio=31 tid=0x00007fc28d809800 nid=0x3003 runnable

&quot;GC task thread#8 (ParallelGC)&quot; os_prio=31 tid=0x00007fc28d80a000 nid=0x5103 runnable

&quot;GC task thread#9 (ParallelGC)&quot; os_prio=31 tid=0x00007fc28d00b000 nid=0x3203 runnable

&quot;VM Periodic Task Thread&quot; os_prio=31 tid=0x00007fc28b820000 nid=0xa403 waiting on condition

JNI global references: 15


Found one Java-level deadlock:
=============================
&quot;é˜¿åŸºç±³å¾·&quot;:
  waiting to lock monitor 0x00007fc28b8708b8 (object 0x000000076ac2fd40, a _12_deadlock.Chopstick),
  which is held by &quot;è‹æ ¼æ‹‰åº•&quot;
&quot;è‹æ ¼æ‹‰åº•&quot;:
  waiting to lock monitor 0x00007fc28b86dc08 (object 0x000000076ac2fd80, a _12_deadlock.Chopstick),
  which is held by &quot;ï¿½ï¿½æ‹‰å›¾&quot;
&quot;æŸæ‹‰å›¾&quot;:
  waiting to lock monitor 0x00007fc28b86db58 (object 0x000000076ac2fdc0, a _12_deadlock.Chopstick),
  which is held by &quot;äºšé‡Œå£«å¤šå¾·&quot;
&quot;äºšé‡Œå£«å¤šå¾·&quot;:
  waiting to lock monitor 0x00007fc28b870808 (object 0x000000076ac2fe00, a _12_deadlock.Chopstick),
  which is held by &quot;èµ«æ‹‰å…‹åˆ©ç‰¹&quot;
&quot;èµ«æ‹‰å…‹åˆ©ç‰¹&quot;:
  waiting to lock monitor 0x00007fc28b870758 (object 0x000000076ac2fe40, a _12_deadlock.Chopstick),
  which is held by &quot;é˜¿åŸºç±³å¾·&quot;

Java stack information for the threads listed above:
===================================================
&quot;é˜¿åŸºç±³å¾·&quot;:
	at _12_deadlock.Philosopher.run(TestPhilosopher.java:51)
	- waiting to lock &lt;0x000000076ac2fd40&gt; (a _12_deadlock.Chopstick)
	- locked &lt;0x000000076ac2fe40&gt; (a _12_deadlock.Chopstick)
&quot;è‹æ ¼æ‹‰åº•&quot;:
	at _12_deadlock.Philosopher.run(TestPhilosopher.java:51)
	- waiting to lock &lt;0x000000076ac2fd80&gt; (a _12_deadlock.Chopstick)
	- locked &lt;0x000000076ac2fd40&gt; (a _12_deadlock.Chopstick)
&quot;æŸæ‹‰å›¾&quot;:
	at _12_deadlock.Philosopher.run(TestPhilosopher.java:51)
	- waiting to lock &lt;0x000000076ac2fdc0&gt; (a _12_deadlock.Chopstick)
	- locked &lt;0x000000076ac2fd80&gt; (a _12_deadlock.Chopstick)
&quot;äºšé‡Œå£«å¤šå¾·&quot;:
	at _12_deadlock.Philosopher.run(TestPhilosopher.java:51)
	- waiting to lock &lt;0x000000076ac2fe00&gt; (a _12_deadlock.Chopstick)
	- locked &lt;0x000000076ac2fdc0&gt; (a _12_deadlock.Chopstick)
&quot;èµ«æ‹‰å…‹åˆ©ç‰¹&quot;:
	at _12_deadlock.Philosopher.run(TestPhilosopher.java:51)
	- waiting to lock &lt;0x000000076ac2fe40&gt; (a _12_deadlock.Chopstick)
	- locked &lt;0x000000076ac2fe00&gt; (a _12_deadlock.Chopstick)

Found 1 deadlock.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br></div></div><p>è¿™ç§çº¿ç¨‹æ²¡æœ‰æŒ‰é¢„æœŸç»“æŸï¼Œæ‰§è¡Œä¸ä¸‹å»çš„æƒ…å†µï¼Œå½’ç±»ä¸ºã€æ´»è·ƒæ€§ã€‘é—®é¢˜ï¼Œé™¤äº†æ­»é”ä»¥å¤–ï¼Œè¿˜æœ‰æ´»é”å’Œé¥¥é¥¿è€…ä¸¤ç§æƒ…å†µ</p> <h3 id="æ´»é”-ğŸ”¥"><a href="#æ´»é”-ğŸ”¥" class="header-anchor">#</a> æ´»é” ğŸ”¥</h3> <p>æ´»é”å‡ºç°åœ¨ä¸¤ä¸ªçº¿ç¨‹<strong>äº’ç›¸æ”¹å˜å¯¹æ–¹çš„ç»“æŸæ¡ä»¶</strong>ï¼Œæœ€åè°ä¹Ÿæ— æ³•ç»“æŸï¼Œä¾‹å¦‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;LiveLock&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LiveLock</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// æœŸæœ›å‡åˆ° 0 é€€å‡ºå¾ªç¯</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    count<span class="token operator">--</span><span class="token punctuation">;</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;count: {}&quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// æœŸæœ›è¶…è¿‡ 20 é€€å‡ºå¾ªç¯</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    count<span class="token operator">++</span><span class="token punctuation">;</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;count: {}&quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>è§£å†³ï¼š</p> <ul><li>å¯ä»¥è®©çº¿ç¨‹äº¤é”™å¼€ï¼ŒåŒæ­¥æ‰§è¡Œï¼›</li> <li>å¢åŠ éšæœºç¡çœ æ—¶é—´æ¥é¿å…</li></ul> <h3 id="é¥¥é¥¿-reentrantlockè§£å†³-ğŸ”¥"><a href="#é¥¥é¥¿-reentrantlockè§£å†³-ğŸ”¥" class="header-anchor">#</a> é¥¥é¥¿â€”reentrantlockè§£å†³ ğŸ”¥</h3> <p>å¾ˆå¤šæ•™ç¨‹ä¸­æŠŠé¥¥é¥¿å®šä¹‰ä¸ºï¼Œä¸€ä¸ªçº¿ç¨‹ç”±äº<strong>ä¼˜å…ˆçº§å¤ªä½</strong>ï¼Œ<strong>å§‹ç»ˆå¾—ä¸åˆ° CPU è°ƒåº¦æ‰§è¡Œ</strong>ï¼Œ<strong>ä¹Ÿä¸èƒ½å¤Ÿç»“æŸ</strong>ï¼Œé¥¥é¥¿çš„æƒ…å†µä¸æ˜“æ¼”ç¤ºï¼Œè®²<strong>è¯»å†™é”</strong>æ—¶ä¼šæ¶‰åŠé¥¥é¥¿é—®é¢˜</p> <p>ä¸‹é¢æˆ‘è®²ä¸€ä¸‹æˆ‘é‡åˆ°çš„ä¸€ä¸ªçº¿ç¨‹é¥¥é¥¿çš„ä¾‹å­ï¼Œå…ˆæ¥çœ‹çœ‹ä½¿ç”¨<strong>é¡ºåºåŠ é”</strong>çš„æ–¹å¼è§£å†³ä¹‹å‰çš„æ­»é”é—®é¢˜</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>é¡ºåºåŠ é”çš„è§£å†³æ–¹æ¡ˆ</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>ä½†æ˜¯é¡ºåºåŠ é”å®¹æ˜“å‡ºç°é¥¥é¥¿é—®é¢˜ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * ç­·å­
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Chopstick</span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;ç­·å­{&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'}'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
 * å“²å­¦å®¶
 */</span>
<span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;Philosopher&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Philosopher</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>

    <span class="token comment">// ç­·å­å……å½“é”</span>
    <span class="token keyword">final</span> <span class="token class-name">Chopstick</span> left<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">Chopstick</span> right<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Chopstick</span> left<span class="token punctuation">,</span> <span class="token class-name">Chopstick</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">=</span> left<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">=</span> right<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è·å¾—å·¦æ‰‹ç­·å­</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>left<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è·å¾—å³æ‰‹ç­·å­</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token comment">// åƒé¥­</span>
                        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;eating...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// æ”¾ä¸‹å³æ‰‹ç­·å­</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// æ”¾ä¸‹å·¦æ‰‹ç­·å­</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestPhilosopher</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Chopstick</span> c1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;è‹æ ¼æ‹‰åº•&quot;</span><span class="token punctuation">,</span> c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;æŸæ‹‰å›¾&quot;</span><span class="token punctuation">,</span> c2<span class="token punctuation">,</span> c3<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;äºšé‡Œå£«å¤šå¾·&quot;</span><span class="token punctuation">,</span> c3<span class="token punctuation">,</span> c4<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;èµ«æ‹‰å…‹åˆ©ç‰¹&quot;</span><span class="token punctuation">,</span> c4<span class="token punctuation">,</span> c5<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æœ¬æ¥ c5, c1 æ”¹å˜é¡ºåºï¼Œå³å¯å‘ç°é¥¥é¥¿é—®é¢˜ï¼Œé˜¿åŸºç±³å¾·ä¸€ç›´å¾—ä¸åˆ°æ‰§è¡Œï¼Œèµ«æ‹‰å…‹åˆ©ç‰¹æ‰§è¡Œæœ€å¤š</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token string">&quot;é˜¿åŸºç±³å¾·&quot;</span><span class="token punctuation">,</span> c1<span class="token punctuation">,</span> c5<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><p>ç¬¬ä¸€è½®äº‰å¤ºå·¦ç­·å­æ—¶ï¼Œè‹å’Œé˜¿åŒæ—¶äº‰å¤ºc1ï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªèƒ½äº‰åˆ°ä¸”è‹å…ˆè¿è¡Œåˆ™è‹è·å–åˆ°</p> <p>ç¬¬äºŒè½®äº‰å¤ºå³ç­·å­æ—¶ï¼Œc5æ²¡äººå’Œèµ«äº‰ï¼ˆé˜¿å·²ç»é˜»å¡ï¼‰æ‰€ä»¥èµ«æ‰§è¡Œæœ€å¤š</p> <h2 id="reentrantlock-ğŸ”¥"><a href="#reentrantlock-ğŸ”¥" class="header-anchor">#</a> ReentrantLock ğŸ”¥</h2> <p>ç›¸å¯¹äº synchronized å®ƒå…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹</p> <ul><li><p>ä¸ synchronized ä¸€æ ·ï¼Œ<strong>éƒ½æ”¯æŒå¯é‡å…¥</strong></p></li> <li><p><strong>å¯ä¸­æ–­</strong></p></li> <li><p>å¯ä»¥è®¾ç½®<strong>è¶…æ—¶æ—¶é—´</strong></p></li> <li><p>å¯ä»¥è®¾ç½®ä¸º<strong>å…¬å¹³é”</strong>ï¼ˆè§£å†³æ­»é”ã€é¥¥é¥¿ï¼‰</p></li> <li><p>æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡ï¼ˆ<strong>ä¸æ»¡è¶³æ¡ä»¶è°ƒç”¨ wait å¯åœ¨å¤šä¸ª WaitSet é‡Œç­‰å¾…</strong>ï¼‰</p></li></ul> <h3 id="å¯é‡å…¥"><a href="#å¯é‡å…¥" class="header-anchor">#</a> å¯é‡å…¥</h3> <h2 id="_7-4-çº¿ç¨‹å®‰å…¨å’ŒåŒæ­¥"><a href="#_7-4-çº¿ç¨‹å®‰å…¨å’ŒåŒæ­¥" class="header-anchor">#</a> 7.4 çº¿ç¨‹å®‰å…¨å’ŒåŒæ­¥</h2> <h4 id="lock-é”"><a href="#lock-é”" class="header-anchor">#</a> Lock é”</h4> <ul><li><p>ä» JDK 5.0 å¼€å§‹ï¼ŒJava æä¾›äº†æ›´å¼ºå¤§çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶â€”â€”é€šè¿‡<strong>æ˜¾å¼å®šä¹‰åŒæ­¥é”å¯¹è±¡</strong>æ¥å®ç°åŒæ­¥ã€‚<code>java.util.concurrent.locks.Lock</code> <strong>æ¥å£</strong>æœºåˆ¶æä¾›äº†æ¯”<code>synchronized</code>ä»£ç å—å’Œ<code>synchronized</code>æ–¹æ³•æ›´å¹¿æ³›çš„é”å®šæ“ä½œï¼ŒåŒæ­¥ä»£ç å—/åŒæ­¥æ–¹æ³•å…·æœ‰çš„åŠŸèƒ½ Lock éƒ½æœ‰ï¼Œé™¤æ­¤ä¹‹å¤–æ›´å¼ºå¤§ï¼Œæ›´ä½“ç°é¢å‘å¯¹è±¡ã€‚</p></li> <li><p><strong>Lock æ¥å£çš„å®ç°ç±»<code>ReentrantLock</code></strong>ã€‚å¯åœ¨æ„é€ æ–¹æ³•ä¸­è®¾ç½®æ˜¯å¦ä¸º<strong>å…¬å¹³é”</strong>ï¼ˆæŒ‰ FIFO é˜Ÿåˆ—ï¼‰ï¼Œä½†æ˜¯æ•ˆç‡å¯èƒ½ä¼šå˜ä½ã€‚</p></li> <li><p><strong>Lock é”ä¹Ÿç§°åŒæ­¥é”</strong>ï¼ŒåŠ é”ä¸é‡Šæ”¾é”æ–¹æ³•åŒ–äº†ï¼Œå¦‚ä¸‹ï¼š</p> <ul><li><p><code>void lock()</code>ï¼š<strong>åŠ åŒæ­¥é”</strong></p></li> <li><p><code>void unlock()</code>ï¼š<strong>é‡Šæ”¾åŒæ­¥é”</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Ticket</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// åŠ åŒæ­¥é”</span>
                lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;--&gt;æ­£åœ¨å–ç¬¬&quot;</span> <span class="token operator">+</span> count <span class="token operator">+</span> <span class="token string">&quot;å¼ ç¥¨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        count<span class="token operator">--</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token comment">// é‡Šæ”¾åŒæ­¥é”</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Ticket</span> ticket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ticket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span> <span class="token string">&quot;çª—å£1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span> <span class="token string">&quot;çª—å£2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span> <span class="token string">&quot;çª—å£3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div></li></ul></li></ul> <h4 id=""><a href="#" class="header-anchor">#</a></h4> <h2 id="ä¹ é¢˜"><a href="#ä¹ é¢˜" class="header-anchor">#</a> ä¹ é¢˜</h2> <h3 id="å®ç°-runnable-æ¥å£çš„å¥½å¤„-ğŸ”¥"><a href="#å®ç°-runnable-æ¥å£çš„å¥½å¤„-ğŸ”¥" class="header-anchor">#</a> å®ç° Runnable æ¥å£çš„å¥½å¤„ ğŸ”¥</h3> <p><strong>å…¶å® Thread ç±»ä¹Ÿæ˜¯å®ç°äº† Runnable æ¥å£</strong>ã€‚start å¯åŠ¨çº¿ç¨‹ä¸­å†…éƒ¨è°ƒç”¨ run æ–¹æ³•æ—¶ï¼Œè‹¥æ˜¯ target æœ‰å€¼ï¼ˆRunnableå¯¹è±¡ï¼‰åˆ™è°ƒç”¨è¯¥ Runnable å¯¹è±¡çš„ run æ–¹æ³•ï¼Œæ— å€¼åˆ™è°ƒç”¨ Thread é‡å†™çš„ run æ–¹æ³•ã€‚</p> <p>æ„é€ æ–¹æ³•åˆå§‹åŒ–æ—¶ä¼šæœ‰</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Thread.java</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span><span class="token comment">// è¿™ä¸ªå³æ˜¯ä¼ å…¥çš„ Runnable å¯¹è±¡ã€‚Thread åŒ¿åå†…éƒ¨ç±»å¯¹è±¡ä¸ä¼šä¼ å…¥æ„é€ æ–¹æ³•çš„</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è°ƒç”¨ start æ–¹å¼æ—¶ä¼šè°ƒç”¨</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Thread.java</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><p>é¿å…äº† Java ç±»<strong>å•ç»§æ‰¿çš„å±€é™æ€§</strong></p></li> <li><p>å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åŒä¸€ä¸ªæ¥å£å®ç°ç±»çš„å¯¹è±¡ï¼Œéå¸¸é€‚åˆå¤šä¸ªç›¸åŒçº¿ç¨‹æ¥<strong>å¤„ç†åŒä¸€ä¸ªèµ„æº</strong>ï¼Œå¢åŠ ç¨‹åºçš„å¥å£®æ€§ï¼Œå®ç°<strong>è§£è€¦</strong>æ“ä½œï¼Œ<strong>ä»»åŠ¡</strong>ä»£ç å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œ<strong>ä»»åŠ¡ä»£ç å’Œçº¿ç¨‹ç‹¬ç«‹</strong></p></li> <li><p><strong>çº¿ç¨‹æ± </strong>åªèƒ½æ”¾å…¥å®ç° Runable æˆ– Callable ç±»çº¿ç¨‹ï¼Œä¸èƒ½ç›´æ¥æ”¾å…¥ç»§æ‰¿ Thread ç±»çš„çº¿ç¨‹</p></li></ul> <h3 id="run-å’Œstart-çš„åŒºåˆ«-ğŸ”¥"><a href="#run-å’Œstart-çš„åŒºåˆ«-ğŸ”¥" class="header-anchor">#</a> <code>run()</code>å’Œ<code>start()</code>çš„åŒºåˆ« ğŸ”¥</h3> <ul><li><code>run()</code>ï¼šä»…ä»…æ˜¯å°è£…è¢«çº¿ç¨‹æ‰§è¡Œçš„ä»£ç ï¼Œç›´æ¥è°ƒç”¨æ˜¯æ™®é€šæ–¹æ³•ã€‚</li> <li><code>start()</code>ï¼šé¦–å…ˆå¯åŠ¨äº†çº¿ç¨‹ï¼Œç„¶åå†ç”± jvm å»è°ƒç”¨è¯¥çº¿ç¨‹çš„ run()æ–¹æ³•ã€‚</li></ul> <h3 id="synchronized-å’Œ-lock-åŒºåˆ«"><a href="#synchronized-å’Œ-lock-åŒºåˆ«" class="header-anchor">#</a> synchronized å’Œ Lock åŒºåˆ«</h3> <ul><li>syn æ˜¯å…³é”®å­—å±äº <strong>JVM å±‚é¢</strong>çš„ï¼ˆåœ¨åŒæ­¥ä¸­å—ä¸­æ‰èƒ½è°ƒç”¨ wait/notifyï¼‰ï¼›Lock æ˜¯æ¥å£ï¼Œæ˜¯ <strong>Api å±‚é¢</strong>çš„ï¼ŒJVM å°†èŠ±è´¹è¾ƒå°‘çš„æ—¶é—´æ¥è°ƒåº¦çº¿ç¨‹ï¼Œæ€§èƒ½æ›´å¥½ã€‚å¹¶ä¸”å…·æœ‰æ›´å¥½çš„æ‰©å±•æ€§ï¼ˆæä¾›æ›´å¤šçš„å­ç±»ï¼‰</li> <li>syn æ˜¯<strong>éšå¼é”</strong>ï¼Œ<strong>å‡ºäº†ä½œç”¨åŸŸ æˆ– æŠ›å¼‚å¸¸ä¼šè‡ªåŠ¨é‡Šæ”¾</strong>ï¼›Lock æ˜¯<strong>æ˜¾å¼é”</strong>ï¼ˆ<strong>æ‰‹åŠ¨å¼€å¯å’Œå…³é—­é”</strong>ï¼Œåˆ«å¿˜è®°å…³é—­é”ï¼‰</li> <li>syn æœ‰ä»£ç å—é”å’Œæ–¹æ³•é”ï¼›Lock åªæœ‰ä»£ç å—é”</li> <li><strong>syn ä¸å¯ä¸­æ–­</strong>ï¼›<strong>Lock å¯ä¸­æ–­</strong>ï¼ˆtryLock è®¾ç½®è¶…æ—¶æ–¹æ³•ï¼ŒlockInterruptibly()æ–¹ä»£ç å—ä¸­ï¼Œç”¨ interrupt()æ–¹æ³•ä¸­æ–­ï¼‰</li> <li>ä½¿ç”¨ Lock çš„ Condition å¯ä»¥<strong>ç²¾ç¡®å”¤é†’</strong></li></ul> <p>ä¼˜å…ˆä½¿ç”¨é¡ºåºï¼šLock â€”&gt; åŒæ­¥ä»£ç å—(å·²ç»è¿›å…¥äº†æ–¹æ³•ä½“ï¼Œåˆ†é…äº†ç›¸åº”èµ„æº) â€”&gt; åŒæ­¥æ–¹æ³• (åœ¨æ–¹æ³•ä½“ä¹‹å¤–)</p> <h3 id="sleep-å’Œ-wait-å¼‚åŒ"><a href="#sleep-å’Œ-wait-å¼‚åŒ" class="header-anchor">#</a> sleep å’Œ wait å¼‚åŒ</h3> <ul><li>sleep æ˜¯ Thread çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä»»ä½•åœºæ™¯ä¸‹è°ƒç”¨ï¼›wait æ˜¯ Object çš„æ–¹æ³•ï¼Œå¿…é¡»åœ¨åŒæ­¥ä¸­è°ƒç”¨ï¼ˆåŒæ­¥ä»£ç å—ã€åŒæ­¥æ–¹æ³•ï¼‰</li> <li>è‹¥ä¿©æ–¹æ³•éƒ½åœ¨åŒæ­¥ä¸­è°ƒç”¨ï¼Œéƒ½ä¼šä½¿çº¿ç¨‹è¿›å…¥ TIME/ WAITING çŠ¶æ€ã€‚ä½† sleep <strong>ä¸ä¼šé‡Šæ”¾é”</strong>ï¼Œä¼‘çœ ç»“æŸå›åˆ°å°±ç»ªçŠ¶æ€ï¼›wait <strong>ç­‰å¾…</strong>å¹¶ç«‹å³<strong>é‡Šæ”¾é”</strong>ï¼Œ<strong>è¢«å”¤é†’åè‹¥è·å¾—é”åˆ™ä»è¿™é‡Œæ‰§è¡Œåç»­ä»£ç </strong></li></ul> <h3 id="_2-ä¸ªçº¿ç¨‹å‘è´¦æˆ·å­˜é’±å¹¶æ‰“å°"><a href="#_2-ä¸ªçº¿ç¨‹å‘è´¦æˆ·å­˜é’±å¹¶æ‰“å°" class="header-anchor">#</a> 2 ä¸ªçº¿ç¨‹å‘è´¦æˆ·å­˜é’±å¹¶æ‰“å°</h3> <p>é“¶è¡Œæœ‰ä¸€ä¸ªè´¦æˆ·ï¼Œæœ‰ä¸¤ä¸ªå‚¨æˆ·åˆ†åˆ«å‘åŒä¸€ä¸ªè´¦æˆ·å­˜ 3000 å…ƒï¼Œæ¯æ¬¡å­˜ 1000ï¼Œå­˜ 3 æ¬¡ã€‚æ¯æ¬¡å­˜å®Œæ‰“å°è´¦æˆ·ä½™é¢ã€‚</p> <p>é—®é¢˜:è¯¥ç¨‹åºæ˜¯å¦æœ‰å®‰å…¨é—®é¢˜ï¼Œå¦‚æœæœ‰ï¼Œå¦‚ä½•è§£å†³ï¼Ÿæ­¤å¤„é‡‡ç”¨ç»§æ‰¿ Thread ç±»æ¥å®ç°ï¼ˆå®ç° Runnable æ¥å£ç¨ç®€å•ï¼‰</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">double</span> balance<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token keyword">double</span> balance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>balance <span class="token operator">=</span> balance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//å­˜é’±</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">deposit</span><span class="token punctuation">(</span><span class="token keyword">double</span> amt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>amt <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            balance <span class="token operator">+=</span> amt<span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:å­˜é’±æˆåŠŸã€‚ä½™é¢ä¸ºï¼š&quot;</span> <span class="token operator">+</span> balance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Customer</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Account</span> acct<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Customer</span><span class="token punctuation">(</span><span class="token class-name">Account</span> acct<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>acct <span class="token operator">=</span> acct<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            acct<span class="token punctuation">.</span><span class="token function">deposit</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Account</span> acct <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Customer</span><span class="token punctuation">(</span>acct<span class="token punctuation">,</span> <span class="token string">&quot;ç”²&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Customer</span><span class="token punctuation">(</span>acct<span class="token punctuation">,</span> <span class="token string">&quot;ä¹™&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="_2-ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°-1-100"><a href="#_2-ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°-1-100" class="header-anchor">#</a> 2 ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å° 1-100</h3> <p>åŒæ­¥ä»£ç å—ã€åŒæ­¥æ–¹æ³•</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">PrintThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// waitã€notify å¿…é¡»åœ¨åŒæ­¥ä¸­ã€‚ä¸”è°ƒç”¨çš„å¯¹è±¡ä¸é”å¯¹è±¡å¿…é¡»ç›¸åŒ</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// å”¤é†’</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">/*try {
                        // ä¸åŠ é”æ—¶ï¼Œå¢åŠ çº¿ç¨‹å®‰å…¨é—®é¢˜å‘ç”Ÿçš„æ¦‚ç‡
                        Thread.sleep(100);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }*/</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;:&quot;</span><span class="token operator">+</span>count<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token comment">// ç­‰å¾…å¹¶ç«‹å³é‡Šæ”¾é”ï¼Œå”¤é†’åè¿˜æ˜¯ä»è¿™é‡Œç»§ç»­ï¼Œä½†æ˜¯éœ€è¦è·å–åˆ°é”ï¼Œæ‰€ä»¥å¤–å±‚éœ€è¦ä½¿ç”¨ while</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PrintTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">PrintThread</span> printThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä¹Ÿå¯ä»¥å°† run æ–¹æ³•å†…å®¹å†™å…¥æ™®é€šæ–¹æ³•ä¸­ï¼Œé‡‡ç”¨æ–¹æ³•å¼•ç”¨æ¥æ“ä½œ</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>printThread<span class="token punctuation">,</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>printThread<span class="token punctuation">,</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>Lock æ–¹å¼æš‚æ—¶æ²¡æƒ³åˆ°å¥½ç‚¹çš„æ–¹æ³•</p> <h3 id="ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜"><a href="#ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜" class="header-anchor">#</a> ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜</h3> <p>è§ç¬”è®°</p> <h3 id="åˆ›å»ºå¤šçº¿ç¨‹çš„-4-ç§æ–¹å¼"><a href="#åˆ›å»ºå¤šçº¿ç¨‹çš„-4-ç§æ–¹å¼" class="header-anchor">#</a> åˆ›å»ºå¤šçº¿ç¨‹çš„ 4 ç§æ–¹å¼</h3> <p>è§ç¬”è®°</p></div></div> <div class="page-slot page-slot-bottom"><!-- æ¨ªå‘è‡ªé€‚åº” -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/master/docs/100.Java/800.å¤šçº¿ç¨‹/804.å…±äº«æ¨¡å‹â€”ç®¡ç¨‹.md" target="_blank" rel="noopener noreferrer">ç¼–è¾‘</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2021/07/07, 14:41:01</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/7fcc72/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ</div></a> <a href="/pages/55e20e/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Monitor &amp; synchronized åŸç†</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pages/7fcc72/" class="prev">çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ</a></span> <span class="next"><a href="/pages/55e20e/">Monitor &amp; synchronized åŸç†</a>â†’
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/7fcc72/"><div>çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ</div></a> <span>07-06</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/a4ef99/"><div>çº¿ç¨‹å®‰å…¨ç†è®º</div></a> <span>06-24</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/890a0b/"><div>å¹¶å‘ç®€å²</div></a> <span>06-24</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">æ›´å¤šæ–‡ç« &gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:894072666@qq.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/xugaoyi" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="å¬éŸ³ä¹" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2019-2021
    <span>Evan Xu | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">Ã—</i> <div><!-- å›ºå®š160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.ac5e3ef4.js" defer></script><script src="/assets/js/2.d960b235.js" defer></script><script src="/assets/js/7.1c00f39e.js" defer></script>
  </body>
</html>