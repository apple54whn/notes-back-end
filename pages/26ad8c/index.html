<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å¤šè¡¨æ“ä½œ | conanan&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="webå‰ç«¯æŠ€æœ¯åšå®¢,ç®€æ´è‡³ä¸Š,ä¸“æ³¨webå‰ç«¯å­¦ä¹ ä¸æ€»ç»“ã€‚JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,githubç­‰æŠ€æœ¯æ–‡ç« ã€‚">
    <meta name="keywords" content="å‰ç«¯åšå®¢,ä¸ªäººæŠ€æœ¯åšå®¢,å‰ç«¯,å‰ç«¯å¼€å‘,å‰ç«¯æ¡†æ¶,webå‰ç«¯,å‰ç«¯é¢è¯•é¢˜,æŠ€æœ¯æ–‡æ¡£,å­¦ä¹ ,é¢è¯•,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.03260d1f.css" as="style"><link rel="preload" href="/assets/js/app.ac5e3ef4.js" as="script"><link rel="preload" href="/assets/js/2.d960b235.js" as="script"><link rel="preload" href="/assets/js/51.f4a8b763.js" as="script"><link rel="prefetch" href="/assets/js/10.949143aa.js"><link rel="prefetch" href="/assets/js/100.122fb3a2.js"><link rel="prefetch" href="/assets/js/101.88060c8d.js"><link rel="prefetch" href="/assets/js/102.06832b28.js"><link rel="prefetch" href="/assets/js/103.a0c17aef.js"><link rel="prefetch" href="/assets/js/104.b38ef641.js"><link rel="prefetch" href="/assets/js/105.603033e4.js"><link rel="prefetch" href="/assets/js/106.6b288074.js"><link rel="prefetch" href="/assets/js/107.1ffec4c0.js"><link rel="prefetch" href="/assets/js/108.c7b79afa.js"><link rel="prefetch" href="/assets/js/109.dda9fbee.js"><link rel="prefetch" href="/assets/js/11.326a1f58.js"><link rel="prefetch" href="/assets/js/110.920cbe6e.js"><link rel="prefetch" href="/assets/js/111.45bfe7f2.js"><link rel="prefetch" href="/assets/js/112.1f11c570.js"><link rel="prefetch" href="/assets/js/113.fab1cc04.js"><link rel="prefetch" href="/assets/js/114.21ea4ed6.js"><link rel="prefetch" href="/assets/js/115.96f65264.js"><link rel="prefetch" href="/assets/js/116.b324c49b.js"><link rel="prefetch" href="/assets/js/117.dc4d308c.js"><link rel="prefetch" href="/assets/js/118.8f152d6d.js"><link rel="prefetch" href="/assets/js/119.ede5fffc.js"><link rel="prefetch" href="/assets/js/12.23122444.js"><link rel="prefetch" href="/assets/js/120.044161d7.js"><link rel="prefetch" href="/assets/js/121.453c745a.js"><link rel="prefetch" href="/assets/js/122.e3b088eb.js"><link rel="prefetch" href="/assets/js/123.d5a90d16.js"><link rel="prefetch" href="/assets/js/124.7731d89c.js"><link rel="prefetch" href="/assets/js/125.e64126c4.js"><link rel="prefetch" href="/assets/js/126.e46361b1.js"><link rel="prefetch" href="/assets/js/127.067ae046.js"><link rel="prefetch" href="/assets/js/128.59df2a2f.js"><link rel="prefetch" href="/assets/js/129.a2b82230.js"><link rel="prefetch" href="/assets/js/13.6780e0cd.js"><link rel="prefetch" href="/assets/js/130.c20833b9.js"><link rel="prefetch" href="/assets/js/131.da020742.js"><link rel="prefetch" href="/assets/js/132.e20ac455.js"><link rel="prefetch" href="/assets/js/133.f114b097.js"><link rel="prefetch" href="/assets/js/134.49de9e80.js"><link rel="prefetch" href="/assets/js/135.1a24633f.js"><link rel="prefetch" href="/assets/js/136.d5853212.js"><link rel="prefetch" href="/assets/js/137.3a1020dd.js"><link rel="prefetch" href="/assets/js/138.f194f86d.js"><link rel="prefetch" href="/assets/js/139.bf8c1ca0.js"><link rel="prefetch" href="/assets/js/14.08edf279.js"><link rel="prefetch" href="/assets/js/140.c800f5e0.js"><link rel="prefetch" href="/assets/js/141.47afa8e4.js"><link rel="prefetch" href="/assets/js/142.fda2db61.js"><link rel="prefetch" href="/assets/js/143.0224a2e5.js"><link rel="prefetch" href="/assets/js/144.4126fe8d.js"><link rel="prefetch" href="/assets/js/145.9fe0839a.js"><link rel="prefetch" href="/assets/js/146.89a9e1b2.js"><link rel="prefetch" href="/assets/js/147.56419b8e.js"><link rel="prefetch" href="/assets/js/148.03d2b50f.js"><link rel="prefetch" href="/assets/js/149.c1331b6d.js"><link rel="prefetch" href="/assets/js/15.f198e5b9.js"><link rel="prefetch" href="/assets/js/16.00e51c93.js"><link rel="prefetch" href="/assets/js/17.291d3ebc.js"><link rel="prefetch" href="/assets/js/18.017a098e.js"><link rel="prefetch" href="/assets/js/19.61ae84a4.js"><link rel="prefetch" href="/assets/js/20.2fed9841.js"><link rel="prefetch" href="/assets/js/21.0540e3f5.js"><link rel="prefetch" href="/assets/js/22.65f1eb05.js"><link rel="prefetch" href="/assets/js/23.fd9e2f2e.js"><link rel="prefetch" href="/assets/js/24.199ad75b.js"><link rel="prefetch" href="/assets/js/25.005a23bb.js"><link rel="prefetch" href="/assets/js/26.46587fdd.js"><link rel="prefetch" href="/assets/js/27.eaf61373.js"><link rel="prefetch" href="/assets/js/28.12bcc1aa.js"><link rel="prefetch" href="/assets/js/29.2ee78c15.js"><link rel="prefetch" href="/assets/js/3.aae4de15.js"><link rel="prefetch" href="/assets/js/30.5a13fad2.js"><link rel="prefetch" href="/assets/js/31.d559ae93.js"><link rel="prefetch" href="/assets/js/32.d5a38545.js"><link rel="prefetch" href="/assets/js/33.484dfc49.js"><link rel="prefetch" href="/assets/js/34.1a006a06.js"><link rel="prefetch" href="/assets/js/35.12b84d1e.js"><link rel="prefetch" href="/assets/js/36.b2cd4408.js"><link rel="prefetch" href="/assets/js/37.a5859cb8.js"><link rel="prefetch" href="/assets/js/38.96209f1d.js"><link rel="prefetch" href="/assets/js/39.71d70a82.js"><link rel="prefetch" href="/assets/js/4.0e4cf147.js"><link rel="prefetch" href="/assets/js/40.a59b859c.js"><link rel="prefetch" href="/assets/js/41.ebb72a6a.js"><link rel="prefetch" href="/assets/js/42.71f99aa2.js"><link rel="prefetch" href="/assets/js/43.092ff2c9.js"><link rel="prefetch" href="/assets/js/44.d70e216f.js"><link rel="prefetch" href="/assets/js/45.afb733d1.js"><link rel="prefetch" href="/assets/js/46.86c421f9.js"><link rel="prefetch" href="/assets/js/47.6d337ef6.js"><link rel="prefetch" href="/assets/js/48.157e1f1c.js"><link rel="prefetch" href="/assets/js/49.1aed4add.js"><link rel="prefetch" href="/assets/js/5.831f36ca.js"><link rel="prefetch" href="/assets/js/50.b495cbac.js"><link rel="prefetch" href="/assets/js/52.beec293d.js"><link rel="prefetch" href="/assets/js/53.2ac4d785.js"><link rel="prefetch" href="/assets/js/54.342112cf.js"><link rel="prefetch" href="/assets/js/55.61e2bfb6.js"><link rel="prefetch" href="/assets/js/56.fa782548.js"><link rel="prefetch" href="/assets/js/57.41bc249e.js"><link rel="prefetch" href="/assets/js/58.c1d5fafb.js"><link rel="prefetch" href="/assets/js/59.4297a34f.js"><link rel="prefetch" href="/assets/js/6.54e4e793.js"><link rel="prefetch" href="/assets/js/60.634948c3.js"><link rel="prefetch" href="/assets/js/61.de4327e7.js"><link rel="prefetch" href="/assets/js/62.c6902476.js"><link rel="prefetch" href="/assets/js/63.737a0e11.js"><link rel="prefetch" href="/assets/js/64.cbe1b041.js"><link rel="prefetch" href="/assets/js/65.2df8f108.js"><link rel="prefetch" href="/assets/js/66.ee7de747.js"><link rel="prefetch" href="/assets/js/67.88edee59.js"><link rel="prefetch" href="/assets/js/68.c29f5efe.js"><link rel="prefetch" href="/assets/js/69.2fedc1f9.js"><link rel="prefetch" href="/assets/js/7.1c00f39e.js"><link rel="prefetch" href="/assets/js/70.0fe4782b.js"><link rel="prefetch" href="/assets/js/71.6c22c273.js"><link rel="prefetch" href="/assets/js/72.1fc7ddbd.js"><link rel="prefetch" href="/assets/js/73.25cb42eb.js"><link rel="prefetch" href="/assets/js/74.e922e1cc.js"><link rel="prefetch" href="/assets/js/75.f48393b6.js"><link rel="prefetch" href="/assets/js/76.72e96818.js"><link rel="prefetch" href="/assets/js/77.3df4edcb.js"><link rel="prefetch" href="/assets/js/78.73c6a652.js"><link rel="prefetch" href="/assets/js/79.22ba589c.js"><link rel="prefetch" href="/assets/js/8.b5f907d4.js"><link rel="prefetch" href="/assets/js/80.2d070db4.js"><link rel="prefetch" href="/assets/js/81.c0bc2539.js"><link rel="prefetch" href="/assets/js/82.4c6a47fa.js"><link rel="prefetch" href="/assets/js/83.a43f597f.js"><link rel="prefetch" href="/assets/js/84.8ce525d0.js"><link rel="prefetch" href="/assets/js/85.6b21aae0.js"><link rel="prefetch" href="/assets/js/86.f6ebabd9.js"><link rel="prefetch" href="/assets/js/87.9acaeb0d.js"><link rel="prefetch" href="/assets/js/88.99cdf592.js"><link rel="prefetch" href="/assets/js/89.58f63450.js"><link rel="prefetch" href="/assets/js/9.053d267f.js"><link rel="prefetch" href="/assets/js/90.1d59f40c.js"><link rel="prefetch" href="/assets/js/91.e8b2a5cd.js"><link rel="prefetch" href="/assets/js/92.b92bba74.js"><link rel="prefetch" href="/assets/js/93.688cad95.js"><link rel="prefetch" href="/assets/js/94.2c11a588.js"><link rel="prefetch" href="/assets/js/95.aa37d1df.js"><link rel="prefetch" href="/assets/js/96.fffa0e6e.js"><link rel="prefetch" href="/assets/js/97.04e9be9f.js"><link rel="prefetch" href="/assets/js/98.2672abca.js"><link rel="prefetch" href="/assets/js/99.c8de1c63.js">
    <link rel="stylesheet" href="/assets/css/0.styles.03260d1f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/EB-logo.png" alt="conanan's blog" class="logo"> <span class="site-name can-hide">conanan's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><a href="/about/" class="nav-link">å…³äº</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/pages/4b56bd/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/4b56bd/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/pages/724936/" class="nav-link">Java Web</a></li><li class="dropdown-item"><h4>å·¥å…·</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b18d09/" class="nav-link">Maven</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DataBase" class="dropdown-title"><a href="/pages/74cdda/" class="link-title">DataBase</a> <span class="title" style="display:none;">DataBase</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/74cdda/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/pages/4e9f47/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool" class="dropdown-title"><a href="/pages/89d1e7/" class="link-title">Tool</a> <span class="title" style="display:none;">Tool</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/89d1e7/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Vim</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d5fb/" class="nav-link">Docker</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/xugaoyi/image_store/blog/20200103123203.jpg"> <div class="blogger-info"><h3>Evan Xu</h3> <span>å‰ç«¯ç•Œçš„å°å­¦ç”Ÿ</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><a href="/about/" class="nav-link">å…³äº</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/pages/4b56bd/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/4b56bd/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/pages/724936/" class="nav-link">Java Web</a></li><li class="dropdown-item"><h4>å·¥å…·</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b18d09/" class="nav-link">Maven</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DataBase" class="dropdown-title"><a href="/pages/74cdda/" class="link-title">DataBase</a> <span class="title" style="display:none;">DataBase</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/74cdda/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/pages/4e9f47/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool" class="dropdown-title"><a href="/pages/89d1e7/" class="link-title">Tool</a> <span class="title" style="display:none;">Tool</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/89d1e7/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Vim</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d5fb/" class="nav-link">Docker</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Jakarta EE</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tomcat</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringMVC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SpringDataJPA</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/9e29b0/" class="sidebar-link">JPAåŸºç¡€</a></li><li><a href="/pages/5427c0/" class="sidebar-link">æ€»è§ˆå…¥é—¨</a></li><li><a href="/pages/a40e65/" class="sidebar-link">åŸºç¡€æ“ä½œ</a></li><li><a href="/pages/26ad8c/" aria-current="page" class="active sidebar-link">å¤šè¡¨æ“ä½œ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/26ad8c/#ä¸€å¯¹ä¸€" class="sidebar-link">ä¸€å¯¹ä¸€</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/26ad8c/#jpa-åè®®-ğŸ”¥" class="sidebar-link">JPA åè®® ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#æ¡ˆä¾‹ä»‹ç»" class="sidebar-link">æ¡ˆä¾‹ä»‹ç»</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#å•å‘å…³è”" class="sidebar-link">å•å‘å…³è”</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#åŒå‘å…³è”" class="sidebar-link">åŒå‘å…³è”</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#onetoone-æºç è§£è¯»" class="sidebar-link">OneToOne æºç è§£è¯»</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#mappedby-æ³¨æ„äº‹é¡¹-ğŸ”¥" class="sidebar-link">mappedBy æ³¨æ„äº‹é¡¹ ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#cascadetypeç”¨æ³•" class="sidebar-link">CascadeTypeç”¨æ³•</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#orphanremoval-å±æ€§ç”¨æ³•" class="sidebar-link">orphanRemoval å±æ€§ç”¨æ³•</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#ä¸»é”®å’Œå¤–é”®éƒ½æ˜¯åŒä¸€ä¸ªå­—æ®µ" class="sidebar-link">ä¸»é”®å’Œå¤–é”®éƒ½æ˜¯åŒä¸€ä¸ªå­—æ®µ</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#onetoone-å»¶è¿ŸåŠ è½½ï¼Œæˆ‘ä»¬åªéœ€è¦-id-å€¼" class="sidebar-link">@OneToOne å»¶è¿ŸåŠ è½½ï¼Œæˆ‘ä»¬åªéœ€è¦ ID å€¼</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#onetoone-çš„æœ€ä½³å®è·µ" class="sidebar-link">@OneToOne çš„æœ€ä½³å®è·µ</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#joincloumns-joincolumn" class="sidebar-link">@JoinCloumns &amp; JoinColumn</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#ä¸€å¯¹å¤š" class="sidebar-link">ä¸€å¯¹å¤š</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/26ad8c/#jpa-åè®®-ğŸ”¥-2" class="sidebar-link">JPA åè®® ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#æ¡ˆä¾‹ä»‹ç»-2" class="sidebar-link">æ¡ˆä¾‹ä»‹ç»</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#åˆ†ææ­¥éª¤" class="sidebar-link">åˆ†ææ­¥éª¤</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#onetomany-manytoone" class="sidebar-link">@OneToMany &amp; @ManyToOne</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#å®æˆ˜ï¼šä¿å­˜" class="sidebar-link">å®æˆ˜ï¼šä¿å­˜</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#é—®é¢˜åˆ†æ" class="sidebar-link">é—®é¢˜åˆ†æ</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#æ”¹è¿›ï¼šä¸»è¡¨æ”¾å¼ƒå¤–é”®ç»´æŠ¤" class="sidebar-link">æ”¹è¿›ï¼šä¸»è¡¨æ”¾å¼ƒå¤–é”®ç»´æŠ¤</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#å®æˆ˜ï¼šçº§è”-â˜ ï¸" class="sidebar-link">å®æˆ˜ï¼šçº§è” â˜ ï¸</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#æœ€ä½³å®è·µ-ğŸ”¥" class="sidebar-link">æœ€ä½³å®è·µ ğŸ”¥</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#å¤šå¯¹å¤š" class="sidebar-link">å¤šå¯¹å¤š</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/26ad8c/#æ¡ˆä¾‹ä»‹ç»-3" class="sidebar-link">æ¡ˆä¾‹ä»‹ç»</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#åˆ†ææ­¥éª¤-2" class="sidebar-link">åˆ†ææ­¥éª¤</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#manytomany-å®æˆ˜-ğŸ”¥" class="sidebar-link">@ManyToMany å®æˆ˜ ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#manytomany-å®æˆ˜ï¼šçº§è”-â˜ ï¸" class="sidebar-link">@ManyToMany å®æˆ˜ï¼šçº§è” â˜ ï¸</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#manytoone-å’Œ-onetomany-è¡¨ç¤º-ğŸ”¥" class="sidebar-link">@ManyToOne å’Œ @OneToMany è¡¨ç¤º ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#å¤šå¯¹å¤šçš„æœ€ä½³å®è·µ-ğŸ”¥" class="sidebar-link">å¤šå¯¹å¤šçš„æœ€ä½³å®è·µ ğŸ”¥</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#å¯¹è±¡å¯¼èˆªæŸ¥è¯¢-ğŸ”¥" class="sidebar-link">å¯¹è±¡å¯¼èˆªæŸ¥è¯¢ ğŸ”¥</a></li><li class="sidebar-sub-header"><a href="/pages/26ad8c/#æœªæ•´ç†" class="sidebar-link">æœªæ•´ç†</a></li></ul></li><li><a href="/pages/544a0d/" class="sidebar-link">å®¡è®¡åŠŸèƒ½</a></li><li><a href="/pages/044c3c/" class="sidebar-link">JPAç¤ºä¾‹ï¼ˆæ—§ï¼‰</a></li></ul></section></li><li><a href="/pages/927e76/" class="sidebar-link">Test</a></li><li><a href="/pages/2ffe27/" class="sidebar-link">Shiro</a></li><li><a href="/pages/16f81e/" class="sidebar-link">Thymeleaf</a></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- æ­£æ–¹å½¢ -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/categories/?category=Java%20Web" title="åˆ†ç±»" data-v-1cd794fe>Java Web</a></li> <li data-v-1cd794fe><a href="/categories/?category=SpringDataJPA" title="åˆ†ç±»" data-v-1cd794fe>SpringDataJPA</a></li> <!----></ul> <div class="info" data-v-1cd794fe><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/apple54whn" target="_blank" title="ä½œè€…" class="beLink" data-v-1cd794fe>conanan</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2021-06-21</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          å¤šè¡¨æ“ä½œ
        </h1> <div class="page-slot page-slot-top"><!-- å›ºå®š100% * 90pxå¯æ˜¾ç¤ºï¼Œmax-height:90pxæœªè§æ˜¾ç¤º-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h1 id="å¤šè¡¨æ“ä½œ"><a href="#å¤šè¡¨æ“ä½œ" class="header-anchor">#</a> å¤šè¡¨æ“ä½œ</h1> <h2 id="ä¸€å¯¹ä¸€"><a href="#ä¸€å¯¹ä¸€" class="header-anchor">#</a> ä¸€å¯¹ä¸€</h2> <h3 id="jpa-åè®®-ğŸ”¥"><a href="#jpa-åè®®-ğŸ”¥" class="header-anchor">#</a> JPA åè®® ğŸ”¥</h3> <p><code>@OneToOne</code> ä¸€èˆ¬è¡¨ç¤ºå¯¹è±¡ä¹‹é—´ä¸€å¯¹ä¸€çš„å…³è”å…³ç³»ï¼Œå®ƒå¯ä»¥æ”¾åœ¨ field ä¸Šé¢ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨ get/set æ–¹æ³•ä¸Šé¢ã€‚</p> <ul><li>å¦‚æœæ˜¯é…ç½®<strong>åŒå‘å…³è”</strong>ï¼Œ<strong>ç»´æŠ¤å…³è”å…³ç³»çš„æ˜¯æ‹¥æœ‰å¤–é”®çš„ä¸€æ–¹</strong>ï¼Œè€Œ<strong>å¦ä¸€æ–¹å¿…é¡»é…ç½® mappedBy</strong></li> <li>å¦‚æœæ˜¯å•é¡¹å…³è”ï¼Œç›´æ¥é…ç½®åœ¨<strong>æ‹¥æœ‰å¤–é”®çš„ä¸€æ–¹</strong>å³å¯ã€‚</li></ul> <h3 id="æ¡ˆä¾‹ä»‹ç»"><a href="#æ¡ˆä¾‹ä»‹ç»" class="header-anchor">#</a> æ¡ˆä¾‹ä»‹ç»</h3> <p>ä¸¾ä¸ªä¾‹å­ï¼šuser è¡¨æ˜¯ç”¨æˆ·çš„ä¸»ä¿¡æ¯ï¼Œuser_info æ˜¯ç”¨æˆ·çš„æ‰©å±•ä¿¡æ¯ï¼Œä¸¤è€…ä¹‹é—´æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚</p> <h3 id="å•å‘å…³è”"><a href="#å•å‘å…³è”" class="header-anchor">#</a> å•å‘å…³è”</h3> <p>user_info è¡¨é‡Œé¢æœ‰ä¸€ä¸ª user_id ä½œä¸ºå…³è”å…³ç³»çš„å¤–é”®ï¼Œå¦‚æœæ˜¯å•é¡¹å…³è”ï¼Œæˆ‘ä»¬çš„å†™æ³•å¦‚ä¸‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Id</span>
   <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy<span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>User å®ä½“é‡Œé¢ä»€ä¹ˆéƒ½æ²¡å˜åŒ–ï¼Œä¸éœ€è¦æ·»åŠ  @OneToOne æ³¨è§£ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨æ‹¥æœ‰å¤–é”®çš„ä¸€æ–¹é…ç½®å°±å¯ä»¥ï¼Œæ‰€ä»¥ UserInfo çš„ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@ToString</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfo</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Id</span>
   <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy<span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">Integer</span> ages<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> telephone<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@OneToOne</span> <span class="token comment">//ç»´æŠ¤userçš„å¤–é”®å…³è”å…³ç³»ï¼Œé…ç½®ä¸€å¯¹ä¸€</span>
   <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>æˆ‘ä»¬çœ‹åˆ°ï¼ŒUserInfo å®ä½“å¯¹è±¡é‡Œé¢æ·»åŠ äº† @OneToOne æ³¨è§£ï¼Œè¿™æ—¶æˆ‘ä»¬å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹è·‘ä¸€ä¸‹çœ‹çœ‹æœ‰ä»€ä¹ˆæ•ˆæœï¼š</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">user</span> <span class="token punctuation">(</span>id <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> address <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> email <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sex <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> user_info <span class="token punctuation">(</span>id <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> ages <span class="token keyword">integer</span><span class="token punctuation">,</span> telephone <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user_id <span class="token keyword">bigint</span><span class="token punctuation">,</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> user_info <span class="token keyword">add</span> <span class="token keyword">constraint</span> FKn8pl63y4abe7n0ls6topbqjh2 <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>user_id<span class="token punctuation">)</span> <span class="token keyword">references</span> <span class="token keyword">user</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>å› ä¸ºæˆ‘ä»¬æ–°å»ºäº†ä¸¤ä¸ªå®ä½“ï¼Œè·‘ä»»ä½•ä¸€ä¸ª @SpringDataTest å°±ä¼šçœ‹åˆ°ä¸Šé¢æœ‰ä¸‰ä¸ª sql åœ¨æ‰§è¡Œï¼Œåˆ†åˆ«åˆ›å»ºäº†ä¸¤å¼ è¡¨ï¼Œè€Œåœ¨ user_info è¡¨ä¸Šé¢è¿˜åˆ›å»ºäº†ä¸€ä¸ªå¤–é”®ç´¢å¼•ã€‚</p> <h3 id="åŒå‘å…³è”"><a href="#åŒå‘å…³è”" class="header-anchor">#</a> åŒå‘å…³è”</h3> <p>æˆ‘ä»¬ä¿æŒ UserInfo ä¸å˜ï¼Œåœ¨ User å®ä½“å¯¹è±¡é‡Œé¢æ·»åŠ è¿™ä¸€æ®µä»£ç å³å¯ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@OneToOne</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">UserInfo</span> userInfo<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å®Œæ•´çš„ User å®ä½“å¯¹è±¡å°±ä¼šå˜æˆå¦‚ä¸‹æ¨¡æ ·ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Id</span>
   <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy<span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@OneToOne</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">UserInfo</span> userInfo<span class="token punctuation">;</span><span class="token comment">//å˜åŒ–ä¹‹å¤„</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>æˆ‘ä»¬è·‘ä»»ä½•ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œå°±ä¼šçœ‹åˆ°è¿è¡Œç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè¿˜æ˜¯ä¸Šé¢ä¸‰æ¡ sqlã€‚é‚£ä¹ˆæˆ‘ä»¬å†æŸ¥çœ‹ä¸€ä¸‹ @OneToOne æºç ï¼Œçœ‹çœ‹å…¶æ”¯æŒçš„é…ç½®éƒ½æœ‰å“ªäº›ã€‚</p> <h3 id="onetoone-æºç è§£è¯»"><a href="#onetoone-æºç è§£è¯»" class="header-anchor">#</a> OneToOne æºç è§£è¯»</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">OneToOne</span> <span class="token punctuation">{</span>
    <span class="token comment">//è¡¨ç¤ºå…³ç³»ç›®æ ‡å®ä½“ï¼Œé»˜è®¤è¯¥æ³¨è§£æ ‡è¯†çš„è¿”å›å€¼çš„ç±»å‹çš„ç±»ã€‚</span>
    <span class="token class-name">Class</span> <span class="token function">targetEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token keyword">void</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    <span class="token comment">//cascade çº§è”æ“ä½œç­–ç•¥ï¼Œå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„çº§è”æ“ä½œ</span>
    <span class="token class-name">CascadeType</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">cascade</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//æ•°æ®è·å–æ–¹å¼EAGER(ç«‹å³åŠ è½½)/LAZY(å»¶è¿ŸåŠ è½½)</span>
    <span class="token class-name">FetchType</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> EAGER<span class="token punctuation">;</span>
    <span class="token comment">//æ˜¯å¦å…è®¸ä¸ºç©ºï¼Œé»˜è®¤æ˜¯å¯é€‰çš„ï¼Œä¹Ÿå°±è¡¨ç¤ºå¯ä»¥ä¸ºç©ºï¼›</span>
    <span class="token keyword">boolean</span> <span class="token function">optional</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">//å…³è”å…³ç³»è¢«è°ç»´æŠ¤çš„ä¸€æ–¹å¯¹è±¡é‡Œé¢çš„å±æ€§åå­—ã€‚ åŒå‘å…³è”çš„æ—¶å€™å¿…å¡«</span>
    <span class="token class-name">String</span> <span class="token function">mappedBy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//å½“è¢«æ ‡è¯†çš„å­—æ®µå‘ç”Ÿåˆ é™¤æˆ–è€…ç½®ç©ºæ“ä½œä¹‹åï¼Œæ˜¯å¦åŒæ­¥åˆ°å…³è”å…³ç³»çš„ä¸€æ–¹ï¼Œå³è¿›è¡Œé€šè¿‡åˆ é™¤æ“ä½œï¼Œé»˜è®¤flaseï¼Œæ³¨æ„ä¸CascadeType.REMOVE çº§è”åˆ é™¤çš„åŒºåˆ«</span>
    <span class="token keyword">boolean</span> <span class="token function">orphanRemoval</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="mappedby-æ³¨æ„äº‹é¡¹-ğŸ”¥"><a href="#mappedby-æ³¨æ„äº‹é¡¹-ğŸ”¥" class="header-anchor">#</a> mappedBy æ³¨æ„äº‹é¡¹ ğŸ”¥</h3> <p>åªæœ‰å…³è”å…³ç³»çš„<strong>ç»´æŠ¤æ–¹</strong>æ‰èƒ½<strong>æ“ä½œä¸¤ä¸ªå®ä½“ä¹‹é—´å¤–é”®</strong>çš„å…³ç³»ã€‚<strong>è¢«ç»´æŠ¤æ–¹å³ä½¿è®¾ç½®äº†ç»´æŠ¤æ–¹å±æ€§è¿›è¡Œå­˜å‚¨ä¹Ÿä¸ä¼šæ›´æ–°å¤–é”®å…³è”</strong>ã€‚</p> <p>mappedBy ä¸èƒ½ä¸ @JoinColumn æˆ–è€… @JoinTable åŒæ—¶ä½¿ç”¨ï¼Œå› ä¸ºæ²¡æœ‰æ„ä¹‰ï¼Œå…³è”å…³ç³»ä¸åœ¨è¿™é‡Œé¢ç»´æŠ¤ã€‚</p> <p>æ­¤å¤–ï¼Œ<strong>mappedBy çš„å€¼</strong>æ˜¯æŒ‡<strong>å¦ä¸€æ–¹çš„å®ä½“é‡Œé¢å±æ€§çš„å­—æ®µ</strong>ï¼Œè€Œä¸æ˜¯æ•°æ®åº“å­—æ®µï¼Œä¹Ÿä¸æ˜¯å®ä½“çš„å¯¹è±¡çš„åå­—ã€‚ä¹Ÿå°±æ˜¯ç»´æŠ¤å…³è”å…³ç³»çš„ä¸€æ–¹å±æ€§å­—æ®µåç§°ï¼Œ<strong>æˆ–è€…åŠ äº† @JoinColumn / @JoinTable æ³¨è§£çš„å±æ€§å­—æ®µåç§°</strong>ã€‚å¦‚ä¸Šé¢çš„ User ä¾‹å­ user é‡Œé¢ mappedBy çš„å€¼ï¼Œå°±æ˜¯ UserInfo é‡Œé¢çš„ user å­—æ®µçš„åå­—ã€‚</p> <h3 id="cascadetypeç”¨æ³•"><a href="#cascadetypeç”¨æ³•" class="header-anchor">#</a> CascadeTypeç”¨æ³•</h3> <p>åœ¨ CascadeType çš„ç”¨æ³•ä¸­ï¼ŒCascadeType çš„æšä¸¾å€¼åªæœ‰äº”ä¸ªï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p> <ol><li>CascadeType.PERSIST çº§è”æ–°å»º</li> <li>CascadeType.REMOVE çº§è”åˆ é™¤</li> <li>CascadeType.REFRESH çº§è”åˆ·æ–°</li> <li>CascadeType.MERGE çº§è”æ›´æ–°</li> <li>CascadeType.ALL å››é¡¹å…¨é€‰</li></ol> <p>å…¶ä¸­ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰çº§è”æ“ä½œçš„ï¼Œå…³ç³»è¡¨ä¸ä¼šäº§ç”Ÿä»»ä½•å½±å“ã€‚æ­¤å¤–ï¼ŒJPA 2.0 è¿˜æ–°å¢äº† CascadeType.DETACHï¼Œå³çº§è”å®ä½“åˆ° Detach çŠ¶æ€ã€‚</p> <p>äº†è§£äº†æšä¸¾å€¼ï¼Œä¸‹é¢æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹çº§è”æ–°å»ºå’Œçº§è”åˆ é™¤ã€‚</p> <p>é¦–å…ˆï¼Œä¿®æ”¹ UserInfo é‡Œé¢çš„å…³é”®ä»£ç å¦‚ä¸‹ï¼Œå¹¶åœ¨ @OneToOne ä¸Šé¢æ·»åŠ </p> <p><code>cascade ={CascadeType.PERSIST,CascadeType.REMOVE}</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DataJpaTest</span>
<span class="token comment">// DataJpaTestã€MybatisTest ä¼šé»˜è®¤ä½¿ç”¨å…¶æµ‹è¯•æ•°æ®æºæ›¿ä»£ï¼Œè‹¥è¦ä½¿ç”¨è‡ªå·±é…ç½®çš„ï¼Œéœ€è¦æ·»åŠ å¦‚ä¸‹æ³¨è§£</span>
<span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace <span class="token operator">=</span> <span class="token class-name">AutoConfigureTestDatabase<span class="token punctuation">.</span>Replace</span><span class="token punctuation">.</span>NONE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">One2OneTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserInfoRepository</span> userInfoRepository<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Test</span>
    <span class="token annotation punctuation">@Rollback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUserRelationships</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jackxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> <span class="token class-name">UserInfo</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ages</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">telephone</span><span class="token punctuation">(</span><span class="token string">&quot;12345678&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¿å­˜userInfoçš„åŒä¸Šä¹Ÿä¼šä¿å­˜Userä¿¡æ¯</span>
        userInfoRepository<span class="token punctuation">.</span><span class="token function">saveAndFlush</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åˆ é™¤userInfoï¼ŒåŒæ—¶ä¹Ÿä¼šçº§è”çš„åˆ é™¤userè®°å½•</span>
        userInfoRepository<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>æœ€åï¼Œè¿è¡Œä¸€ä¸‹çœ‹çœ‹æ•ˆæœã€‚</p> <p><img src="/assets/img/CgqCHl9xtbmAP4vcAAEKnyVM6Ig708.f8618bfc.png" alt="img"></p> <p>ä¸Šé¢çš„æµ‹è¯•åœ¨æ‰§è¡Œäº† insert çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œä¸¤æ¡ insert çš„sql å’Œä¸¤æ¡ delete çš„ sqlï¼Œè¿™å°±ä½“ç°å‡ºäº† CascadeType.PERSIST å’Œ CascadeType.REMOVE çš„ä½œç”¨ã€‚</p> <p>ä¸Šé¢è®²äº†<strong>çº§è”åˆ é™¤</strong>çš„åœºæ™¯ï¼Œä¸‹é¢æˆ‘ä»¬å†è¯´ä¸€ä¸‹<strong>å…³è”å…³ç³»çš„åˆ é™¤åœºæ™¯</strong>è¯¥æ€ä¹ˆåšã€‚</p> <h3 id="orphanremoval-å±æ€§ç”¨æ³•"><a href="#orphanremoval-å±æ€§ç”¨æ³•" class="header-anchor">#</a> orphanRemoval å±æ€§ç”¨æ³•</h3> <p><strong>orphanRemoval è¡¨ç¤ºå½“å…³è”å…³ç³»è¢«åˆ é™¤</strong>çš„æ—¶å€™ï¼Œ<strong>æ˜¯å¦åº”ç”¨çº§è”åˆ é™¤</strong>ï¼Œé»˜è®¤ falseã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæµ‹è¯•ä¸€ä¸‹ä½ å°±ä¼šæ˜ç™½ã€‚</p> <p>é¦–å…ˆï¼Œè¿˜æ²¿ç”¨ä¸Šé¢çš„ä¾‹å­ï¼Œå½“æˆ‘ä»¬åˆ é™¤ userInfo çš„æ—¶å€™ï¼ŒæŠŠ User ç½®ç©ºï¼Œä½œå¦‚ä¸‹æ”¹åŠ¨ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>userInfo<span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
userInfoRepository<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å…¶æ¬¡ï¼Œæˆ‘ä»¬å†è¿è¡Œæµ‹è¯•ï¼Œçœ‹çœ‹æ•ˆæœã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>delete from user_info where id=?
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>è¿™æ—¶å€™ä½ å°±ä¼šå‘ç°ï¼Œå°‘äº†ä¸€æ¡åˆ é™¤ user çš„ sqlï¼Œè¯´æ˜æ²¡æœ‰è¿›è¡Œçº§è”åˆ é™¤ã€‚é‚£æˆ‘ä»¬å†æŠŠ UserInfo åšä¸€ä¸‹è°ƒæ•´ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfo</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@OneToOne</span><span class="token punctuation">(</span>cascade <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">CascadeType</span><span class="token punctuation">.</span>PERSIST<span class="token punctuation">}</span><span class="token punctuation">,</span>orphanRemoval <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>
   <span class="token comment">//....å…¶ä»–æ²¡å˜çš„ä»£ç çœäº†</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ç„¶åï¼Œæˆ‘ä»¬æŠŠ CascadeType.Remove åˆ é™¤äº†ï¼Œä¸è®©å®ƒè¿›è¡Œçº§è”åˆ é™¤ï¼Œä½†æ˜¯æˆ‘ä»¬æŠŠ orphanRemoval è®¾ç½®æˆ trueï¼Œå³å½“å…³è”å…³ç³»å˜åŒ–çš„æ—¶å€™çº§è”æ›´æ–°ã€‚æˆ‘ä»¬çœ‹ä¸‹å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUserRelationships</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jackxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> <span class="token class-name">UserInfo</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ages</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">telephone</span><span class="token punctuation">(</span><span class="token string">&quot;12345678&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userInfoRepository<span class="token punctuation">.</span><span class="token function">saveAndFlush</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        userInfo<span class="token punctuation">.</span><span class="token function">setAges</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userInfo<span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿˜æ˜¯é€šè¿‡è¿™ä¸ªè®¾ç½®useræ•°æ®ä¸ºç©º</span>
        userInfoRepository<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿è¡Œç»“æœã€‚</p> <p><img src="/assets/img/CgqCHl9xthOAHALuAAFaT_9YXuM848.ffc9dfcd.png" alt="img"></p> <p>å¯ä»¥çœ‹åˆ°ï¼Œç»“æœä¾ç„¶æ˜¯ä¸¤ä¸ª inser å’Œä¸¤ä¸ª deleteï¼Œä½†æ˜¯ä¸­é—´å¤šäº†ä¸€ä¸ª updateã€‚æˆ‘æ¥è§£é‡Šä¸€ä¸‹ï¼Œå› ä¸ºå»æ‰äº† CascadeType.REMOVEï¼Œè¿™ä¸ªæ—¶å€™ä¸ä¼šè¿›è¡Œçº§è”åˆ é™¤äº†ã€‚å½“æˆ‘ä»¬æŠŠ user å¯¹è±¡æ›´æ–°æˆç©ºçš„æ—¶å€™ï¼Œå°±ä¼šæ‰§è¡Œä¸€æ¡ update è¯­å¥æŠŠå…³è”å…³ç³»å»æ‰äº†ã€‚</p> <p>è€Œä¸ºä»€ä¹ˆåˆå‡ºç°äº†çº§è”åˆ é™¤ user å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬ä¿®æ”¹äº†é›†åˆå…³è”å…³ç³»ï¼ŒorphanRemoval è®¾ç½®ä¸º trueï¼Œæ‰€ä»¥åˆæ‰§è¡Œäº†çº§è”åˆ é™¤çš„æ“ä½œã€‚è¿™ä¸€ç‚¹ä½ å¯ä»¥ä»”ç»†ä½“ä¼šä¸€ä¸‹ orphanRemoval å’Œ CascadeType.REMOVE çš„åŒºåˆ«ã€‚</p> <p>åˆ°è¿™é‡Œï¼Œ@OneToOne å…³è”å…³ç³»ä»‹ç»å®Œäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹æ—¥å¸¸å·¥ä½œå¸¸è§çš„åœºæ™¯ï¼Œå…ˆçœ‹åœºæ™¯ä¸€ï¼šä¸»é”®å’Œå¤–é”®éƒ½æ˜¯åŒä¸€ä¸ªå­—æ®µçš„æƒ…å†µã€‚</p> <h3 id="ä¸»é”®å’Œå¤–é”®éƒ½æ˜¯åŒä¸€ä¸ªå­—æ®µ"><a href="#ä¸»é”®å’Œå¤–é”®éƒ½æ˜¯åŒä¸€ä¸ªå­—æ®µ" class="header-anchor">#</a> ä¸»é”®å’Œå¤–é”®éƒ½æ˜¯åŒä¸€ä¸ªå­—æ®µ</h3> <p>æˆ‘ä»¬å‡è®¾ user è¡¨æ˜¯ä¸»è¡¨ï¼Œuser_info çš„ä¸»é”®æ˜¯ user_idï¼Œå¹¶ä¸” user_id=user è¡¨é‡Œé¢çš„ idï¼Œé‚£æˆ‘ä»¬åº”è¯¥æ€ä¹ˆå†™ï¼Ÿ</p> <p>ç»§ç»­æ²¿ç”¨ä¸Šé¢çš„ä¾‹å­ï¼ŒUser å®ä½“ä¸å˜ï¼Œæˆ‘ä»¬çœ‹çœ‹ UserInfo å˜æˆä»€ä¹ˆæ ·äº†ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfo</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Id</span>
   <span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">Integer</span> ages<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> telephone<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@MapsId</span>
   <span class="token annotation punctuation">@OneToOne</span><span class="token punctuation">(</span>cascade <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">CascadeType</span><span class="token punctuation">.</span>PERSIST<span class="token punctuation">}</span><span class="token punctuation">,</span>orphanRemoval <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>è¿™é‡Œçš„åšæ³•å¾ˆç®€å•ï¼Œæˆ‘ä»¬ç›´æ¥æŠŠ userId è®¾ç½®ä¸ºä¸»é”®ï¼Œåœ¨ @OneToOne ä¸Šé¢æ·»åŠ  @MapsId æ³¨è§£å³å¯ã€‚<strong>@MapsId æ³¨è§£çš„ä½œç”¨æ˜¯æŠŠå…³è”å…³ç³»å®ä½“é‡Œé¢çš„ IDï¼ˆé»˜è®¤ï¼‰å€¼ copy åˆ° @MapsId æ ‡æ³¨çš„å­—æ®µä¸Šé¢</strong>ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯ user_id å­—æ®µï¼‰ã€‚</p> <p>æ¥ç€ï¼Œä¸Šé¢çš„æµ‹è¯•ç”¨ä¾‹æˆ‘ä»¬è·‘ä¸€ä¸‹ï¼Œçœ‹ä¸€ä¸‹æ•ˆæœã€‚</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">user</span> <span class="token punctuation">(</span>id <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> address <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> email <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sex <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> user_info <span class="token punctuation">(</span>ages <span class="token keyword">integer</span><span class="token punctuation">,</span> telephone <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user_id <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> user_info <span class="token keyword">add</span> <span class="token keyword">constraint</span> FKn8pl63y4abe7n0ls6topbqjh2 <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>user_id<span class="token punctuation">)</span> <span class="token keyword">references</span> <span class="token keyword">user</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç›´æ¥åˆ›å»ºäº† user è¡¨å’Œ user_info è¡¨ï¼Œå…¶ä¸­ user_info çš„ä¸»é”®æ˜¯ user_idï¼Œå¹¶ä¸”é€šè¿‡å¤–é”®å…³è”åˆ°äº† user è¡¨çš„ ID å­—æ®µï¼Œé‚£ä¹ˆæˆ‘ä»¬åŒæ—¶çœ‹ä¸€ä¸‹ inser çš„ sqlï¼Œä¹Ÿå‘ç”Ÿäº†å˜åŒ–ã€‚</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">user</span> <span class="token punctuation">(</span>address<span class="token punctuation">,</span> email<span class="token punctuation">,</span> name<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> user_info <span class="token punctuation">(</span>ages<span class="token punctuation">,</span> telephone<span class="token punctuation">,</span> user_id<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢å°±æ˜¯æˆ‘ä»¬è®²çš„å®æˆ˜åœºæ™¯ä¸€ï¼Œä¸»é”®å’Œå¤–é”®éƒ½æ˜¯åŒä¸€ä¸ªå­—æ®µã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å†è¯´ä¸€ä¸ªåœºæ™¯ï¼Œå°±æ˜¯åœ¨æŸ¥ user_info çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªæƒ³çŸ¥é“ user_id çš„å€¼å°±è¡Œäº†ï¼Œä¸éœ€è¦æŸ¥ user çš„å…¶ä»–ä¿¡æ¯ï¼Œå…·ä½“æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p> <h3 id="onetoone-å»¶è¿ŸåŠ è½½ï¼Œæˆ‘ä»¬åªéœ€è¦-id-å€¼"><a href="#onetoone-å»¶è¿ŸåŠ è½½ï¼Œæˆ‘ä»¬åªéœ€è¦-id-å€¼" class="header-anchor">#</a> @OneToOne å»¶è¿ŸåŠ è½½ï¼Œæˆ‘ä»¬åªéœ€è¦ ID å€¼</h3> <p>åœ¨ @OneToOne å»¶è¿ŸåŠ è½½çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å‡è®¾åªæƒ³æŸ¥ä¸‹ user_idï¼Œè€Œä¸æƒ³æŸ¥çœ‹ user è¡¨å…¶ä»–çš„ä¿¡æ¯ï¼Œå› ä¸ºå½“å‰ç”¨ä¸åˆ°ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹å‡ ç§åšæ³•ã€‚</p> <p>ç¬¬ä¸€ç§åšæ³•ï¼šè¿˜æ˜¯ User å®ä½“ä¸å˜ï¼Œæˆ‘ä»¬æ”¹ä¸€ä¸‹ UserInfo å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@ToString</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfo</span><span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Id</span>
   <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy<span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">Integer</span> ages<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> telephone<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@MapsId</span>
   <span class="token annotation punctuation">@OneToOne</span><span class="token punctuation">(</span>cascade <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">CascadeType</span><span class="token punctuation">.</span>PERSIST<span class="token punctuation">}</span><span class="token punctuation">,</span>orphanRemoval <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>ä»ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œå¯ä»¥çœ‹åˆ°åšçš„æ›´æ”¹å¦‚ä¸‹ï¼š</p> <ul><li>id å­—æ®µæˆ‘ä»¬å…ˆç”¨åŸæ¥çš„</li> <li>@OneToOne ä¸Šé¢æˆ‘ä»¬æ·»åŠ  @MapsId æ³¨è§£</li> <li>@OneToOne é‡Œé¢çš„ fetch = FetchType.LAZY è®¾ç½®å»¶è¿ŸåŠ è½½ï¼ˆé»˜è®¤ï¼‰</li></ul> <p>æ¥ç€ï¼Œæˆ‘ä»¬æ”¹é€ ä¸€ä¸‹æµ‹è¯•ç±»ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DataJpaTest</span>
<span class="token annotation punctuation">@TestInstance</span><span class="token punctuation">(</span><span class="token class-name">TestInstance<span class="token punctuation">.</span>Lifecycle</span><span class="token punctuation">.</span>PER_CLASS<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfoRepositoryTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserInfoRepository</span> userInfoRepository<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@BeforeAll</span>
    <span class="token annotation punctuation">@Rollback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jackxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&quot;123456@126.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> <span class="token class-name">UserInfo</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ages</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">telephone</span><span class="token punctuation">(</span><span class="token string">&quot;12345678&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userInfoRepository<span class="token punctuation">.</span><span class="token function">saveAndFlush</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * æµ‹è¯•ç”¨Userå…³è”å…³ç³»æ“ä½œ
     *
     * @throws JsonProcessingException
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token annotation punctuation">@Rollback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUserRelationships</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserInfo</span> userInfo1 <span class="token operator">=</span> userInfoRepository<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userInfo1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userInfo1<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>ç„¶åï¼Œæˆ‘ä»¬è·‘ä¸€ä¸‹æµ‹è¯•ç”¨ä¾‹ï¼Œçœ‹çœ‹æµ‹è¯•ç»“æœã€‚</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">user</span> <span class="token punctuation">(</span>address<span class="token punctuation">,</span> email<span class="token punctuation">,</span> name<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">user</span> <span class="token punctuation">(</span>address<span class="token punctuation">,</span> email<span class="token punctuation">,</span> name<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span>

<span class="token comment">-- ä¸¤æ¡inserç…§æ—§ï¼Œè€Œåªæœ‰ä¸€ä¸ªselect</span>
<span class="token keyword">select</span> userinfo0_<span class="token punctuation">.</span>user_id <span class="token keyword">as</span> user_id3_6_0_<span class="token punctuation">,</span> userinfo0_<span class="token punctuation">.</span>ages <span class="token keyword">as</span> ages1_6_0_<span class="token punctuation">,</span> userinfo0_<span class="token punctuation">.</span>telephone <span class="token keyword">as</span> telephon2_6_0_ <span class="token keyword">from</span> user_info userinfo0_ <span class="token keyword">where</span> userinfo0_<span class="token punctuation">.</span>user_id<span class="token operator">=</span>?
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>æœ€åä½ ä¼šå‘ç°ï¼Œæ‰“å°çš„ç»“æœç¬¦åˆé¢„æœŸã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>UserInfo(id=1, ages=12, telephone=12345678)
1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æ¥ä¸‹æ¥ä»‹ç»ç¬¬äºŒç§åšæ³•ï¼Œè¿™ç§åšæ³•å¾ˆç®€å•ï¼Œåªè¦åœ¨ UserInfo å¯¹è±¡é‡Œé¢ç›´æ¥å»æ‰ @OneToOne å…³è”å…³ç³»ï¼Œæ–°å¢ä¸‹é¢çš„å­—æ®µå³å¯ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user_id&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¿™å°±æ²¡æœ‰å…³è”å…³ç³»äº†</p> <p>ç¬¬ä¸‰åšæ³•æ˜¯åˆ©ç”¨ Hibernateï¼Œå®ƒç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§å­—èŠ‚ç å¢å¼ºæŠ€æœ¯ï¼Œé€šè¿‡ç¼–è¯‘å™¨æ”¹å˜ class è§£å†³äº†å»¶è¿ŸåŠ è½½é—®é¢˜ã€‚è¿™ç§æ–¹å¼æœ‰ç‚¹å¤æ‚ï¼Œéœ€è¦åœ¨ç¼–è¯‘å™¨å¼•å…¥ hibernateEnhance çš„ç›¸å…³ jar åŒ…ï¼Œä»¥åŠç¼–è¯‘å™¨éœ€è¦æ”¹å˜ class æ–‡ä»¶å¹¶æ·»åŠ  lazy ä»£ç†æ¥è§£å†³å»¶è¿ŸåŠ è½½ã€‚æˆ‘ä¸å¤ªæ¨èè¿™ç§æ–¹å¼ï¼Œå› ä¸ºå¤ªå¤æ‚ï¼Œä½ çŸ¥é“æœ‰è¿™å›äº‹å°±è¡Œäº†ã€‚</p> <p>ä»¥ä¸Šæˆ‘ä»¬æŒæ¡äº†è¿™ä¹ˆå¤šç”¨æ³•ï¼Œé‚£ä¹ˆæœ€ä½³å®è·µæ˜¯ä»€ä¹ˆï¼ŸåŒå‘å…³è”æ›´å¥½è¿˜æ˜¯å•å‘å…³è”æ›´å¥½ï¼Ÿæ ¹æ®æœ€è¿‘å‡ å¹´çš„åº”ç”¨ï¼Œæˆ‘æ€»ç»“å‡ºäº†ä¸€äº›æœ€ä½³å®è·µï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ã€‚</p> <h3 id="onetoone-çš„æœ€ä½³å®è·µ"><a href="#onetoone-çš„æœ€ä½³å®è·µ" class="header-anchor">#</a> @OneToOne çš„æœ€ä½³å®è·µ</h3> <p><strong>ç¬¬ä¸€ï¼Œæˆ‘è¦è¯´ä¸€ç§ Java é¢å‘å¯¹è±¡çš„è®¾è®¡åŸåˆ™ï¼šå¼€é—­åŸåˆ™ã€‚</strong></p> <p>å³å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚<strong>å¦‚æœæˆ‘ä»¬ä¸€ç›´ä½¿ç”¨åŒå‘å…³è”ï¼Œä¸¤ä¸ªå®ä½“çš„å¯¹è±¡è€¦åˆå¤ªä¸¥é‡äº†</strong>ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œéšç€ä¸šåŠ¡çš„å‘å±•ï¼ŒUser å¯¹è±¡å¯èƒ½æ˜¯åŸå§‹å¯¹è±¡ï¼Œ<strong>å›´ç»•ç€ User å¯èƒ½ä¼šæ‰©å±•å‡ºå„ç§å…³è”å¯¹è±¡</strong>ã€‚<strong>éš¾é“ User é‡Œé¢æ¯æ¬¡éƒ½è¦ä¿®æ”¹ï¼Œå»æ·»åŠ åŒå‘å…³è”å…³ç³»å—</strong>ï¼Ÿè‚¯å®šä¸æ˜¯ï¼Œå¦åˆ™æ—¶é—´é•¿äº†ï¼Œå¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„å…³è”å…³ç³»å°±æ˜¯ä¸€å›¢ä¹±éº»ã€‚</p> <p>æ‰€ä»¥ï¼Œæˆ‘ä»¬<strong>å°½é‡ã€ç”šè‡³ä¸è¦ç”¨åŒå‘å…³è”ï¼Œå¦‚æœéè¦ç”¨å…³è”å…³ç³»çš„è¯ï¼Œåªç”¨å•å‘å…³è”å°±å¤Ÿäº†</strong>ã€‚åŒå‘å…³è”æ­£æ˜¯ JPA çš„å¼ºå¤§ä¹‹å¤„ï¼Œä½†åŒæ—¶ä¹Ÿæ˜¯é—®é¢˜æœ€å¤šï¼Œæœ€è¢«äººè¯Ÿç—…ä¹‹å¤„ã€‚æ‰€ä»¥æˆ‘ä»¬è¦ç”¨å®ƒçš„ä¼˜ç‚¹ï¼Œè€Œä¸æ˜¯å­¦ä¼šäº†å°±ä¸€å®šè¦ä½¿ç”¨ã€‚</p> <p><strong>ç¬¬äºŒï¼Œæˆ‘æƒ³è¯´ CascadeType å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯æˆ‘ä¹Ÿå»ºè®®ä¿æŒé»˜è®¤ã€‚</strong></p> <p>å³æ²¡æœ‰çº§è”æ›´æ–°åŠ¨ä½œï¼Œæ²¡æœ‰çº§è”åˆ é™¤åŠ¨ä½œã€‚è¿˜æœ‰ orphanRemoval ä¹Ÿè¦å°½é‡ä¿æŒé»˜è®¤ falseï¼Œä¸åšçº§è”åˆ é™¤ã€‚å› ä¸ºè¿™ä¸¤ä¸ªåŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯æˆ‘ä¸ªäººè§‰å¾—è¿™è¿èƒŒäº†é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™é‡Œé¢çš„â€œèŒè´£å•ä¸€åŸåˆ™â€ï¼Œé™¤éä½ éå¸¸éå¸¸ç†Ÿæ‚‰ï¼Œå¦åˆ™ä½ åœ¨ç”¨çš„æ—¶å€™ä¼šæ—¶å¸¸æ„Ÿåˆ°æƒŠè®¶â€”â€”æ•°æ®ä»€ä¹ˆæ—¶é—´è¢«æ›´æ–°äº†ï¼Ÿæ•°æ®è¢«è°åˆ é™¤äº†ï¼Ÿé‡åˆ°è¿™ç§é—®é¢˜æŸ¥èµ·æ¥éå¸¸éº»çƒ¦ï¼Œå› ä¸ºæ˜¯æ¡†æ¶å¤„ç†ï¼Œæœ‰çš„æ—¶å€™å¹¶éé¢„æœŸçš„æ•ˆæœã€‚</p> <p>ä¸€æ—¦ç”Ÿäº§æ•°æ®è¢«è«åæ›´æ–°æˆ–è€…åˆ é™¤ï¼Œé‚£æ˜¯ä¸€ä»¶éå¸¸ç³Ÿç³•çš„äº‹æƒ…ã€‚å› ä¸ºè¿™äº›çº§è”æ“ä½œä¼šä½¿ä½ çš„æ–¹æ³•åå­—æ²¡åŠæ³•å‘½åï¼Œè€Œä¸”å®ƒä¸æ˜¯è·Ÿç€ä¸šåŠ¡é€»è¾‘å˜åŒ–çš„ï¼Œè€Œæ˜¯è·Ÿç€å®ä½“å˜åŒ–çš„ï¼Œè¿™å°±ä¼šä½¿æ–¹æ³•å’Œå¯¹è±¡çš„èŒè´£ä¸å•ä¸€ã€‚</p> <p><strong>ç¬¬ä¸‰ï¼Œæˆ‘æƒ³å‘Šè¯‰ä½ ï¼Œæ‰€æœ‰ç”¨åˆ°å…³è”å…³ç³»çš„åœ°æ–¹ï¼Œèƒ½ç”¨ Lazy çš„ç»å¯¹ä¸è¦ç”¨ EAGERï¼Œå¦åˆ™ä¼šæœ‰ SQL æ€§èƒ½é—®é¢˜ï¼Œä¼šå‡ºç°ä¸æ˜¯é¢„æœŸçš„ SQLã€‚</strong></p> <p>ä»¥ä¸Šä¸‰ç‚¹æ˜¯æˆ‘æ€»ç»“çš„é¿å‘æŒ‡å—ï¼Œæœ‰ç»éªŒçš„åŒå­¦è¿™æ—¶å€™ä¼šæœ‰ä¸ªç–‘é—®ï¼šå¤–é”®çº¦æŸä¸æ˜¯ä¸æ¨èä½¿ç”¨çš„å—ï¼Ÿå¦‚æœæˆ‘çš„å¤–é”®å­—æ®µåä¸æ˜¯çº¦å®šçš„æ€ä¹ˆåŠï¼Ÿåˆ«ç€æ€¥ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹ @JoinColumn æ³¨è§£å’Œ @JoinColumns æ³¨è§£ã€‚</p> <h3 id="joincloumns-joincolumn"><a href="#joincloumns-joincolumn" class="header-anchor">#</a> @JoinCloumns &amp; JoinColumn</h3> <p>è¿™ä¸¤ä¸ªæ³¨è§£æ˜¯é›†åˆå…³ç³»ï¼Œä»–ä»¬å¯ä»¥åŒæ—¶ä½¿ç”¨ï¼Œ@JoinColumn è¡¨ç¤ºå•å­—æ®µï¼Œ@JoinCloumns è¡¨ç¤ºå¤šä¸ª @JoinColumnï¼Œæˆ‘ä»¬æ¥ä¸€ä¸€çœ‹ä¸€ä¸‹ã€‚</p> <p>æˆ‘ä»¬è¿˜æ˜¯å…ˆç›´æ¥çœ‹ä¸€ä¸‹ @JoinColumn æºç ï¼Œäº†è§£ä¸‹è¿™ä¸€æ³¨è§£éƒ½æœ‰å“ªäº›é…ç½®é¡¹ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">JoinColumn</span> <span class="token punctuation">{</span>
    <span class="token comment">//å…³é”®çš„å­—æ®µå,é»˜è®¤æ³¨è§£ä¸Šçš„å­—æ®µåï¼Œåœ¨@OneToOneä»£è¡¨æœ¬è¡¨çš„å¤–é”®å­—æ®µåå­—ï¼›</span>
    <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//ä¸nameç›¸åå…³è”å¯¹è±¡çš„å­—æ®µï¼Œé»˜è®¤ä¸»é”®å­—æ®µ</span>
    <span class="token class-name">String</span> <span class="token function">referencedColumnName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//å¤–é”®å­—æ®µæ˜¯å¦å”¯ä¸€</span>
    <span class="token keyword">boolean</span> <span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">//å¤–é”®å­—æ®µæ˜¯å¦å…è®¸ä¸ºç©º</span>
    <span class="token keyword">boolean</span> <span class="token function">nullable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">//æ˜¯å¦è·Ÿéšä¸€èµ·æ–°å¢</span>
    <span class="token keyword">boolean</span> <span class="token function">insertable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">//æ˜¯å¦è·Ÿéšä¸€èµ·æ›´æ–°</span>
    <span class="token keyword">boolean</span> <span class="token function">updatable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">//JPA2.1æ–°å¢ï¼Œå¤–é”®ç­–ç•¥</span>
    <span class="token class-name">ForeignKey</span> <span class="token function">foreignKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token annotation punctuation">@ForeignKey</span><span class="token punctuation">(</span>PROVIDER_DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>å…¶æ¬¡ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ @ForeignKey(PROVIDER_DEFAULT) é‡Œé¢æšä¸¾å€¼æœ‰å‡ ä¸ªã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">ConstraintMode</span> <span class="token punctuation">{</span>
    <span class="token comment">//åˆ›å»ºå¤–é”®çº¦æŸ</span>
   CONSTRAINT<span class="token punctuation">,</span>
    <span class="token comment">//ä¸åˆ›å»ºå¤–é”®çº¦æŸ</span>
   NO_CONSTRAINT<span class="token punctuation">,</span>
   <span class="token comment">//é‡‡ç”¨é»˜è®¤è¡Œä¸º</span>
   PROVIDER_DEFAULT
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªæ³¨è§£çš„è¯­æ³•ï¼Œå°±å¯ä»¥è§£ç­”æˆ‘ä»¬ä¸Šé¢çš„ä¸¤ä¸ªé—®é¢˜ã€‚ä¿®æ”¹ä¸€ä¸‹ UserInfoï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfo</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy<span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> ages<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> telephone<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@OneToOne</span><span class="token punctuation">(</span>cascade <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">CascadeType</span><span class="token punctuation">.</span>PERSIST<span class="token punctuation">}</span><span class="token punctuation">,</span>orphanRemoval <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">)</span>
    <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>foreignKey <span class="token operator">=</span> <span class="token annotation punctuation">@ForeignKey</span><span class="token punctuation">(</span><span class="token class-name">ConstraintMode</span><span class="token punctuation">.</span>NO_CONSTRAINT<span class="token punctuation">)</span><span class="token punctuation">,</span>name <span class="token operator">=</span> <span class="token string">&quot;my_user_id&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>
    <span class="token comment">//...å…¶ä»–ä¸å˜</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­æŒ‡å®šäº†å­—æ®µçš„åå­—ï¼šmy_user_idï¼Œå¹¶ä¸”æŒ‡å®š NO_CONSTRAINT ä¸ç”Ÿæˆå¤–é”®ã€‚è€Œæµ‹è¯•ç”¨ä¾‹ä¸å˜ï¼Œæˆ‘ä»¬çœ‹ä¸‹è¿è¡Œç»“æœã€‚</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">user</span> <span class="token punctuation">(</span>id <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> address <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> email <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sex <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> user_info <span class="token punctuation">(</span>id <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> ages <span class="token keyword">integer</span><span class="token punctuation">,</span> telephone <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> my_user_id <span class="token keyword">bigint</span><span class="token punctuation">,</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¿™æ—¶æˆ‘ä»¬çœ‹åˆ° user_info è¡¨é‡Œé¢æ–°å¢äº†ä¸€ä¸ªå­—æ®µ my_user_idï¼Œinsert çš„æ—¶å€™ä¹Ÿèƒ½æ­£ç¡® inser my_user_id çš„å€¼ç­‰äº user.idã€‚</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> user_info <span class="token punctuation">(</span>ages<span class="token punctuation">,</span> telephone<span class="token punctuation">,</span> my_user_id<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>è€Œ @JoinColumns æ˜¯ JoinColumns çš„å¤æ•°å½¢å¼ï¼Œå°±æ˜¯é€šè¿‡ä¸¤ä¸ªå­—æ®µè¿›è¡Œçš„å¤–é”®å…³è”ï¼Œè¿™ä¸ªä¸å¸¸ç”¨ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ª demo äº†è§£ä¸€ä¸‹å°±å¥½ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompanyOffice</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@ManyToOne</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">)</span>
   <span class="token annotation punctuation">@JoinColumns</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
         <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;ADDR_ID&quot;</span><span class="token punctuation">,</span> referencedColumnName<span class="token operator">=</span><span class="token string">&quot;ID&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;ADDR_ZIP&quot;</span><span class="token punctuation">,</span> referencedColumnName<span class="token operator">=</span><span class="token string">&quot;ZIP&quot;</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">Address</span> address<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>ä¸Šé¢çš„å®ä¾‹ä¸­ï¼ŒCompanyOffice é€šè¿‡ ADDR_ID å’Œ ADDR_ZIP ä¸¤ä¸ªå­—æ®µå¯¹åº”ä¸€æ¡ address ä¿¡æ¯ï¼Œè§£é‡Šäº†ä¸€ä¸‹@JoinColumnsçš„ç”¨æ³•ã€‚</p> <p>å¦‚æœä½ äº†è§£äº† @OneToOne çš„è¯¦ç»†ç”¨æ³•ï¼Œåé¢è¦è®²çš„å‡ ä¸ªæ³¨è§£å°±å¾ˆå¥½ç†è§£äº†ï¼Œå› ä¸ºä»–ä»¬æœ‰ç‚¹ç±»ä¼¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹ @ManyToOne å’Œ @OneToMany çš„ç”¨æ³•ã€‚</p> <h2 id="ä¸€å¯¹å¤š"><a href="#ä¸€å¯¹å¤š" class="header-anchor">#</a> ä¸€å¯¹å¤š</h2> <h3 id="jpa-åè®®-ğŸ”¥-2"><a href="#jpa-åè®®-ğŸ”¥-2" class="header-anchor">#</a> JPA åè®® ğŸ”¥</h3> <ul><li><strong>ç»´æŠ¤å…³è”å…³ç³»çš„æ˜¯æ‹¥æœ‰å¤–é”®çš„ä¸€æ–¹ï¼Œè€Œå¦ä¸€æ–¹å¿…é¡»é…ç½® <code>mappedBy</code></strong></li></ul> <h3 id="æ¡ˆä¾‹ä»‹ç»-2"><a href="#æ¡ˆä¾‹ä»‹ç»-2" class="header-anchor">#</a> æ¡ˆä¾‹ä»‹ç»</h3> <p>å®¢æˆ·å’Œè”ç³»äººçš„æ¡ˆä¾‹ï¼ˆæ³¨æ„ï¼Œå®¢æˆ·å’Œè”ç³»äººæ˜¯å±äºåŒä¸€å…¬å¸çš„ï¼‰</p> <ul><li>å®¢æˆ·ï¼šä¹°äº†å•†å“çš„ä¸€å®¶å…¬å¸</li> <li>è”ç³»äººï¼šä¹°äº†å•†å“çš„è¿™å®¶å…¬å¸çš„å‘˜å·¥ï¼ˆå¯æœ‰å¤šä¸ªï¼‰</li></ul> <p>ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€ä¸ªå®¢æˆ·å¯ä»¥å…·æœ‰å¤šä¸ªè”ç³»äººï¼Œä¸€ä¸ªè”ç³»äººä»å±äºä¸€å®¶å…¬å¸</p> <h3 id="åˆ†ææ­¥éª¤"><a href="#åˆ†ææ­¥éª¤" class="header-anchor">#</a> åˆ†ææ­¥éª¤</h3> <ol><li><p>æ˜ç¡®è¡¨å…³ç³»ï¼šä¸€å¯¹å¤šå…³ç³»</p></li> <li><p>ç¡®å®šè¡¨å…³ç³»ï¼ˆå¤–é”®ï¼‰</p> <ul><li><strong>ä¸»è¡¨</strong>ï¼šå®¢æˆ·è¡¨</li> <li><strong>ä»è¡¨</strong>ï¼šè”ç³»äººè¡¨ï¼Œåœ¨ä»è¡¨æ·»åŠ <strong>å¤–é”®</strong></li></ul></li> <li><p>ç¼–å†™å®ä½“ç±»ï¼Œå†å®ä½“ç±»ä¸­æè¿°è¡¨å…³ç³»ï¼ˆ<strong>ç»„åˆ</strong>ï¼‰</p> <ul><li>å®¢æˆ·ï¼šå†å®¢æˆ·çš„å®ä½“ç±»ä¸­åŒ…å«ä¸€ä¸ªè”ç³»äººçš„é›†åˆ</li> <li>è”ç³»äººï¼šåœ¨è”ç³»äººçš„å®ä½“ç±»ä¸­åŒ…å«ä¸€ä¸ªå®¢æˆ·çš„å¯¹è±¡</li></ul></li> <li><p>é…ç½®æ˜ å°„å…³ç³»</p> <ul><li>ä½¿ç”¨ <strong>JPA æ³¨è§£é…ç½®ä¸€å¯¹å¤šæ˜ å°„å…³ç³»</strong></li></ul></li></ol> <h3 id="onetomany-manytoone"><a href="#onetomany-manytoone" class="header-anchor">#</a> @OneToMany &amp; @ManyToOne</h3> <p>@ManyToOne ä»£è¡¨å¤šå¯¹ä¸€çš„å…³è”å…³ç³»ï¼Œè€Œ @OneToMany ä»£è¡¨ä¸€å¯¹å¤šï¼Œä¸€èˆ¬ä¸¤ä¸ªæˆå¯¹ä½¿ç”¨è¡¨ç¤ºåŒå‘å…³è”å…³ç³»ã€‚è€Œ JPA åè®®ä¸­ä¹Ÿæ˜¯æ˜ç¡®è§„å®šï¼š<strong>ç»´æŠ¤å…³è”å…³ç³»çš„æ˜¯æ‹¥æœ‰å¤–é”®çš„ä¸€æ–¹ï¼ˆä»è¡¨ï¼‰ï¼Œè€Œå¦ä¸€æ–¹ï¼ˆä¸»è¡¨ï¼‰å¿…é¡»é…ç½® mappedBy</strong>ã€‚ä½“ä¼šä¸åˆ°çœ‹ä¸‹é¢çš„å®æˆ˜åŠé—®é¢˜åˆ†æå³å¯æ˜äº†ã€‚</p> <p>çœ‹ä¸‹é¢çš„æºç ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">ManyToOne</span> <span class="token punctuation">{</span>

    <span class="token class-name">Class</span> <span class="token function">targetEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token keyword">void</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>

    <span class="token class-name">CascadeType</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">cascade</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token class-name">FetchType</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> EAGER<span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">optional</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

 <span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">OneToMany</span> <span class="token punctuation">{</span>

    <span class="token class-name">Class</span> <span class="token function">targetEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token keyword">void</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>

 	<span class="token comment">//cascade çº§è”æ“ä½œç­–ç•¥ï¼š(CascadeType.PERSISTã€CascadeType.REMOVEã€CascadeType.REFRESHã€CascadeType.MERGEã€CascadeType.ALL) å¦‚æœä¸å¡«ï¼Œé»˜è®¤å…³ç³»è¡¨ä¸ä¼šäº§ç”Ÿä»»ä½•å½±å“ã€‚</span>
    <span class="token class-name">CascadeType</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">cascade</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token comment">//æ•°æ®è·å–æ–¹å¼EAGER(ç«‹å³åŠ è½½)/LAZY(å»¶è¿ŸåŠ è½½)</span>
    <span class="token class-name">FetchType</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> LAZY<span class="token punctuation">;</span>

    <span class="token comment">//å…³ç³»è¢«è°ç»´æŠ¤ï¼Œå•é¡¹çš„ã€‚æ³¨æ„ï¼šåªæœ‰å…³ç³»ç»´æŠ¤æ–¹æ‰èƒ½æ“ä½œä¸¤è€…çš„å…³ç³»ã€‚</span>
    <span class="token class-name">String</span> <span class="token function">mappedBy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

	<span class="token comment">//æ˜¯å¦çº§è”åˆ é™¤ã€‚å’ŒCascadeType.REMOVEçš„æ•ˆæœä¸€æ ·ã€‚ä¸¤ç§é…ç½®äº†ä¸€ä¸ªå°±ä¼šè‡ªåŠ¨çº§è”åˆ é™¤</span>
    <span class="token keyword">boolean</span> <span class="token function">orphanRemoval</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>æˆ‘ä»¬çœ‹åˆ°ä¸Šé¢çš„å­—æ®µå’Œ @OneToOne é‡Œé¢çš„åŸºæœ¬ä¸€æ ·ï¼Œç”¨æ³•æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p> <ol><li>@ManyToOne ä¸€å®šæ˜¯ç»´æŠ¤å¤–é”®å…³ç³»çš„ä¸€æ–¹ï¼Œæ‰€ä»¥æ²¡æœ‰ mappedBy å­—æ®µï¼›</li> <li>@ManyToOne åˆ é™¤çš„æ—¶å€™ä¸€å®šä¸èƒ½æŠŠ One çš„ä¸€æ–¹åˆ é™¤äº†ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰ orphanRemoval çš„é€‰é¡¹ï¼›</li> <li>@ManyToOne çš„ Lazy æ•ˆæœå’Œ @OneToOne çš„ä¸€æ ·ï¼Œæ‰€ä»¥å’Œä¸Šé¢çš„ç”¨æ³•åŸºæœ¬ä¸€è‡´ï¼›</li> <li>@OneToMany çš„ Lazy æ˜¯æœ‰æ•ˆæœçš„ã€‚</li></ol> <h3 id="å®æˆ˜ï¼šä¿å­˜"><a href="#å®æˆ˜ï¼šä¿å­˜" class="header-anchor">#</a> å®æˆ˜ï¼šä¿å­˜</h3> <p>å®ä½“ç±»å¦‚ä¸‹ï¼Œç›®å‰é…ç½®äº†<strong>åŒå‘å…³è”</strong>ï¼ˆ@OneToManyã€@ManyToOneï¼‰ï¼Œ<strong>ä¸”ä¸»ä»è¡¨éƒ½å¯ä»¥ç»´æŠ¤å¤–é”®ï¼ˆä¸æ¨èï¼‰</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@Setter</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Customer</span> <span class="token punctuation">{</span>


    <span class="token comment">/* å®¢æˆ·ç¼–å·ï¼ˆä¸»é”®ï¼‰*/</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> <span class="token class-name">Id</span><span class="token punctuation">;</span>

    <span class="token comment">/* å®¢æˆ·åç§°ï¼ˆå…¬å¸åç§°ï¼‰ */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token comment">/* å®¢æˆ·ä¿¡æ¯æ¥æº */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> source<span class="token punctuation">;</span>

    <span class="token comment">/* å®¢æˆ·æ‰€å±è¡Œä¸š */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> industry<span class="token punctuation">;</span>

    <span class="token comment">/* å®¢æˆ·çº§åˆ« */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> level<span class="token punctuation">;</span>

    <span class="token comment">/* å®¢æˆ·è”ç³»åœ°å€ */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>

    <span class="token comment">/* å®¢æˆ·è”ç³»ç”µè¯ */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> phone<span class="token punctuation">;</span>


    <span class="token comment">// ä¸æ¨èçš„é…ç½®ï¼Œä¸»è¡¨æ²¡æœ‰æ”¾å¼ƒç»´æŠ¤å¤–é”®</span>
    <span class="token annotation punctuation">@OneToMany</span>
    <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;custId&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LinkMan</span><span class="token punctuation">&gt;</span></span> linkManSet<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@Setter</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkMan</span> <span class="token punctuation">{</span>

    <span class="token comment">/* è”ç³»äººç¼–å·(ä¸»é”®) */</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token comment">/* è”ç³»äººå§“å */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token comment">/* è”ç³»äººæ€§åˆ« */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> gender<span class="token punctuation">;</span>

    <span class="token comment">/* è”ç³»äººåŠå…¬ç”µè¯ */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> phone<span class="token punctuation">;</span>

    <span class="token comment">/* è”ç³»äººæ‰‹æœº */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> mobile<span class="token punctuation">;</span>

    <span class="token comment">/* è”ç³»äººé‚®ç®± */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>

    <span class="token comment">/* è”ç³»äººèŒä½ */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> position<span class="token punctuation">;</span>

    <span class="token comment">/* è”ç³»äººå¤‡æ³¨ */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> remark<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@ManyToOne</span>
    <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;cust_id&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Customer</span> customer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>æµ‹è¯•</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DataJpaTest</span>
<span class="token comment">// DataJpaTestã€MybatisTest ä¼šé»˜è®¤ä½¿ç”¨å…¶æµ‹è¯•æ•°æ®æºæ›¿ä»£ï¼Œè‹¥è¦ä½¿ç”¨è‡ªå·±é…ç½®çš„ï¼Œéœ€è¦æ·»åŠ å¦‚ä¸‹æ³¨è§£</span>
<span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace <span class="token operator">=</span> <span class="token class-name">AutoConfigureTestDatabase<span class="token punctuation">.</span>Replace</span><span class="token punctuation">.</span>NONE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">One2ManyTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">CustomerRepository</span> customerRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">LinkManRepository</span> linkManRepository<span class="token punctuation">;</span>


    <span class="token comment">/**
     * ä¸»è¡¨æ”¾å¼ƒç»´æŠ¤å¤–é”®åè¯¥æ–¹æ³•æ— æ³•æ·»åŠ å¤–é”®å€¼
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token annotation punctuation">@Rollback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">void</span> <span class="token function">testSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Customer</span> customer <span class="token operator">=</span> <span class="token class-name">Customer</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;è…¾è®¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">linkManSet</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">LinkMan</span> linkMan <span class="token operator">=</span> <span class="token class-name">LinkMan</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;å°é©¬&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// åŒå‘å…³è”ï¼Œä¸»è¡¨ç»´æŠ¤å¤–é”®</span>
        customer<span class="token punctuation">.</span><span class="token function">getLinkManSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>linkMan<span class="token punctuation">)</span><span class="token punctuation">;</span>

        customerRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        linkManRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>linkMan<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä¿å­˜å¤–é”®æ—¶æ²¡æœ‰ç›´æ¥ insert è€Œæ˜¯2æ¡ insert åæ‰§è¡Œäº† updateï¼</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * æ¨èä½¿ç”¨çš„æ–¹å¼
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token annotation punctuation">@Rollback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">void</span> <span class="token function">testSave2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Customer</span> customer <span class="token operator">=</span> <span class="token class-name">Customer</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;è…¾è®¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">LinkMan</span> linkMan <span class="token operator">=</span> <span class="token class-name">LinkMan</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;å°é©¬&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">customer</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token comment">// åŒå‘å…³è”ï¼Œä»è¡¨ç»´æŠ¤å¤–é”®</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        customerRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        linkManRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>linkMan<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä¿å­˜å¤–é”®æ—¶åªç”¨äº†2æ¡ updateï¼</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h3 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="header-anchor">#</a> é—®é¢˜åˆ†æ</h3> <p>testSave è‡ªåŠ¨ç”Ÿæˆçš„sqlï¼š</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> customer <span class="token punctuation">(</span>
	id <span class="token keyword">BIGINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
	address <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	industry <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token keyword">LEVEL</span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	NAME <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	phone <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
source <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> id <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> link_man <span class="token punctuation">(</span>
	id <span class="token keyword">BIGINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
	email <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	gender <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	mobile <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	NAME <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	phone <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	position <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	remark <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
cust_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> id <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span><span class="token punctuation">;</span>

<span class="token comment">-- å¤–é”®çº¦æŸ</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> link_man <span class="token keyword">add</span> <span class="token keyword">constraint</span> FKd378jah5xd7bsqjolfsop35i <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>cust_id<span class="token punctuation">)</span> <span class="token keyword">references</span> customer <span class="token punctuation">(</span>id<span class="token punctuation">)</span>

<span class="token comment">-- ä¿å­˜</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> customer <span class="token punctuation">(</span>address<span class="token punctuation">,</span> industry<span class="token punctuation">,</span> <span class="token keyword">level</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> source<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> link_man <span class="token punctuation">(</span>cust_id<span class="token punctuation">,</span> email<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> mobile<span class="token punctuation">,</span> name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> position<span class="token punctuation">,</span> remark<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span>
<span class="token keyword">update</span> link_man <span class="token keyword">set</span> cust_id<span class="token operator">=</span>? <span class="token keyword">where</span> id<span class="token operator">=</span>?
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>å¯è§ï¼Œ<strong>ç›®å‰ç”Ÿæˆçš„å»ºè¡¨è¯­å¥ç«Ÿç„¶æœ‰3æ¡</strong>ï¼Œæœ¬åº”è¯¥åªæœ‰2æ¡ï¼å¹¶ä¸”ä¿å­˜å¤–é”®æ—¶<strong>æ²¡æœ‰ç›´æ¥ insert è€Œæ˜¯2æ¡ insert åæ‰§è¡Œäº† update</strong>ï¼</p> <p>å› æ­¤è¯¥æ–¹å¼<strong>ä¸å¯å–</strong>ï¼ˆå®é™…ç”Ÿäº§ä¸­å»ºè¡¨å¯ä»¥ä¸ç”¨ç®¡ï¼Œä½†æ˜¯å¯¹äºä¿å­˜æ“ä½œå°±ä¸åº”è¯¥ç”¨è¿™ä¹ˆå¤šæ¡è¯­å¥å®Œæˆï¼ï¼‰</p> <p>testSave2 è‡ªåŠ¨ç”Ÿæˆçš„sqlï¼š</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> customer <span class="token punctuation">(</span>
	id <span class="token keyword">BIGINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
	address <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	industry <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token keyword">LEVEL</span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	NAME <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	phone <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
source <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> id <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> link_man <span class="token punctuation">(</span>
	id <span class="token keyword">BIGINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
	email <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	gender <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	mobile <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	NAME <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	phone <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	position <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
	remark <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">255</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
cust_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> id <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span><span class="token punctuation">;</span>

<span class="token comment">-- å¤–é”®çº¦æŸ</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> link_man <span class="token keyword">add</span> <span class="token keyword">constraint</span> FKd378jah5xd7bsqjolfsop35i <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>cust_id<span class="token punctuation">)</span> <span class="token keyword">references</span> customer <span class="token punctuation">(</span>id<span class="token punctuation">)</span>

<span class="token comment">-- ä¿å­˜</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> customer <span class="token punctuation">(</span>address<span class="token punctuation">,</span> industry<span class="token punctuation">,</span> <span class="token keyword">level</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> source<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> link_man <span class="token punctuation">(</span>cust_id<span class="token punctuation">,</span> email<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> mobile<span class="token punctuation">,</span> name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> position<span class="token punctuation">,</span> remark<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>å¯è§ï¼Œ<strong>ç›®å‰ç”Ÿæˆçš„å»ºè¡¨è¯­å¥ç«Ÿç„¶æœ‰3æ¡</strong>ï¼Œæœ¬åº”è¯¥åªæœ‰2æ¡ï¼ä½†æ˜¯ä¿å­˜å¤–é”®æ—¶<strong>åªç”¨äº†2æ¡ update</strong>ï¼æ‰€ä»¥æ¨èï¼</p> <h3 id="æ”¹è¿›ï¼šä¸»è¡¨æ”¾å¼ƒå¤–é”®ç»´æŠ¤"><a href="#æ”¹è¿›ï¼šä¸»è¡¨æ”¾å¼ƒå¤–é”®ç»´æŠ¤" class="header-anchor">#</a> æ”¹è¿›ï¼šä¸»è¡¨æ”¾å¼ƒå¤–é”®ç»´æŠ¤</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Customer</span> <span class="token punctuation">{</span>


    <span class="token comment">/* å®¢æˆ·ç¼–å·ï¼ˆä¸»é”®ï¼‰*/</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> <span class="token class-name">Id</span><span class="token punctuation">;</span>

    <span class="token comment">/* å®¢æˆ·åç§°ï¼ˆå…¬å¸åç§°ï¼‰ */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token comment">/* å®¢æˆ·ä¿¡æ¯æ¥æº */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> source<span class="token punctuation">;</span>

    <span class="token comment">/* å®¢æˆ·æ‰€å±è¡Œä¸š */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> industry<span class="token punctuation">;</span>

    <span class="token comment">/* å®¢æˆ·çº§åˆ« */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> level<span class="token punctuation">;</span>

    <span class="token comment">/* å®¢æˆ·è”ç³»åœ°å€ */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>

    <span class="token comment">/* å®¢æˆ·è”ç³»ç”µè¯ */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> phone<span class="token punctuation">;</span>



    <span class="token comment">// ä¸»è¡¨åº”è¯¥æ”¾å¼ƒå¯¹å¤–é”®çš„ç»´æŠ¤</span>
    <span class="token comment">// @OneToMany</span>
    <span class="token comment">// @JoinColumn(name = &quot;custId&quot;)</span>
    <span class="token comment">// private Set&lt;LinkMan&gt; linkManSet;</span>

    <span class="token annotation punctuation">@OneToMany</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">&quot;customer&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LinkMan</span><span class="token punctuation">&gt;</span></span> linkManSet<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>å…¶ä½™ä¸å˜ï¼Œä½†æ˜¯æ³¨æ„æµ‹è¯•æ–¹æ³•åªæœ‰testSave2å¯ä»¥æ·»åŠ å¤–é”®å€¼äº†ï¼å› ä¸ºåªæœ‰ä»è¡¨æ‰èƒ½ç»´æŠ¤å¤–é”®äº†</p> <h3 id="å®æˆ˜ï¼šçº§è”-â˜ ï¸"><a href="#å®æˆ˜ï¼šçº§è”-â˜ ï¸" class="header-anchor">#</a> å®æˆ˜ï¼šçº§è” â˜ ï¸</h3> <p><strong>åˆ é™¤ä»è¡¨</strong>æ•°æ®ï¼šå¯ä»¥éšæ—¶ä»»æ„åˆ é™¤</p> <p><strong>åˆ é™¤ä¸»è¡¨</strong>æ•°æ®ï¼š</p> <ul><li><p>æ²¡æœ‰ä»è¡¨æ•°æ®å¼•ç”¨ï¼šéšä¾¿åˆ </p></li> <li><p>æœ‰ä»è¡¨æ•°æ®ï¼š</p> <ul><li>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šæŠŠå¤–é”®å­—æ®µç½®ä¸ºnullï¼Œç„¶ååˆ é™¤ä¸»è¡¨æ•°æ®ã€‚å¦‚æœåœ¨æ•°æ®åº“çš„è¡¨ç»“æ„ä¸Šï¼Œå¤–é”®å­—æ®µæœ‰éç©ºçº¦æŸï¼Œé»˜è®¤æƒ…å†µå°±ä¼šæŠ¥é”™äº†</li> <li>å¦‚æœé…ç½®äº†æ”¾å¼ƒç»´æŠ¤å…³è”å…³ç³»çš„æƒåˆ©ï¼Œåˆ™ä¸èƒ½åˆ é™¤ï¼ˆä¸å¤–é”®å­—æ®µæ˜¯å¦å…è®¸ä¸ºnullï¼Œæ²¡æœ‰å…³ç³»ï¼‰å› ä¸ºåœ¨åˆ é™¤æ—¶ï¼Œå®ƒæ ¹æœ¬ä¸ä¼šå»æ›´æ–°ä»è¡¨çš„å¤–é”®å­—æ®µäº†</li> <li>å¦‚æœè¿˜æƒ³åˆ é™¤ï¼Œä½¿ç”¨çº§è”åˆ é™¤å¼•ç”¨ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œçº§è”åˆ é™¤è¯·æ…ç”¨ï¼(åœ¨ä¸€å¯¹å¤šçš„æƒ…å†µä¸‹)</li></ul></li></ul> <p><strong>çº§è”</strong>ï¼šæ“ä½œä¸€ä¸ªå¯¹è±¡çš„åŒæ—¶æ“ä½œä»–çš„å…³è”å¯¹è±¡</p> <ul><li>çº§è”æ“ä½œï¼š 1.éœ€è¦<strong>åŒºåˆ†æ“ä½œä¸»ä½“</strong> 2.éœ€è¦åœ¨æ“ä½œä¸»ä½“çš„å®ä½“ç±»ä¸Šï¼ˆä¸»è¡¨æˆ–ç»´æŠ¤è¡¨ï¼‰ï¼Œæ·»åŠ çº§è”å±æ€§<code>cascade</code>ï¼ˆéœ€è¦æ·»åŠ åˆ°å¤šè¡¨æ˜ å°„å…³ç³»çš„æ³¨è§£ä¸Šï¼‰</li> <li>çº§è”æ·»åŠ ï¼Œæ¡ˆä¾‹ï¼šå½“æˆ‘ä¿å­˜ä¸€ä¸ªå®¢æˆ·çš„åŒæ—¶ä¿å­˜è”ç³»äººï¼ˆåœ¨ä»£ç ä¸­åªéœ€ä¿å­˜å®¢æˆ·ï¼ï¼‰</li> <li>çº§è”åˆ é™¤ï¼Œæ¡ˆä¾‹ï¼šå½“æˆ‘åˆ é™¤ä¸€ä¸ªå®¢æˆ·çš„åŒæ—¶åˆ é™¤æ­¤å®¢æˆ·çš„æ‰€æœ‰è”ç³»äººï¼Œæœ‰ä¸­é—´è¡¨ä¼šå…ˆåˆ é™¤ä¸­é—´è¡¨ï¼ˆåœ¨ä»£ç ä¸­åªéœ€åˆ é™¤å®¢æˆ·ï¼ï¼‰</li> <li>çº§è”æ›´æ–°ï¼Œç•¥</li></ul> <p><strong>é»˜è®¤æ˜¯ä¸è¿›è¡Œçº§è”æ“ä½œ</strong>ï¼Œéœ€è¦åœ¨**æ“ä½œä¸»è¡¨é…ç½®ï¼ˆä¸€èˆ¬é…ç½®åœ¨ä¸»è¡¨ï¼Œè™½ç„¶ä»è¡¨ä¹Ÿå¯ä»¥é…ç½®ï¼‰**å¦‚ä¸‹æ³¨è§£ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@Setter</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Customer</span> <span class="token punctuation">{</span>


    <span class="token comment">/* å®¢æˆ·ç¼–å·ï¼ˆä¸»é”®ï¼‰*/</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> <span class="token class-name">Id</span><span class="token punctuation">;</span>

    <span class="token comment">/* å®¢æˆ·åç§°ï¼ˆå…¬å¸åç§°ï¼‰ */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token comment">/* å®¢æˆ·ä¿¡æ¯æ¥æº */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> source<span class="token punctuation">;</span>

    <span class="token comment">/* å®¢æˆ·æ‰€å±è¡Œä¸š */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> industry<span class="token punctuation">;</span>

    <span class="token comment">/* å®¢æˆ·çº§åˆ« */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> level<span class="token punctuation">;</span>

    <span class="token comment">/* å®¢æˆ·è”ç³»åœ°å€ */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>

    <span class="token comment">/* å®¢æˆ·è”ç³»ç”µè¯ */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> phone<span class="token punctuation">;</span>

    <span class="token comment">// å¯ä»¥å•ç‹¬é…ç½®çº§è”ä¿å­˜ã€åˆ é™¤ï¼Œè¿˜å¯ä»¥é…ç½®æ›´æ–°ç­‰æ“ä½œï¼Œä¹Ÿå¯ä»¥ç›´æ¥é…ç½®å…¨éƒ¨</span>
    <span class="token annotation punctuation">@OneToMany</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">&quot;customer&quot;</span><span class="token punctuation">,</span> cascade <span class="token operator">=</span><span class="token class-name">CascadeType</span><span class="token punctuation">.</span>ALL<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LinkMan</span><span class="token punctuation">&gt;</span></span> linkManSet<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>æµ‹è¯•</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DataJpaTest</span>
<span class="token comment">// DataJpaTestã€MybatisTest ä¼šé»˜è®¤ä½¿ç”¨å…¶æµ‹è¯•æ•°æ®æºæ›¿ä»£ï¼Œè‹¥è¦ä½¿ç”¨è‡ªå·±é…ç½®çš„ï¼Œéœ€è¦æ·»åŠ å¦‚ä¸‹æ³¨è§£</span>
<span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace <span class="token operator">=</span> <span class="token class-name">AutoConfigureTestDatabase<span class="token punctuation">.</span>Replace</span><span class="token punctuation">.</span>NONE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">One2ManyTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">CustomerRepository</span> customerRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">LinkManRepository</span> linkManRepository<span class="token punctuation">;</span>

    <span class="token comment">/**
     * çº§è”æ·»åŠ ï¼Œä¿å­˜ä¸€ä¸ªå®¢æˆ·çš„åŒæ—¶ä¿å­˜è”ç³»äºº
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token annotation punctuation">@Rollback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">void</span> <span class="token function">testCascadeSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Customer</span> customer <span class="token operator">=</span> <span class="token class-name">Customer</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;è…¾è®¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">linkManSet</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">LinkMan</span> linkMan <span class="token operator">=</span> <span class="token class-name">LinkMan</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;å°é©¬&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">customer</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token comment">// åŒå‘å…³è”ï¼Œä»è¡¨ç»´æŠ¤å¤–é”®ï¼ˆè¿™ä¸ªæ˜¯ç»´æŠ¤å¤–é”®çš„ï¼Œå’Œçº§è”æ²¡æœ‰å…³ç³»ï¼ï¼ï¼ï¼‰</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        customer<span class="token punctuation">.</span><span class="token function">getLinkManSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>linkMan<span class="token punctuation">)</span><span class="token punctuation">;</span>

        customerRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token comment">/**
     * çº§è”åˆ é™¤ï¼Œåˆ é™¤ä¸€ä¸ªå®¢æˆ·çš„åŒæ—¶åˆ é™¤æ­¤å®¢æˆ·çš„æ‰€æœ‰è”ç³»äººã€‚æ‰§è¡Œåˆ é™¤å‰è®°å¾—æŠŠ ddl-auto æ”¹ä¸º update
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token annotation punctuation">@Rollback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">void</span> <span class="token function">testCascadeRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        customerRepository<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>çº§è”ä¿å­˜çš„sql</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>Hibernate: <span class="token keyword">insert</span> <span class="token keyword">into</span> customer <span class="token punctuation">(</span>address<span class="token punctuation">,</span> industry<span class="token punctuation">,</span> <span class="token keyword">level</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> source<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span>
Hibernate: <span class="token keyword">insert</span> <span class="token keyword">into</span> link_man <span class="token punctuation">(</span>cust_id<span class="token punctuation">,</span> email<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> mobile<span class="token punctuation">,</span> name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> position<span class="token punctuation">,</span> remark<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>çº§è”åˆ é™¤çš„sql</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>Hibernate: <span class="token keyword">select</span> customer0_<span class="token punctuation">.</span>id <span class="token keyword">as</span> id1_1_0_<span class="token punctuation">,</span> customer0_<span class="token punctuation">.</span>address <span class="token keyword">as</span> address2_1_0_<span class="token punctuation">,</span> customer0_<span class="token punctuation">.</span>industry <span class="token keyword">as</span> industry3_1_0_<span class="token punctuation">,</span> customer0_<span class="token punctuation">.</span><span class="token keyword">level</span> <span class="token keyword">as</span> level4_1_0_<span class="token punctuation">,</span> customer0_<span class="token punctuation">.</span>name <span class="token keyword">as</span> name5_1_0_<span class="token punctuation">,</span> customer0_<span class="token punctuation">.</span>phone <span class="token keyword">as</span> phone6_1_0_<span class="token punctuation">,</span> customer0_<span class="token punctuation">.</span>source <span class="token keyword">as</span> source7_1_0_ <span class="token keyword">from</span> customer customer0_ <span class="token keyword">where</span> customer0_<span class="token punctuation">.</span>id<span class="token operator">=</span>?
Hibernate: <span class="token keyword">select</span> linkmanset0_<span class="token punctuation">.</span>cust_id <span class="token keyword">as</span> cust_id9_2_0_<span class="token punctuation">,</span> linkmanset0_<span class="token punctuation">.</span>id <span class="token keyword">as</span> id1_2_0_<span class="token punctuation">,</span> linkmanset0_<span class="token punctuation">.</span>id <span class="token keyword">as</span> id1_2_1_<span class="token punctuation">,</span> linkmanset0_<span class="token punctuation">.</span>cust_id <span class="token keyword">as</span> cust_id9_2_1_<span class="token punctuation">,</span> linkmanset0_<span class="token punctuation">.</span>email <span class="token keyword">as</span> email2_2_1_<span class="token punctuation">,</span> linkmanset0_<span class="token punctuation">.</span>gender <span class="token keyword">as</span> gender3_2_1_<span class="token punctuation">,</span> linkmanset0_<span class="token punctuation">.</span>mobile <span class="token keyword">as</span> mobile4_2_1_<span class="token punctuation">,</span> linkmanset0_<span class="token punctuation">.</span>name <span class="token keyword">as</span> name5_2_1_<span class="token punctuation">,</span> linkmanset0_<span class="token punctuation">.</span>phone <span class="token keyword">as</span> phone6_2_1_<span class="token punctuation">,</span> linkmanset0_<span class="token punctuation">.</span>position <span class="token keyword">as</span> position7_2_1_<span class="token punctuation">,</span> linkmanset0_<span class="token punctuation">.</span>remark <span class="token keyword">as</span> remark8_2_1_ <span class="token keyword">from</span> link_man linkmanset0_ <span class="token keyword">where</span> linkmanset0_<span class="token punctuation">.</span>cust_id<span class="token operator">=</span>?
Hibernate: <span class="token keyword">delete</span> <span class="token keyword">from</span> link_man <span class="token keyword">where</span> id<span class="token operator">=</span>?
Hibernate: <span class="token keyword">delete</span> <span class="token keyword">from</span> customer <span class="token keyword">where</span> id<span class="token operator">=</span>?
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="æœ€ä½³å®è·µ-ğŸ”¥"><a href="#æœ€ä½³å®è·µ-ğŸ”¥" class="header-anchor">#</a> æœ€ä½³å®è·µ ğŸ”¥</h3> <p>é…ç½®å¹¶ä½¿ç”¨å¤šçš„ä¸€æ–¹ç»´æŠ¤å…³è”å…³ç³»ï¼ˆå¤–é”®ï¼‰ï¼Œä¿å­˜æ—¶ç›´æ¥å¯¹å¤–é”®èµ‹å€¼ï¼›é…ç½®å¹¶ä½¿ç”¨ä¸€çš„ä¸€æ–¹ç»´æŠ¤å…³è”å…³ç³»ï¼Œè¿˜ä¼šæ‰§è¡Œ1æ¡updateè¯­å¥ï¼ˆå¤šä½™ï¼ï¼‰ã€‚æ‰€ä»¥ JPA åè®®æœ‰è§„å®šï¼š</p> <ul><li>è‹¥é…ç½®<strong>å•å‘</strong>å…³è”ï¼Œå…³è”å…³ç³»çš„ç»´æŠ¤ç›´æ¥**é…ç½®åœ¨æ‹¥æœ‰å¤–é”®çš„ä¸€æ–¹ï¼ˆä»è¡¨ï¼‰**å³å¯ã€‚æ‹‰å‹¾è¯¾ç¨‹æ¨èä½¿ç”¨å•å‘å…³è”ï¼Œä¸æ¨èåŒå‘å…³è”ï¼Œä¸»è¡¨æŸ¥è¯¢æ—¶ä½¿ç”¨ sqlæŸ¥è¯¢ã€‚</li> <li>è‹¥é…ç½®<strong>åŒå‘</strong>å…³è”ï¼Œ<strong>ç»´æŠ¤å…³è”å…³ç³»çš„æ˜¯æ‹¥æœ‰å¤–é”®çš„ä¸€æ–¹ï¼ˆä»è¡¨ï¼‰</strong>ï¼Œè€Œ<strong>å¦ä¸€æ–¹ï¼ˆä¸»è¡¨ï¼‰å¿…é¡»é…ç½® mappedBy æ”¾å¼ƒå¤–é”®ç»´æŠ¤</strong>ï¼›</li></ul> <p><strong>å°½é‡é¿å…åŒå‘å…³è”ï¼Œå³åªç”¨ä¸€ä¸ªæ³¨è§£@ManyToOne</strong>ã€‚<a href="http://www.wangzhenhua.rocks/zh-hans/java/jpa-one-to-many-many-to-one-best-practice" target="_blank" rel="noopener noreferrer">JPAä¸­çš„OneToManyå’ŒManyToOneçš„æœ€ä½³å®è·µ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>ä¸€åˆ‡çº§è”æ›´æ–°å’Œ orphanRemoval éƒ½ä¿æŒé»˜è®¤è§„åˆ™ï¼Œå¹¶ä¸” fetch é‡‡ç”¨ lazy å»¶è¿ŸåŠ è½½ï¼ˆä¹Ÿæ˜¯é»˜è®¤è§„åˆ™ï¼‰ã€‚</p> <p>æ³¨æ„ï¼š<strong>æ”¾å¼ƒå¤–é”®ç»´æŠ¤å’Œçº§è”æ“ä½œæ²¡æœ‰åŠç‚¹å…³ç³»</strong></p> <h2 id="å¤šå¯¹å¤š"><a href="#å¤šå¯¹å¤š" class="header-anchor">#</a> å¤šå¯¹å¤š</h2> <h3 id="æ¡ˆä¾‹ä»‹ç»-3"><a href="#æ¡ˆä¾‹ä»‹ç»-3" class="header-anchor">#</a> æ¡ˆä¾‹ä»‹ç»</h3> <p>ç”¨æˆ·å’Œè§’è‰²ï¼ˆå¤šå¯¹å¤šå…³ç³»ï¼‰ï¼Œä¸ç”¨å¤šé€¼é€¼äº†ï¼Œå°±æ˜¯ RBAC æ¨¡å‹</p> <h3 id="åˆ†ææ­¥éª¤-2"><a href="#åˆ†ææ­¥éª¤-2" class="header-anchor">#</a> åˆ†ææ­¥éª¤</h3> <ol><li><p>æ˜ç¡®è¡¨å…³ç³»ï¼šä¸€å¯¹å¤šå…³ç³»</p></li> <li><p>ç¡®å®šè¡¨å…³ç³»ï¼ˆä¸­é—´è¡¨ï¼‰</p></li> <li><p>ç¼–å†™å®ä½“ç±»ï¼Œå†å®ä½“ç±»ä¸­æè¿°è¡¨å…³ç³»ï¼ˆ<strong>ç»„åˆ</strong>ï¼‰</p> <ul><li>ç”¨æˆ·ï¼šåŒ…å«è§’è‰²çš„é›†åˆ</li> <li>è§’è‰²ï¼šåŒ…å«ç”¨æˆ·çš„é›†åˆ</li></ul></li> <li><p>é…ç½®æ˜ å°„å…³ç³»</p> <ul><li>ä½¿ç”¨ <strong>JPA æ³¨è§£é…ç½®ä¸€å¯¹å¤šæ˜ å°„å…³ç³»</strong></li></ul></li></ol> <h3 id="manytomany-å®æˆ˜-ğŸ”¥"><a href="#manytomany-å®æˆ˜-ğŸ”¥" class="header-anchor">#</a> @ManyToMany å®æˆ˜ ğŸ”¥</h3> <p>@ManyToMany ä»£è¡¨å¤šå¯¹å¤šçš„å…³è”å…³ç³»ï¼Œè¿™ç§å…³è”å…³ç³»<strong>ä»»ä½•ä¸€æ–¹éƒ½å¯ä»¥ç»´æŠ¤å…³è”å…³ç³»</strong></p> <p>å®é™…å¼€å‘è€…å¯¹ @ManyToMany <strong>ç”¨å¾—æ¯”è¾ƒå°‘</strong>ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼š<strong>ç”¨æˆå¯¹çš„ @ManyToOne å’Œ @OneToMany ä»£æ›¿</strong>ï¼Œå› ä¸ºæˆ‘ä»¬çš„ä¸­é—´è¡¨å¯èƒ½è¿˜æœ‰ä¸€äº›çº¦å®šçš„å…¬å…±å­—æ®µï¼Œå¦‚ IDã€update_timeã€create_timeç­‰å…¶ä»–å­—æ®µï¼Œå½“ç„¶<strong>è¦æ˜¯æ²¡æœ‰è¿™äº›å­—æ®µï¼Œå¯ä»¥ä½¿ç”¨</strong> @ManyToMany</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@Setter</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysUser</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@ManyToMany</span>
    <span class="token annotation punctuation">@JoinTable</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;sys_user_role&quot;</span><span class="token punctuation">,</span>
            joinColumns <span class="token operator">=</span> <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            inverseJoinColumns <span class="token operator">=</span> <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;role_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysRole</span><span class="token punctuation">&gt;</span></span> roles<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@Setter</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysRole</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> roleId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> roleName<span class="token punctuation">;</span>

    <span class="token comment">// æ”¾å¼ƒä¸­é—´è¡¨ç»´æŠ¤æƒ</span>
    <span class="token annotation punctuation">@ManyToMany</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">&quot;roles&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> users<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SysUserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">JpaSpecificationExecutor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SysRoleRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysRole</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">JpaSpecificationExecutor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysRole</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æµ‹è¯•</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DataJpaTest</span>
<span class="token comment">// DataJpaTestã€MybatisTest ä¼šé»˜è®¤ä½¿ç”¨å…¶æµ‹è¯•æ•°æ®æºæ›¿ä»£ï¼Œè‹¥è¦ä½¿ç”¨è‡ªå·±é…ç½®çš„ï¼Œéœ€è¦æ·»åŠ å¦‚ä¸‹æ³¨è§£</span>
<span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace <span class="token operator">=</span> <span class="token class-name">AutoConfigureTestDatabase<span class="token punctuation">.</span>Replace</span><span class="token punctuation">.</span>NONE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Many2ManyTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SysUserRepository</span> sysUserRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SysRoleRepository</span> sysRoleRepository<span class="token punctuation">;</span>


    <span class="token comment">/**
     * ä¿å­˜ä¸€ä¸ªç”¨æˆ·ã€ä¸€ä¸ªè§’è‰²
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token annotation punctuation">@Rollback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">void</span> <span class="token function">testSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">SysUser</span> sysUser <span class="token operator">=</span> <span class="token class-name">SysUser</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">userName</span><span class="token punctuation">(</span><span class="token string">&quot;conanan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">SysRole</span> sysRole <span class="token operator">=</span> <span class="token class-name">SysRole</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roleName</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶æ„å¸ˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">users</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// é…ç½®ç”¨æˆ·åˆ°è§’è‰²çš„å…³ç³»ï¼Œå¯ä»¥å¯¹ä¸­é—´è¡¨è¿›è¡Œç»´æŠ¤</span>
        sysUser<span class="token punctuation">.</span><span class="token function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sysRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é…ç½®è§’è‰²åˆ°ç”¨æˆ·çš„å…³ç³»ï¼Œå¯ä»¥å¯¹ä¸­é—´è¡¨è¿›è¡Œç»´æŠ¤</span>
        <span class="token comment">// sysRole.getUsers().add(sysUser);</span>
        <span class="token comment">// ä½†æ˜¯ä¸èƒ½åŒæ—¶ç»´æŠ¤ï¼Œå› ä¸ºè”åˆä¸»é”®ä¸èƒ½é‡å¤ï¼</span>
        <span class="token comment">// æŠ¥é”™ Caused by: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry '1-1' for key 'sys_user_role.PRIMARY'</span>
        <span class="token comment">// æ”¾å¼ƒè¢«é€‰æ‹©ä¸€æ–¹ï¼ˆå¦‚è§’è‰²ï¼‰çš„ä¸­é—´è¡¨ç»´æŠ¤æƒå³å¯ï¼</span>

        sysUserRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>sysUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sysRoleRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>sysRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>ç”Ÿæˆçš„sqlï¼š</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> sys_user_role <span class="token punctuation">(</span>user_id <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> role_id <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> role_id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">InnoDB</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> sys_role <span class="token punctuation">(</span>role_id <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span> role_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>role_id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">InnoDB</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> sys_user <span class="token punctuation">(</span>user_id <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span> age <span class="token keyword">integer</span><span class="token punctuation">,</span> user_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">InnoDB</span>

<span class="token keyword">alter</span> <span class="token keyword">table</span> sys_user_role <span class="token keyword">add</span> <span class="token keyword">constraint</span> FKhh52n8vd4ny9ff4x9fb8v65qx <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>role_id<span class="token punctuation">)</span> <span class="token keyword">references</span> sys_role <span class="token punctuation">(</span>role_id<span class="token punctuation">)</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> sys_user_role <span class="token keyword">add</span> <span class="token keyword">constraint</span> FKb40xxfch70f5qnyfw8yme1n1s <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>user_id<span class="token punctuation">)</span> <span class="token keyword">references</span> sys_user <span class="token punctuation">(</span>user_id<span class="token punctuation">)</span>

<span class="token comment">-- ä¿å­˜</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> sys_user <span class="token punctuation">(</span>age<span class="token punctuation">,</span> user_name<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> sys_role <span class="token punctuation">(</span>role_name<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> sys_user_role <span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> role_id<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>å¯è§ï¼Œ<strong>ç›®å‰ç”Ÿæˆçš„å»ºè¡¨è¯­å¥ç«Ÿç„¶æœ‰5æ¡</strong>ï¼Œæœ¬åº”è¯¥åªæœ‰3æ¡ï¼</p> <h3 id="manytomany-å®æˆ˜ï¼šçº§è”-â˜ ï¸"><a href="#manytomany-å®æˆ˜ï¼šçº§è”-â˜ ï¸" class="header-anchor">#</a> @ManyToMany å®æˆ˜ï¼šçº§è” â˜ ï¸</h3> <p>é…ç½®åŒä¸€å¯¹å¤š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@Setter</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysUser</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@ManyToMany</span><span class="token punctuation">(</span>cascade <span class="token operator">=</span> <span class="token class-name">CascadeType</span><span class="token punctuation">.</span>ALL<span class="token punctuation">)</span>
    <span class="token annotation punctuation">@JoinTable</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;sys_user_role&quot;</span><span class="token punctuation">,</span>
            joinColumns <span class="token operator">=</span> <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            inverseJoinColumns <span class="token operator">=</span> <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;role_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysRole</span><span class="token punctuation">&gt;</span></span> roles<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>æµ‹è¯•</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DataJpaTest</span>
<span class="token comment">// DataJpaTestã€MybatisTest ä¼šé»˜è®¤ä½¿ç”¨å…¶æµ‹è¯•æ•°æ®æºæ›¿ä»£ï¼Œè‹¥è¦ä½¿ç”¨è‡ªå·±é…ç½®çš„ï¼Œéœ€è¦æ·»åŠ å¦‚ä¸‹æ³¨è§£</span>
<span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace <span class="token operator">=</span> <span class="token class-name">AutoConfigureTestDatabase<span class="token punctuation">.</span>Replace</span><span class="token punctuation">.</span>NONE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Many2ManyTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SysUserRepository</span> sysUserRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SysRoleRepository</span> sysRoleRepository<span class="token punctuation">;</span>


    <span class="token comment">/**
     * ä¿å­˜ä¸€ä¸ªç”¨æˆ·ã€ä¸€ä¸ªè§’è‰²
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token annotation punctuation">@Rollback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">void</span> <span class="token function">testSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">SysUser</span> sysUser <span class="token operator">=</span> <span class="token class-name">SysUser</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">userName</span><span class="token punctuation">(</span><span class="token string">&quot;conanan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">SysRole</span> sysRole <span class="token operator">=</span> <span class="token class-name">SysRole</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roleName</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶æ„å¸ˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">users</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// é…ç½®ç”¨æˆ·åˆ°è§’è‰²çš„å…³ç³»ï¼Œå¯ä»¥å¯¹ä¸­é—´è¡¨è¿›è¡Œç»´æŠ¤</span>
        sysUser<span class="token punctuation">.</span><span class="token function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sysRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é…ç½®è§’è‰²åˆ°ç”¨æˆ·çš„å…³ç³»ï¼Œå¯ä»¥å¯¹ä¸­é—´è¡¨è¿›è¡Œç»´æŠ¤</span>
        <span class="token comment">// sysRole.getUsers().add(sysUser);</span>
        <span class="token comment">// ä½†æ˜¯ä¸èƒ½åŒæ—¶ç»´æŠ¤ï¼Œå› ä¸ºè”åˆä¸»é”®ä¸èƒ½é‡å¤ï¼</span>
        <span class="token comment">// æŠ¥é”™ Caused by: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry '1-1' for key 'sys_user_role.PRIMARY'</span>
        <span class="token comment">// æ”¾å¼ƒè¢«é€‰æ‹©ä¸€æ–¹ï¼ˆå¦‚è§’è‰²ï¼‰çš„ä¸­é—´è¡¨ç»´æŠ¤æƒå³å¯ï¼</span>

        sysUserRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>sysUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sysRoleRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>sysRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * æµ‹è¯•çº§è”æ·»åŠ ï¼ˆä¿å­˜ä¸€ä¸ªç”¨æˆ·åŒæ—¶ä¿å­˜ç”¨æˆ·ç›¸å…³è§’è‰²åŠä¸­é—´è¡¨å…³è”ä¿¡æ¯ï¼‰
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token annotation punctuation">@Rollback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">void</span> <span class="token function">testCascadeAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">SysUser</span> sysUser <span class="token operator">=</span> <span class="token class-name">SysUser</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">userName</span><span class="token punctuation">(</span><span class="token string">&quot;conanan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysRole</span><span class="token punctuation">&gt;</span></span> byId <span class="token operator">=</span> sysRoleRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">5L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">SysRole</span> sysRole <span class="token operator">=</span> <span class="token class-name">SysRole</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roleId</span><span class="token punctuation">(</span><span class="token number">5L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">users</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// é…ç½®ç”¨æˆ·åˆ°è§’è‰²çš„å…³ç³»ï¼Œå¯ä»¥å¯¹ä¸­é—´è¡¨è¿›è¡Œç»´æŠ¤ã€‚è‹¥è¿˜é…ç½®äº†çº§è”ï¼Œåˆ™è¿™é‡Œä¹Ÿç»´æŠ¤äº†çº§è”å…³ç³»</span>
        sysUser<span class="token punctuation">.</span><span class="token function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>byId<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SysRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é…ç½®è§’è‰²åˆ°ç”¨æˆ·çš„å…³ç³»ï¼Œå¯ä»¥å¯¹ä¸­é—´è¡¨è¿›è¡Œç»´æŠ¤</span>
        <span class="token comment">// sysRole.getUsers().add(sysUser);</span>
        <span class="token comment">// ä½†æ˜¯ä¸èƒ½åŒæ—¶ç»´æŠ¤ï¼Œå› ä¸ºè”åˆä¸»é”®ä¸èƒ½é‡å¤ï¼</span>
        <span class="token comment">// æŠ¥é”™ Caused by: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry '1-1' for key 'sys_user_role.PRIMARY'</span>
        <span class="token comment">// æ”¾å¼ƒè¢«é€‰æ‹©ä¸€æ–¹ï¼ˆå¦‚è§’è‰²ï¼‰çš„ä¸­é—´è¡¨ç»´æŠ¤æƒå³å¯ï¼</span>

        sysUserRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>sysUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * æµ‹è¯•çº§è”åˆ é™¤ï¼ˆåˆ é™¤ä¸€ä¸ªç”¨æˆ·åŒæ—¶åˆ é™¤ä¸­é—´è¡¨å…³è”ä¿¡æ¯åŠç”¨æˆ·ç›¸å…³è§’è‰²ï¼‰
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token annotation punctuation">@Rollback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">void</span> <span class="token function">testCascadeRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        sysUserRepository<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token number">5L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><p>ä¿å­˜çš„sql</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> sys_user_role <span class="token punctuation">(</span>user_id <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> role_id <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> role_id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">InnoDB</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> sys_role <span class="token punctuation">(</span>role_id <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span> role_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>role_id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">InnoDB</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> sys_user <span class="token punctuation">(</span>user_id <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span> age <span class="token keyword">integer</span><span class="token punctuation">,</span> user_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">InnoDB</span>

<span class="token keyword">alter</span> <span class="token keyword">table</span> sys_user_role <span class="token keyword">add</span> <span class="token keyword">constraint</span> FKhh52n8vd4ny9ff4x9fb8v65qx <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>role_id<span class="token punctuation">)</span> <span class="token keyword">references</span> sys_role <span class="token punctuation">(</span>role_id<span class="token punctuation">)</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> sys_user_role <span class="token keyword">add</span> <span class="token keyword">constraint</span> FKb40xxfch70f5qnyfw8yme1n1s <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>user_id<span class="token punctuation">)</span> <span class="token keyword">references</span> sys_user <span class="token punctuation">(</span>user_id<span class="token punctuation">)</span>

<span class="token comment">-- ä¿å­˜</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> sys_user <span class="token punctuation">(</span>age<span class="token punctuation">,</span> user_name<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> sys_role <span class="token punctuation">(</span>role_name<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> sys_user_role <span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> role_id<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>å¯è§ï¼Œ<strong>ç›®å‰ç”Ÿæˆçš„å»ºè¡¨è¯­å¥ç«Ÿç„¶æœ‰5æ¡</strong>ï¼Œæœ¬åº”è¯¥åªæœ‰3æ¡ï¼å…¶ä½™çš„ä¸€æ¨¡ä¸€æ ·</p> <p>çº§è”åˆ é™¤çš„sql</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> sysuser0_<span class="token punctuation">.</span>user_id <span class="token keyword">as</span> user_id1_5_0_<span class="token punctuation">,</span> sysuser0_<span class="token punctuation">.</span>age <span class="token keyword">as</span> age2_5_0_<span class="token punctuation">,</span> sysuser0_<span class="token punctuation">.</span>user_name <span class="token keyword">as</span> user_nam3_5_0_ <span class="token keyword">from</span> sys_user sysuser0_ <span class="token keyword">where</span> sysuser0_<span class="token punctuation">.</span>user_id<span class="token operator">=</span>?
<span class="token keyword">select</span> roles0_<span class="token punctuation">.</span>user_id <span class="token keyword">as</span> user_id1_3_0_<span class="token punctuation">,</span> roles0_<span class="token punctuation">.</span>role_id <span class="token keyword">as</span> role_id2_3_0_<span class="token punctuation">,</span> sysrole1_<span class="token punctuation">.</span>role_id <span class="token keyword">as</span> role_id1_4_1_<span class="token punctuation">,</span> sysrole1_<span class="token punctuation">.</span>role_name <span class="token keyword">as</span> role_nam2_4_1_ <span class="token keyword">from</span> sys_user_role roles0_ <span class="token keyword">inner</span> <span class="token keyword">join</span> sys_role sysrole1_ <span class="token keyword">on</span> roles0_<span class="token punctuation">.</span>role_id<span class="token operator">=</span>sysrole1_<span class="token punctuation">.</span>role_id <span class="token keyword">where</span> roles0_<span class="token punctuation">.</span>user_id<span class="token operator">=</span>?
<span class="token keyword">delete</span> <span class="token keyword">from</span> sys_user_role <span class="token keyword">where</span> user_id<span class="token operator">=</span>?
<span class="token keyword">delete</span> <span class="token keyword">from</span> sys_role <span class="token keyword">where</span> role_id<span class="token operator">=</span>?
<span class="token keyword">delete</span> <span class="token keyword">from</span> sys_user <span class="token keyword">where</span> user_id<span class="token operator">=</span>?
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>æœ‰å¯èƒ½åˆ é™¤æŠ¥é”™ï¼å› ä¸ºåœ¨åˆ é™¤ä¸­é—´è¡¨åï¼Œåˆ é™¤è§’è‰²è¡¨æ—¶ï¼Œè¯¥è§’è‰²å¯èƒ½è¿˜è¢«å…¶ä»–ç”¨æˆ·å¼•ç”¨ï¼</p> <h3 id="manytoone-å’Œ-onetomany-è¡¨ç¤º-ğŸ”¥"><a href="#manytoone-å’Œ-onetomany-è¡¨ç¤º-ğŸ”¥" class="header-anchor">#</a> @ManyToOne å’Œ @OneToMany è¡¨ç¤º ğŸ”¥</h3> <p>éœ€è¦æ–°å»ºä¸€ä¸ªä¸­é—´è¡¨ @Entity ç±»ï¼Œå¹¶åœ¨è¯¥ç±»ä¸­ç»´æŠ¤æ˜ å°„å…³ç³»ï¼Œè®°å¾—åœ¨2ä¸ªä¸»è¡¨ä¸­é…ç½® mappedByã€‚æ­¤æ—¶å¯è§ï¼Œ<strong>ç›®å‰ç”Ÿæˆçš„å»ºè¡¨è¯­å¥å°±åªæœ‰3æ¡</strong>ï¼Œéå¸¸æ­£å¸¸ï¼</p> <h3 id="å¤šå¯¹å¤šçš„æœ€ä½³å®è·µ-ğŸ”¥"><a href="#å¤šå¯¹å¤šçš„æœ€ä½³å®è·µ-ğŸ”¥" class="header-anchor">#</a> å¤šå¯¹å¤šçš„æœ€ä½³å®è·µ ğŸ”¥</h3> <ul><li>@ManyToMany ä½¿ç”¨ä¸€èˆ¬è¾ƒå°‘ï¼Œé™¤éæ²¡æœ‰é¢å¤–å­—æ®µ</li> <li>ä¸Šé¢æˆ‘ä»¬ä»‹ç»çš„ @OneToMany çš„æœ€ä½³å®è·µåŒæ ·é€‚ç”¨ï¼Œæˆ‘ä¸ºäº†è¯´æ˜æ–¹ä¾¿ï¼Œé‡‡ç”¨çš„æ˜¯åŒå‘å…³è”ï¼Œè€Œ<strong>å®é™…ç”Ÿäº§ä¸€èˆ¬æ˜¯åœ¨ä¸­é—´è¡¨å¯¹è±¡é‡Œé¢åšå•å‘å…³è”</strong>ï¼Œè¿™æ ·ä¼šè®©å®ä½“ä¹‹é—´çš„å…³è”å…³ç³»ç®€å•å¾ˆå¤šã€‚</li> <li>ä¸ @OneToMany ä¸€æ ·çš„é“ç†ï¼Œä¸è¦ç”¨çº§è”åˆ é™¤å’Œ orphanRemoval=trueã€‚é»˜è®¤é…ç½®å³å¯ï¼</li> <li>FetchType é‡‡ç”¨é»˜è®¤æ–¹å¼ï¼šfetch = FetchType.LAZY çš„æ–¹å¼ã€‚é»˜è®¤é…ç½®å³å¯ï¼</li></ul> <h2 id="å¯¹è±¡å¯¼èˆªæŸ¥è¯¢-ğŸ”¥"><a href="#å¯¹è±¡å¯¼èˆªæŸ¥è¯¢-ğŸ”¥" class="header-anchor">#</a> å¯¹è±¡å¯¼èˆªæŸ¥è¯¢ ğŸ”¥</h2> <p>å¯¹è±¡å¯¼èˆªæŸ¥è¯¢æ˜¯æ ¹æ®å·²ç»åŠ è½½çš„å¯¹è±¡ï¼Œå¯¼èˆªåˆ°ä»–çš„å…³è”å¯¹è±¡ã€‚å®ƒåˆ©ç”¨ç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»æ¥æ£€ç´¢å¯¹è±¡ã€‚ä¾‹å¦‚ï¼šæˆ‘ä»¬é€šè¿‡IDæŸ¥è¯¢æ–¹å¼æŸ¥å‡ºä¸€ä¸ªå®¢æˆ·ï¼Œå¯ä»¥è°ƒç”¨Customerç±»ä¸­çš„getLinkMans()æ–¹æ³•æ¥è·å–è¯¥å®¢æˆ·çš„æ‰€æœ‰è”ç³»äººã€‚å¯¹è±¡å¯¼èˆªæŸ¥è¯¢çš„ä½¿ç”¨è¦æ±‚æ˜¯ï¼šä¸¤ä¸ªå¯¹è±¡ä¹‹é—´å¿…é¡»å­˜åœ¨å…³è”å…³ç³»ã€‚</p> <p>å¯¹è±¡å¯¼èˆªæŸ¥è¯¢</p> <ul><li><strong>ä»ä¸€æ–¹æŸ¥è¯¢å¤šæ–¹ï¼šé»˜è®¤å»¶è¿ŸåŠ è½½</strong></li> <li><strong>ä»å¤šæ–¹æŸ¥è¯¢ä¸€æ–¹ï¼šé»˜è®¤ç«‹å³åŠ è½½</strong></li></ul> <p>å¯ä»¥ä¿®æ”¹é…ç½®å°†å…¶æ”¹ä¸ºç«‹å³åŠ è½½ï¼ˆä¸æ¨èï¼ï¼‰ï¼Œ<strong>fetché…ç½®åœ¨å¤šè¡¨å…³ç³»ä¸­ä¸»ä½“ï¼ˆæˆ–ä¸€æ–¹æˆ–å¤šæ–¹ï¼‰çš„æ³¨è§£ä¸Š</strong></p> <p>ä¸€å¯¹å¤šä¸­çš„ä¾‹å­ï¼Œæ— éœ€ä»»ä½•ä¿®æ”¹</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DataJpaTest</span>
<span class="token comment">// DataJpaTestã€MybatisTest ä¼šé»˜è®¤ä½¿ç”¨å…¶æµ‹è¯•æ•°æ®æºæ›¿ä»£ï¼Œè‹¥è¦ä½¿ç”¨è‡ªå·±é…ç½®çš„ï¼Œéœ€è¦æ·»åŠ å¦‚ä¸‹æ³¨è§£</span>
<span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace <span class="token operator">=</span> <span class="token class-name">AutoConfigureTestDatabase<span class="token punctuation">.</span>Replace</span><span class="token punctuation">.</span>NONE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ObjectNavigationTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">CustomerRepository</span> customerRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">LinkManRepository</span> linkManRepository<span class="token punctuation">;</span>


    <span class="token comment">/**
     * å¯¹è±¡å¯¼èˆªæŸ¥è¯¢é»˜è®¤ä¹Ÿæ˜¯ä½¿ç”¨å»¶è¿ŸåŠ è½½ï¼Œä½¿ç”¨å…³è”å¯¹è±¡æ—¶æ‰æŸ¥è¯¢ï¼Œä»…ä»….è°ƒç”¨ä¸ä¼šæ‰§è¡ŒæŸ¥è¯¢
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testSelect1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Customer</span> customer <span class="token operator">=</span> customerRepository<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LinkMan</span><span class="token punctuation">&gt;</span></span> linkManSet <span class="token operator">=</span> customer<span class="token punctuation">.</span><span class="token function">getLinkManSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>linkManSet<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ­¤æ—¶æ‰æŸ¥è¯¢</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>ä»ä¸€æ–¹æŸ¥è¯¢å¤šæ–¹ï¼šé»˜è®¤å»¶è¿ŸåŠ è½½</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> customer customer0_ <span class="token keyword">where</span> customer0_<span class="token punctuation">.</span>id<span class="token operator">=</span>?
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> link_man linkmanset0_ <span class="token keyword">where</span> linkmanset0_<span class="token punctuation">.</span>cust_id<span class="token operator">=</span>?
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä»å¤šæ–¹æŸ¥è¯¢ä¸€æ–¹ï¼šé»˜è®¤ç«‹å³åŠ è½½</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> 
 <span class="token comment">-- ç•¥æ‰å­—æ®µ</span>
 <span class="token operator">*</span>
<span class="token keyword">FROM</span>
	link_man linkman0_
	<span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> customer customer1_ <span class="token keyword">ON</span> linkman0_<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> customer1_<span class="token punctuation">.</span>id 
<span class="token keyword">WHERE</span>
	linkman0_<span class="token punctuation">.</span>id <span class="token operator">=</span>?
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="æœªæ•´ç†"><a href="#æœªæ•´ç†" class="header-anchor">#</a> æœªæ•´ç†</h2> <p><a href="http://www.wangzhenhua.rocks/zh-hans/java/jpa-one-to-many-many-to-one-best-practice" target="_blank" rel="noopener noreferrer">JPAä¸­çš„OneToManyå’ŒManyToOneçš„æœ€ä½³å®è·µ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œè¿˜æœ‰ç¯‡åšå®¢</p> <p>å¤ªå¤æ‚äº†ï¼ŒJPA å˜ç”¨è¾¹å†™å§ã€‚ã€‚ã€‚</p></div></div> <div class="page-slot page-slot-bottom"><!-- æ¨ªå‘è‡ªé€‚åº” -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/master/docs/200.Java Web/600.SpringDataJPA/404.å¤šè¡¨æ“ä½œ.md" target="_blank" rel="noopener noreferrer">ç¼–è¾‘</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2021/06/21, 15:45:42</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/a40e65/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">åŸºç¡€æ“ä½œ</div></a> <a href="/pages/544a0d/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">å®¡è®¡åŠŸèƒ½</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pages/a40e65/" class="prev">åŸºç¡€æ“ä½œ</a></span> <span class="next"><a href="/pages/544a0d/">å®¡è®¡åŠŸèƒ½</a>â†’
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/7fcc72/"><div>çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ</div></a> <span>07-06</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/a4ef99/"><div>çº¿ç¨‹å®‰å…¨ç†è®º</div></a> <span>06-24</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/890a0b/"><div>å¹¶å‘ç®€å²</div></a> <span>06-24</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">æ›´å¤šæ–‡ç« &gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:894072666@qq.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/xugaoyi" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="å¬éŸ³ä¹" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2019-2021
    <span>Evan Xu | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">Ã—</i> <div><!-- å›ºå®š160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.ac5e3ef4.js" defer></script><script src="/assets/js/2.d960b235.js" defer></script><script src="/assets/js/51.f4a8b763.js" defer></script>
  </body>
</html>