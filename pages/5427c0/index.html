<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>总览入门 | conanan&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="web前端技术博客,简洁至上,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.03260d1f.css" as="style"><link rel="preload" href="/assets/js/app.ac5e3ef4.js" as="script"><link rel="preload" href="/assets/js/2.d960b235.js" as="script"><link rel="preload" href="/assets/js/8.b5f907d4.js" as="script"><link rel="prefetch" href="/assets/js/10.949143aa.js"><link rel="prefetch" href="/assets/js/100.122fb3a2.js"><link rel="prefetch" href="/assets/js/101.88060c8d.js"><link rel="prefetch" href="/assets/js/102.06832b28.js"><link rel="prefetch" href="/assets/js/103.a0c17aef.js"><link rel="prefetch" href="/assets/js/104.b38ef641.js"><link rel="prefetch" href="/assets/js/105.603033e4.js"><link rel="prefetch" href="/assets/js/106.6b288074.js"><link rel="prefetch" href="/assets/js/107.1ffec4c0.js"><link rel="prefetch" href="/assets/js/108.c7b79afa.js"><link rel="prefetch" href="/assets/js/109.dda9fbee.js"><link rel="prefetch" href="/assets/js/11.326a1f58.js"><link rel="prefetch" href="/assets/js/110.920cbe6e.js"><link rel="prefetch" href="/assets/js/111.45bfe7f2.js"><link rel="prefetch" href="/assets/js/112.1f11c570.js"><link rel="prefetch" href="/assets/js/113.fab1cc04.js"><link rel="prefetch" href="/assets/js/114.21ea4ed6.js"><link rel="prefetch" href="/assets/js/115.96f65264.js"><link rel="prefetch" href="/assets/js/116.b324c49b.js"><link rel="prefetch" href="/assets/js/117.dc4d308c.js"><link rel="prefetch" href="/assets/js/118.8f152d6d.js"><link rel="prefetch" href="/assets/js/119.ede5fffc.js"><link rel="prefetch" href="/assets/js/12.23122444.js"><link rel="prefetch" href="/assets/js/120.044161d7.js"><link rel="prefetch" href="/assets/js/121.453c745a.js"><link rel="prefetch" href="/assets/js/122.e3b088eb.js"><link rel="prefetch" href="/assets/js/123.d5a90d16.js"><link rel="prefetch" href="/assets/js/124.7731d89c.js"><link rel="prefetch" href="/assets/js/125.e64126c4.js"><link rel="prefetch" href="/assets/js/126.e46361b1.js"><link rel="prefetch" href="/assets/js/127.067ae046.js"><link rel="prefetch" href="/assets/js/128.59df2a2f.js"><link rel="prefetch" href="/assets/js/129.a2b82230.js"><link rel="prefetch" href="/assets/js/13.6780e0cd.js"><link rel="prefetch" href="/assets/js/130.c20833b9.js"><link rel="prefetch" href="/assets/js/131.da020742.js"><link rel="prefetch" href="/assets/js/132.e20ac455.js"><link rel="prefetch" href="/assets/js/133.f114b097.js"><link rel="prefetch" href="/assets/js/134.49de9e80.js"><link rel="prefetch" href="/assets/js/135.1a24633f.js"><link rel="prefetch" href="/assets/js/136.d5853212.js"><link rel="prefetch" href="/assets/js/137.3a1020dd.js"><link rel="prefetch" href="/assets/js/138.f194f86d.js"><link rel="prefetch" href="/assets/js/139.bf8c1ca0.js"><link rel="prefetch" href="/assets/js/14.08edf279.js"><link rel="prefetch" href="/assets/js/140.c800f5e0.js"><link rel="prefetch" href="/assets/js/141.47afa8e4.js"><link rel="prefetch" href="/assets/js/142.fda2db61.js"><link rel="prefetch" href="/assets/js/143.0224a2e5.js"><link rel="prefetch" href="/assets/js/144.4126fe8d.js"><link rel="prefetch" href="/assets/js/145.9fe0839a.js"><link rel="prefetch" href="/assets/js/146.89a9e1b2.js"><link rel="prefetch" href="/assets/js/147.56419b8e.js"><link rel="prefetch" href="/assets/js/148.03d2b50f.js"><link rel="prefetch" href="/assets/js/149.c1331b6d.js"><link rel="prefetch" href="/assets/js/15.f198e5b9.js"><link rel="prefetch" href="/assets/js/16.00e51c93.js"><link rel="prefetch" href="/assets/js/17.291d3ebc.js"><link rel="prefetch" href="/assets/js/18.017a098e.js"><link rel="prefetch" href="/assets/js/19.61ae84a4.js"><link rel="prefetch" href="/assets/js/20.2fed9841.js"><link rel="prefetch" href="/assets/js/21.0540e3f5.js"><link rel="prefetch" href="/assets/js/22.65f1eb05.js"><link rel="prefetch" href="/assets/js/23.fd9e2f2e.js"><link rel="prefetch" href="/assets/js/24.199ad75b.js"><link rel="prefetch" href="/assets/js/25.005a23bb.js"><link rel="prefetch" href="/assets/js/26.46587fdd.js"><link rel="prefetch" href="/assets/js/27.eaf61373.js"><link rel="prefetch" href="/assets/js/28.12bcc1aa.js"><link rel="prefetch" href="/assets/js/29.2ee78c15.js"><link rel="prefetch" href="/assets/js/3.aae4de15.js"><link rel="prefetch" href="/assets/js/30.5a13fad2.js"><link rel="prefetch" href="/assets/js/31.d559ae93.js"><link rel="prefetch" href="/assets/js/32.d5a38545.js"><link rel="prefetch" href="/assets/js/33.484dfc49.js"><link rel="prefetch" href="/assets/js/34.1a006a06.js"><link rel="prefetch" href="/assets/js/35.12b84d1e.js"><link rel="prefetch" href="/assets/js/36.b2cd4408.js"><link rel="prefetch" href="/assets/js/37.a5859cb8.js"><link rel="prefetch" href="/assets/js/38.96209f1d.js"><link rel="prefetch" href="/assets/js/39.71d70a82.js"><link rel="prefetch" href="/assets/js/4.0e4cf147.js"><link rel="prefetch" href="/assets/js/40.a59b859c.js"><link rel="prefetch" href="/assets/js/41.ebb72a6a.js"><link rel="prefetch" href="/assets/js/42.71f99aa2.js"><link rel="prefetch" href="/assets/js/43.092ff2c9.js"><link rel="prefetch" href="/assets/js/44.d70e216f.js"><link rel="prefetch" href="/assets/js/45.afb733d1.js"><link rel="prefetch" href="/assets/js/46.86c421f9.js"><link rel="prefetch" href="/assets/js/47.6d337ef6.js"><link rel="prefetch" href="/assets/js/48.157e1f1c.js"><link rel="prefetch" href="/assets/js/49.1aed4add.js"><link rel="prefetch" href="/assets/js/5.831f36ca.js"><link rel="prefetch" href="/assets/js/50.b495cbac.js"><link rel="prefetch" href="/assets/js/51.f4a8b763.js"><link rel="prefetch" href="/assets/js/52.beec293d.js"><link rel="prefetch" href="/assets/js/53.2ac4d785.js"><link rel="prefetch" href="/assets/js/54.342112cf.js"><link rel="prefetch" href="/assets/js/55.61e2bfb6.js"><link rel="prefetch" href="/assets/js/56.fa782548.js"><link rel="prefetch" href="/assets/js/57.41bc249e.js"><link rel="prefetch" href="/assets/js/58.c1d5fafb.js"><link rel="prefetch" href="/assets/js/59.4297a34f.js"><link rel="prefetch" href="/assets/js/6.54e4e793.js"><link rel="prefetch" href="/assets/js/60.634948c3.js"><link rel="prefetch" href="/assets/js/61.de4327e7.js"><link rel="prefetch" href="/assets/js/62.c6902476.js"><link rel="prefetch" href="/assets/js/63.737a0e11.js"><link rel="prefetch" href="/assets/js/64.cbe1b041.js"><link rel="prefetch" href="/assets/js/65.2df8f108.js"><link rel="prefetch" href="/assets/js/66.ee7de747.js"><link rel="prefetch" href="/assets/js/67.88edee59.js"><link rel="prefetch" href="/assets/js/68.c29f5efe.js"><link rel="prefetch" href="/assets/js/69.2fedc1f9.js"><link rel="prefetch" href="/assets/js/7.1c00f39e.js"><link rel="prefetch" href="/assets/js/70.0fe4782b.js"><link rel="prefetch" href="/assets/js/71.6c22c273.js"><link rel="prefetch" href="/assets/js/72.1fc7ddbd.js"><link rel="prefetch" href="/assets/js/73.25cb42eb.js"><link rel="prefetch" href="/assets/js/74.e922e1cc.js"><link rel="prefetch" href="/assets/js/75.f48393b6.js"><link rel="prefetch" href="/assets/js/76.72e96818.js"><link rel="prefetch" href="/assets/js/77.3df4edcb.js"><link rel="prefetch" href="/assets/js/78.73c6a652.js"><link rel="prefetch" href="/assets/js/79.22ba589c.js"><link rel="prefetch" href="/assets/js/80.2d070db4.js"><link rel="prefetch" href="/assets/js/81.c0bc2539.js"><link rel="prefetch" href="/assets/js/82.4c6a47fa.js"><link rel="prefetch" href="/assets/js/83.a43f597f.js"><link rel="prefetch" href="/assets/js/84.8ce525d0.js"><link rel="prefetch" href="/assets/js/85.6b21aae0.js"><link rel="prefetch" href="/assets/js/86.f6ebabd9.js"><link rel="prefetch" href="/assets/js/87.9acaeb0d.js"><link rel="prefetch" href="/assets/js/88.99cdf592.js"><link rel="prefetch" href="/assets/js/89.58f63450.js"><link rel="prefetch" href="/assets/js/9.053d267f.js"><link rel="prefetch" href="/assets/js/90.1d59f40c.js"><link rel="prefetch" href="/assets/js/91.e8b2a5cd.js"><link rel="prefetch" href="/assets/js/92.b92bba74.js"><link rel="prefetch" href="/assets/js/93.688cad95.js"><link rel="prefetch" href="/assets/js/94.2c11a588.js"><link rel="prefetch" href="/assets/js/95.aa37d1df.js"><link rel="prefetch" href="/assets/js/96.fffa0e6e.js"><link rel="prefetch" href="/assets/js/97.04e9be9f.js"><link rel="prefetch" href="/assets/js/98.2672abca.js"><link rel="prefetch" href="/assets/js/99.c8de1c63.js">
    <link rel="stylesheet" href="/assets/css/0.styles.03260d1f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/EB-logo.png" alt="conanan's blog" class="logo"> <span class="site-name can-hide">conanan's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/pages/4b56bd/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/4b56bd/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/pages/724936/" class="nav-link">Java Web</a></li><li class="dropdown-item"><h4>工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b18d09/" class="nav-link">Maven</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DataBase" class="dropdown-title"><a href="/pages/74cdda/" class="link-title">DataBase</a> <span class="title" style="display:none;">DataBase</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/74cdda/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/pages/4e9f47/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool" class="dropdown-title"><a href="/pages/89d1e7/" class="link-title">Tool</a> <span class="title" style="display:none;">Tool</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/89d1e7/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Vim</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d5fb/" class="nav-link">Docker</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/xugaoyi/image_store/blog/20200103123203.jpg"> <div class="blogger-info"><h3>Evan Xu</h3> <span>前端界的小学生</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/pages/4b56bd/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/4b56bd/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/pages/724936/" class="nav-link">Java Web</a></li><li class="dropdown-item"><h4>工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b18d09/" class="nav-link">Maven</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DataBase" class="dropdown-title"><a href="/pages/74cdda/" class="link-title">DataBase</a> <span class="title" style="display:none;">DataBase</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/74cdda/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/pages/4e9f47/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool" class="dropdown-title"><a href="/pages/89d1e7/" class="link-title">Tool</a> <span class="title" style="display:none;">Tool</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/89d1e7/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Vim</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d5fb/" class="nav-link">Docker</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Jakarta EE</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tomcat</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringMVC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SpringDataJPA</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/9e29b0/" class="sidebar-link">JPA基础</a></li><li><a href="/pages/5427c0/" aria-current="page" class="active sidebar-link">总览入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/5427c0/#持久层开发的问题" class="sidebar-link">持久层开发的问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/5427c0/#持久层开发的问题-2" class="sidebar-link">持久层开发的问题</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#什么是-spring-data？" class="sidebar-link">什么是 Spring Data？</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#spring-data-的子项目" class="sidebar-link">Spring Data 的子项目</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#spring-data-jpa-关系图-🔥" class="sidebar-link">Spring Data JPA 关系图 🔥</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#spring-data-common-之-repository-🔥" class="sidebar-link">Spring Data Common 之 Repository 🔥</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/5427c0/#spring-data-jpa-的依赖关系" class="sidebar-link">Spring Data JPA 的依赖关系</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#repository-接口、层次关系-🔥" class="sidebar-link">Repository 接口、层次关系 🔥</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#测试-entity-user" class="sidebar-link">测试 Entity—User</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#repository-接口示例-方法名称规则查询-🔥" class="sidebar-link">Repository 接口示例—方法名称规则查询 🔥</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#crudrepository-接口示例-🔥" class="sidebar-link">CrudRepository 接口示例 🔥</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#pagingandsortingrepository-接口示例-🔥" class="sidebar-link">PagingAndSortingRepository 接口示例 🔥</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#jparepository-接口示例-🔥" class="sidebar-link">JpaRepository 接口示例 🔥</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#具体实现类-simplejparepository-🔥" class="sidebar-link">具体实现类 SimpleJpaRepository 🔥</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#启发-🔥" class="sidebar-link">启发 🔥</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#entity-中的-jpa-注解-🔥" class="sidebar-link">@Entity 中的 JPA 注解 🔥</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/5427c0/#entity-实体是什么？" class="sidebar-link">Entity 实体是什么？</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#详细的注解都有哪些？" class="sidebar-link">详细的注解都有哪些？</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#entity" class="sidebar-link">@Entity</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#table" class="sidebar-link">@Table</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#access" class="sidebar-link">@Access</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#id" class="sidebar-link">@Id</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#generatedvalue" class="sidebar-link">@GeneratedValue</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#enumerated（没啥用）" class="sidebar-link">@Enumerated（没啥用）</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#basic" class="sidebar-link">@Basic</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#transient" class="sidebar-link">@Transient</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#column" class="sidebar-link">@Column</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#temporal" class="sidebar-link">@Temporal</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#完整的例子" class="sidebar-link">完整的例子</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#联合主键" class="sidebar-link">联合主键</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/5427c0/#通过-id-和-idclass-做到联合主键" class="sidebar-link">通过@Id 和 @IdClass 做到联合主键</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#embeddable-与-embeddedid-注解使用" class="sidebar-link">@Embeddable 与 @EmbeddedId 注解使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#实体之间的继承关系如何实现？🔥" class="sidebar-link">实体之间的继承关系如何实现？🔥</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/5427c0/#总结" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#附-spring-mvc-测试" class="sidebar-link">附. Spring MVC 测试</a></li><li class="sidebar-sub-header"><a href="/pages/5427c0/#未整理-🔥" class="sidebar-link">未整理 🔥</a></li></ul></li><li><a href="/pages/a40e65/" class="sidebar-link">基础操作</a></li><li><a href="/pages/26ad8c/" class="sidebar-link">多表操作</a></li><li><a href="/pages/544a0d/" class="sidebar-link">审计功能</a></li><li><a href="/pages/044c3c/" class="sidebar-link">JPA示例（旧）</a></li></ul></section></li><li><a href="/pages/927e76/" class="sidebar-link">Test</a></li><li><a href="/pages/2ffe27/" class="sidebar-link">Shiro</a></li><li><a href="/pages/16f81e/" class="sidebar-link">Thymeleaf</a></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/categories/?category=Java%20Web" title="分类" data-v-1cd794fe>Java Web</a></li> <li data-v-1cd794fe><a href="/categories/?category=SpringDataJPA" title="分类" data-v-1cd794fe>SpringDataJPA</a></li> <!----></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/apple54whn" target="_blank" title="作者" class="beLink" data-v-1cd794fe>conanan</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2021-06-21</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">
          总览入门
        </h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h1 id="总览入门"><a href="#总览入门" class="header-anchor">#</a> 总览入门</h1> <h2 id="持久层开发的问题"><a href="#持久层开发的问题" class="header-anchor">#</a> 持久层开发的问题</h2> <h3 id="持久层开发的问题-2"><a href="#持久层开发的问题-2" class="header-anchor">#</a> 持久层开发的问题</h3> <p>随着互联网技术的发展，现在的企业开发中用到的用于数据存储的产品，不再仅仅是关系型数据库，而是要根据场景需要选择不同的存储技术，比如用于缓存热点数据的redis，用于存储文档数据的mongodb，用于支持强大搜索功能的elasticsearch等等。</p> <p>在Java中，对于上面所说的产品都提供了优秀的访问技术。比如针对关系型数据库的mybatis、jpa等技术，针对于redis的jedis技术等等..... 这些技术虽然可以很好的针对各个存储产品进行访问操作，但同时也带来了新的问题，那就是不同的持久层技术的API是不一样的。这样一来，开发人员就必须同时掌握多种数据访问技术，这无疑增加了开发成本。那么我们会想，有没有这样一种技术，它可以使用<strong>一套API支持各个不同的存储的访问</strong>呢？就在这样的需求下，SpringData产生了。</p> <h3 id="什么是-spring-data？"><a href="#什么是-spring-data？" class="header-anchor">#</a> 什么是 Spring Data？</h3> <p>Spring Data 项目是从 2010 年开发发展起来的，Spring Data 利用一个大家熟悉的、一致的、基于“注解”的数据访问编程模型，做一些<strong>公共操作的封装</strong>，它可以轻松地让开发者使用数据库访问技术，<strong>简化 DAO 层开发</strong>，包括<strong>关系数据库、非关系数据库</strong>（NoSQL）。同时又有不同的数据框架的实现，保留了每个底层数据存储结构的特殊特性。</p> <p><strong>Spring Data Common 是 Spring Data 所有模块的公共部分</strong>，该项目提供了基于 Spring 的共享基础设施，它提供了基于 repository 接口以 DB 操作的一些封装，以及一个坚持在 Java 实体类上标注元数据的模型。</p> <p>Spring Data 不仅对传统的数据库访问技术如 JDBC、Hibernate、JDO、TopLick、JPA、MyBatis 做了很好的支持和扩展、抽象、提供方便的操作方法，还对 MongoDb、KeyValue、Redis、LDAP、Cassandra 等非关系数据的 NoSQL 做了不同的实现版本，方便我们开发者触类旁通。</p> <h3 id="spring-data-的子项目"><a href="#spring-data-的子项目" class="header-anchor">#</a> Spring Data 的子项目</h3> <p>下图为目前 Spring Data 的框架分类结构图，里面都有哪些模块可以一目了然，也可以知道哪些是我们需要关心的项目</p> <p><img src="/assets/img/CgqCHl9fA2iAJZruAAEOKPj_-ZU042.2b831632.png" alt="img"></p> <p>主要项目（Main Modules）：</p> <ul><li><strong>Spring Data Commons</strong>，相当于定义了一套<strong>抽象的接口</strong></li> <li>Spring Data JDBC，对JDBC的Spring Data存储库支持</li> <li><strong>Spring Data JPA</strong>，我们关注的重点，对 Spring Data Common 的接口的 JPA 协议的实现</li> <li>Spring Data Gemfire</li> <li>Spring Data KeyValue</li> <li>Spring Data LDAP</li> <li>Spring Data MongoDB，对MongoDB的基于Spring对象文档的存储库支持</li> <li>Spring Data REST</li> <li>Spring Data Redis，封装Jedis技术，对redis实现访问操作</li> <li>Spring Data for Apache Cassandra</li> <li>Spring Data for Apache Solr</li></ul> <p>社区支持的项目（Community Modules）：</p> <ul><li>Spring Data Aerospike</li> <li>Spring Data Couchbase</li> <li>Spring Data DynamoDB</li> <li>Spring Data Elasticsearch，对Elasticsearch实现访问操作（一般不太用，因为版本更新比较慢）</li> <li>Spring Data Hazelcast</li> <li>Spring Data Jest</li> <li>Spring Data Neo4j</li> <li>Spring Data Vault</li></ul> <p>其他（Related Modules）：</p> <ul><li>Spring Data JDBC Extensions</li> <li>Spring for Apache Hadoop</li> <li>Spring Content</li></ul> <p>关于 Spring Data 的子项目，除了上面这些，还有很多开源社区版本，比如 Spring Data、MyBatis 等</p> <h3 id="spring-data-jpa-关系图-🔥"><a href="#spring-data-jpa-关系图-🔥" class="header-anchor">#</a> Spring Data JPA 关系图 🔥</h3> <p>只需在 JPA 规范上面再添加一个 Spring Data JPA 即可</p> <p><img src="/assets/img/image-20201217220824953.47b008b3.png" alt="image-20201217220824953"></p> <h2 id="spring-data-common-之-repository-🔥"><a href="#spring-data-common-之-repository-🔥" class="header-anchor">#</a> Spring Data Common 之 Repository 🔥</h2> <p>Spring Data Common 定义了很多公用的接口和一些相对数据操作的公共实现（如分页排序、结果映射、Autiting 信息、事务等），而 Spring Data JPA 就是 Spring Data Common 的关系数据库的查询实现。本节了解下 Spring Data Common 的核心内容——Repository，从 Repository 的所有子类着手，逐步掌握 CrudRepository、PageingAndSortingRepository、JpaRepository的使用。</p> <h3 id="spring-data-jpa-的依赖关系"><a href="#spring-data-jpa-的依赖关系" class="header-anchor">#</a> Spring Data JPA 的依赖关系</h3> <p>先来看看 Spring Data JPA 所依赖的 jar 包关系是什么样的</p> <p><img src="/assets/img/image-20201219193544969.6c90189a.png" alt="image-20201219193544969"></p> <p>数据库连接用的是 JDBC，连接池用的是 HikariCP（看 starter-jdbc），<strong>强依赖 Hibernate（不能切换实现了JPA的其他框架）</strong>；Spring Boot Starter Data JPA 依赖 Spring Data JPA；而 Spring Data JPA 依赖 Spring Data Commons。Spring Data Commons 是终极依赖。下面学习 DB 操作的入口 Repository及其子类</p> <h3 id="repository-接口、层次关系-🔥"><a href="#repository-接口、层次关系-🔥" class="header-anchor">#</a> Repository 接口、层次关系 🔥</h3> <h4 id="repository-接口"><a href="#repository-接口" class="header-anchor">#</a> Repository 接口</h4> <p>Repository 是 Spring Data Common 里面的顶级父类接口，操作 DB 的入口类。首先介绍 Repository 接口的源码、类层次关系和使用实例。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>repository</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Indexed</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Indexed</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Resposiory 是 Spring Data 里面进行数据库操作顶级的抽象接口，里面什么方法都没有，但是如果任何接口继承它，就能得到一个 Repository，还可以实现 JPA 的一些默认实现方法（<strong>如方法名称规则查询</strong>）。这是 Spring 利用 Respository 作为 DAO 操作的 Type，以及利用 Java 动态代理机制实现的</p> <p>Spring 在做动态代理的时候，只要是它的子类或者实现类，再利用 T 类以及 T 类的 主键 ID 类型作为泛型的类型参数，就可以来标记出来、并捕获到要使用的实体类型，就能帮助使用者进行数据库操作。</p> <h4 id="repository-类层次关系"><a href="#repository-类层次关系" class="header-anchor">#</a> Repository 类层次关系</h4> <p>Type hierarchy 类的层次结构，使用 Ctrl + H（mac）即可看到</p> <p><img src="/assets/img/image-20201219195036228.cca35c48.png" alt="image-20201219195036228"></p> <p>通过该层次结构视图，你就会明白基类 Repository 的用意，由此可知，存储库分为以下 4 个大类。</p> <ul><li>ReactiveCrudRepository 这条线是响应式编程，主要支持当前 NoSQL 方面的操作，因为这方面大部分操作都是分布式的，所以由此我们可以看出 Spring Data 想统一数据操作的“野心”，即想提供关于所有 Data 方面的操作。目前 Reactive 主要有 Cassandra、MongoDB、Redis 的实现。</li> <li>RxJava2/3CrudRepository 这条线是为了支持 RxJava 2/3 做的标准响应式编程的接口。</li> <li>CoroutineCrudRepository 这条继承关系链是为了支持 Kotlin 语法而实现的。</li> <li>CrudRepository 这条继承关系链正是本课时我要详细介绍的 JPA 相关的操作接口，你也可以把我的这种方法应用到另外 3 种继承关系链里面学习。</li></ul> <p>点击 Show Diagram 显示层次结构图，其中 JpaSpecificationExecutor 也是继承了借口后出现的，也是需要学习的！</p> <p><img src="/assets/img/image-20201219195652297.a656d1cb.png" alt="image-20201219195652297"></p> <p>需要掌握和使用到的类如下所示：</p> <p><strong>7 大 Repository 接口：</strong></p> <ul><li>Repository(org.springframework.data.repository)，没有暴露任何方法；</li> <li>CrudRepository(org.springframework.data.repository)，简单的 Curd 方法；</li> <li>PagingAndSortingRepository(org.springframework.data.repository)，带分页和排序的方法；</li> <li>QueryByExampleExecutor(org.springframework.data.repository.query)，简单 Example 查询；</li> <li>JpaRepository(org.springframework.data.jpa.repository)，JPA 的扩展方法；</li> <li>JpaSpecificationExecutor(org.springframework.data.jpa.repository)，JpaSpecification 扩展查询；</li> <li>QueryDslPredicateExecutor(org.springframework.data.querydsl)，QueryDsl 的封装。</li></ul> <p><strong>2 大 Repository 实现类：</strong></p> <ul><li>SimpleJpaRepository(org.springframework.data.jpa.repository.support)，JPA 所有接口的默认实现类；</li> <li>QueryDslJpaRepository(org.springframework.data.jpa.repository.support)，QueryDsl 的实现类。</li></ul> <p>关于其他的类，后面我也会通过不同方式的讲解</p> <h3 id="测试-entity-user"><a href="#测试-entity-user" class="header-anchor">#</a> 测试 Entity—User</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy<span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="repository-接口示例-方法名称规则查询-🔥"><a href="#repository-接口示例-方法名称规则查询-🔥" class="header-anchor">#</a> Repository 接口示例—方法名称规则查询 🔥</h3> <p>利用 UserRepository 继承 Repository 来实现对 User 的两个查询方法（<strong>方法名称规则查询</strong>）</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
	<span class="token comment">//根据名称进行查询用户列表</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 根据用户的邮箱和名称查询</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByEmailAndName</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>由于 Repository 接口里面没有任何方法，所以此 UserRepository 对外只有两个可用方法</p> <h3 id="crudrepository-接口示例-🔥"><a href="#crudrepository-接口示例-🔥" class="header-anchor">#</a> CrudRepository 接口示例 🔥</h3> <p>通过 IDEA 工具，看下 CrudRepository 为我们提供的方法有哪些</p> <p><img src="/assets/img/image-20201219200638254.618f6793.png" alt="image-20201219200638254"></p> <ul><li><p><code>&lt;S extends T&gt; S save(S entity);</code> 保存/更新实体方法</p> <p>Entity 中若 id 为 null，则 persist，否则执行 merge（源码中会进行 id 是否为 null 等判断。<strong>有的说根据id 查询了？乐观锁</strong>）</p> <p>如果当传递的参数里面没有 ID，则直接 insert；若当传递的参数里面有 ID，则会触发 select 查询。此方法会去看一下数据库里面是否存在此记录，若存在，则 update，否则 insert</p> <p>注意更新时实体类中当前为null的字段也会被更新为null，可以配置更改该策略，<strong>DynamicUpdate 策略</strong></p> <p>参数和返回结果可以是实体的子类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">S</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">S</span> entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>entityInformation<span class="token punctuation">.</span><span class="token function">isNew</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        em<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> entity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> em<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p><code>saveAll(Iterable&lt;S&gt; entities)</code> : 批量保存/更新，原理和 save方法相同，我们去看实现的话，就是 for 循环调用上面的 save 方法。</p> <p>那这就很扯淡了，当然可以设置一下<code>spring.jpa.properties.hibernate.jdbc.batch_size=200</code>，就会批量操作了！</p></li> <li><p><code>void deleteById(ID id);</code> 根据主键删除，查看源码会发现，其是先根据主键查询出来再进行删除，<strong>没查询到直接抛异常（需要处理该异常，但是一般删除操作不会产生并发）</strong>；（实际使用时无需手动查询！）</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token class-name">ID</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> ID_MUST_NOT_BE_NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 没查询到直接抛异常</span>
    <span class="token function">delete</span><span class="token punctuation">(</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">EmptyResultDataAccessException</span><span class="token punctuation">(</span>
        <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;No %s entity with id %s exists!&quot;</span><span class="token punctuation">,</span> entityInformation<span class="token punctuation">.</span><span class="token function">getJavaType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p><code>void delete(T entity)</code> 根据 Entity（其实是主键） 进行删除（底层和 deleteById 一样）；</p></li> <li><p><code>void deleteAll(Iterable&lt;? extends T&gt; entities)</code> 批量删除，还是for循环调用 delete(T entity)。</p> <p>那这就很扯淡了，当然可以使用 JpaRepository 的批量删除！</p></li> <li><p><code>void deleteAll()</code> 删除所有；原理可以通过刚才的类关系查看，CrudRepository 的实现方法如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//SimpleJpaRepository里面的deleteALL方法</span>
<span class="token comment">// 利用 for 循环调用 delete 方法进行删除操作</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">T</span> element <span class="token operator">:</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">delete</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p><code>boolean existsById(ID id)</code> 根据主键判断实体是否存在；</p></li> <li><p><code>Optional&lt;T&gt; findById(ID id);</code> 根据主键查询实体，返回 JDK 1.8 的 Optional，这可以避免 null exception；</p></li> <li><p><code>Iterable&lt;T&gt; findAllById(Iterable ids);</code> 根据主键列表查询实体列表；</p></li> <li><p><code>Iterable&lt;T&gt; findAll();</code> 查询实体的所有列表；</p></li> <li><p><code>count()</code>: long 查询总数返回 long 类型；</p></li></ul> <p>上面这些方法是 CrudRepository 对外暴露的常见的 Crud 接口，我们在对数据库进行 Crud 的时候就会运用到，如下所示</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">CrudRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="pagingandsortingrepository-接口示例-🔥"><a href="#pagingandsortingrepository-接口示例-🔥" class="header-anchor">#</a> PagingAndSortingRepository 接口示例 🔥</h3> <p>主要用于分页查询和排序查询。源码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@NoRepositoryBean</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PagingAndSortingRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID<span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">CrudRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
	<span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Sort</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span> （<span class="token number">1</span>）
	<span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span> （<span class="token number">2</span>）
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>第一个方法 findAll 参数是 Sort，是根据排序参数，实现不同的排序规则获取所有的对象的集合</li> <li>🔥 第二个方法 findAll 参数是 Pageable，是根据分页和排序进行查询，并用 Page 对返回结果进行封装。而 Pageable 对象包含 Page 和 Sort 对象</li></ul> <p>使用方式如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">PagingAndSortingRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 验证排序和分页查询方法，Pageable的默认实现类：PageRequest
 * @return
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;/page&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAllUserByPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> userRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>
         <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span><span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Sort<span class="token punctuation">.</span>Order</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span>ASC<span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * 排序查询方法，使用Sort对象
 * @return
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;/sort&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAllUsersWithSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> userRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Sort<span class="token punctuation">.</span>Order</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span>ASC<span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="jparepository-接口示例-🔥"><a href="#jparepository-接口示例-🔥" class="header-anchor">#</a> JpaRepository 接口示例 🔥</h3> <p>到这里可以进入到分水岭了，<strong>上面的那些都是 Spring Data 为了兼容 NoSQL 而进行的一些抽象封装</strong>，而<strong>从 JpaRepository 开始是对关系型数据库进行抽象封装</strong>。从类图可以看出来它继承 PagingAndSortingRepository 类，也就继承了其所有方法，并且其实现类也是 SimpleJpaRepository。从类图上还可以看出 JpaRepository 继承和拥有了 QueryByExampleExecutor 的相关方法，我们先来看一下 JpaRepository 有哪些方法。</p> <p><img src="/assets/img/image-20201219224246112.79919e92.png" alt="image-20201219224246112"></p> <p>涉及 QueryByExample 的部分我们在 11 课时“JpaRepository 如何自定义”再详细介绍，</p> <p>JpaRepository 里面重点新增了<strong>批量删除</strong>，优化了批量删除的性能，类似于之前 SQL 的 batch 操作，并不是像上面的 deleteAll 来 for 循环删除。</p> <p>其中 flush() 和 saveAndFlush() 提供了手动刷新 session，把对象的值立即更新到数据库里面的机制。JPA 是 由 Hibernate 实现的，所以有 session 一级缓存的机制，当调用 save() 方法的时候，数据库里面是不会立即变化的，其原理我将在 21 课时“Persistence Context 所表达的核心概念是什么”再详细讲解</p> <p>使用方式如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="具体实现类-simplejparepository-🔥"><a href="#具体实现类-simplejparepository-🔥" class="header-anchor">#</a> 具体实现类 SimpleJpaRepository 🔥</h3> <p>PagingAndSortingRepository 和 CrudRepository 都是 Spring Data Common 的标准接口，那么实现类是什么呢？如果我们采用 JPA，那对应的实现类就是 Spring Data JPA 的 jar 包里面的 SimpleJpaRepository。如果是其他 NoSQL的 实现如 MongoDB，那实现就在 Spring Data MongoDB 的 jar 里面的 MongoRepositoryImpl。JpaRepository 的实现类也是 SimpleJpaRepository</p> <p>关系数据库的所有 Repository 接口的实现类就是 SimpleJpaRepository，如果有些业务场景需要进行扩展了，可以继续继承此类，如 QueryDsl 的扩展（虽然不推荐使用了，但我们可以参考它的做法，自定义自己的 SimpleJpaRepository），<strong>如果能将此类里面的实现方法看透了，基本上 JPA 中的 API 就能掌握大部分内容</strong>。</p> <p>UserRepository 的实现类是 Spring 启动的时候，利用 Java 动态代理机制帮我们生成的实现类，而真正的实现类就是 SimpleJpaRepository。</p> <p><img src="/assets/img/image-20201219225302748.89813a5e.png" alt="image-20201219225302748"></p> <p><img src="/assets/img/image-20201220000423131.9ffce899.png" alt="image-20201220000423131"></p> <p>它是在什么时候被动态代理生成的？在 RepositoryFactorySupport 设置一个断点，启动的时候，在我们的断点处就会发现 UserRepository 的接口会被 JdkDynamicAopProxy 动态代理成 SimpleJapRepository 的实现类（底层还是 InvocationHandler 的 invoke 方法；非接口的动态代理会使用 Cglib）。注意每一个 Repository 的子类，都会通过这里的动态代理生成实现类</p> <p><img src="/assets/img/image-20201219225948290.a6c009dd.png" alt="image-20201219225948290"></p> <p>部分源码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>readOnly <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleJpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID<span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">JpaSpecificationExecutor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> ID_MUST_NOT_BE_NULL <span class="token operator">=</span> <span class="token string">&quot;The given id must not be null!&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">JpaEntityInformation</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> entityInformation<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">EntityManager</span> em<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">PersistenceProvider</span> provider<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">CrudMethodMetadata</span> metadata<span class="token punctuation">;</span>

    <span class="token comment">// ......</span>
  
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteAllInBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        em<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token function">getDeleteAllQueryString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//......</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>通过此类的源码，我们可以挺清晰地看出 SimpleJpaRepository 的实现机制，是<strong>通过 EntityManger 进行实体的操作（就是和JPA一样）</strong>，而 JpaEntityInforMation 里面存在实体的相关信息和 Crud 方法的元数据等。</p> <h3 id="启发-🔥"><a href="#启发-🔥" class="header-anchor">#</a> 启发 🔥</h3> <ul><li>上面的 7 个大 Repository 接口，在使用的时候可以根据实际场景<strong>继承不同的接口</strong>，从而选择暴露不同的 Spring Data Common 给我们提供的已有接口。这其实利用了 Java 语言的 interface 特性。</li> <li>利用源码也可以很好地理解一下 Spring 中<strong>动态代理</strong>的作用，可以利用这种思想，在改善 MyBatis 的时候使用。</li></ul> <h2 id="entity-中的-jpa-注解-🔥"><a href="#entity-中的-jpa-注解-🔥" class="header-anchor">#</a> @Entity 中的 JPA 注解 🔥</h2> <h3 id="entity-实体是什么？"><a href="#entity-实体是什么？" class="header-anchor">#</a> Entity 实体是什么？</h3> <ul><li>实体是直接进行数据库持久化操作的领域对象（即一个简单的 POJO，可以按照业务领域划分），必须通过 @Entity 注解进行标示。</li> <li>实体必须有一个 public 或者 protected 的无参数构造方法。</li> <li>持久化映射的注解可以标示在 Entity 的字段 field 上，也可以将持久化注解运用在 Entity 里面的 get/set 方法上，通常我们是放在 get 方法中。即 Entity 里面的注解生效只有两种方式：将注解写在字段上或者将注解写在方法上（JPA 里面称 Property）。但是<strong>需要注意的是，在同一个 Entity 里面只能有一种方式生效</strong>，也就是说，注解要么全部写在 field 上面，要么就全部写在 Property 上面</li> <li>只要是在 @Entity 的实体里面被注解标注的字段，都会被映射到数据库中，除了使用 <strong>@Transient</strong> 注解的字段之外。</li> <li>实体里面<strong>必须要有一个主键</strong>，主键标示的字段可以是单个字段，也可以是复合主键字段。</li></ul> <p>JPA 协议的官方地址：https://download.oracle.com/otn-pub/jcp/persistence-2_2-mrel-spec/JavaPersistence.pdf</p> <h3 id="详细的注解都有哪些？"><a href="#详细的注解都有哪些？" class="header-anchor">#</a> 详细的注解都有哪些？</h3> <p>利用 IEDA 工具，打开 @Entity 所在的包，就可以看到 JPA 里面支持的注解有哪些。如下所示；</p> <p><img src="/assets/img/Ciqc1F9rLPSAFNw1AAQfaEA3Bgo587.d8e39e6f.png" alt="img"></p> <p>这里只提及一些最常见的，包括 @Entity、@Table、@Access、@Id、@GeneratedValue、@Enumerated、@Basic、@Column、@Transient、@Lob、@Temporal 等。</p> <h3 id="entity"><a href="#entity" class="header-anchor">#</a> @Entity</h3> <p>用于定义对象将会成为被 JPA 管理的实体，必填，将字段映射到指定的数据库表中，使用起来很简单，直接用在实体类上面即可，通过源码表达的语法如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>TYPE<span class="token punctuation">)</span> <span class="token comment">//表示此注解只能用在class上面</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Entity</span> <span class="token punctuation">{</span>
   <span class="token comment">//可选，默认是实体类的名字，整个应用里面全局唯一。</span>
   <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="table"><a href="#table" class="header-anchor">#</a> @Table</h3> <p>用于指定数据库的表名，表示此实体对应的数据库里面的表名，非必填，默认表名和 entity 名字一样。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>TYPE<span class="token punctuation">)</span> <span class="token comment">//一样只能用在类上面</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Table</span> <span class="token punctuation">{</span>
   <span class="token comment">//表的名字，可选。如果不填写，系统认为好实体的名字一样为表名。</span>
   <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
   <span class="token comment">//此表所在schema，可选</span>
   <span class="token class-name">String</span> <span class="token function">schema</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
   <span class="token comment">//唯一性约束，在创建表的时候有用，表创建之后后面就不需要了。</span>
   <span class="token class-name">UniqueConstraint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">uniqueConstraints</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token comment">//索引，在创建表的时候使用，表创建之后后面就不需要了。</span>
   <span class="token class-name">Index</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">indexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="access"><a href="#access" class="header-anchor">#</a> @Access</h3> <p>用于指定 entity 里面的注解是写在字段上面，还是 get/set 方法上面生效，非必填。在默认不填写的情况下，当实体里面的第一个注解出现在字段上或者 get/set 方法上面，就以第一次出现的方式为准；也就是说，一个实体里面的注解既有用在 field 上面，又有用在 properties 上面的时候，看下面的代码你就会明白。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Id</span>
<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>length <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> userName<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>那么由于 @Id 是实体里面第一个出现的注解，并且作用在字段上面，所以所有写在 get/set 方法上面的注解就会失效。而 @Access 可以干预默认值，指定是在 fileds 上面生效还是在 properties 上面生效。我们通过源码看下语法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> TYPE<span class="token punctuation">,</span> METHOD<span class="token punctuation">,</span> FIELD <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//表示此注解可以运用在class上(那么这个时候就可以指定此实体的默认注解生效策略了)，也可以用在方法上或者字段上(表示可以独立设置某一个字段或者方法的生效策略)；</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RUNTIME<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Access</span> <span class="token punctuation">{</span>
<span class="token comment">//指定是字段上面生效还是方法上面生效</span>
    <span class="token class-name">AccessType</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">AccessType</span> <span class="token punctuation">{</span>
    FIELD<span class="token punctuation">,</span>
    PROPERTY
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="id"><a href="#id" class="header-anchor">#</a> @Id</h3> <p>定义属性为数据库的主键，一个实体里面必须有一个主键，但不一定是这个注解，可以和 @GeneratedValue 配合使用或成对出现。</p> <h3 id="generatedvalue"><a href="#generatedvalue" class="header-anchor">#</a> @GeneratedValue</h3> <p>主键生成策略，如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">GeneratedValue</span> <span class="token punctuation">{</span>
    <span class="token comment">//Id的生成策略</span>
    <span class="token class-name">GenerationType</span> <span class="token function">strategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> AUTO<span class="token punctuation">;</span>
    <span class="token comment">//通过Sequences生成Id,常见的是Orcale数据库ID生成规则，这个时候需要配合@SequenceGenerator使用</span>
    <span class="token class-name">String</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>其中，GenerationType 一共有以下四个值：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">GenerationType</span> <span class="token punctuation">{</span>
    <span class="token comment">//通过表产生主键，框架借由表模拟序列产生主键，使用该策略可以使应用更易于数据库移植。</span>
    TABLE<span class="token punctuation">,</span>
    <span class="token comment">//通过序列产生主键，通过 @SequenceGenerator 注解指定序列名， MySql 不支持这种方式；</span>
    SEQUENCE<span class="token punctuation">,</span>
    <span class="token comment">//采用数据库ID自增长， 一般用于mysql数据库</span>
    IDENTITY<span class="token punctuation">,</span>
<span class="token comment">//JPA 自动选择合适的策略，是默认选项；</span>
    AUTO
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="enumerated（没啥用）"><a href="#enumerated（没啥用）" class="header-anchor">#</a> @Enumerated（没啥用）</h3> <p>这个注解很不好用，因为它对 enum 提供了下标和 name 两种方式，用法直接映射在 enum 枚举类型的字段上。请看下面源码。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span>METHOD<span class="token punctuation">,</span> FIELD<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//作用在方法和字段上</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Enumerated</span> <span class="token punctuation">{</span>
<span class="token comment">//枚举映射的类型，默认是ORDINAL（即枚举字段的下标）。</span>
    <span class="token class-name">EnumType</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> ORDINAL<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">EnumType</span> <span class="token punctuation">{</span>
    <span class="token comment">//映射枚举字段的下标</span>
    ORDINAL<span class="token punctuation">,</span>
    <span class="token comment">//映射枚举的Name</span>
    STRING
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>再来看一个 User 里面关于性别枚举的例子，你就会知道 @Enumerated 在这里<strong>没什么作用了</strong>，如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//有一个枚举类，用户的性别</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Gender</span> <span class="token punctuation">{</span>
    <span class="token function">MAIL</span><span class="token punctuation">(</span><span class="token string">&quot;男性&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">FMAIL</span><span class="token punctuation">(</span><span class="token string">&quot;女性&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> value<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Gender</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//实体类@Enumerated的写法如下</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;tb_user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Enumerated</span><span class="token punctuation">(</span><span class="token class-name">EnumType</span><span class="token punctuation">.</span>STRING<span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user_gender&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Gender</span> gender<span class="token punctuation">;</span>
    <span class="token comment">//.......................</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>这时候插入两条数据，数据库里面的值会变成 MAIL/FMAIL，而不是“男性” / 女性。</p> <p><strong>经验分享：</strong> 如果我们用 @Enumerated（EnumType.ORDINAL），这时候数据库里面的值是 0、1。但是实际工作中，不建议用数字下标，因为枚举里面的属性值是会不断新增的，如果新增一个，位置变化了就惨了。并且 0、1、2 这种下标在数据库里面看着非常痛苦，时间长了就会一点也看不懂了。</p> <h3 id="basic"><a href="#basic" class="header-anchor">#</a> @Basic</h3> <p>表示属性是到数据库表的字段的映射。如果实体的字段上没有任何注解，默认即为 @Basic。也就是说默认所有的字段肯定是和数据库进行映射的，并且默认为 Eager 类型。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Basic</span> <span class="token punctuation">{</span>
    <span class="token comment">//可选，EAGER（默认）：立即加载；LAZY：延迟加载。（LAZY主要应用在大字段上面）</span>
    <span class="token class-name">FetchType</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> EAGER<span class="token punctuation">;</span>
    <span class="token comment">//可选。这个字段是否可以为null，默认是true。</span>
    <span class="token keyword">boolean</span> <span class="token function">optional</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="transient"><a href="#transient" class="header-anchor">#</a> @Transient</h3> <p>表示该属性并非一个到数据库表的字段的映射，表示非持久化属性。JPA 映射数据库的时候忽略它，与 @Basic 有相反的作用。也就是每个字段上面 @Transient 和 @Basic 必须二选一，而什么都不指定的话，默认是 @Basic。</p> <h3 id="column"><a href="#column" class="header-anchor">#</a> @Column</h3> <p>定义该属性对应数据库中的列名。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Column</span> <span class="token punctuation">{</span>
    <span class="token comment">//数据库中的表的列名；可选，如果不填写认为字段名和实体属性名一样。</span>
    <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//是否唯一。默认flase，可选。</span>
    <span class="token keyword">boolean</span> <span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">//数据字段是否允许空。可选，默认true。</span>
    <span class="token keyword">boolean</span> <span class="token function">nullable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">//执行insert操作的时候是否包含此字段，默认，true，可选。</span>
    <span class="token keyword">boolean</span> <span class="token function">insertable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">//执行update的时候是否包含此字段，默认，true，可选。</span>
    <span class="token keyword">boolean</span> <span class="token function">updatable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">//表示该字段在数据库中的实际类型。</span>
    <span class="token class-name">String</span> <span class="token function">columnDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
   <span class="token comment">//数据库字段的长度，可选，默认255</span>
    <span class="token keyword">int</span> <span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">255</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="temporal"><a href="#temporal" class="header-anchor">#</a> @Temporal</h3> <p>用来设置 Date 类型的属性映射到对应精度的字段，存在以下三种情况：</p> <ul><li>@Temporal(TemporalType.DATE)映射为日期 // date （<strong>只有日期</strong>）</li> <li>@Temporal(TemporalType.TIME)映射为日期 // time （<strong>只有时间</strong>）</li> <li>@Temporal(TemporalType.TIMESTAMP)映射为日期 // date time （<strong>日期+时间</strong>）</li></ul> <h3 id="完整的例子"><a href="#完整的例子" class="header-anchor">#</a> 完整的例子</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user_topic&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Access</span><span class="token punctuation">(</span><span class="token class-name">AccessType</span><span class="token punctuation">.</span>FIELD<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserTopic</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Id</span>
   <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
   <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Basic</span>
   <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;create_user_id&quot;</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">Integer</span> createUserId<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Basic</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">)</span>
   <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;content&quot;</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
   <span class="token annotation punctuation">@Lob</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Basic</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">)</span>
   <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;image&quot;</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
   <span class="token annotation punctuation">@Lob</span>
   <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> image<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Basic</span>
   <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;create_time&quot;</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
   <span class="token annotation punctuation">@Temporal</span><span class="token punctuation">(</span><span class="token class-name">TemporalType</span><span class="token punctuation">.</span>TIMESTAMP<span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Basic</span>
   <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;create_date&quot;</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
   <span class="token annotation punctuation">@Temporal</span><span class="token punctuation">(</span><span class="token class-name">TemporalType</span><span class="token punctuation">.</span>DATE<span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">Date</span> createDate<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Enumerated</span><span class="token punctuation">(</span><span class="token class-name">EnumType</span><span class="token punctuation">.</span>STRING<span class="token punctuation">)</span>
   <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;topic_type&quot;</span><span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">Type</span> type<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Transient</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> transientSimple<span class="token punctuation">;</span>
   <span class="token comment">//非数据库映射字段，业务类型的字段</span>
   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getTransientSimple</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> title <span class="token operator">+</span> <span class="token string">&quot;auto:jack&quot;</span> <span class="token operator">+</span> type<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token comment">//有一个枚举类，主题的类型</span>
   <span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Type</span> <span class="token punctuation">{</span>
      <span class="token function">EN</span><span class="token punctuation">(</span><span class="token string">&quot;英文&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">CN</span><span class="token punctuation">(</span><span class="token string">&quot;中文&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> des<span class="token punctuation">;</span>
      <span class="token class-name">Type</span><span class="token punctuation">(</span><span class="token class-name">String</span> des<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>des <span class="token operator">=</span> des<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>其实这里面的很多注解都可以省略，直接使用默认的就可以。如 @Basic、@Column 名字有一定的映射策略（我们在第 17 课时讲 DataSource 的时候会详细讲解映射策略），所以可以省略。此外，@Access 也可以省略，我们只要在这些类里面保持一致就可以了。学会<strong>利用工具去生成 Entity 类</strong>，将会节省很多时间。</p> <p>首先，<strong>打开 Persistence 视图，点击 Generate Persistence Mapping</strong>，接着<strong>点击选中数据源</strong>，然后，<strong>选择表和字段，并点击 OK</strong>。</p> <p>但是需要注意的是，在生产环境中我们要把外键关联关系关闭，不然会出现意想不到的 ERROR，毕竟生产环境不同开发环境，我们可以通过在开发环境生成的表导出 DDL 到生产执行。我经常会利用生成 DDL 来做测试和写案例， 这样省去了创建表的时间，只需要关注我的代码就行了。</p> <h2 id="联合主键"><a href="#联合主键" class="header-anchor">#</a> 联合主键</h2> <p>可以通过 javax.persistence.EmbeddedId 和 javax.persistence.IdClass 两个注解实现联合主键的效果。</p> <h3 id="通过-id-和-idclass-做到联合主键"><a href="#通过-id-和-idclass-做到联合主键" class="header-anchor">#</a> 通过@Id 和 @IdClass 做到联合主键</h3> <p>我们先看一下怎么通过 @IdClass 做到联合主键。</p> <p>第一步：新建一个 UserInfoID 类里面是联合主键。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfoID</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span>telephone<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>第二步：再新建一个 UserInfo 的实体，采用 @IdClass 引用联合主键类。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@IdClass</span><span class="token punctuation">(</span><span class="token class-name">UserInfoID</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfo</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token class-name">Integer</span> ages<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Id</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Id</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> telephone<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>第三步：新增一个 UserInfoReposito 类来做 CRUD 操作。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserInfoRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">,</span><span class="token class-name">UserInfoID</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>第四步：写一个测试用例，测试一下。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DataJpaTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfoRepositoryTest</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Autowired</span>
   <span class="token keyword">private</span> <span class="token class-name">UserInfoRepository</span> userInfoRepository<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Test</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testIdClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   userInfoRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">UserInfo</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ages</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">telephone</span><span class="token punctuation">(</span><span class="token string">&quot;123456789&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> userInfo <span class="token operator">=</span> userInfoRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">UserInfoID</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">telephone</span><span class="token punctuation">(</span><span class="token string">&quot;123456789&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>Hibernate: create table user_info (name varchar(255) not null, telephone varchar(255) not null, ages integer, primary key (name, telephone))
Hibernate: select userinfo0_.name as name1_3_0_, userinfo0_.telephone as telephon2_3_0_, userinfo0_.ages as ages3_3_0_ from user_info userinfo0_ where userinfo0_.name=? and userinfo0_.telephone=?
UserInfo(ages=1, name=jack, telephone=123456789)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>通过上面的例子我们可以发现，我们的表的主键是 primary key (name, telephone)，而 Entity 里面不再是一个 @Id 字段了。那么我来介绍另外一个注解 @Embeddable，也能做到这一点。</p> <h3 id="embeddable-与-embeddedid-注解使用"><a href="#embeddable-与-embeddedid-注解使用" class="header-anchor">#</a> @Embeddable 与 @EmbeddedId 注解使用</h3> <p>第一步：在我们上面例子中的 UserInfoID 里面添加 @Embeddable 注解。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@Embeddable</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfoID</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span>telephone<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>第二步：改一下我们刚才的 User 对象，删除 @IdClass，添加 @EmbeddedId 注解，如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfo</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token class-name">Integer</span> ages<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@EmbeddedId</span>
   <span class="token keyword">private</span> <span class="token class-name">UserInfoID</span> userInfoID<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>unique <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> uniqueNumber<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>第三步：UserInfoRepository 不变，我们直接修改一下测试用例。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testIdClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  userInfoRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">UserInfo</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ages</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">userInfoID</span><span class="token punctuation">(</span><span class="token class-name">UserInfoID</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">telephone</span><span class="token punctuation">(</span><span class="token string">&quot;123456789&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> userInfo <span class="token operator">=</span> userInfoRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">UserInfoID</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">telephone</span><span class="token punctuation">(</span><span class="token string">&quot;123456789&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>运行完之后，你可以得到相同的结果。那么 @IdClass 和 @EmbeddedId 的区别是什么？有以下两个方面：</p> <ol><li><p>如上面测试用例，在使用的时候，Embedded 用的是对象，而 IdClass 用的是具体的某一个字段；</p></li> <li><p>二者的JPQL 也会不一样：</p> <p>用 @IdClass JPQL 的写法：SELECT u.name FROM UserInfo u</p> <p>用 @EmbeddedId 的 JPQL 的写法：select u.userInfoId.name FROM UserInfo u</p></li></ol> <p>联合主键还有需要注意的就是，它与唯一性索引约束的区别是写法不同，如上面所讲，唯一性索引的写法如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>unique <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> uniqueNumber<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>到这里，联合主键我们讲完了，那么在遇到联合主键的时候，利用 @IdClass、@EmbeddedId，你就可以应对联合主键了。</p> <p>此外，Java 是面向对象的，肯定会用到多态的使用场景，那么场景都有哪些？公共父类又该如何写？我们来学习一下。</p> <h2 id="实体之间的继承关系如何实现？🔥"><a href="#实体之间的继承关系如何实现？🔥" class="header-anchor">#</a> 实体之间的继承关系如何实现？🔥</h2> <p>在 Java 面向对象的语言环境中，@Entity 之间的关系多种多样，而根据 JPA 的规范，我们大致可以将其分为以下几种：</p> <ol><li>纯粹的继承，和表没关系，<strong>对象之间的字段共享</strong>。利用注解 <strong>@MappedSuperclass</strong>，<strong>协议规定父类不能是 @Entity</strong>。</li> <li>单表多态问题，同一张 Table，表示了不同的对象，通过一个字段来进行区分。利用<code>@Inheritance(strategy = InheritanceType.SINGLE_TABLE)</code>注解完成，只有父类有 @Table。</li> <li>多表多态，每一个子类一张表，父类的表拥有所有公用字段。通过<code>@Inheritance(strategy = InheritanceType.JOINED)</code>注解完成，父类和子类都是表，有公用的字段在父表里面。</li> <li>Object 的继承，数据库里面每一张表是分开的，相互独立不受影响。通过<code>@Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)</code>注解完成，父类（可以是一张表，也可以不是）和子类都是表，相互之间没有关系。</li></ol> <h4 id="mappedsuperclass-🔥"><a href="#mappedsuperclass-🔥" class="header-anchor">#</a> @MappedSuperclass 🔥</h4> <p>其中，第一种 @MappedSuperclass，我们暂时不多介绍，在第 12 课时讲解“JPA 的审计功能”时，再做详细介绍，我们先看一下第二种<code>SINGLE_TABLE</code>。</p> <h4 id="inheritance-strategy-inheritancetype-single-table"><a href="#inheritance-strategy-inheritancetype-single-table" class="header-anchor">#</a> @Inheritance(strategy = InheritanceType.SINGLE_TABLE)</h4> <p>父类实体对象与各个子实体对象共用一张表，通过一个字段的不同值代表不同的对象，我们看一个例子。</p> <p>我们抽象一个 Book 对象，如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;book&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Inheritance</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">InheritanceType</span><span class="token punctuation">.</span>SINGLE_TABLE<span class="token punctuation">)</span>
<span class="token annotation punctuation">@DiscriminatorColumn</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;color&quot;</span><span class="token punctuation">,</span> discriminatorType <span class="token operator">=</span> <span class="token class-name">DiscriminatorType</span><span class="token punctuation">.</span>STRING<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Id</span>
   <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy<span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>再新建一个 BlueBook 对象，作为 Book 的子对象。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@EqualsAndHashCode</span><span class="token punctuation">(</span>callSuper<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DiscriminatorValue</span><span class="token punctuation">(</span><span class="token string">&quot;blue&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlueBook</span> <span class="token keyword">extends</span> <span class="token class-name">Book</span><span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> blueMark<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>再新建一个 RedBook 对象，作为 Book 的另一子对象。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//红皮书</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@DiscriminatorValue</span><span class="token punctuation">(</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@EqualsAndHashCode</span><span class="token punctuation">(</span>callSuper<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedBook</span> <span class="token keyword">extends</span> <span class="token class-name">Book</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> redMark<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这时，我们一共新建了三个 Entity 对象，其实都是指 book 这一张表，通过 book 表里面的 color 字段来区分红书还是绿书。我们继续做一下测试看看结果。</p> <p>我们再新建一个 RedBookRepositor 类，操作一下 RedBook 会看到如下结果：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RedBookRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RedBook</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后再新建一个测试用例。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DataJpaTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedBookRepositoryTest</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Autowired</span>
   <span class="token keyword">private</span> <span class="token class-name">RedBookRepository</span> redBookRepository<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Test</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testRedBook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">RedBook</span> redBook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedBook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      redBook<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">&quot;redbook&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      redBook<span class="token punctuation">.</span><span class="token function">setRedMark</span><span class="token punctuation">(</span><span class="token string">&quot;redmark&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      redBook<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      redBookRepository<span class="token punctuation">.</span><span class="token function">saveAndFlush</span><span class="token punctuation">(</span>redBook<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">RedBook</span> r <span class="token operator">=</span> redBookRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;:&quot;</span><span class="token operator">+</span>r<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;:&quot;</span><span class="token operator">+</span>r<span class="token punctuation">.</span><span class="token function">getRedMark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>最后看一下执行结果。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Hibernate: create table book (color varchar(31) not null, id bigint not null, title varchar(255), blue_mark varchar(255), red_mark varchar(255), primary key (id))
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>你会发现，我们只创建了一张表，insert 了一条数据，但是我们发现 color 字段默认给的是 red。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Hibernate: insert into book (title, red_mark, color, id) values (?, ?, 'red', ?)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>那么再看一下打印结果。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1:redbook:redmark
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>结果完全和预期的一样，这说明了 RedBook、BlueBook、Book，都是一张表，通过字段 color 的值不一样，来区分不同的实体。
那么接下来我们看一下 InheritanceType.JOINED，它的每个实体都是独立的表。</p> <h4 id="inheritance-strategy-inheritancetype-joined"><a href="#inheritance-strategy-inheritancetype-joined" class="header-anchor">#</a> @Inheritance(strategy = InheritanceType.JOINED)</h4> <p>在这种映射策略里面，继承结构中的每一个实体（entity）类都会映射到数据库里一个单独的表中。也就是说，每个实体（entity）都会被映射到数据库中，一个实体（entity）类对应数据库中的一个表。</p> <p>其中根实体（root entity）对应的表中定义了主键（primary key），所有的子类对应的数据库表都要共同使用 Book 里面的 @ID 这个主键。</p> <p>首先，我们改一下上面的三个实体，测试一下InheritanceType.JOINED，改动如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;book&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Inheritance</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">InheritanceType</span><span class="token punctuation">.</span>JOINED<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Id</span>
   <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy<span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>其次，我们 Book 父类、改变 Inheritance 策略、删除 DiscriminatorColumn，你会看到如下结果。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@EqualsAndHashCode</span><span class="token punctuation">(</span>callSuper<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PrimaryKeyJoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;book_id&quot;</span><span class="token punctuation">,</span> referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlueBook</span> <span class="token keyword">extends</span> <span class="token class-name">Book</span><span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> blueMark<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@PrimaryKeyJoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;book_id&quot;</span><span class="token punctuation">,</span> referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@EqualsAndHashCode</span><span class="token punctuation">(</span>callSuper<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedBook</span> <span class="token keyword">extends</span> <span class="token class-name">Book</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> redMark<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>然后，BlueBook和RedBook也删除DiscriminatorColumn，新增@PrimaryKeyJoinColumn(name = &quot;book_id&quot;, referencedColumnName = &quot;id&quot;)，和 book 父类共用一个主键值，而 RedBookRepository 和测试用例不变，我们执行看一下结果。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Hibernate: create table blue_book (blue_mark varchar(255), book_id bigint not null, primary key (book_id))
Hibernate: create table book (id bigint not null, title varchar(255), primary key (id))
Hibernate: create table red_book (red_mark varchar(255), book_id bigint not null, primary key (book_id))
Hibernate: alter table blue_book add constraint FK9uuwgq7a924vtnys1rgiyrlk7 foreign key (book_id) references book
Hibernate: alter table red_book add constraint FKk8rvl61bjy9lgsr9nhxn5soq5 foreign key (book_id) references book
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>上述代码可以看到，我们一共创建了三张表，并且新增了两个外键约束；而我们 save 的时候也生成了两个 insert 语句，如下：</p> <div class="language-j line-numbers-mode"><pre class="language-j"><code>Hibernate<span class="token conjunction variable">:</span> insert into book <span class="token punctuation">(</span>title<span class="token verb keyword">,</span> id<span class="token punctuation">)</span> values <span class="token punctuation">(</span><span class="token verb keyword">?</span><span class="token verb keyword">,</span> <span class="token verb keyword">?</span><span class="token punctuation">)</span>
Hibernate<span class="token conjunction variable">:</span> insert into red_book <span class="token punctuation">(</span>red_mark<span class="token verb keyword">,</span> book_id<span class="token punctuation">)</span> values <span class="token punctuation">(</span><span class="token verb keyword">?</span><span class="token verb keyword">,</span> <span class="token verb keyword">?</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>而打印结果依然不变。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1:redbook:redmark
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这就是 InheritanceType.JOINED 的例子，这个方法和上面的 InheritanceType.SINGLE_TABLE 区别在于表的数量和关系不一样，这是表设计的另一种方式。</p> <h4 id="inheritance-strategy-inheritancetype-table-per-class-🔥"><a href="#inheritance-strategy-inheritancetype-table-per-class-🔥" class="header-anchor">#</a> @Inheritance(strategy = InheritanceType.TABLE_PER_CLASS) 🔥</h4> <p>我们在使用 @MappedSuperClass 主键的时候，如果不指定 @Inhertance，默认就是此种TABLE_PER_CLASS模式。当然了，我们也显示指定，要求继承基类的都是一张表，而父类不是表，是 java 对象的抽象类。我们看一个例子。</p> <p>首先，还是改一下上面的三个实体。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;book&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Inheritance</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">InheritanceType</span><span class="token punctuation">.</span>TABLE_PER_CLASS<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Id</span>
   <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy<span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>其次，Book 表采用 TABLE_PER_CLASS 策略，其子实体类都代表各自的表，实体代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@EqualsAndHashCode</span><span class="token punctuation">(</span>callSuper<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedBook</span> <span class="token keyword">extends</span> <span class="token class-name">Book</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> redMark<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@EqualsAndHashCode</span><span class="token punctuation">(</span>callSuper<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlueBook</span> <span class="token keyword">extends</span> <span class="token class-name">Book</span><span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> blueMark<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>这时，从 RedBook 和 BlueBook 里面去掉 PrimaryKeyJoinColumn，而 RedBookRepository 和测试用例不变，我们执行看一下结果。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Hibernate: create table blue_book (id bigint not null, title varchar(255), blue_mark varchar(255), primary key (id))
Hibernate: create table book (id bigint not null, title varchar(255), primary key (id))
Hibernate: create table red_book (id bigint not null, title varchar(255), red_mark varchar(255), primary key (id))
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这里可以看到，我们还是创建了三张表，但三张表什么关系也没有。而 insert 语句也只有一条，如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Hibernate: insert into red_book (title, red_mark, id) values (?, ?, ?)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>打印结果还是不变。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1:redbook:redmark
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这个方法与上面两个相比较，语义更加清晰，是比较常用的一种做法。
以上就是实体之间继承关系的实现方法，可以在涉及 java 多态的时候加以应用，不过要注意区分三种方式所表达的表的意思，再加以运用。</p> <h4 id="关于继承关系的经验之谈-inheritance-被淘汰-🔥"><a href="#关于继承关系的经验之谈-inheritance-被淘汰-🔥" class="header-anchor">#</a> 关于继承关系的经验之谈—@Inheritance 被淘汰 🔥</h4> <p>从我的个人经验来看，@Inheritance 的这种使用方式会逐渐被淘汰，因为这样的表的设计很复杂，本应该在业务层面做的事情（多态），而在 datasoure 的表级别做了。所以在 JPA 中使用这个的时候你就会想：“这么复杂的东西，我直接用 Mybatis 算了。”我想告诉你，其实它们是一样的，只是我们使用的思路不对。</p> <p>那么为什么行业内都不建议使用了，还要介绍这么详细呢？因为，如果你遇到的是老一点的项目，如果不是用 Java 语言写的，不一定有面向对象的思想。这个时候如果让你迁移成 Java 怎么办？如果你可以想到这种用法，就不至于束手无措。</p> <p>此外，在互联网项目中，一旦有关表的业务对象过多了之后，就可以拆表拆库了，这个时候我们要想到我们的@Table 注解指定表名和 schema。</p> <p>关于上面提到的方法中，最常用的是第一种 @MappedSuperclass，这个我们将在第 12 课时“JPA 的审计功能解决了哪些问题？”中详细介绍，到时候你可以体验一下它的不同之处。</p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>Entity 里面常用的基本注解我们就介绍到这里，因为注解太多没办法一一介绍，你可以掌握一下学习方法。先通过源码把大致注解看一下，有哪些不熟悉的可以看看源码里面的注释，再阅读 JPA 官方协议，还可以写一个测试用例试，跑一下看看 sql 输出和日志，这样很快就可以知道结果了。</p> <h2 id="附-spring-mvc-测试"><a href="#附-spring-mvc-测试" class="header-anchor">#</a> 附. Spring MVC 测试</h2> <p>在 /src/test/resources 中创建 JpaApplication.http 文件</p> <div class="language-h line-numbers-mode"><pre class="language-text"><code>### 新增（注意请求空行！）
POST /api/v1/user HTTP/1.1
Host: 127.0.0.1:10000
Content-Type: application/json
Cache-Control: no-cache

{&quot;name&quot;:&quot;jack&quot;,&quot;email&quot;:&quot;123@126.com&quot;}


### 查询（我也不直到为啥这个必须加 ip + port
GET http://127.0.0.1:10000/api/v1/users?size=3&amp;page=0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="未整理-🔥"><a href="#未整理-🔥" class="header-anchor">#</a> 未整理 🔥</h2> <ul><li>save对null，DynamicUpdate</li> <li>控制台怎么打印出的binding parameter：logging.level.org.hibernate.type.descriptor.sql=TRACE</li></ul></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/master/docs/200.Java Web/600.SpringDataJPA/402.总览入门.md" target="_blank" rel="noopener noreferrer">编辑</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/06/21, 15:45:42</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/9e29b0/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">JPA基础</div></a> <a href="/pages/a40e65/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">基础操作</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/9e29b0/" class="prev">JPA基础</a></span> <span class="next"><a href="/pages/a40e65/">基础操作</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/7fcc72/"><div>线程生命周期</div></a> <span>07-06</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/a4ef99/"><div>线程安全理论</div></a> <span>06-24</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/890a0b/"><div>并发简史</div></a> <span>06-24</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:894072666@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/xugaoyi" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2021
    <span>Evan Xu | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">×</i> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.ac5e3ef4.js" defer></script><script src="/assets/js/2.d960b235.js" defer></script><script src="/assets/js/8.b5f907d4.js" defer></script>
  </body>
</html>