<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Shiro | conanan&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="web前端技术博客,简洁至上,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.03260d1f.css" as="style"><link rel="preload" href="/assets/js/app.ac5e3ef4.js" as="script"><link rel="preload" href="/assets/js/2.d960b235.js" as="script"><link rel="preload" href="/assets/js/32.d5a38545.js" as="script"><link rel="prefetch" href="/assets/js/10.949143aa.js"><link rel="prefetch" href="/assets/js/100.122fb3a2.js"><link rel="prefetch" href="/assets/js/101.88060c8d.js"><link rel="prefetch" href="/assets/js/102.06832b28.js"><link rel="prefetch" href="/assets/js/103.a0c17aef.js"><link rel="prefetch" href="/assets/js/104.b38ef641.js"><link rel="prefetch" href="/assets/js/105.603033e4.js"><link rel="prefetch" href="/assets/js/106.6b288074.js"><link rel="prefetch" href="/assets/js/107.1ffec4c0.js"><link rel="prefetch" href="/assets/js/108.c7b79afa.js"><link rel="prefetch" href="/assets/js/109.dda9fbee.js"><link rel="prefetch" href="/assets/js/11.326a1f58.js"><link rel="prefetch" href="/assets/js/110.920cbe6e.js"><link rel="prefetch" href="/assets/js/111.45bfe7f2.js"><link rel="prefetch" href="/assets/js/112.1f11c570.js"><link rel="prefetch" href="/assets/js/113.fab1cc04.js"><link rel="prefetch" href="/assets/js/114.21ea4ed6.js"><link rel="prefetch" href="/assets/js/115.96f65264.js"><link rel="prefetch" href="/assets/js/116.b324c49b.js"><link rel="prefetch" href="/assets/js/117.dc4d308c.js"><link rel="prefetch" href="/assets/js/118.8f152d6d.js"><link rel="prefetch" href="/assets/js/119.ede5fffc.js"><link rel="prefetch" href="/assets/js/12.23122444.js"><link rel="prefetch" href="/assets/js/120.044161d7.js"><link rel="prefetch" href="/assets/js/121.453c745a.js"><link rel="prefetch" href="/assets/js/122.e3b088eb.js"><link rel="prefetch" href="/assets/js/123.d5a90d16.js"><link rel="prefetch" href="/assets/js/124.7731d89c.js"><link rel="prefetch" href="/assets/js/125.e64126c4.js"><link rel="prefetch" href="/assets/js/126.e46361b1.js"><link rel="prefetch" href="/assets/js/127.067ae046.js"><link rel="prefetch" href="/assets/js/128.59df2a2f.js"><link rel="prefetch" href="/assets/js/129.a2b82230.js"><link rel="prefetch" href="/assets/js/13.6780e0cd.js"><link rel="prefetch" href="/assets/js/130.c20833b9.js"><link rel="prefetch" href="/assets/js/131.da020742.js"><link rel="prefetch" href="/assets/js/132.e20ac455.js"><link rel="prefetch" href="/assets/js/133.f114b097.js"><link rel="prefetch" href="/assets/js/134.49de9e80.js"><link rel="prefetch" href="/assets/js/135.1a24633f.js"><link rel="prefetch" href="/assets/js/136.d5853212.js"><link rel="prefetch" href="/assets/js/137.3a1020dd.js"><link rel="prefetch" href="/assets/js/138.f194f86d.js"><link rel="prefetch" href="/assets/js/139.bf8c1ca0.js"><link rel="prefetch" href="/assets/js/14.08edf279.js"><link rel="prefetch" href="/assets/js/140.c800f5e0.js"><link rel="prefetch" href="/assets/js/141.47afa8e4.js"><link rel="prefetch" href="/assets/js/142.fda2db61.js"><link rel="prefetch" href="/assets/js/143.0224a2e5.js"><link rel="prefetch" href="/assets/js/144.4126fe8d.js"><link rel="prefetch" href="/assets/js/145.9fe0839a.js"><link rel="prefetch" href="/assets/js/146.89a9e1b2.js"><link rel="prefetch" href="/assets/js/147.56419b8e.js"><link rel="prefetch" href="/assets/js/148.03d2b50f.js"><link rel="prefetch" href="/assets/js/149.c1331b6d.js"><link rel="prefetch" href="/assets/js/15.f198e5b9.js"><link rel="prefetch" href="/assets/js/16.00e51c93.js"><link rel="prefetch" href="/assets/js/17.291d3ebc.js"><link rel="prefetch" href="/assets/js/18.017a098e.js"><link rel="prefetch" href="/assets/js/19.61ae84a4.js"><link rel="prefetch" href="/assets/js/20.2fed9841.js"><link rel="prefetch" href="/assets/js/21.0540e3f5.js"><link rel="prefetch" href="/assets/js/22.65f1eb05.js"><link rel="prefetch" href="/assets/js/23.fd9e2f2e.js"><link rel="prefetch" href="/assets/js/24.199ad75b.js"><link rel="prefetch" href="/assets/js/25.005a23bb.js"><link rel="prefetch" href="/assets/js/26.46587fdd.js"><link rel="prefetch" href="/assets/js/27.eaf61373.js"><link rel="prefetch" href="/assets/js/28.12bcc1aa.js"><link rel="prefetch" href="/assets/js/29.2ee78c15.js"><link rel="prefetch" href="/assets/js/3.aae4de15.js"><link rel="prefetch" href="/assets/js/30.5a13fad2.js"><link rel="prefetch" href="/assets/js/31.d559ae93.js"><link rel="prefetch" href="/assets/js/33.484dfc49.js"><link rel="prefetch" href="/assets/js/34.1a006a06.js"><link rel="prefetch" href="/assets/js/35.12b84d1e.js"><link rel="prefetch" href="/assets/js/36.b2cd4408.js"><link rel="prefetch" href="/assets/js/37.a5859cb8.js"><link rel="prefetch" href="/assets/js/38.96209f1d.js"><link rel="prefetch" href="/assets/js/39.71d70a82.js"><link rel="prefetch" href="/assets/js/4.0e4cf147.js"><link rel="prefetch" href="/assets/js/40.a59b859c.js"><link rel="prefetch" href="/assets/js/41.ebb72a6a.js"><link rel="prefetch" href="/assets/js/42.71f99aa2.js"><link rel="prefetch" href="/assets/js/43.092ff2c9.js"><link rel="prefetch" href="/assets/js/44.d70e216f.js"><link rel="prefetch" href="/assets/js/45.afb733d1.js"><link rel="prefetch" href="/assets/js/46.86c421f9.js"><link rel="prefetch" href="/assets/js/47.6d337ef6.js"><link rel="prefetch" href="/assets/js/48.157e1f1c.js"><link rel="prefetch" href="/assets/js/49.1aed4add.js"><link rel="prefetch" href="/assets/js/5.831f36ca.js"><link rel="prefetch" href="/assets/js/50.b495cbac.js"><link rel="prefetch" href="/assets/js/51.f4a8b763.js"><link rel="prefetch" href="/assets/js/52.beec293d.js"><link rel="prefetch" href="/assets/js/53.2ac4d785.js"><link rel="prefetch" href="/assets/js/54.342112cf.js"><link rel="prefetch" href="/assets/js/55.61e2bfb6.js"><link rel="prefetch" href="/assets/js/56.fa782548.js"><link rel="prefetch" href="/assets/js/57.41bc249e.js"><link rel="prefetch" href="/assets/js/58.c1d5fafb.js"><link rel="prefetch" href="/assets/js/59.4297a34f.js"><link rel="prefetch" href="/assets/js/6.54e4e793.js"><link rel="prefetch" href="/assets/js/60.634948c3.js"><link rel="prefetch" href="/assets/js/61.de4327e7.js"><link rel="prefetch" href="/assets/js/62.c6902476.js"><link rel="prefetch" href="/assets/js/63.737a0e11.js"><link rel="prefetch" href="/assets/js/64.cbe1b041.js"><link rel="prefetch" href="/assets/js/65.2df8f108.js"><link rel="prefetch" href="/assets/js/66.ee7de747.js"><link rel="prefetch" href="/assets/js/67.88edee59.js"><link rel="prefetch" href="/assets/js/68.c29f5efe.js"><link rel="prefetch" href="/assets/js/69.2fedc1f9.js"><link rel="prefetch" href="/assets/js/7.1c00f39e.js"><link rel="prefetch" href="/assets/js/70.0fe4782b.js"><link rel="prefetch" href="/assets/js/71.6c22c273.js"><link rel="prefetch" href="/assets/js/72.1fc7ddbd.js"><link rel="prefetch" href="/assets/js/73.25cb42eb.js"><link rel="prefetch" href="/assets/js/74.e922e1cc.js"><link rel="prefetch" href="/assets/js/75.f48393b6.js"><link rel="prefetch" href="/assets/js/76.72e96818.js"><link rel="prefetch" href="/assets/js/77.3df4edcb.js"><link rel="prefetch" href="/assets/js/78.73c6a652.js"><link rel="prefetch" href="/assets/js/79.22ba589c.js"><link rel="prefetch" href="/assets/js/8.b5f907d4.js"><link rel="prefetch" href="/assets/js/80.2d070db4.js"><link rel="prefetch" href="/assets/js/81.c0bc2539.js"><link rel="prefetch" href="/assets/js/82.4c6a47fa.js"><link rel="prefetch" href="/assets/js/83.a43f597f.js"><link rel="prefetch" href="/assets/js/84.8ce525d0.js"><link rel="prefetch" href="/assets/js/85.6b21aae0.js"><link rel="prefetch" href="/assets/js/86.f6ebabd9.js"><link rel="prefetch" href="/assets/js/87.9acaeb0d.js"><link rel="prefetch" href="/assets/js/88.99cdf592.js"><link rel="prefetch" href="/assets/js/89.58f63450.js"><link rel="prefetch" href="/assets/js/9.053d267f.js"><link rel="prefetch" href="/assets/js/90.1d59f40c.js"><link rel="prefetch" href="/assets/js/91.e8b2a5cd.js"><link rel="prefetch" href="/assets/js/92.b92bba74.js"><link rel="prefetch" href="/assets/js/93.688cad95.js"><link rel="prefetch" href="/assets/js/94.2c11a588.js"><link rel="prefetch" href="/assets/js/95.aa37d1df.js"><link rel="prefetch" href="/assets/js/96.fffa0e6e.js"><link rel="prefetch" href="/assets/js/97.04e9be9f.js"><link rel="prefetch" href="/assets/js/98.2672abca.js"><link rel="prefetch" href="/assets/js/99.c8de1c63.js">
    <link rel="stylesheet" href="/assets/css/0.styles.03260d1f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/EB-logo.png" alt="conanan's blog" class="logo"> <span class="site-name can-hide">conanan's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/pages/4b56bd/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/4b56bd/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/pages/724936/" class="nav-link">Java Web</a></li><li class="dropdown-item"><h4>工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b18d09/" class="nav-link">Maven</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DataBase" class="dropdown-title"><a href="/pages/74cdda/" class="link-title">DataBase</a> <span class="title" style="display:none;">DataBase</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/74cdda/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/pages/4e9f47/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool" class="dropdown-title"><a href="/pages/89d1e7/" class="link-title">Tool</a> <span class="title" style="display:none;">Tool</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/89d1e7/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Vim</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d5fb/" class="nav-link">Docker</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/xugaoyi/image_store/blog/20200103123203.jpg"> <div class="blogger-info"><h3>Evan Xu</h3> <span>前端界的小学生</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/pages/4b56bd/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/4b56bd/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/pages/724936/" class="nav-link">Java Web</a></li><li class="dropdown-item"><h4>工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b18d09/" class="nav-link">Maven</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DataBase" class="dropdown-title"><a href="/pages/74cdda/" class="link-title">DataBase</a> <span class="title" style="display:none;">DataBase</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/74cdda/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/pages/4e9f47/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool" class="dropdown-title"><a href="/pages/89d1e7/" class="link-title">Tool</a> <span class="title" style="display:none;">Tool</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/89d1e7/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Vim</a></li><li class="dropdown-item"><!----> <a href="/pages/2029ba/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d5fb/" class="nav-link">Docker</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Jakarta EE</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/724936/" class="sidebar-link">Servlet</a></li><li><a href="/pages/889cae/" class="sidebar-link">Servlet3</a></li><li><a href="/pages/cf018b/" class="sidebar-link">Filter</a></li><li><a href="/pages/625d5c/" class="sidebar-link">Listener</a></li><li><a href="/pages/f62788/" class="sidebar-link">JSP</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tomcat</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringMVC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringDataJPA</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/pages/927e76/" class="sidebar-link">Test</a></li><li><a href="/pages/2ffe27/" aria-current="page" class="active sidebar-link">Shiro</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/2ffe27/#功能" class="sidebar-link">功能</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#架构" class="sidebar-link">架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/2ffe27/#subject-🔥" class="sidebar-link">Subject 🔥</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#securitymanager-🔥" class="sidebar-link">SecurityManager 🔥</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#realm-🔥" class="sidebar-link">Realm 🔥</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#authenticator" class="sidebar-link">Authenticator</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#authrizer" class="sidebar-link">Authrizer</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#sessionmanager" class="sidebar-link">SessionManager</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#sessiondao" class="sidebar-link">SessionDAO</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#cachemanager" class="sidebar-link">CacheManager</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#cryptography" class="sidebar-link">Cryptography</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#术语" class="sidebar-link">术语</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/2ffe27/#authentication-认证" class="sidebar-link">Authentication—认证</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#authorization-授权" class="sidebar-link">Authorization—授权</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#cipher-加密算法" class="sidebar-link">Cipher—加密算法</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#credential-凭据-🔥" class="sidebar-link">Credential—凭据 🔥</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#cryptography-加密" class="sidebar-link">Cryptography—加密</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#hash-哈希" class="sidebar-link">Hash—哈希</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#permission-权限" class="sidebar-link">Permission—权限</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#principal-主体-🔥" class="sidebar-link">Principal—主体 🔥</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#realm-领域" class="sidebar-link">Realm—领域</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#role-角色" class="sidebar-link">Role—角色</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#session-会话" class="sidebar-link">Session—会话</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#subject" class="sidebar-link">Subject</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#authentication-认证-2" class="sidebar-link">Authentication—认证</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/2ffe27/#认证流程" class="sidebar-link">认证流程</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#authenticator-2" class="sidebar-link">Authenticator</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#authenticationstrategy" class="sidebar-link">AuthenticationStrategy</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#quickstart" class="sidebar-link">QuickStart</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/2ffe27/#引入依赖" class="sidebar-link">引入依赖</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#配置" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#示例" class="sidebar-link">示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#web-应用程序" class="sidebar-link">Web 应用程序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/2ffe27/#引入依赖-2" class="sidebar-link">引入依赖</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#提供-realm-实现" class="sidebar-link">提供 Realm 实现</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#shirofilterchaindefinition" class="sidebar-link">ShiroFilterChainDefinition</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#shiro-注解" class="sidebar-link">Shiro 注解</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#独立应用程序-☠️" class="sidebar-link">独立应用程序—☠️</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/2ffe27/#引入依赖-3" class="sidebar-link">引入依赖</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#自定义-realm-类" class="sidebar-link">自定义 Realm 类</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#过滤器" class="sidebar-link">过滤器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/2ffe27/#anon-🔥" class="sidebar-link">anon 🔥</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#authc-🔥" class="sidebar-link">authc 🔥</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#perms-🔥" class="sidebar-link">perms 🔥</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#roles" class="sidebar-link">roles</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#logout-🔥" class="sidebar-link">logout 🔥</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#rest-🔥" class="sidebar-link">rest 🔥</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#user" class="sidebar-link">user</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#authcbasic-🔥" class="sidebar-link">authcBasic 🔥</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#authcbearer" class="sidebar-link">authcBearer</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#nosessioncreation" class="sidebar-link">noSessionCreation</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#port" class="sidebar-link">port</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#ssl" class="sidebar-link">ssl</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#tag" class="sidebar-link">Tag</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#caching" class="sidebar-link">Caching</a></li><li class="sidebar-sub-header"><a href="/pages/2ffe27/#configuration-properties" class="sidebar-link">Configuration Properties</a></li></ul></li><li><a href="/pages/16f81e/" class="sidebar-link">Thymeleaf</a></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/categories/?category=Java%20Web" title="分类" data-v-1cd794fe>Java Web</a></li> <!----> <!----></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/apple54whn" target="_blank" title="作者" class="beLink" data-v-1cd794fe>conanan</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>1984-01-24</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">
          Shiro
        </h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h1 id="shiro"><a href="#shiro" class="header-anchor">#</a> Shiro</h1> <h2 id="功能"><a href="#功能" class="header-anchor">#</a> 功能</h2> <p><a href="https://shiro.apache.org/index.html" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Apache Shiro是一个功能强大且灵活的开源安全框架，可以干净地处理身份认证，授权，企业会话管理和加密。Apache Shiro的首要目标是易于使用和理解。 安全有时可能非常复杂，甚至会很痛苦，但这不是必须的。 框架应尽可能掩盖复杂性，并公开简洁直观的API，以简化开发人员确保其应用程序安全的工作。Shiro功能如下：</p> <p><img src="/assets/img/ShiroFeatures.7f3d6693.png" alt="img"></p> <p>Primary Concerns</p> <ul><li><strong>认证</strong>：有时称为“登录”，这是证明用户就是他们所说的身份的行为。</li> <li><strong>授权</strong>：访问控制的过程，即确定“谁”有权访问“什么”。</li> <li>会话管理：即使在非Web或EJB应用程序中，也可以管理用户特定的会话。</li> <li>加密：使用密码算法保持数据安全，同时仍然易于使用。</li></ul> <p>Supporting Features</p> <ul><li>网络支持：Shiro的网络支持API可帮助轻松保护网络应用程序。</li> <li>缓存：缓存是Apache Shiro API的一线公民，可确保安全操作保持快速有效。比如用户登录后，其用户信息、拥有的角色/权限不必每次去查，这样可以提高效率；</li> <li>并发性：Apache Shiro的并发功能支持多线程应用程序。即如在一个线程中开启另一个线程，能把权限自动传播过去；</li> <li>测试：测试支持可帮助您编写单元测试和集成测试，并确保您的代码将按预期进行保护。</li> <li>“<strong>Run As</strong>”：允许用户采用其他用户的身份（如果允许）的功能，有时在管理方案中很有用。</li> <li>“<strong>Remember Me</strong>”：记住用户在各个会话中的身份，因此他们只需要在必要时登录即可。</li></ul> <h2 id="架构"><a href="#架构" class="header-anchor">#</a> 架构</h2> <p>Apache Shiro的设计目标是通过直观且易于使用来简化应用程序安全性。Shiro的核心设计模拟了大多数人如何在与某人（或某物）进行交互的情况下如何考虑应用程序安全性。</p> <p>在最高概念层次，Shiro 的架构有3个主要的概念：<code>Subject</code>，<code>SecurityManager</code>和<code>Realms</code>。下图是这些组件如何交互的高级概述，我们将在下面介绍每个概念：</p> <p><img src="/assets/img/ShiroBasicArchitecture.a54b0384.png" alt="img"></p> <h3 id="subject-🔥"><a href="#subject-🔥" class="header-anchor">#</a> Subject 🔥</h3> <p><strong>Subject 本质上是当前执行用户的特定于安全性的“视图”</strong>。 “用户”一词通常表示一个人，而主题可以是一个人，但是它也可以表示第三方服务，守护程序帐户，定时任务或类似的东西，基本上是<strong>当前与该软件交互的任何东西</strong>。<strong>Subject 实例都绑定到（并需要）SecurityManager</strong>。与 Subject 进行交互时，这些交互会转换为与 SecurityManager 的特定 Subject 的交互。</p> <h3 id="securitymanager-🔥"><a href="#securitymanager-🔥" class="header-anchor">#</a> SecurityManager 🔥</h3> <p><strong>SecurityManager 是 Shiro 体系结构的核心</strong>，充当一种伞形对象，协调其内部安全组件，这些组件一起形成一个对象图。但是，一旦为应用程序配置了SecurityManager及其内部对象图，它通常就会被搁置，应用程序开发人员几乎把所有时间都花在Subject API上。稍后我们将详细讨论SecurityManager，但重要的是要认识到，当您与主题交互时，实际上是SecurityManager在幕后执行<strong>所有操作</strong>。</p> <h3 id="realm-🔥"><a href="#realm-🔥" class="header-anchor">#</a> Realm 🔥</h3> <p>领域充当 Shiro 和应用程序安全数据之间的桥梁或连接器。当需要与安全相关的数据(如用户帐户)进行实际交互以执行身份验证(登录)和授权(访问控制)时，Shiro会从为应用程序配置的<strong>一个或多个</strong>领域中查找这些内容。</p> <p>从这个意义上说，Realm 本质上是一个安全特定的 <strong>DAO</strong>：它封装了数据源的连接细节，并根据需要将相关数据提供给Shiro。在配置Shiro时，必须指定至少一个用于身份验证和/或授权的领域。SecurityManager <strong>可以配置多个域，但至少需要一个域</strong>。</p> <p>Shiro 提供了开箱即用的 Realm 来连接许多安全数据源，如LDAP、关系数据库(JDBC)、文本配置源(如INI和属性文件)等等。如果缺省领域不能满足您的需要，您可以插入自己的域实现来表示自定义数据源。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>与其他内部组件一样，<strong>SecurityManager 管理如何使用 Realm 来获取安全数据和身份数据，并将其表示为 Subject 实例</strong>。</p></div> <h3 id="authenticator"><a href="#authenticator" class="header-anchor">#</a> Authenticator</h3> <p>认证器</p> <p>是负责执行和响应用户身份验证(登录)尝试的组件。当用户尝试登录时，验证程序将执行该逻辑。Authenticator知道如何与存储相关用户/帐户信息的一个或多个域进行协调。从这些领域获得的数据用于验证用户的身份，以确保用户确实是他们所说的那个人。</p> <p>身份验证策略</p> <p>如果配置了多个域，AuthenticationStrategy将协调域以确定身份验证尝试成功或失败的条件(例如，如果一个域成功但其他域失败，那么尝试成功吗?)所有领域必须成功吗?只有第一个?)</p> <h3 id="authrizer"><a href="#authrizer" class="header-anchor">#</a> Authrizer</h3> <p>授权器是负责确定应用程序中用户访问控制的组件。它是最终决定用户是否被允许做某事的机制。与Authenticator一样，授权器也知道如何与多个后端数据源协调，以访问角色和权限信息。授权方使用此信息准确地确定是否允许用户执行给定的操作。</p> <h3 id="sessionmanager"><a href="#sessionmanager" class="header-anchor">#</a> SessionManager</h3> <p>SessionManager知道如何创建和管理用户会话生命周期，为所有环境中的用户提供健壮的会话体验。这是安全框架世界中的一个独特特性—Shiro能够在任何环境中本地管理用户会话，即使没有Web/Servlet或EJB容器可用。默认情况下，Shiro将使用现有的会话机制(如Servlet容器)，但如果没有，例如在独立应用程序或非web环境中，它将使用内置的企业会话管理来提供相同的编程体验。SessionDAO的存在是为了允许使用任何数据源来持久化会话。</p> <h3 id="sessiondao"><a href="#sessiondao" class="header-anchor">#</a> SessionDAO</h3> <p>SessionDAO代表SessionManager执行会话持久性(CRUD)操作。这允许将任何数据存储插入到会话管理基础设施。</p> <h3 id="cachemanager"><a href="#cachemanager" class="header-anchor">#</a> CacheManager</h3> <p>CacheManager创建和管理其他Shiro组件使用的缓存实例的生命周期。由于Shiro可以访问许多后端数据源来进行身份验证、授权和会话管理，因此缓存一直是框架中的一个一流架构特性，可以在使用这些数据源时提高性能。任何现代的开源和/或企业缓存产品都可以插入到Shiro中，以提供快速和高效的用户体验。</p> <p>缓存控制器，来管理如用户、角色、权限等的缓存的；因为这些数据基本上很少去改变，放到缓存中后可以提高访问的性能</p> <h3 id="cryptography"><a href="#cryptography" class="header-anchor">#</a> Cryptography</h3> <p>密码学是企业安全框架的自然补充。Shiro的加密包包含易于使用和理解的密码、散列(又名摘要)和不同的编解码器实现的表示形式。这个包中的所有类都经过精心设计，非常易于使用和理解。任何使用过Java的本地加密支持的人都知道，要驯服它是一种具有挑战性的动物。Shiro的crypto api简化了复杂的Java机制，使普通人可以轻松地使用密码术。</p> <h2 id="术语"><a href="#术语" class="header-anchor">#</a> 术语</h2> <h3 id="authentication-认证"><a href="#authentication-认证" class="header-anchor">#</a> Authentication—认证</h3> <p>身份验证是验证主体身份的过程——本质上证明某人确实是他们所说的那个人。当身份验证尝试成功时，应用程序可以相信该主题一定是应用程序所期望的。</p> <h3 id="authorization-授权"><a href="#authorization-授权" class="header-anchor">#</a> Authorization—授权</h3> <p>授权，也称为访问控制，是决定 user / Subject 是否被允许做某事的过程。它通常是通过检查和解释 Subject 的角色和权限(见下面)，然后允许或拒绝访问请求的资源或函数来完成的。</p> <h3 id="cipher-加密算法"><a href="#cipher-加密算法" class="header-anchor">#</a> Cipher—加密算法</h3> <p>加密算法是执行加密或解密的算法。该算法通常依赖于一条名为密钥的信息。而加密是根据密钥而变化的，所以没有密钥的解密是非常困难的。
密码有不同的变体。块密码通常在固定大小的符号块上工作，而流密码则在连续的符号流上工作。对称密码使用相同的密钥进行加密和解密，而非对称密码使用不同的密钥。如果非对称密码中的密钥不能从另一个密钥派生出来，则可以公开共享一个密钥，从而创建公共/私有密钥对。</p> <h3 id="credential-凭据-🔥"><a href="#credential-凭据-🔥" class="header-anchor">#</a> Credential—凭据 🔥</h3> <p><strong>凭据</strong>是验证 user / Subject 身份的一段信息。在验证过程中，一个(或多个) Credential 与 Subject 一起提交，以验证提交 Credential 的 user / Subject 实际上是关联的用户。凭证通常是只有特定 user / Subject 才知道的非常秘密的东西，比如密码、PGP密钥、生物统计属性或类似的机制。
其思想是，对于一个负责人，只有一个人知道正确的 Credential 来与该负责人“配对”。如果当前 user / Subject 提供了与系统中存储的 Credential 相匹配的正确 Credential ，那么系统可以假定并相信当前 user / Subject 就是他们所说的那个人。信任程度随着更安全的凭据类型(例如生物特征签名&gt;密码)的增加而增加。</p> <h3 id="cryptography-加密"><a href="#cryptography-加密" class="header-anchor">#</a> Cryptography—加密</h3> <p>加密是一种实践，通过隐藏信息或将其转换成没有意义的信息，从而避免不希望的访问，这样其他人就无法读取信息。Shiro专注于密码学的两个核心元素：使用公钥或私钥加密数据(如电子邮件)的密码，以及不可逆加密数据(如密码)的散列(又名消息摘要)。</p> <h3 id="hash-哈希"><a href="#hash-哈希" class="header-anchor">#</a> Hash—哈希</h3> <p>哈希函数是输入源(有时称为消息)到经过编码的哈希值(有时称为消息摘要)的单向、不可逆转换。它通常用于密码、数字指纹或具有底层字节数组的数据。</p> <h3 id="permission-权限"><a href="#permission-权限" class="header-anchor">#</a> Permission—权限</h3> <p>权限(至少按照Shiro的解释)是描述应用程序原始功能的语句，仅此而已。权限是安全策略中最低级别的构造。它们只定义应用程序可以做什么。它们没有描述“谁”能够执行这些操作。许可只是一种行为的陈述，仅此而已。</p> <h3 id="principal-主体-🔥"><a href="#principal-主体-🔥" class="header-anchor">#</a> Principal—主体 🔥</h3> <p><strong>Principal 是应用程序 user ( Subject ) 的标识属性</strong>。“标识属性”可以是对您的应用程序有意义的任何内容—用户名、姓氏、给定名称、社会安全号码、用户ID等等。
Shiro还引用了我们称为 Principal 的主要原则的东西。 Principal 是在整个应用程序中唯一标识 Subject 的任何 Principal。理想的Principal 是像 RDBMS 用户表主键那样的用户名或用户ID。在<strong>应用程序中， user ( Subject ) 只有一个主 Principal</strong>。</p> <h3 id="realm-领域"><a href="#realm-领域" class="header-anchor">#</a> Realm—领域</h3> <p>略</p> <h3 id="role-角色"><a href="#role-角色" class="header-anchor">#</a> Role—角色</h3> <p>略</p> <h3 id="session-会话"><a href="#session-会话" class="header-anchor">#</a> Session—会话</h3> <p>Session 是与在一段时间内与软件系统交互的单个 user ( Subject ) 相关联的有状态数据上下文。当主题使用应用程序时，可以从会话中添加/读取/删除数据，而应用程序稍后在需要时可以使用这些数据。会话在用户/主题注销应用程序或由于不活动而超时时终止。
对于那些熟悉HttpSession的人来说，Shiro会话具有相同的用途，只是Shiro会话可以在任何环境中使用，即使没有Servlet容器或EJB容器可用。</p> <h3 id="subject"><a href="#subject" class="header-anchor">#</a> Subject</h3> <p>Subject 只是一个花哨的安全术语，基本上是指应用程序用户的特定于安全的“视图”。但是，Subject并不总是需要反映人——它可以表示调用您的应用程序的外部进程，或者可能表示在一段时间内间歇执行某些操作的守护进程系统帐户(例如cron作业)。它基本上是任何对应用程序进行操作的实体的表示。</p> <h2 id="authentication-认证-2"><a href="#authentication-认证-2" class="header-anchor">#</a> Authentication—认证</h2> <p><img src="/assets/img/ShiroAuthenticationSequence.3471ccc8.png" alt="img"></p> <h3 id="认证流程"><a href="#认证流程" class="header-anchor">#</a> 认证流程</h3> <ol><li>应用程序代码执行 <code>Subject.login</code> 方法，传递构造的 AuthenticationToken 实例，该实例表示最终用户的 principals 和 credentials。</li> <li>Subject 实例，通常是一个 DelegatingSubject（或子类）被应用委托来调用<code>SecurityManager.login(token)</code>，实际的身份验证工作从这里开始。</li> <li>SecurityManager 是一个基本的“伞形”组件，它接收令牌并通过调用<code>Authenticator.authenticate(token)</code>将其简单地委托给它的内部 Authenticator 实例。这几乎总是一个 ModularRealmAuthenticator 实例，它支持在身份验证期间协调一个或多个 Realm 实例。 ModularRealmAuthenticator 本质上为Apache Shiro提供了一个PAM样式的范型(在PAM术语中，每个 Realm 都是一个“模块”)。</li> <li>如果只配置了单个 Realm，则直接调用它——在单个域应用程序中不需要验证策略。</li> <li>如果为应用程序配置了多个 Realm，ModularRealmAuthenticator 实例将利用其配置的 AuthenticationStrategy 发起多域身份验证尝试。在为身份验证调用领域之前、期间和之后，将调用 AuthenticationStrategy 以允许它对每个领域的结果作出反应。我们将很快介绍身份验证策略。</li> <li>每个已配置的 Realm 都将被查询，以查看它是否支持提交的 AuthenticationToken。如果是，将使用提交的令牌调用支持域的<code>getAuthenticationInfo</code>方法。<code>getAuthenticationInfo</code>方法有效地表示该特定 Realm 的单个身份认证尝试。我们稍后将讨论领域身份认证行为。</li></ol> <h3 id="authenticator-2"><a href="#authenticator-2" class="header-anchor">#</a> Authenticator</h3> <p>如前所述，Shiro SecurityManager实现默认使用 ModularRealmAuthenticator 实例。ModularRealmAuthenticator 同样支持具有单个 Realm 的应用程序和具有多个 Realm 的应用程序。</p> <p>在单一 Realm 应用程序中，ModularRealmAuthenticator 将直接调用单一领域。如果配置了两个或多个域，它将使用AuthenticationStrategy实例来协调如何进行尝试。我们将在下面讨论身份验证策略。</p> <p>可以自定义认证器，虽然 ModularRealmAuthenticator 可以适应大部分需求。略</p> <h3 id="authenticationstrategy"><a href="#authenticationstrategy" class="header-anchor">#</a> AuthenticationStrategy</h3> <p>多个 Realm 才会使用，见文档，略</p> <h2 id="quickstart"><a href="#quickstart" class="header-anchor">#</a> QuickStart</h2> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>详细代码查看仓库</p></div> <h3 id="引入依赖"><a href="#引入依赖" class="header-anchor">#</a> 引入依赖</h3> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shiro-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--哔了狗，官网文档给的1.5.2-SNAPSHOT但是并没有存入Maven库里--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h3> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token comment"># -----------------------------------------------------------------------------</span>
<span class="token comment"># Users and their assigned roles</span>
<span class="token comment">#</span>
<span class="token comment"># Each line conforms to the format defined in the</span>
<span class="token comment"># org.apache.shiro.realm.text.TextConfigurationRealm#setUserDefinitions JavaDoc</span>
<span class="token comment"># -----------------------------------------------------------------------------</span>
<span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">users</span><span class="token punctuation">]</span></span>
<span class="token comment"># user 'root' with password 'secret' and the 'admin' role</span>
<span class="token key attr-name">root</span> <span class="token punctuation">=</span> <span class="token value attr-value">secret, admin</span>
<span class="token comment"># user 'guest' with the password 'guest' and the 'guest' role</span>
<span class="token key attr-name">guest</span> <span class="token punctuation">=</span> <span class="token value attr-value">guest, guest</span>
<span class="token comment"># user 'presidentskroob' with password '12345' (&quot;That's the same combination on</span>
<span class="token comment"># my luggage!!!&quot; ;)), and role 'president'</span>
<span class="token key attr-name">presidentskroob</span> <span class="token punctuation">=</span> <span class="token value attr-value">12345, president</span>
<span class="token comment"># user 'darkhelmet' with password 'ludicrousspeed' and roles 'darklord' and 'schwartz'</span>
<span class="token key attr-name">darkhelmet</span> <span class="token punctuation">=</span> <span class="token value attr-value">ludicrousspeed, darklord, schwartz</span>
<span class="token comment"># user 'lonestarr' with password 'vespa' and roles 'goodguy' and 'schwartz'</span>
<span class="token key attr-name">lonestarr</span> <span class="token punctuation">=</span> <span class="token value attr-value">vespa, goodguy, schwartz</span>

<span class="token comment"># -----------------------------------------------------------------------------</span>
<span class="token comment"># Roles with assigned permissions</span>
<span class="token comment"># </span>
<span class="token comment"># Each line conforms to the format defined in the</span>
<span class="token comment"># org.apache.shiro.realm.text.TextConfigurationRealm#setRoleDefinitions JavaDoc</span>
<span class="token comment"># -----------------------------------------------------------------------------</span>
<span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">roles</span><span class="token punctuation">]</span></span>
<span class="token comment"># 'admin' role has all permissions, indicated by the wildcard '*'</span>
<span class="token key attr-name">admin</span> <span class="token punctuation">=</span> <span class="token value attr-value">*</span>
<span class="token comment"># The 'schwartz' role can do anything (*) with any lightsaber:</span>
<span class="token key attr-name">schwartz</span> <span class="token punctuation">=</span> <span class="token value attr-value">lightsaber:*</span>
<span class="token comment"># The 'goodguy' role is allowed to 'drive' (action) the winnebago (type) with</span>
<span class="token comment"># license plate 'eagle5' (instance specific id)</span>
<span class="token key attr-name">goodguy</span> <span class="token punctuation">=</span> <span class="token value attr-value">winnebago:drive:eagle5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/*
   创建配置了Shiro SecurityManager的最简单方法, realms, users, roles 和 permissions 使用了简单的 INI 配置
   官方给的示例中使用 IniSecurityManagerFactory 构造来获取 SecurityManager 的方式已经过时，推荐使用 Shiro 的 Environment 替代
  */</span>
  <span class="token class-name">BasicIniEnvironment</span> basicIniEnvironment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicIniEnvironment</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:shiro.ini&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">SecurityManager</span> securityManager <span class="token operator">=</span> basicIniEnvironment<span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/*
   对于这个简单的快速入门示例，使用SecurityManager可作为JVM单例访问。大多数应用程序不会这样做而是依赖于它们的容器配置或 webapps 的web.xml。
   */</span>
  <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span>securityManager<span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">/*
   获取当前执行的用户（安全领域公认的命名 Subject）
   独立应用程序中的 getSubject() 调用可能基于特定于应用程序位置的用户数据返回 Subject，而在服务器环境(例如web应用程序)中，它基于与当前线程或传入请求相关的用户数据获取 Subject。
   */</span>
  <span class="token class-name">Subject</span> currentUser <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/*
   使用 Session 做一些事情(不需要web或EJB容器!!)
   该 Session 是一个特定于 Shiro 的实例，它提供了常规 HttpSession 所提供的大部分内容，但也提供了一些额外的好处，还有一个很大的区别: 它不需要HTTP环境!
   如果在 web 应用程序中部署，默认情况下会话将基于 HttpSession。但是，在非 web 环境中，比如这个简单的快速入门，Shiro默认情况下会自动使用它的企业会话管理。
   这意味着您可以在任何层的应用程序中使用相同的API，而不管部署环境如何。这打开了一个全新的应用程序世界，因为任何需要会话的应用程序都不需要强制使用HttpSession或EJB有状态会话bean。
   而且，任何客户机技术现在都可以共享会话数据。
   */</span>
  <span class="token class-name">Session</span> session <span class="token operator">=</span> currentUser<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;conanan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;conanan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;获取到正确的值! [&quot;</span> <span class="token operator">+</span> value <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/*
   登录当前用户，可以检查角色和权限
   我们只能对已知用户进行这些检查。上面的 Subject 实例表示当前用户，但是谁是当前用户呢?嗯，他们是匿名的——也就是说，直到他们至少登录一次。让我们这样做:
   */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>currentUser<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">UsernamePasswordToken</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">(</span><span class="token string">&quot;lonestarr&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;vespa&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// token.setRememberMe(true); //也可以在构造中第三个参数添加</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// 登录失败需捕获异常</span>
      currentUser<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownAccountException</span> uae<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;该用户不存在：&quot;</span> <span class="token operator">+</span> token<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IncorrectCredentialsException</span> ice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;账号的密码错误!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">LockedAccountException</span> lae<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;账号&quot;</span> <span class="token operator">+</span> token<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; 已被锁.  &quot;</span> <span class="token operator">+</span>
               <span class="token string">&quot;请联系管理员解锁.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 在这里捕获更多的异常(可能是特定于您的应用程序的自定义异常?)</span>
    <span class="token comment">// 可参考https://shiro.apache.org/static/1.5.1/apidocs/org/apache/shiro/authc/AuthenticationException.html</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticationException</span> ae<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//unexpected condition?  error?</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/*
   用户登陆后可以做如下事情：告诉我们当前用户是谁，输出他的 identifying principal（主要身份，在这个示例中是 username）
   */</span>
  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;用户 [&quot;</span> <span class="token operator">+</span> currentUser<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;] 登陆成功.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/*
   测试是否有这个角色
   */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>currentUser<span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">&quot;schwartz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;May the Schwartz be with you!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, mere mortal.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/*
   我们还可以看到他们是否有权限对某种类型的实体采取行动:
   */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>currentUser<span class="token punctuation">.</span><span class="token function">isPermitted</span><span class="token punctuation">(</span><span class="token string">&quot;lightsaber:wield&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;You may use a lightsaber ring.  Use it wisely.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Sorry, lightsaber rings are for schwartz masters only.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/*
   此外，我们可以执行一个非常强大的实例级权限检查——查看用户是否有能力访问某个类型的特定实例:
   */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>currentUser<span class="token punctuation">.</span><span class="token function">isPermitted</span><span class="token punctuation">(</span><span class="token string">&quot;winnebago:drive:eagle5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;You are permitted to 'drive' the winnebago with license plate (id) 'eagle5'.  &quot;</span> <span class="token operator">+</span> <span class="token string">&quot;Here are the keys - have fun!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Sorry, you aren't allowed to drive the 'eagle5' winnebago!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/*
   退出。删除所有标识信息并使其会话无效。
   因为 remember 标示通常使用cookie表示，定向到登陆页面，设置同名cookie且maxAge为0
   */</span>
  currentUser<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br></div></div><p>执行后的日志</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>a.s.s.m.AbstractValidatingSessionManager : Enabling session validation scheduler...
t.c.s.ShiroQuickstartApplication         : 获取到正确的值! [conanan]
t.c.s.ShiroQuickstartApplication         : 用户 [lonestarr] 登陆成功.
t.c.s.ShiroQuickstartApplication         : May the Schwartz be with you!
t.c.s.ShiroQuickstartApplication         : You may use a lightsaber ring.  Use it wisely.
t.c.s.ShiroQuickstartApplication         : You are permitted to 'drive' the winnebago with license plate (id) 'eagle5'.  Here are the keys - have fun!
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="web-应用程序"><a href="#web-应用程序" class="header-anchor">#</a> Web 应用程序</h2> <div class="custom-block tip"><p class="custom-block-title">文档&amp;博客</p> <p>集成 Shiro 到 SpringBoot 的<a href="https://shiro.apache.org/spring-boot.html" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。还是用谷歌搜出来的，官方文档没找到入口，👴佛了。<a href="https://github.com/apache/shiro" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的 samples 也有详细代码。这篇<a href="https://developer.okta.com/blog/2017/07/13/apache-shiro-spring-boot" target="_blank" rel="noopener noreferrer">博客<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>也不错。</p></div> <p>Shiro 对 Spring web应用程序提供了一流的支持。在 web 应用程序中，所有可访问 Shiro 的 web 请求都必须经过一个<strong>主 Shiro 过滤器</strong>。这个过滤器本身非常强大，允许基于任何 URL 路径表达式执行<strong>自定义过滤器链</strong>。</p> <h3 id="引入依赖-2"><a href="#引入依赖-2" class="header-anchor">#</a> 引入依赖</h3> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shiro-spring-boot-web-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--哔了狗，官网文档给的1.5.2-SNAPSHOT但是并没有存入Maven库里--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>Maven: org.apache.shiro:shiro-cache:1.5.1</li> <li>Maven: org.apache.shiro:shiro-config-core:1.5.1</li> <li>Maven: org.apache.shiro:shiro-config-ogdl:1.5.1</li> <li>Maven: org.apache.shiro:shiro-core:1.5.1</li> <li>Maven: org.apache.shiro:shiro-crypto-cipher:1.5.1</li> <li>Maven: org.apache.shiro:shiro-crypto-core:1.5.1</li> <li>Maven: org.apache.shiro:shiro-crypto-hash:1.5.1</li> <li>Maven: org.apache.shiro:shiro-event:1.5.1</li> <li>Maven: org.apache.shiro:shiro-lang:1.5.1</li> <li>Maven: org.apache.shiro:shiro-spring:1.5.1</li> <li>Maven: org.apache.shiro:shiro-web:1.5.1</li> <li>Maven: org.apache.shiro:shiro-spring-boot-starter:1.5.1</li></ul> <h3 id="提供-realm-实现"><a href="#提供-realm-实现" class="header-anchor">#</a> 提供 Realm 实现</h3> <p><strong>具体Realm实现需要重写一个类，且需将其Bean放入配置类中</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * AuthorizingRealm 继承了顶级抽象类 AuthenticatingRealm（仅用于登陆认证）
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserRealm</span> <span class="token keyword">extends</span> <span class="token class-name">AuthorizingRealm</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 认证
     *
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> authenticationToken<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;认证，详细见认证步骤&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 授权
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principalCollection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;授权&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>如果未定义<code>Realm</code> bean，则默认情况下，<code>ShiroAutoConfiguration</code>将提供<code>IniRealm</code>实现，该实现期望在<code>src/main/resources</code>或<code>src/main/resources/META-INF</code>中找到<code>shiro.ini</code>文件。</p> <h3 id="shirofilterchaindefinition"><a href="#shirofilterchaindefinition" class="header-anchor">#</a> ShiroFilterChainDefinition</h3> <p><strong>可写在一个配置类中</strong></p> <p>它将把任何应用程序特定的路径<strong>映射到给定的过滤器</strong>，以允许<strong>不同的路径不同级别的访问</strong>。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ShiroFilterChainDefinition</span> <span class="token function">shiroFilterChainDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">DefaultShiroFilterChainDefinition</span> chainDefinition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultShiroFilterChainDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token comment">// logged in users with the 'admin' role</span>
    chainDefinition<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/admin/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;authc, roles[admin]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token comment">// logged in users with the 'document:read' permission</span>
    chainDefinition<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/docs/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;authc, perms[document:read]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token comment">// all other paths require a logged in user</span>
    chainDefinition<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;authc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> chainDefinition<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>如果我们不定义一个ShiroFilterChainDefinition bean，那么框架将保护所有路径并将登录URL设置为login.jsp。我们可以通过向application.yml 中添加以下条目来更改这个默认的登录URL和其他默认值</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">shiro</span><span class="token punctuation">:</span>
  <span class="token key atrule">loginUrl</span><span class="token punctuation">:</span> /login.html
  <span class="token key atrule">successUrl</span><span class="token punctuation">:</span> /index.html
  <span class="token key atrule">unauthorizedUrl</span><span class="token punctuation">:</span> /login.html
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="shiro-注解"><a href="#shiro-注解" class="header-anchor">#</a> Shiro 注解</h3> <p>在独立应用程序和 web 应用程序中，可以 Shiro 的注释用于安全检查，替代<code>ShiroFilterChainDefinition</code>，例如，<code>@RequiresRoles</code>、<code>@requirespermission</code>等，这些注释在上述两个启动程序中都是自动启用的。只需注释您的方法以便使用它们。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequiresPermissions</span><span class="token punctuation">(</span><span class="token string">&quot;document:read&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Shiro 注解完全支持在<code>@Controller</code>类中使用</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountInfoController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequiresRoles</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/admin/config&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">adminConfig</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;view&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><code>ShiroFilterChainDefinition</code> bean仍然需要至少一个定义才能工作，二选一：要么配置所有路径为可通过<code>anon</code>过滤器访问，要么配置一个过滤器为允许模式，例如<code>authcBasic[per]</code>。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ShiroFilterChainDefinition</span> <span class="token function">shiroFilterChainDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">DefaultShiroFilterChainDefinition</span> chainDefinition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultShiroFilterChainDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// logged in users with the 'admin' role</span>
    chainDefinition<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/admin/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;authc, roles[admin]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token comment">// logged in users with the 'document:read' permission</span>
    chainDefinition<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/docs/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;authc, perms[document:read]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token comment">// all other paths require a logged in user</span>
    chainDefinition<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;authc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> chainDefinition<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="独立应用程序-☠️"><a href="#独立应用程序-☠️" class="header-anchor">#</a> 独立应用程序—☠️</h2> <h3 id="引入依赖-3"><a href="#引入依赖-3" class="header-anchor">#</a> 引入依赖</h3> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shiro-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--哔了狗，官网文档给的1.5.2-SNAPSHOT但是并没有存入Maven库里--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="自定义-realm-类"><a href="#自定义-realm-类" class="header-anchor">#</a> 自定义 Realm 类</h3> <p>使用<code>shiro-spring-boot-starter</code>剩下的惟一工作就是配置一个Realm</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Realm</span> <span class="token function">realm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>设置Shiro的最简单的方法，这样所有的<code>SecurityUtils.*</code>方法在所有情况下都能工作，就是使<code>SecurityManager</code> bean成为一个静态单例。不要在web应用程序中这样做——请参阅上面的web应用程序部分。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">SecurityManager</span> securityManager<span class="token punctuation">;</span>
  
 <span class="token annotation punctuation">@PostConstruct</span>
 <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initStaticSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span>securityManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>其他自己看文档</p> <h2 id="过滤器"><a href="#过滤器" class="header-anchor">#</a> 过滤器</h2> <p>查看<code>org.apache.shiro.web.filter.mgt.DefaultFilter</code>该枚举</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">DefaultFilter</span> <span class="token punctuation">{</span>

  <span class="token function">anon</span><span class="token punctuation">(</span><span class="token class-name">AnonymousFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">authc</span><span class="token punctuation">(</span><span class="token class-name">FormAuthenticationFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">authcBasic</span><span class="token punctuation">(</span><span class="token class-name">BasicHttpAuthenticationFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">authcBearer</span><span class="token punctuation">(</span><span class="token class-name">BearerHttpAuthenticationFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">logout</span><span class="token punctuation">(</span><span class="token class-name">LogoutFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">noSessionCreation</span><span class="token punctuation">(</span><span class="token class-name">NoSessionCreationFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">perms</span><span class="token punctuation">(</span><span class="token class-name">PermissionsAuthorizationFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">port</span><span class="token punctuation">(</span><span class="token class-name">PortFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">rest</span><span class="token punctuation">(</span><span class="token class-name">HttpMethodPermissionFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">roles</span><span class="token punctuation">(</span><span class="token class-name">RolesAuthorizationFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">ssl</span><span class="token punctuation">(</span><span class="token class-name">SslFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">user</span><span class="token punctuation">(</span><span class="token class-name">UserFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="anon-🔥"><a href="#anon-🔥" class="header-anchor">#</a> anon 🔥</h3> <p><strong>无需执行任何类型的安全性检查即可直接访问路径的筛选器。</strong></p> <p>此过滤器主要在<strong>排除策略</strong>中有用，在该策略中，您已定义了url模式以要求一定的安全级别，但也许该模式中仅URL的子集应允许任何访问。例如，如果您有网站的仅用户部分，则可能需要要求该部分中的任何URL访问都必须来自经过身份验证的用户。</p> <p>这是IniShiroFilter配置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[urls] 
/user/** = authc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>但是，如果您希望<code>/user/signup/**</code>对任何人都可用，则必须排除该路径，因为它是上述IniShiroFilter配置的路径的子集。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>/user/signup/** = anon
/user/** = authc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="authc-🔥"><a href="#authc-🔥" class="header-anchor">#</a> authc 🔥</h3> <p>要求<strong>对请求用户进行身份验证</strong>以使请求继续，如果未通过，则通过将用户重定向到您配置的<code>loginUrl</code>来强制用户登录。</p> <p>此过滤器构造一个UsernamePasswordToken，其中包含在username，password和RememberMe请求参数中找到的值。
然后，它调用Subject.login（usernamePasswordToken），有效地自动执行登录尝试。
请注意，仅当isLoginSubmission（request，response）为true时，才会尝试登录，默认情况下，当请求是针对loginUrl且为POST请求时，才会尝试登录。</p> <p>如果登录失败，则将在AuthenticationKey属性项下将得到的AuthenticationException完全限定的类名设置为请求属性。
该FQCN可用作i18n键或查找机制，以向用户解释其登录尝试失败的原因（例如，无帐户，密码错误等）。</p> <p>如果您希望处理身份验证验证并使用自己的代码登录，请考虑改用PassThruAuthenticationFilter，它允许对loginUrl的请求直接传递到应用程序的代码。</p> <h3 id="perms-🔥"><a href="#perms-🔥" class="header-anchor">#</a> perms 🔥</h3> <p>如果当前用户具有映射值指定的权限，则允许访问的过滤器；如果用户没有指定所有权限，则拒绝访问的过滤器。推荐！</p> <h3 id="roles"><a href="#roles" class="header-anchor">#</a> roles</h3> <p>如果当前用户具有映射值指定的角色，则允许访问的过滤器；如果用户没有指定所有角色，则拒绝访问的过滤器。但不推荐！</p> <h3 id="logout-🔥"><a href="#logout-🔥" class="header-anchor">#</a> logout 🔥</h3> <p>简单过滤器，接收到请求后，将立即注销当前正在执行的 <code>Subject</code>，然后将其重定向到已配置的 <code>redirectUrl</code>。</p> <h3 id="rest-🔥"><a href="#rest-🔥" class="header-anchor">#</a> rest 🔥</h3> <p>一个过滤器，它将HTTP请求的方法（例如GET，POST等）转换为相应的动作（动词），并使用该动词来构造将被检查以确定访问权限的权限。提供此过滤器主要是为了支持REST环境，在该环境中，请求的类型（方法）转换为对一个或多个资源执行的操作。此范例与Shiro的使用权限进行访问控制的概念很好地配合使用，可以轻松地执行权限检查。</p> <p>该过滤器的功能如下：</p> <ol><li>发现传入的HTTP请求的方法（GET，POST，PUT，DELETE等）。</li> <li>该方法被翻译成更“易于应用”的动词，例如“创建”，“编辑”，“删除”等。</li> <li>该动词将附加到当前匹配路径的任何已配置权限。</li> <li>如果当前的Subject被允许执行已解决的操作，则允许请求继续。</li></ol> <p>例如，如果定义了以下过滤器链，“rest”是赋予该类的过滤器实例的名称：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>/user/** = rest[user]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后，对<code>/user/1234</code>的 HTTP GET请求将转换为构造的权限<code>user:read</code>（GET 映射到 read 操作）并执行权限检查<code>Subject.isPermitted(&quot;user:read&quot;)</code>以便允许请求继续。</p> <p>同样，到<code>/user</code>的HTTP POST会转换为构造的权限<code>user:create</code>（POST 映射到 create 操作）并执行权限检查<code>Subject.isPermitted(&quot;user:create&quot;)</code>以便允许请求继续。</p> <p>以下为映射方法：</p> <table><thead><tr><th>HTTP Method</th> <th>Mapped Action</th> <th>Example Permission</th> <th>Runtime Check</th></tr></thead> <tbody><tr><td>head</td> <td>read</td> <td>perm1</td> <td>perm1:read</td></tr> <tr><td>get</td> <td>read</td> <td>perm2</td> <td>perm2:read</td></tr> <tr><td>put</td> <td>update</td> <td>perm3</td> <td>perm3:update</td></tr> <tr><td>post</td> <td>create</td> <td>perm4</td> <td>perm4:create</td></tr> <tr><td>delete</td> <td>delete</td> <td>perm5</td> <td>perm5:delete</td></tr> <tr><td>mkcol</td> <td>create</td> <td>perm6</td> <td>perm6:create</td></tr> <tr><td>options</td> <td>read</td> <td>perm7</td> <td>perm7:read</td></tr> <tr><td>trace</td> <td>read</td> <td>perm8</td> <td>perm8:read</td></tr></tbody></table> <h3 id="user"><a href="#user" class="header-anchor">#</a> user</h3> <p>如果访问者是已知用户（定义为具有已知 principal），则允许访问资源的过滤器。这意味着将允许通过“<strong>记住我</strong>”功能通过身份验证或记住的任何用户访问此过滤器。如果访问者不是已知用户，那么他们将被重定向到 <code>loginUrl</code></p> <h3 id="authcbasic-🔥"><a href="#authcbasic-🔥" class="header-anchor">#</a> authcBasic 🔥</h3> <p>要求对请求用户进行身份验证以使请求继续，否则，要求用户通过特定于HTTP Basic协议的质询登录。成功登录后，允许他们继续访问请求的资源/ URL。</p> <p>此实现是RFC 2617中基本HTTP身份验证规范的“clean room” Java实现。</p> <p>基本身份验证功能如下：</p> <ol><li><p>要求提供需要身份验证的资源。</p></li> <li><p>服务器以401响应状态答复，设置WWW-Authenticate标头，并通知用户输入资源需要认证的页面内容。</p></li> <li><p>从服务器收到此WWW-Authenticate质询后，客户端将采用用户名和密码，并将其设置为以下格式：<code>username:password</code></p></li> <li><p>然后，此令牌以base 64编码。</p></li> <li><p>然后，客户端使用以下 header 发送对同一资源的另一个请求：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Authorization: Basic
Base64_encoded_username_and_password
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol> <p>仅当发出请求的主题未通过身份验证时，才会调用onAccessDenied（ServletRequest，ServletResponse）方法</p> <h3 id="authcbearer"><a href="#authcbearer" class="header-anchor">#</a> authcBearer</h3> <p>要求对请求用户进行身份验证以使请求继续，否则，要求用户通过特定于HTTP Bearer协议的质询登录。
成功登录后，允许他们继续访问请求的资源/ URL。</p> <h3 id="nosessioncreation"><a href="#nosessioncreation" class="header-anchor">#</a> noSessionCreation</h3> <p>一个PathMatchingFilter，它将在请求期间禁止创建新的会话。这是一个有用的过滤器，可以放置在任何过滤器链的前面，这些过滤器链可能会导致REST，SOAP或其他不打算参与会话的服务调用。</p> <p>此筛选器启用以下行为：</p> <ol><li>如果在调用此过滤器时某个Subject还没有Session，则此过滤器将有效地禁用对subject.getSession（）和subject.getSession（true）的所有调用。如果在请求期间调用了任何一个，则将引发异常。</li> <li>但是，如果 Subject 在调用此过滤器之前已经具有关联的会话，要么是因为它是在应用程序的另一部分中创建的，要么是在创建的链中更高的过滤器，则此过滤器无效。</li></ol> <p>最后，对subject.getSession（false）的调用将不受影响，并且在所有情况下都可以在不受到影响的情况下进行调用。</p> <h3 id="port"><a href="#port" class="header-anchor">#</a> port</h3> <p>要求请求位于特定端口上的过滤器，如果没有，则重定向到该端口上的相同URL。</p> <p>示例配置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[filters]
port.port = 80
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>[urls]
/some/path/** = port
# override for just this path:
/another/path/** = port[8080]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="ssl"><a href="#ssl" class="header-anchor">#</a> ssl</h3> <p>要求通过SSL进行请求的过滤器。如果在已配置的服务器端口和<code>request.isSecure()</code>上收到请求，则允许访问。
如果任一条件为假，则过滤器链将不会继续。端口属性默认为443，并且还保证请求方案始终为“ https”（端口80除外，端口80保留了“ http”方案）。</p> <p>示例配置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[urls]
/secure/path/** = ssl
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="tag"><a href="#tag" class="header-anchor">#</a> Tag</h2> <p>参考<a href="https://shiro.apache.org/web.html#Web-JSP%2FGSPTagLibrary" target="_blank" rel="noopener noreferrer">文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，介绍的很详细</p> <h2 id="caching"><a href="#caching" class="header-anchor">#</a> Caching</h2> <p>启用缓存只需提供 <code>CacheManager</code> bean</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">protected</span> <span class="token class-name">CacheManager</span> <span class="token function">cacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MemoryConstrainedCacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="configuration-properties"><a href="#configuration-properties" class="header-anchor">#</a> Configuration Properties</h2> <table><thead><tr><th style="text-align:left;">Key</th> <th style="text-align:left;">Default Value</th> <th style="text-align:left;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;">shiro.enabled</td> <td style="text-align:left;"><code>true</code></td> <td style="text-align:left;">Enables Shiro’s Spring module</td></tr> <tr><td style="text-align:left;">shiro.web.enabled</td> <td style="text-align:left;"><code>true</code></td> <td style="text-align:left;">Enables Shiro’s Spring web module</td></tr> <tr><td style="text-align:left;">shiro.annotations.enabled</td> <td style="text-align:left;"><code>true</code></td> <td style="text-align:left;">Enables Spring support for Shiro’s annotations</td></tr> <tr><td style="text-align:left;">shiro.sessionManager.deleteInvalidSessions</td> <td style="text-align:left;"><code>true</code></td> <td style="text-align:left;">Remove invalid session from session storage</td></tr> <tr><td style="text-align:left;">shiro.sessionManager.sessionIdCookieEnabled</td> <td style="text-align:left;"><code>true</code></td> <td style="text-align:left;">Enable session ID to cookie, for session tracking</td></tr> <tr><td style="text-align:left;">shiro.sessionManager.sessionIdUrlRewritingEnabled</td> <td style="text-align:left;"><code>true</code></td> <td style="text-align:left;">Enable session URL rewriting support</td></tr> <tr><td style="text-align:left;">shiro.userNativeSessionManager</td> <td style="text-align:left;"><code>false</code></td> <td style="text-align:left;">If enabled Shiro will manage the HTTP sessions instead of the container</td></tr> <tr><td style="text-align:left;">shiro.sessionManager.cookie.name</td> <td style="text-align:left;"><code>JSESSIONID</code></td> <td style="text-align:left;">Session cookie name</td></tr> <tr><td style="text-align:left;"><strong>shiro.sessionManager.cookie.maxAge</strong></td> <td style="text-align:left;"><code>-1</code></td> <td style="text-align:left;">Session cookie max age</td></tr> <tr><td style="text-align:left;"><strong>shiro.sessionManager.cookie.domain</strong></td> <td style="text-align:left;">null</td> <td style="text-align:left;">Session cookie domain</td></tr> <tr><td style="text-align:left;"><strong>shiro.sessionManager.cookie.path</strong></td> <td style="text-align:left;">null</td> <td style="text-align:left;">Session cookie path</td></tr> <tr><td style="text-align:left;">shiro.sessionManager.cookie.secure</td> <td style="text-align:left;"><code>false</code></td> <td style="text-align:left;">Session cookie secure flag</td></tr> <tr><td style="text-align:left;"><strong>shiro.rememberMeManager.cookie.name</strong></td> <td style="text-align:left;"><code>rememberMe</code></td> <td style="text-align:left;">RememberMe cookie name</td></tr> <tr><td style="text-align:left;"><strong>shiro.rememberMeManager.cookie.maxAge</strong></td> <td style="text-align:left;">one year</td> <td style="text-align:left;">RememberMe cookie max age</td></tr> <tr><td style="text-align:left;"><strong>shiro.rememberMeManager.cookie.domain</strong></td> <td style="text-align:left;">null</td> <td style="text-align:left;">RememberMe cookie domain</td></tr> <tr><td style="text-align:left;"><strong>shiro.rememberMeManager.cookie.path</strong></td> <td style="text-align:left;">null</td> <td style="text-align:left;">RememberMe cookie path</td></tr> <tr><td style="text-align:left;"><strong>shiro.rememberMeManager.cookie.secure</strong></td> <td style="text-align:left;"><code>false</code></td> <td style="text-align:left;">RememberMe cookie secure flag</td></tr> <tr><td style="text-align:left;"><strong>shiro.loginUrl</strong></td> <td style="text-align:left;"><code>/login.jsp</code></td> <td style="text-align:left;">Login URL used when unauthenticated users are redirected to login page</td></tr> <tr><td style="text-align:left;"><strong>shiro.successUrl</strong></td> <td style="text-align:left;"><code>/</code></td> <td style="text-align:left;">Default landing page after a user logs in (if alternative cannot be found in the current session)</td></tr> <tr><td style="text-align:left;"><strong>shiro.unauthorizedUrl</strong></td> <td style="text-align:left;">null</td> <td style="text-align:left;">Page to redirect user to if they are unauthorized (403 page)</td></tr></tbody></table></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/master/docs/200.Java Web/900.Shiro.md" target="_blank" rel="noopener noreferrer">编辑</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/06/21, 15:45:42</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/927e76/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Test</div></a> <a href="/pages/16f81e/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Thymeleaf</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/927e76/" class="prev">Test</a></span> <span class="next"><a href="/pages/16f81e/">Thymeleaf</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/7fcc72/"><div>线程生命周期</div></a> <span>07-06</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/a4ef99/"><div>线程安全理论</div></a> <span>06-24</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/890a0b/"><div>并发简史</div></a> <span>06-24</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:894072666@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/xugaoyi" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2021
    <span>Evan Xu | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">×</i> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.ac5e3ef4.js" defer></script><script src="/assets/js/2.d960b235.js" defer></script><script src="/assets/js/32.d5a38545.js" defer></script>
  </body>
</html>